
% Default to the notebook output style

    


% Inherit from the specified cell style.




    
\documentclass[11pt]{article}

    
    
    \usepackage[T1]{fontenc}
    % Nicer default font (+ math font) than Computer Modern for most use cases
    \usepackage{mathpazo}

    % Basic figure setup, for now with no caption control since it's done
    % automatically by Pandoc (which extracts ![](path) syntax from Markdown).
    \usepackage{graphicx}
    % We will generate all images so they have a width \maxwidth. This means
    % that they will get their normal width if they fit onto the page, but
    % are scaled down if they would overflow the margins.
    \makeatletter
    \def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth
    \else\Gin@nat@width\fi}
    \makeatother
    \let\Oldincludegraphics\includegraphics
    % Set max figure width to be 80% of text width, for now hardcoded.
    \renewcommand{\includegraphics}[1]{\Oldincludegraphics[width=.8\maxwidth]{#1}}
    % Ensure that by default, figures have no caption (until we provide a
    % proper Figure object with a Caption API and a way to capture that
    % in the conversion process - todo).
    \usepackage{caption}
    \DeclareCaptionLabelFormat{nolabel}{}
    \captionsetup{labelformat=nolabel}

    \usepackage{adjustbox} % Used to constrain images to a maximum size 
    \usepackage{xcolor} % Allow colors to be defined
    \usepackage{enumerate} % Needed for markdown enumerations to work
    \usepackage{geometry} % Used to adjust the document margins
    \usepackage{amsmath} % Equations
    \usepackage{amssymb} % Equations
    \usepackage{textcomp} % defines textquotesingle
    % Hack from http://tex.stackexchange.com/a/47451/13684:
    \AtBeginDocument{%
        \def\PYZsq{\textquotesingle}% Upright quotes in Pygmentized code
    }
    \usepackage{upquote} % Upright quotes for verbatim code
    \usepackage{eurosym} % defines \euro
    \usepackage[mathletters]{ucs} % Extended unicode (utf-8) support
    \usepackage[utf8x]{inputenc} % Allow utf-8 characters in the tex document
    \usepackage{fancyvrb} % verbatim replacement that allows latex
    \usepackage{grffile} % extends the file name processing of package graphics 
                         % to support a larger range 
    % The hyperref package gives us a pdf with properly built
    % internal navigation ('pdf bookmarks' for the table of contents,
    % internal cross-reference links, web links for URLs, etc.)
    \usepackage{hyperref}
    \usepackage{longtable} % longtable support required by pandoc >1.10
    \usepackage{booktabs}  % table support for pandoc > 1.12.2
    \usepackage[inline]{enumitem} % IRkernel/repr support (it uses the enumerate* environment)
    \usepackage[normalem]{ulem} % ulem is needed to support strikethroughs (\sout)
                                % normalem makes italics be italics, not underlines
    

    
    
    % Colors for the hyperref package
    \definecolor{urlcolor}{rgb}{0,.145,.698}
    \definecolor{linkcolor}{rgb}{.71,0.21,0.01}
    \definecolor{citecolor}{rgb}{.12,.54,.11}

    % ANSI colors
    \definecolor{ansi-black}{HTML}{3E424D}
    \definecolor{ansi-black-intense}{HTML}{282C36}
    \definecolor{ansi-red}{HTML}{E75C58}
    \definecolor{ansi-red-intense}{HTML}{B22B31}
    \definecolor{ansi-green}{HTML}{00A250}
    \definecolor{ansi-green-intense}{HTML}{007427}
    \definecolor{ansi-yellow}{HTML}{DDB62B}
    \definecolor{ansi-yellow-intense}{HTML}{B27D12}
    \definecolor{ansi-blue}{HTML}{208FFB}
    \definecolor{ansi-blue-intense}{HTML}{0065CA}
    \definecolor{ansi-magenta}{HTML}{D160C4}
    \definecolor{ansi-magenta-intense}{HTML}{A03196}
    \definecolor{ansi-cyan}{HTML}{60C6C8}
    \definecolor{ansi-cyan-intense}{HTML}{258F8F}
    \definecolor{ansi-white}{HTML}{C5C1B4}
    \definecolor{ansi-white-intense}{HTML}{A1A6B2}

    % commands and environments needed by pandoc snippets
    % extracted from the output of `pandoc -s`
    \providecommand{\tightlist}{%
      \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
    \DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
    % Add ',fontsize=\small' for more characters per line
    \newenvironment{Shaded}{}{}
    \newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{\textbf{{#1}}}}
    \newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.56,0.13,0.00}{{#1}}}
    \newcommand{\DecValTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\FloatTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\CharTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\StringTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\CommentTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textit{{#1}}}}
    \newcommand{\OtherTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{{#1}}}
    \newcommand{\AlertTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{{#1}}}}
    \newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.02,0.16,0.49}{{#1}}}
    \newcommand{\RegionMarkerTok}[1]{{#1}}
    \newcommand{\ErrorTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{{#1}}}}
    \newcommand{\NormalTok}[1]{{#1}}
    
    % Additional commands for more recent versions of Pandoc
    \newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.53,0.00,0.00}{{#1}}}
    \newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.73,0.40,0.53}{{#1}}}
    \newcommand{\ImportTok}[1]{{#1}}
    \newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.73,0.13,0.13}{\textit{{#1}}}}
    \newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\VariableTok}[1]{\textcolor[rgb]{0.10,0.09,0.49}{{#1}}}
    \newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{\textbf{{#1}}}}
    \newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.40,0.40,0.40}{{#1}}}
    \newcommand{\BuiltInTok}[1]{{#1}}
    \newcommand{\ExtensionTok}[1]{{#1}}
    \newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.74,0.48,0.00}{{#1}}}
    \newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.49,0.56,0.16}{{#1}}}
    \newcommand{\InformationTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\WarningTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    
    
    % Define a nice break command that doesn't care if a line doesn't already
    % exist.
    \def\br{\hspace*{\fill} \\* }
    % Math Jax compatability definitions
    \def\gt{>}
    \def\lt{<}
    % Document parameters
    \title{TCA\_gene\_overlap\_check}
    
    
    

    % Pygments definitions
    
\makeatletter
\def\PY@reset{\let\PY@it=\relax \let\PY@bf=\relax%
    \let\PY@ul=\relax \let\PY@tc=\relax%
    \let\PY@bc=\relax \let\PY@ff=\relax}
\def\PY@tok#1{\csname PY@tok@#1\endcsname}
\def\PY@toks#1+{\ifx\relax#1\empty\else%
    \PY@tok{#1}\expandafter\PY@toks\fi}
\def\PY@do#1{\PY@bc{\PY@tc{\PY@ul{%
    \PY@it{\PY@bf{\PY@ff{#1}}}}}}}
\def\PY#1#2{\PY@reset\PY@toks#1+\relax+\PY@do{#2}}

\expandafter\def\csname PY@tok@w\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.73,0.73}{##1}}}
\expandafter\def\csname PY@tok@c\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@cp\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.74,0.48,0.00}{##1}}}
\expandafter\def\csname PY@tok@k\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@kp\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@kt\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.69,0.00,0.25}{##1}}}
\expandafter\def\csname PY@tok@o\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@ow\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.67,0.13,1.00}{##1}}}
\expandafter\def\csname PY@tok@nb\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@nf\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\expandafter\def\csname PY@tok@nc\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\expandafter\def\csname PY@tok@nn\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\expandafter\def\csname PY@tok@ne\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.82,0.25,0.23}{##1}}}
\expandafter\def\csname PY@tok@nv\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@no\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.53,0.00,0.00}{##1}}}
\expandafter\def\csname PY@tok@nl\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.63,0.63,0.00}{##1}}}
\expandafter\def\csname PY@tok@ni\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.60,0.60,0.60}{##1}}}
\expandafter\def\csname PY@tok@na\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.49,0.56,0.16}{##1}}}
\expandafter\def\csname PY@tok@nt\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@nd\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.67,0.13,1.00}{##1}}}
\expandafter\def\csname PY@tok@s\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@sd\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@si\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.73,0.40,0.53}{##1}}}
\expandafter\def\csname PY@tok@se\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.73,0.40,0.13}{##1}}}
\expandafter\def\csname PY@tok@sr\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.40,0.53}{##1}}}
\expandafter\def\csname PY@tok@ss\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@sx\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@m\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@gh\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,0.50}{##1}}}
\expandafter\def\csname PY@tok@gu\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.50,0.00,0.50}{##1}}}
\expandafter\def\csname PY@tok@gd\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.63,0.00,0.00}{##1}}}
\expandafter\def\csname PY@tok@gi\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.63,0.00}{##1}}}
\expandafter\def\csname PY@tok@gr\endcsname{\def\PY@tc##1{\textcolor[rgb]{1.00,0.00,0.00}{##1}}}
\expandafter\def\csname PY@tok@ge\endcsname{\let\PY@it=\textit}
\expandafter\def\csname PY@tok@gs\endcsname{\let\PY@bf=\textbf}
\expandafter\def\csname PY@tok@gp\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,0.50}{##1}}}
\expandafter\def\csname PY@tok@go\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.53,0.53,0.53}{##1}}}
\expandafter\def\csname PY@tok@gt\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.27,0.87}{##1}}}
\expandafter\def\csname PY@tok@err\endcsname{\def\PY@bc##1{\setlength{\fboxsep}{0pt}\fcolorbox[rgb]{1.00,0.00,0.00}{1,1,1}{\strut ##1}}}
\expandafter\def\csname PY@tok@kc\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@kd\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@kn\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@kr\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@bp\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@fm\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\expandafter\def\csname PY@tok@vc\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@vg\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@vi\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@vm\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@sa\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@sb\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@sc\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@dl\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@s2\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@sh\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@s1\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@mb\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@mf\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@mh\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@mi\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@il\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@mo\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@ch\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@cm\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@cpf\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@c1\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@cs\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}

\def\PYZbs{\char`\\}
\def\PYZus{\char`\_}
\def\PYZob{\char`\{}
\def\PYZcb{\char`\}}
\def\PYZca{\char`\^}
\def\PYZam{\char`\&}
\def\PYZlt{\char`\<}
\def\PYZgt{\char`\>}
\def\PYZsh{\char`\#}
\def\PYZpc{\char`\%}
\def\PYZdl{\char`\$}
\def\PYZhy{\char`\-}
\def\PYZsq{\char`\'}
\def\PYZdq{\char`\"}
\def\PYZti{\char`\~}
% for compatibility with earlier versions
\def\PYZat{@}
\def\PYZlb{[}
\def\PYZrb{]}
\makeatother


    % Exact colors from NB
    \definecolor{incolor}{rgb}{0.0, 0.0, 0.5}
    \definecolor{outcolor}{rgb}{0.545, 0.0, 0.0}



    
    % Prevent overflowing lines due to hard-to-break entities
    \sloppy 
    % Setup hyperref package
    \hypersetup{
      breaklinks=true,  % so long urls are correctly broken across lines
      colorlinks=true,
      urlcolor=urlcolor,
      linkcolor=linkcolor,
      citecolor=citecolor,
      }
    % Slightly bigger margins than the latex defaults
    
    \geometry{verbose,tmargin=1in,bmargin=1in,lmargin=1in,rmargin=1in}
    
    

    \begin{document}
    
    
    \maketitle
    
    

    
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}1}]:} \PY{k+kn}{library}\PY{p}{(}glmnet\PY{p}{)}
        \PY{k+kn}{library}\PY{p}{(}matrixStats\PY{p}{)}
        \PY{k+kn}{library}\PY{p}{(}abind\PY{p}{)}
        \PY{k+kn}{library}\PY{p}{(}pracma\PY{p}{)}
        \PY{k+kn}{library}\PY{p}{(}matrixcalc\PY{p}{)}
        \PY{k+kn}{library}\PY{p}{(}TCA\PY{p}{)}
        \PY{k+kn}{library}\PY{p}{(}MCMCpack\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
Loading required package: Matrix
Loading required package: foreach
Loaded glmnet 2.0-18


Attaching package: ‘pracma’

The following objects are masked from ‘package:Matrix’:

    expm, lu, tril, triu

Loading required package: coda
Loading required package: MASS
\#\#
\#\# Markov Chain Monte Carlo Package (MCMCpack)
\#\# Copyright (C) 2003-2019 Andrew D. Martin, Kevin M. Quinn, and Jong Hee Park
\#\#
\#\# Support provided by the U.S. National Science Foundation
\#\# (Grants SES-0350646 and SES-0350613)
\#\#

Attaching package: ‘MCMCpack’

The following object is masked from ‘package:matrixcalc’:

    vech

The following object is masked from ‘package:pracma’:

    procrustes


    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}157}]:} generate\PYZus{}params \PY{o}{\PYZlt{}\PYZhy{}} \PY{k+kr}{function}\PY{p}{(}cont\PYZus{}her\PY{o}{=}\PY{k+kc}{TRUE}\PY{p}{,}seed\PY{o}{=}\PY{l+m}{1}\PY{p}{)}\PY{p}{\PYZob{}}
              \PY{k+kp}{set.seed}\PY{p}{(}\PY{l+m}{1}\PY{p}{)}
              M \PY{o}{=} \PY{l+m}{50}
              K \PY{o}{=} \PY{l+m}{4}
              N \PY{o}{=} \PY{l+m}{5000}
              pc\PYZus{}num \PY{o}{=} \PY{l+m}{2}
              \PY{c+c1}{\PYZsh{} cis\PYZus{}snps\PYZus{}nums = floor(runif(M, min = 150, max = 400))}
              D \PY{o}{=} \PY{l+m}{250}
              cis\PYZus{}snps\PYZus{}nums \PY{o}{=} \PY{k+kt}{array}\PY{p}{(}D\PY{p}{,}M\PY{p}{)}
              sigma\PYZus{}g \PY{o}{=} \PY{l+m}{0.01}
              sigma\PYZus{}z \PY{o}{=} \PY{l+m}{0.2}
              
              \PY{k+kr}{if}\PY{p}{(}cont\PYZus{}her\PY{p}{)}\PY{p}{\PYZob{}} \PY{c+c1}{\PYZsh{} varing heribility across genes}
                  heritibility\PYZus{}cell\PYZus{}specific \PY{o}{=} \PY{k+kp}{do.call}\PY{p}{(}\PY{k+kp}{rbind}\PY{p}{,}\PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}K\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} \PY{k+kp}{seq}\PY{p}{(}from \PY{o}{=} \PY{l+m}{0.1}\PY{p}{,}to \PY{o}{=} \PY{l+m}{0.9}\PY{p}{,}length.out\PY{o}{=}M\PY{p}{)}\PY{p}{)}\PY{p}{)}
                  heritibility\PYZus{}bulk \PY{o}{=} \PY{k+kt}{array}\PY{p}{(}\PY{l+m}{0.8}\PY{p}{,}M\PY{p}{)}
                  overlap \PY{o}{=} \PY{k+kt}{array}\PY{p}{(}\PY{l+m}{0.4}\PY{p}{,}M\PY{p}{)}
                  pslab \PY{o}{=} \PY{k+kt}{matrix}\PY{p}{(}\PY{l+m}{0.5}\PY{p}{,}nrow\PY{o}{=}M\PY{p}{,}ncol\PY{o}{=}K\PY{p}{)}
              \PY{p}{\PYZcb{}}\PY{k+kp}{else}\PY{p}{\PYZob{}} \PY{c+c1}{\PYZsh{} varying overlap with the same heribility}
                  heritibility\PYZus{}cell\PYZus{}specific \PY{o}{=} \PY{k+kt}{matrix}\PY{p}{(}\PY{l+m}{0.5}\PY{p}{,}nrow\PY{o}{=}K\PY{p}{,}ncol\PY{o}{=}M\PY{p}{)}
                  heritibility\PYZus{}bulk \PY{o}{=} \PY{k+kt}{array}\PY{p}{(}\PY{l+m}{0.8}\PY{p}{,}M\PY{p}{)}
                  overlap \PY{o}{=} \PY{k+kp}{seq}\PY{p}{(}from\PY{o}{=}\PY{l+m}{0.1}\PY{p}{,}to\PY{o}{=}\PY{l+m}{0.5}\PY{p}{,}length.out\PY{o}{=}M\PY{p}{)}
                  pslab \PY{o}{=} \PY{k+kt}{matrix}\PY{p}{(}\PY{l+m}{0.5}\PY{p}{,}nrow\PY{o}{=}M\PY{p}{,}ncol\PY{o}{=}K\PY{p}{)}
              \PY{p}{\PYZcb{}}
              MAF \PY{o}{=} \PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}\PY{k+kp}{length}\PY{p}{(}cis\PYZus{}snps\PYZus{}nums\PY{p}{)}\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} runif\PY{p}{(}cis\PYZus{}snps\PYZus{}nums\PY{p}{[}x\PY{p}{]}\PY{p}{,}min\PY{o}{=}\PY{l+m}{0.1}\PY{p}{,}max\PY{o}{=}\PY{l+m}{0.5}\PY{p}{)}\PY{p}{)}
              id\PYZus{}name \PY{o}{=} \PY{k+kp}{sapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}N\PY{p}{,} \PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} \PY{k+kp}{paste}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{SAMPLE\PYZsq{}}\PY{p}{,}\PY{k+kp}{toString}\PY{p}{(}x\PY{p}{)}\PY{p}{,}sep \PY{o}{=} \PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZsq{}}\PY{p}{)}\PY{p}{)}
              cell\PYZus{}type\PYZus{}name\PY{o}{=}\PY{k+kp}{sapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}K\PY{p}{,} \PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} \PY{k+kp}{paste}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{Cell\PYZus{}type\PYZsq{}}\PY{p}{,}x\PY{p}{,}sep \PY{o}{=} \PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZsq{}}\PY{p}{)}\PY{p}{)}
              
              \PY{c+c1}{\PYZsh{}\PYZsh{}\PYZsh{} generate C1 and C2}
              male \PY{o}{=} \PY{k+kt}{matrix}\PY{p}{(}rbinom\PY{p}{(}N\PY{p}{,} \PY{l+m}{1}\PY{p}{,} \PY{l+m}{0.5}\PY{p}{)}\PY{p}{,}nrow\PY{o}{=}N\PY{p}{)}
              smoking \PY{o}{=} \PY{k+kt}{matrix}\PY{p}{(}rbinom\PY{p}{(}N\PY{p}{,} \PY{l+m}{2}\PY{p}{,} \PY{l+m}{0.2}\PY{p}{)}\PY{p}{,}nrow\PY{o}{=}N\PY{p}{)}
              smoking \PY{o}{=} \PY{p}{(}smoking \PY{o}{\PYZhy{}} \PY{k+kp}{min}\PY{p}{(}smoking\PY{p}{)}\PY{p}{)}\PY{o}{/}\PY{p}{(}\PY{k+kp}{max}\PY{p}{(}smoking\PY{p}{)}\PY{p}{)}
              age \PY{o}{=} \PY{k+kt}{matrix}\PY{p}{(}\PY{k+kp}{sapply}\PY{p}{(}\PY{k+kp}{sapply}\PY{p}{(}rnorm\PY{p}{(}N\PY{p}{,}\PY{l+m}{50}\PY{p}{,}\PY{l+m}{20}\PY{p}{)}\PY{p}{,} \PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} \PY{k+kp}{floor}\PY{p}{(}x\PY{p}{)}\PY{p}{)}\PY{p}{,} \PY{k+kr}{function}\PY{p}{(}x\PY{p}{)}  \PY{k+kr}{if} \PY{p}{(}x\PY{o}{\PYZlt{}}\PY{l+m}{0}\PY{p}{)}\PY{p}{\PYZob{}}x\PY{o}{=}\PY{l+m}{20}\PY{p}{\PYZcb{}} \PY{k+kp}{else}\PY{p}{\PYZob{}}x\PY{o}{=}x\PY{p}{\PYZcb{}}\PY{p}{)}\PY{p}{,}nrow\PY{o}{=}N\PY{p}{)} 
              age \PY{o}{=} \PY{p}{(}age\PY{o}{\PYZhy{}}\PY{k+kp}{min}\PY{p}{(}age\PY{p}{)}\PY{p}{)}\PY{o}{/}\PY{p}{(}\PY{k+kp}{max}\PY{p}{(}age\PY{p}{)}\PY{o}{\PYZhy{}}\PY{k+kp}{min}\PY{p}{(}age\PY{p}{)}\PY{p}{)}
              c1 \PY{o}{=} \PY{k+kp}{scale}\PY{p}{(}\PY{k+kp}{cbind}\PY{p}{(}male\PY{p}{,} smoking\PY{p}{,} age\PY{p}{)}\PY{p}{)}
              c2 \PY{o}{=} \PY{k+kp}{scale}\PY{p}{(}\PY{k+kt}{matrix}\PY{p}{(}rnorm\PY{p}{(}N\PY{o}{*}pc\PYZus{}num\PY{p}{)}\PY{p}{,} nrow\PY{o}{=}N\PY{p}{)}\PY{p}{)}
                                      
              \PY{k+kp}{rownames}\PY{p}{(}c1\PY{p}{)} \PY{o}{=} id\PYZus{}name
              \PY{k+kp}{colnames}\PY{p}{(}c1\PY{p}{)} \PY{o}{=} \PY{k+kt}{c}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{male\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{smoking\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{age\PYZsq{}}\PY{p}{)}
              \PY{k+kp}{rownames}\PY{p}{(}c2\PY{p}{)} \PY{o}{=} id\PYZus{}name
              \PY{k+kp}{colnames}\PY{p}{(}c2\PY{p}{)} \PY{o}{=} \PY{k+kp}{sapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}pc\PYZus{}num\PY{p}{,} \PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} \PY{k+kp}{paste}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{PC\PYZsq{}}\PY{p}{,}\PY{k+kp}{toString}\PY{p}{(}x\PY{p}{)}\PY{p}{,}sep \PY{o}{=} \PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZsq{}}\PY{p}{)}\PY{p}{)}
              
              \PY{c+c1}{\PYZsh{} cell type proportion, from the real data estimated}
              W\PYZus{}alpha \PY{o}{=} \PY{k+kt}{c}\PY{p}{(}\PY{l+m}{26.553683792256}\PY{p}{,}\PY{l+m}{17.6621467979005}\PY{p}{,}\PY{l+m}{4.48671525658667}\PY{p}{,}\PY{l+m}{1.56874856517803}\PY{p}{,}\PY{l+m}{0.178797663350679}\PY{p}{)}
              W\PYZus{}alpha \PY{o}{=} \PY{l+m}{50.4500920752719}
              W\PYZus{}xsi \PY{o}{=} \PY{k+kt}{c}\PY{p}{(}\PY{l+m}{0.526335685426257}\PY{p}{,}\PY{l+m}{0.350091468050216}\PY{p}{,}\PY{l+m}{0.088933737720289}\PY{p}{,}\PY{l+m}{0.0310950585152043}\PY{p}{,}\PY{l+m}{0.00354405028803339}\PY{p}{)}
              \PY{k+kr}{if}\PY{p}{(}K \PY{o}{\PYZlt{}=} \PY{k+kp}{length}\PY{p}{(}W\PYZus{}alpha\PY{p}{)}\PY{p}{)}\PY{p}{\PYZob{}}
                  W \PY{o}{=} rdirichlet\PY{p}{(}N\PY{p}{,} W\PYZus{}alpha\PY{p}{[}\PY{l+m}{1}\PY{o}{:}K\PY{p}{]}\PY{p}{)}
              \PY{p}{\PYZcb{}}\PY{k+kp}{else}\PY{p}{\PYZob{}} \PY{c+c1}{\PYZsh{}more cell type prop}
                  W \PY{o}{=} rdirichlet\PY{p}{(}N\PY{p}{,} runif\PY{p}{(}K\PY{p}{,} \PY{l+m}{0}\PY{p}{,} \PY{l+m}{1}\PY{p}{)}\PY{p}{)}
              \PY{p}{\PYZcb{}}
              \PY{k+kp}{colnames}\PY{p}{(}W\PY{p}{)} \PY{o}{=} cell\PYZus{}type\PYZus{}name
              \PY{k+kp}{rownames}\PY{p}{(}W\PY{p}{)} \PY{o}{=} id\PYZus{}name
              
              \PY{k+kr}{return}\PY{p}{(}\PY{k+kt}{list}\PY{p}{(}
                  \PY{l+s}{\PYZsq{}}\PY{l+s}{M\PYZsq{}}\PY{o}{=}M\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{K\PYZsq{}}\PY{o}{=}K\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{N\PYZsq{}}\PY{o}{=}N\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{pc\PYZus{}num\PYZsq{}}\PY{o}{=}pc\PYZus{}num\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{D\PYZsq{}}\PY{o}{=}D\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{id\PYZus{}name\PYZsq{}}\PY{o}{=}id\PYZus{}name\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{cell\PYZus{}name\PYZsq{}}\PY{o}{=}cell\PYZus{}type\PYZus{}name\PY{p}{,}
                  \PY{l+s}{\PYZsq{}}\PY{l+s}{her\PYZsq{}}\PY{o}{=}heritibility\PYZus{}cell\PYZus{}specific\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{her\PYZus{}bulk\PYZsq{}}\PY{o}{=}heritibility\PYZus{}bulk\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{overlap\PYZsq{}}\PY{o}{=}overlap\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{pslab\PYZsq{}}\PY{o}{=}pslab\PY{p}{,}
                  \PY{l+s}{\PYZsq{}}\PY{l+s}{MAF\PYZsq{}}\PY{o}{=}MAF\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{c1\PYZsq{}}\PY{o}{=}c1\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{c2\PYZsq{}}\PY{o}{=}c2\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{W\PYZsq{}}\PY{o}{=}W\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{sigma\PYZus{}g\PYZsq{}}\PY{o}{=}sigma\PYZus{}g\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{sigma\PYZus{}z\PYZsq{}}\PY{o}{=}sigma\PYZus{}z\PY{p}{)}\PY{p}{)}
          \PY{p}{\PYZcb{}}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}158}]:} one\PYZus{}gene \PY{o}{\PYZlt{}\PYZhy{}} \PY{k+kr}{function}\PY{p}{(}par\PY{p}{,}g\PY{p}{,}seed\PY{o}{=}\PY{l+m}{1}\PY{p}{)}\PY{p}{\PYZob{}}
              \PY{k+kp}{set.seed}\PY{p}{(}seed\PY{p}{)}
              cell\PYZus{}type \PY{o}{=} par\PY{o}{\PYZdl{}}K
              n\PYZus{}snps \PY{o}{=} par\PY{o}{\PYZdl{}}D
              her \PY{o}{=} par\PY{o}{\PYZdl{}}her\PY{p}{[}\PY{p}{,}g\PY{p}{]}
              pslab \PY{o}{=} par\PY{o}{\PYZdl{}}pslab\PY{p}{[}g\PY{p}{,}\PY{p}{]}
              overlap \PY{o}{=} par\PY{o}{\PYZdl{}}overlap\PY{p}{[}g\PY{p}{]}
              maf \PY{o}{=} par\PY{o}{\PYZdl{}}MAF\PY{p}{[[}g\PY{p}{]]}
              dummy\PYZus{}var \PY{o}{=} \PY{l+m}{10}
          
              \PY{c+c1}{\PYZsh{} Please guarantee that Gene Expression Variance is 1 across ge in cell}
              rmask \PY{o}{=} \PY{k+kp}{do.call}\PY{p}{(}\PY{k+kp}{rbind}\PY{p}{,}\PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}cell\PYZus{}type\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} rbinom\PY{p}{(}n\PYZus{}snps\PY{p}{,}\PY{l+m}{1}\PY{p}{,}\PY{l+m}{1}\PY{o}{\PYZhy{}}pslab\PY{p}{[}x\PY{p}{]}\PY{p}{)}\PY{p}{)}\PY{p}{)}
              sigma\PYZus{}beta\PYZus{} \PY{o}{=} \PY{k+kp}{sqrt}\PY{p}{(}her\PY{o}{/}n\PYZus{}snps\PY{o}{/}pslab\PY{p}{)}
              beta\PYZus{} \PY{o}{=} \PY{k+kp}{do.call}\PY{p}{(}\PY{k+kp}{rbind}\PY{p}{,}\PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}cell\PYZus{}type\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} rnorm\PY{p}{(}n\PYZus{}snps\PY{p}{,}mean\PY{o}{=}dummy\PYZus{}var\PY{p}{,}sd\PY{o}{=}sigma\PYZus{}beta\PYZus{}\PY{p}{[}x\PY{p}{]}\PY{p}{)}\PY{p}{)}\PY{p}{)}
              beta \PY{o}{=} beta\PYZus{}\PY{o}{*}rmask
              \PY{c+c1}{\PYZsh{} find overlap}
          
              sorted\PYZus{}effect\PYZus{}size \PY{o}{=} \PY{k+kp}{t}\PY{p}{(}\PY{k+kp}{apply}\PY{p}{(}\PY{k+kp}{beta}\PY{p}{,}\PY{l+m}{1}\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} \PY{k+kp}{sort}\PY{p}{(}x\PY{p}{,}decreasing\PY{o}{=}\PY{k+kc}{TRUE}\PY{p}{)}\PY{p}{)}\PY{p}{)}
              full\PYZus{}effect\PYZus{}size \PY{o}{=} \PY{k+kp}{sum}\PY{p}{(}\PY{k+kp}{as.integer}\PY{p}{(}\PY{k+kp}{apply}\PY{p}{(}sorted\PYZus{}effect\PYZus{}size\PY{p}{,}\PY{l+m}{2}\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} \PY{p}{(}\PY{o}{!}\PY{l+m}{0} \PY{o}{\PYZpc{}in\PYZpc{}} x\PY{p}{)}\PY{p}{)}\PY{p}{)}\PY{p}{)}
              sorted\PYZus{}effect\PYZus{}size\PY{p}{[}sorted\PYZus{}effect\PYZus{}size\PY{o}{\PYZgt{}}dummy\PYZus{}var\PY{o}{/}\PY{l+m}{2}\PY{p}{]} \PY{o}{=} sorted\PYZus{}effect\PYZus{}size\PY{p}{[}sorted\PYZus{}effect\PYZus{}size\PY{o}{\PYZgt{}}dummy\PYZus{}var\PY{o}{/}\PY{l+m}{2}\PY{p}{]}\PY{o}{\PYZhy{}}dummy\PYZus{}var
              overlap\PYZus{}num \PY{o}{=} \PY{k+kp}{floor}\PY{p}{(}n\PYZus{}snps\PY{o}{*}overlap\PY{p}{)}
              \PY{c+c1}{\PYZsh{}print(paste(\PYZsq{}technical overlap\PYZsq{},overlap,sep=\PYZsq{},\PYZsq{}))}
              \PY{k+kr}{if}\PY{p}{(}full\PYZus{}effect\PYZus{}size\PY{o}{\PYZlt{}}overlap\PYZus{}num\PY{p}{)}\PY{p}{\PYZob{}}
                  overlap\PYZus{}num \PY{o}{=} full\PYZus{}effect\PYZus{}size
              \PY{p}{\PYZcb{}}
              \PY{c+c1}{\PYZsh{}print(paste(\PYZsq{}actual technical overlap\PYZsq{},overlap\PYZus{}num/n\PYZus{}snps))}
              full\PYZus{}effect\PYZus{}size \PY{o}{=} \PY{k+kp}{t}\PY{p}{(}\PY{k+kp}{apply}\PY{p}{(}sorted\PYZus{}effect\PYZus{}size\PY{p}{[}\PY{p}{,}\PY{l+m}{1}\PY{o}{:}overlap\PYZus{}num\PY{p}{]}\PY{p}{,}\PY{l+m}{1}\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} \PY{k+kp}{sample}\PY{p}{(}x\PY{p}{,}overlap\PYZus{}num\PY{p}{)}\PY{p}{)}\PY{p}{)}
              other\PYZus{}effect\PYZus{}size \PY{o}{=} \PY{k+kp}{t}\PY{p}{(}\PY{k+kp}{apply}\PY{p}{(}sorted\PYZus{}effect\PYZus{}size\PY{p}{[}\PY{p}{,}\PY{p}{(}overlap\PYZus{}num\PY{l+m}{+1}\PY{p}{)}\PY{o}{:}\PY{k+kp}{dim}\PY{p}{(}sorted\PYZus{}effect\PYZus{}size\PY{p}{)}\PY{p}{[}\PY{l+m}{2}\PY{p}{]]}\PY{p}{,}\PY{l+m}{1}\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} \PY{k+kp}{sample}\PY{p}{(}x\PY{p}{)}\PY{p}{)}\PY{p}{)}
          
              beta \PY{o}{=} \PY{k+kp}{cbind}\PY{p}{(}full\PYZus{}effect\PYZus{}size\PY{p}{,}other\PYZus{}effect\PYZus{}size\PY{p}{)}
              act\PYZus{}lap \PY{o}{=} \PY{k+kp}{sum}\PY{p}{(}\PY{k+kp}{apply}\PY{p}{(}\PY{k+kp}{beta}\PY{p}{,}\PY{l+m}{2}\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} \PY{p}{(}\PY{o}{!}\PY{l+m}{0}\PY{o}{\PYZpc{}in\PYZpc{}}x\PY{p}{)}\PY{p}{)}\PY{p}{)}\PY{o}{/}n\PYZus{}snps
              \PY{c+c1}{\PYZsh{}print(paste(\PYZsq{}final overlap\PYZsq{},act\PYZus{}lap),sep=\PYZsq{},\PYZsq{})}
          
              X \PY{o}{=} \PY{k+kp}{t}\PY{p}{(}\PY{k+kp}{do.call}\PY{p}{(}\PY{k+kp}{rbind}\PY{p}{,}\PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}n\PYZus{}snps\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} rbinom\PY{p}{(}par\PY{o}{\PYZdl{}}N\PY{p}{,}\PY{l+m}{2}\PY{p}{,}maf\PY{p}{[}x\PY{p}{]}\PY{p}{)}\PY{p}{)}\PY{p}{)}\PY{p}{)}
              \PY{k+kp}{colnames}\PY{p}{(}X\PY{p}{)} \PY{o}{=} \PY{k+kp}{sapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}n\PYZus{}snps\PY{p}{,} \PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} \PY{k+kp}{paste}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{G\PYZsq{}}\PY{p}{,}g\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZus{}SNP\PYZsq{}}\PY{p}{,}\PY{k+kp}{toString}\PY{p}{(}x\PY{p}{)}\PY{p}{,}sep \PY{o}{=} \PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZsq{}}\PY{p}{)}\PY{p}{)}
              \PY{k+kp}{rownames}\PY{p}{(}X\PY{p}{)} \PY{o}{=} par\PY{o}{\PYZdl{}}id\PYZus{}name
              X \PY{o}{=} \PY{k+kp}{scale}\PY{p}{(}X\PY{p}{)}
              \PY{c+c1}{\PYZsh{} enforce variance of samples by adjusting sd of gamma\PYZus{}c1}
              beta \PY{o}{=} \PY{k+kp}{do.call}\PY{p}{(}\PY{k+kp}{rbind}\PY{p}{,}
                                \PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}cell\PYZus{}type\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} \PY{k+kp}{beta}\PY{p}{[}x\PY{p}{,}\PY{p}{]}\PY{o}{*}\PY{p}{(}\PY{k+kp}{sqrt}\PY{p}{(}her\PY{p}{[}x\PY{p}{]}\PY{p}{)}\PY{o}{/}sd\PY{p}{(}X \PY{o}{\PYZpc{}*\PYZpc{}} \PY{k+kp}{beta}\PY{p}{[}x\PY{p}{,}\PY{p}{]}\PY{p}{)}\PY{p}{)}\PY{p}{)}\PY{p}{)}
          
              mu\PYZus{}z \PY{o}{=} X\PY{o}{\PYZpc{}*\PYZpc{}}\PY{k+kp}{t}\PY{p}{(}\PY{k+kp}{beta}\PY{p}{)}
              res\PYZus{}her \PY{o}{=} \PY{l+m}{1}\PY{o}{\PYZhy{}}her
              noise\PYZus{}z \PY{o}{=} par\PY{o}{\PYZdl{}}sigma\PYZus{}z\PY{o}{*}par\PY{o}{\PYZdl{}}sigma\PYZus{}z
              \PY{k+kp}{stopifnot}\PY{p}{(}noise\PYZus{}z\PY{o}{\PYZlt{}}\PY{k+kp}{min}\PY{p}{(}res\PYZus{}her\PY{p}{)}\PY{p}{)}
              epsilon\PYZus{}z \PY{o}{=} \PY{k+kt}{array}\PY{p}{(}rnorm\PY{p}{(}par\PY{o}{\PYZdl{}}N\PY{o}{*}cell\PYZus{}type\PY{p}{,}mean\PY{o}{=}\PY{l+m}{0}\PY{p}{,}sd\PY{o}{=}par\PY{o}{\PYZdl{}}sigma\PYZus{}z\PY{p}{)}\PY{p}{,} \PY{k+kt}{c}\PY{p}{(}par\PY{o}{\PYZdl{}}N\PY{p}{,}cell\PYZus{}type\PY{p}{)}\PY{p}{)}
              epsilon\PYZus{}z \PY{o}{=} \PY{k+kp}{apply}\PY{p}{(}epsilon\PYZus{}z\PY{p}{,}\PY{l+m}{2}\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} x\PY{o}{*}par\PY{o}{\PYZdl{}}sigma\PYZus{}z\PY{o}{/}sd\PY{p}{(}x\PY{p}{)}\PY{p}{)}
              \PY{c+c1}{\PYZsh{} do not need to enforce sparsity on c1}
              her\PYZus{}c1 \PY{o}{=} res\PYZus{}her \PY{o}{\PYZhy{}} noise\PYZus{}z
              sd\PYZus{}gamma\PYZus{}c1 \PY{o}{=} \PY{k+kp}{sqrt}\PY{p}{(}her\PYZus{}c1\PY{o}{/}\PY{k+kp}{dim}\PY{p}{(}par\PY{o}{\PYZdl{}}c1\PY{p}{)}\PY{p}{[}\PY{l+m}{2}\PY{p}{]}\PY{p}{)}
              gamma\PYZus{}c1 \PY{o}{=} \PY{k+kp}{do.call}\PY{p}{(}\PY{k+kp}{rbind}\PY{p}{,}\PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}cell\PYZus{}type\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} rnorm\PY{p}{(}\PY{k+kp}{dim}\PY{p}{(}par\PY{o}{\PYZdl{}}c1\PY{p}{)}\PY{p}{[}\PY{l+m}{2}\PY{p}{]}\PY{p}{,}mean\PY{o}{=}\PY{l+m}{0}\PY{p}{,}sd\PY{o}{=}sd\PYZus{}gamma\PYZus{}c1\PY{p}{[}x\PY{p}{]}\PY{p}{)}\PY{p}{)}\PY{p}{)}
              \PY{c+c1}{\PYZsh{} enforce variance of samples by adjusting sd of gamma\PYZus{}c1}
              gamma\PYZus{}c1 \PY{o}{=} \PY{k+kp}{do.call}\PY{p}{(}\PY{k+kp}{rbind}\PY{p}{,}
                                \PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}cell\PYZus{}type\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} gamma\PYZus{}c1\PY{p}{[}x\PY{p}{,}\PY{p}{]}\PY{o}{*}\PY{p}{(}\PY{k+kp}{sqrt}\PY{p}{(}her\PYZus{}c1\PY{p}{[}x\PY{p}{]}\PY{p}{)}\PY{o}{/}sd\PY{p}{(}par\PY{o}{\PYZdl{}}c1 \PY{o}{\PYZpc{}*\PYZpc{}} gamma\PYZus{}c1\PY{p}{[}x\PY{p}{,}\PY{p}{]}\PY{p}{)}\PY{p}{)}\PY{p}{)}\PY{p}{)}
              c1\PYZus{}gamma \PY{o}{=} par\PY{o}{\PYZdl{}}c1 \PY{o}{\PYZpc{}*\PYZpc{}} \PY{k+kp}{t}\PY{p}{(}gamma\PYZus{}c1\PY{p}{)}
          
              Z \PY{o}{=} epsilon\PYZus{}z \PY{o}{+} mu\PYZus{}z \PY{o}{+} c1\PYZus{}gamma
              \PY{k+kp}{rownames}\PY{p}{(}Z\PY{p}{)} \PY{o}{=} par\PY{o}{\PYZdl{}}id\PYZus{}name
              \PY{k+kp}{colnames}\PY{p}{(}Z\PY{p}{)} \PY{o}{=} par\PY{o}{\PYZdl{}}cell\PYZus{}name
              
              \PY{c+c1}{\PYZsh{}\PYZsh{}\PYZsh{} Generate Gene expressions}
              G \PY{o}{=} \PY{k+kp}{rowSums}\PY{p}{(}\PY{p}{(}par\PY{o}{\PYZdl{}}W\PY{p}{)}\PY{o}{*}Z\PY{p}{)}
              res\PYZus{}var \PY{o}{=} \PY{l+m}{1}\PY{o}{/}par\PY{o}{\PYZdl{}}her\PYZus{}bulk\PY{p}{[}g\PY{p}{]}\PY{l+m}{\PYZhy{}1}
              noise\PYZus{}g \PY{o}{=} par\PY{o}{\PYZdl{}}sigma\PYZus{}g\PY{o}{*}par\PY{o}{\PYZdl{}}sigma\PYZus{}g
              \PY{k+kp}{stopifnot}\PY{p}{(}noise\PYZus{}g\PY{o}{\PYZlt{}}res\PYZus{}var\PY{p}{)}
              epsilon\PYZus{}G \PY{o}{=} rnorm\PY{p}{(}par\PY{o}{\PYZdl{}}N\PY{p}{,}mean\PY{o}{=}\PY{l+m}{0}\PY{p}{,}sd\PY{o}{=}par\PY{o}{\PYZdl{}}sigma\PYZus{}g\PY{p}{)}
              
              sd\PYZus{}gamma\PYZus{}c2 \PY{o}{=} \PY{k+kp}{sqrt}\PY{p}{(}\PY{p}{(}res\PYZus{}var\PY{o}{\PYZhy{}}noise\PYZus{}g\PY{p}{)}\PY{o}{/}par\PY{o}{\PYZdl{}}pc\PYZus{}num\PY{p}{)}
              gamma\PYZus{}c2 \PY{o}{=} \PY{k+kt}{matrix}\PY{p}{(}rnorm\PY{p}{(}par\PY{o}{\PYZdl{}}pc\PYZus{}num\PY{p}{,}mean\PY{o}{=}\PY{l+m}{0}\PY{p}{,}sd\PY{o}{=}sd\PYZus{}gamma\PYZus{}c2\PY{p}{)}\PY{p}{,}nrow\PY{o}{=}par\PY{o}{\PYZdl{}}pc\PYZus{}num\PY{p}{,}ncol\PY{o}{=}\PY{l+m}{1}\PY{p}{)}
              c2\PYZus{}gamma \PY{o}{=} par\PY{o}{\PYZdl{}}c2 \PY{o}{\PYZpc{}*\PYZpc{}} gamma\PYZus{}c2
              
              \PY{c+c1}{\PYZsh{}G = t(G + c2\PYZus{}gamma + epsilon\PYZus{}G)}
              G \PY{o}{=} \PY{k+kp}{t}\PY{p}{(}G\PY{o}{+}epsilon\PYZus{}G\PY{p}{)}
              \PY{k+kp}{colnames}\PY{p}{(}G\PY{p}{)} \PY{o}{\PYZlt{}\PYZhy{}} par\PY{o}{\PYZdl{}}id\PYZus{}name
              \PY{k+kp}{rownames}\PY{p}{(}G\PY{p}{)} \PY{o}{\PYZlt{}\PYZhy{}} \PY{k+kp}{paste}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{gene\PYZsq{}}\PY{p}{,}g\PY{p}{,}sep\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZus{}\PYZsq{}}\PY{p}{)}
              G \PY{o}{=} \PY{k+kp}{as.data.frame}\PY{p}{(}G\PY{p}{)}
              
              \PY{k+kr}{return}\PY{p}{(}\PY{k+kt}{list}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{X\PYZsq{}}\PY{o}{=}X\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{beta\PYZsq{}}\PY{o}{=}\PY{k+kp}{beta}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{gamma\PYZus{}c1\PYZsq{}}\PY{o}{=}\PY{k+kp}{t}\PY{p}{(}gamma\PYZus{}c1\PY{p}{)}\PY{p}{,}
                          \PY{l+s}{\PYZsq{}}\PY{l+s}{gamma\PYZus{}c2\PYZsq{}}\PY{o}{=}gamma\PYZus{}c2\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{Z\PYZsq{}}\PY{o}{=}Z\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{G\PYZsq{}}\PY{o}{=}G\PY{p}{,}
                         \PY{l+s}{\PYZsq{}}\PY{l+s}{theo\PYZus{}lap\PYZsq{}}\PY{o}{=}overlap\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{act\PYZus{}lap\PYZsq{}}\PY{o}{=}act\PYZus{}lap\PY{p}{)}\PY{p}{)}
          \PY{p}{\PYZcb{}}
                                              
          \PY{c+c1}{\PYZsh{}data = one\PYZus{}gene(par=params,1)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}159}]:} summary\PYZus{}statistics \PY{o}{\PYZlt{}\PYZhy{}} \PY{k+kr}{function}\PY{p}{(}mdl\PY{p}{,}train\PYZus{}X\PY{p}{,}test\PYZus{}X\PY{p}{,}train\PYZus{}c1\PY{p}{,}test\PYZus{}c1\PY{p}{,}
                                         train\PYZus{}G\PY{p}{,}test\PYZus{}G\PY{p}{,}train\PYZus{}Z\PY{p}{,}test\PYZus{}Z\PY{p}{,}\PY{k+kp}{beta}\PY{p}{,}
                                         gamma\PYZus{}c1\PY{p}{,}gamma\PYZus{}c2\PY{p}{,}model\PY{o}{=}\PY{l+m}{1}\PY{p}{)}\PY{p}{\PYZob{}}
              \PY{c+c1}{\PYZsh{} TCA estimation \PYZam{} parameters}
              Z\PYZus{}hat\PYZus{}tca \PY{o}{=} tensor\PY{p}{(}train\PYZus{}G\PY{p}{,}mdl\PY{p}{,}log\PYZus{}file\PY{o}{=}\PY{k+kc}{NULL}\PY{p}{,}verbose\PY{o}{=}\PY{k+kc}{FALSE}\PY{p}{,}debug\PY{o}{=}\PY{k+kc}{FALSE}\PY{p}{)}
              rmse\PYZus{}tca \PY{o}{=} \PY{k+kp}{t}\PY{p}{(}\PY{k+kp}{do.call}\PY{p}{(}\PY{k+kp}{rbind}\PY{p}{,}\PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}\PY{k+kp}{length}\PY{p}{(}Z\PYZus{}hat\PYZus{}tca\PY{p}{)}\PY{p}{,}
                                              \PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} \PY{k+kp}{sqrt}\PY{p}{(}\PY{k+kp}{sum}\PY{p}{(}\PY{p}{(}Z\PYZus{}hat\PYZus{}tca\PY{p}{[[}x\PY{p}{]]}\PY{o}{\PYZhy{}}train\PYZus{}Z\PY{p}{[}\PY{p}{,}x\PY{p}{]}\PY{p}{)}\PY{o}{\PYZca{}}\PY{l+m}{2}\PY{p}{)}\PY{o}{/}\PY{k+kp}{length}\PY{p}{(}train\PYZus{}Z\PY{p}{[}\PY{p}{,}x\PY{p}{]}\PY{p}{)}\PY{p}{)}\PY{p}{)}\PY{p}{)}\PY{p}{)}
              Z\PYZus{}hat\PYZus{}cor\PYZus{}tca \PY{o}{=} \PY{k+kp}{sapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}\PY{k+kp}{length}\PY{p}{(}Z\PYZus{}hat\PYZus{}tca\PY{p}{)}\PY{p}{,} \PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} cor\PY{p}{(}\PY{k+kp}{unlist}\PY{p}{(}Z\PYZus{}hat\PYZus{}tca\PY{p}{[}x\PY{p}{]}\PY{p}{)}\PY{p}{,}train\PYZus{}Z\PY{p}{[}\PY{p}{,}x\PY{p}{]}\PY{p}{)}\PY{p}{)}
              cell\PYZus{}type \PY{o}{=} \PY{k+kp}{ncol}\PY{p}{(}mdl\PY{o}{\PYZdl{}}W\PY{p}{)}
              \PY{k+kr}{if}\PY{p}{(}model\PY{o}{==}\PY{l+m}{1}\PY{p}{)}\PY{p}{\PYZob{}}
                  tca\PYZus{}beta \PY{o}{=} \PY{k+kp}{t}\PY{p}{(}\PY{k+kt}{matrix}\PY{p}{(}mdl\PY{o}{\PYZdl{}}gammas\PYZus{}hat\PY{p}{[}\PY{p}{,}\PY{k+kp}{grepl}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{\PYZus{}SNP\PYZdq{}}\PY{p}{,}\PY{k+kp}{colnames}\PY{p}{(}mdl\PY{o}{\PYZdl{}}gammas\PYZus{}hat\PY{p}{)}\PY{p}{)}\PY{p}{]}\PY{p}{,}ncol\PY{o}{=}cell\PYZus{}type\PY{p}{)}\PY{p}{)}
                  beta\PYZus{}hat\PYZus{}cor\PYZus{}tca \PY{o}{=} \PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}cell\PYZus{}type\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} 
                      cor\PY{p}{(}\PY{k+kp}{beta}\PY{p}{[}x\PY{p}{,}\PY{p}{]}\PY{p}{,}mdl\PY{o}{\PYZdl{}}gammas\PYZus{}hat\PY{p}{[}\PY{p}{,}\PY{k+kp}{grepl}\PY{p}{(}\PY{k+kp}{paste}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{Cell\PYZus{}type\PYZdq{}}\PY{p}{,}x\PY{p}{,}\PY{l+s}{\PYZdq{}}\PY{l+s}{.G\PYZdq{}}\PY{p}{,}sep\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZsq{}}\PY{p}{)}\PY{p}{,}\PY{k+kp}{colnames}\PY{p}{(}mdl\PY{o}{\PYZdl{}}gammas\PYZus{}hat\PY{p}{)}\PY{p}{)}\PY{p}{]}\PY{p}{)}\PY{p}{)}        
              \PY{p}{\PYZcb{}}\PY{k+kp}{else}\PY{p}{\PYZob{}} \PY{c+c1}{\PYZsh{} model 2 does not predict beta for snps}
                  tca\PYZus{}beta \PY{o}{=} \PY{k+kc}{NULL}
                  beta\PYZus{}hat\PYZus{}cor\PYZus{}tca \PY{o}{=} \PY{k+kc}{NULL}
              \PY{p}{\PYZcb{}}
              gamma\PYZus{}hat\PYZus{}cor\PYZus{}tca \PY{o}{=} cor\PY{p}{(}\PY{k+kt}{array}\PY{p}{(}gamma\PYZus{}c1\PY{p}{)}\PY{p}{,}
                                  mdl\PY{o}{\PYZdl{}}gammas\PYZus{}hat\PY{p}{[}\PY{p}{,}\PY{k+kp}{grepl}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{male|smok|age\PYZsq{}}\PY{p}{,} \PY{k+kp}{colnames}\PY{p}{(}mdl\PY{o}{\PYZdl{}}gammas\PYZus{}hat\PY{p}{)}\PY{p}{)}\PY{p}{]}\PY{p}{)}
              \PY{k+kr}{if}\PY{p}{(}model\PY{o}{==}\PY{l+m}{1}\PY{p}{)}\PY{p}{\PYZob{}}
                  pred \PY{o}{=} \PY{k+kp}{cbind}\PY{p}{(}train\PYZus{}X\PY{p}{,}train\PYZus{}c1\PY{p}{)}
                  test\PYZus{}pred \PY{o}{=} \PY{k+kp}{cbind}\PY{p}{(}test\PYZus{}X\PY{p}{,}test\PYZus{}c1\PY{p}{)}        
              \PY{p}{\PYZcb{}}\PY{k+kp}{else}\PY{p}{\PYZob{}} \PY{c+c1}{\PYZsh{} model 2 does not use train\PYZus{}X/test\PYZus{}X as C1}
                  pred \PY{o}{=} train\PYZus{}c1
                  test\PYZus{}pred \PY{o}{=} test\PYZus{}c1
              \PY{p}{\PYZcb{}}
              \PY{c+c1}{\PYZsh{} TCA parameter direct estimation \PYZlt{}\PYZhy{}\PYZhy{}\PYZhy{}\PYZhy{}\PYZgt{} C1 \PYZam{} X}
              Z\PYZus{}hat\PYZus{}train\PYZus{}second\PYZus{}eq\PYZus{}tca \PY{o}{=} \PY{k+kp}{sapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}cell\PYZus{}type\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} pred \PY{o}{\PYZpc{}*\PYZpc{}} mdl\PY{o}{\PYZdl{}}gammas\PYZus{}hat\PY{p}{[}\PY{p}{,}\PY{p}{(}\PY{p}{(}x\PY{l+m}{\PYZhy{}1}\PY{p}{)}\PY{o}{*}\PY{k+kp}{dim}\PY{p}{(}pred\PY{p}{)}\PY{p}{[}\PY{l+m}{2}\PY{p}{]}\PY{l+m}{+1}\PY{p}{)}\PY{o}{:}\PY{p}{(}x\PY{o}{*}\PY{k+kp}{dim}\PY{p}{(}pred\PY{p}{)}\PY{p}{[}\PY{l+m}{2}\PY{p}{]}\PY{p}{)}\PY{p}{]}\PY{p}{)}
              Z\PYZus{}hat\PYZus{}train\PYZus{}second\PYZus{}eq\PYZus{}cor\PYZus{}tca \PY{o}{=} \PY{k+kp}{diag}\PY{p}{(}cor\PY{p}{(}train\PYZus{}Z\PY{p}{,}Z\PYZus{}hat\PYZus{}train\PYZus{}second\PYZus{}eq\PYZus{}tca\PY{p}{)}\PY{p}{)}
              Z\PYZus{}hat\PYZus{}test\PYZus{}second\PYZus{}eq\PYZus{}tca \PY{o}{=} \PY{k+kp}{sapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}cell\PYZus{}type\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} test\PYZus{}pred \PY{o}{\PYZpc{}*\PYZpc{}} mdl\PY{o}{\PYZdl{}}gammas\PYZus{}hat\PY{p}{[}\PY{p}{,}\PY{p}{(}\PY{p}{(}x\PY{l+m}{\PYZhy{}1}\PY{p}{)}\PY{o}{*}\PY{k+kp}{dim}\PY{p}{(}test\PYZus{}pred\PY{p}{)}\PY{p}{[}\PY{l+m}{2}\PY{p}{]}\PY{l+m}{+1}\PY{p}{)}\PY{o}{:}\PY{p}{(}x\PY{o}{*}\PY{k+kp}{dim}\PY{p}{(}test\PYZus{}pred\PY{p}{)}\PY{p}{[}\PY{l+m}{2}\PY{p}{]}\PY{p}{)}\PY{p}{]}\PY{p}{)}
              Z\PYZus{}hat\PYZus{}test\PYZus{}second\PYZus{}eq\PYZus{}cor\PYZus{}tca \PY{o}{=} \PY{k+kp}{diag}\PY{p}{(}cor\PY{p}{(}test\PYZus{}Z\PY{p}{,}Z\PYZus{}hat\PYZus{}test\PYZus{}second\PYZus{}eq\PYZus{}tca\PY{p}{)}\PY{p}{)}
              
              \PY{c+c1}{\PYZsh{} Lasso bulk data regression \PYZlt{}\PYZhy{}\PYZhy{}\PYZhy{}\PYZhy{}\PYZgt{} X only}
              glmnet.mdl.X.cv \PY{o}{\PYZlt{}\PYZhy{}} cv.glmnet\PY{p}{(}x\PY{o}{=}train\PYZus{}X\PY{p}{,}y\PY{o}{=}\PY{k+kp}{t}\PY{p}{(}train\PYZus{}G\PY{p}{)}\PY{p}{,}nfolds\PY{o}{=}\PY{l+m}{5}\PY{p}{)}
              glmnet.mdl.X \PY{o}{\PYZlt{}\PYZhy{}} glmnet\PY{p}{(}x\PY{o}{=}train\PYZus{}X\PY{p}{,}y\PY{o}{=}\PY{k+kp}{t}\PY{p}{(}train\PYZus{}G\PY{p}{)}\PY{p}{,}lambda\PY{o}{=}glmnet.mdl.X.cv\PY{o}{\PYZdl{}}lambda.min\PY{p}{)}
              beta\PYZus{}full\PYZus{}X\PYZus{}bulk \PY{o}{\PYZlt{}\PYZhy{}} \PY{k+kp}{as.numeric}\PY{p}{(}glmnet.mdl.X\PY{o}{\PYZdl{}}\PY{k+kp}{beta}\PY{p}{)}
              \PY{c+c1}{\PYZsh{} extract non zero predictors and recorrelate}
              predictors.X \PY{o}{\PYZlt{}\PYZhy{}} \PY{k+kp}{colnames}\PY{p}{(}train\PYZus{}X\PY{p}{)}\PY{p}{[}\PY{k+kp}{which}\PY{p}{(}beta\PYZus{}full\PYZus{}X\PYZus{}bulk\PY{o}{!=}\PY{l+m}{0}\PY{p}{)}\PY{p}{]}
              beta\PYZus{}X \PY{o}{\PYZlt{}\PYZhy{}} \PY{k+kp}{as.matrix}\PY{p}{(}\PY{k+kt}{c}\PY{p}{(}glmnet.mdl.X\PY{o}{\PYZdl{}}a0\PY{p}{,}\PY{k+kp}{as.matrix}\PY{p}{(}glmnet.mdl.X\PY{o}{\PYZdl{}}\PY{k+kp}{beta}\PY{p}{[}predictors.X\PY{p}{,}\PY{p}{]}\PY{p}{)}\PY{p}{)}\PY{p}{)}
              bias\PYZus{}one \PY{o}{\PYZlt{}\PYZhy{}} \PY{k+kt}{numeric}\PY{p}{(}\PY{k+kp}{nrow}\PY{p}{(}train\PYZus{}X\PY{p}{)}\PY{p}{)}\PY{l+m}{+1}
              G\PYZus{}hat\PYZus{}train\PYZus{}lasso \PY{o}{\PYZlt{}\PYZhy{}} \PY{k+kp}{cbind}\PY{p}{(}bias\PYZus{}one\PY{p}{,}train\PYZus{}X\PY{p}{[}\PY{p}{,}predictors.X\PY{p}{]}\PY{p}{)} \PY{o}{\PYZpc{}*\PYZpc{}} beta\PYZus{}X
              G\PYZus{}hat\PYZus{}train\PYZus{}cor\PYZus{}bulk \PY{o}{\PYZlt{}\PYZhy{}} cor\PY{p}{(}\PY{k+kp}{t}\PY{p}{(}train\PYZus{}G\PY{p}{)}\PY{p}{,}G\PYZus{}hat\PYZus{}train\PYZus{}lasso\PY{p}{)}
              G\PYZus{}hat\PYZus{}test\PYZus{}lasso \PY{o}{\PYZlt{}\PYZhy{}} \PY{k+kp}{cbind}\PY{p}{(}\PY{k+kt}{numeric}\PY{p}{(}\PY{k+kp}{nrow}\PY{p}{(}test\PYZus{}X\PY{p}{)}\PY{p}{)}\PY{l+m}{+1}\PY{p}{,}test\PYZus{}X\PY{p}{[}\PY{p}{,}predictors.X\PY{p}{]}\PY{p}{)} \PY{o}{\PYZpc{}*\PYZpc{}} beta\PYZus{}X
              G\PYZus{}hat\PYZus{}test\PYZus{}cor\PYZus{}bulk \PY{o}{\PYZlt{}\PYZhy{}} cor\PY{p}{(}\PY{k+kp}{t}\PY{p}{(}test\PYZus{}G\PY{p}{)}\PY{p}{,}G\PYZus{}hat\PYZus{}test\PYZus{}lasso\PY{p}{)}
              
              \PY{c+c1}{\PYZsh{} cell type specific lasso}
              corrs \PY{o}{=} \PY{k+kt}{numeric}\PY{p}{(}\PY{k+kp}{ncol}\PY{p}{(}mdl\PY{o}{\PYZdl{}}W\PY{p}{)}\PY{p}{)}
              corrs.real \PY{o}{=} \PY{k+kt}{numeric}\PY{p}{(}\PY{k+kp}{ncol}\PY{p}{(}mdl\PY{o}{\PYZdl{}}W\PY{p}{)}\PY{p}{)}
              corrs.beta \PY{o}{=} \PY{k+kt}{numeric}\PY{p}{(}\PY{k+kp}{ncol}\PY{p}{(}mdl\PY{o}{\PYZdl{}}W\PY{p}{)}\PY{p}{)}
              corrs.test.real \PY{o}{=} \PY{k+kt}{numeric}\PY{p}{(}\PY{k+kp}{ncol}\PY{p}{(}mdl\PY{o}{\PYZdl{}}W\PY{p}{)}\PY{p}{)}
              dev\PYZus{}ratio \PY{o}{=} \PY{k+kt}{numeric}\PY{p}{(}\PY{k+kp}{ncol}\PY{p}{(}mdl\PY{o}{\PYZdl{}}W\PY{p}{)}\PY{p}{)}
              rmse\PYZus{}lasso \PY{o}{=} \PY{k+kt}{numeric}\PY{p}{(}\PY{k+kp}{ncol}\PY{p}{(}mdl\PY{o}{\PYZdl{}}W\PY{p}{)}\PY{p}{)}
              beta\PYZus{}full\PYZus{}cell \PY{o}{=} \PY{k+kt}{matrix}\PY{p}{(}\PY{l+m}{0}\PY{p}{,}nrow\PY{o}{=}\PY{k+kp}{ncol}\PY{p}{(}mdl\PY{o}{\PYZdl{}}W\PY{p}{)}\PY{p}{,}ncol\PY{o}{=}\PY{k+kp}{dim}\PY{p}{(}train\PYZus{}X\PY{p}{)}\PY{p}{[}\PY{l+m}{2}\PY{p}{]}\PY{p}{)}
              \PY{k+kr}{for} \PY{p}{(}h \PY{k+kr}{in} \PY{l+m}{1}\PY{o}{:}\PY{k+kp}{ncol}\PY{p}{(}mdl\PY{o}{\PYZdl{}}W\PY{p}{)}\PY{p}{)}\PY{p}{\PYZob{}}
                  
                  glmnet.mdl.cv \PY{o}{\PYZlt{}\PYZhy{}} cv.glmnet\PY{p}{(}x\PY{o}{=}train\PYZus{}X\PY{p}{,}y\PY{o}{=}Z\PYZus{}hat\PYZus{}tca\PY{p}{[[}h\PY{p}{]]}\PY{p}{,}standardize\PY{o}{=}\PY{k+kc}{FALSE}\PY{p}{,}alpha\PY{o}{=}\PY{l+m}{1}\PY{p}{,}nfolds\PY{o}{=}\PY{l+m}{5}\PY{p}{)}
                  rmse\PYZus{}lasso\PY{p}{[}h\PY{p}{]} \PY{o}{=} \PY{k+kp}{sqrt}\PY{p}{(}glmnet.mdl.cv\PY{o}{\PYZdl{}}cvm\PY{p}{[}glmnet.mdl.cv\PY{o}{\PYZdl{}}lambda \PY{o}{==} glmnet.mdl.cv\PY{o}{\PYZdl{}}lambda.min\PY{p}{]}\PY{p}{)}
                  glmnet.mdl \PY{o}{\PYZlt{}\PYZhy{}} glmnet\PY{p}{(}x\PY{o}{=}train\PYZus{}X\PY{p}{,}y\PY{o}{=}Z\PYZus{}hat\PYZus{}tca\PY{p}{[[}h\PY{p}{]]}\PY{p}{,}standardize\PY{o}{=}\PY{k+kc}{FALSE}\PY{p}{,}alpha\PY{o}{=}\PY{l+m}{1}\PY{p}{,}lambda\PY{o}{=}glmnet.mdl.cv\PY{o}{\PYZdl{}}lambda.min\PY{p}{)}
                  dev\PYZus{}ratio\PY{p}{[}h\PY{p}{]} \PY{o}{\PYZlt{}\PYZhy{}} glmnet.mdl\PY{o}{\PYZdl{}}dev.ratio
                  beta.full \PY{o}{\PYZlt{}\PYZhy{}} \PY{k+kp}{as.numeric}\PY{p}{(}glmnet.mdl\PY{o}{\PYZdl{}}\PY{k+kp}{beta}\PY{p}{)}
                  beta\PYZus{}full\PYZus{}cell\PY{p}{[}h\PY{p}{,}\PY{p}{]} \PY{o}{\PYZlt{}\PYZhy{}} beta.full
                  predictors \PY{o}{\PYZlt{}\PYZhy{}} \PY{k+kp}{colnames}\PY{p}{(}train\PYZus{}X\PY{p}{)}\PY{p}{[}\PY{k+kp}{which}\PY{p}{(}beta.full \PY{o}{!=} \PY{l+m}{0}\PY{p}{)}\PY{p}{]}
                  beta\PYZus{}lasso \PY{o}{\PYZlt{}\PYZhy{}} \PY{k+kp}{as.matrix}\PY{p}{(}\PY{k+kt}{c}\PY{p}{(}glmnet.mdl\PY{o}{\PYZdl{}}a0\PY{p}{,}\PY{k+kp}{as.matrix}\PY{p}{(}glmnet.mdl\PY{o}{\PYZdl{}}\PY{k+kp}{beta}\PY{p}{[}predictors\PY{p}{,}\PY{p}{]}\PY{p}{)}\PY{p}{)}\PY{p}{)}
                  Z\PYZus{}hat\PYZus{}train\PYZus{}lasso \PY{o}{\PYZlt{}\PYZhy{}} \PY{k+kp}{cbind}\PY{p}{(}\PY{k+kt}{numeric}\PY{p}{(}\PY{k+kp}{nrow}\PY{p}{(}train\PYZus{}X\PY{p}{)}\PY{p}{)}\PY{l+m}{+1}\PY{p}{,}train\PYZus{}X\PY{p}{[}\PY{p}{,}predictors\PY{p}{]}\PY{p}{)} \PY{o}{\PYZpc{}*\PYZpc{}} beta\PYZus{}lasso
                  \PY{k+kr}{if}\PY{p}{(}\PY{k+kp}{sum}\PY{p}{(}beta\PYZus{}lasso\PY{p}{)}\PY{o}{==}\PY{l+m}{0} \PY{o}{|} sd\PY{p}{(}Z\PYZus{}hat\PYZus{}train\PYZus{}lasso\PY{p}{)}\PY{o}{==}\PY{l+m}{0}\PY{p}{)}\PY{p}{\PYZob{}}
                      \PY{c+c1}{\PYZsh{} model 2 lasso forces SNPs effect to become zero.}
                      \PY{c+c1}{\PYZsh{} If there were no predictors, then cor would be NaN. Which also means}
                      \PY{c+c1}{\PYZsh{} np snps is correlated with Z. cor just set to 0.}
                      corrs\PY{p}{[}h\PY{p}{]} \PY{o}{=} \PY{l+m}{0}
                      corrs.real\PY{p}{[}h\PY{p}{]} \PY{o}{=} \PY{l+m}{0}
                      corrs.beta\PY{p}{[}h\PY{p}{]} \PY{o}{=} \PY{l+m}{0}
                      corrs.test.real\PY{p}{[}h\PY{p}{]} \PY{o}{=} \PY{l+m}{0}
                  \PY{p}{\PYZcb{}}\PY{k+kp}{else}\PY{p}{\PYZob{}}
                      corrs\PY{p}{[}h\PY{p}{]} \PY{o}{\PYZlt{}\PYZhy{}} cor\PY{p}{(}\PY{k+kp}{t}\PY{p}{(}Z\PYZus{}hat\PYZus{}tca\PY{p}{[[}h\PY{p}{]]}\PY{p}{)}\PY{p}{,}Z\PYZus{}hat\PYZus{}train\PYZus{}lasso\PY{p}{)}
                      corrs.real\PY{p}{[}h\PY{p}{]} \PY{o}{\PYZlt{}\PYZhy{}} cor\PY{p}{(}train\PYZus{}Z\PY{p}{[}\PY{p}{,}h\PY{p}{]}\PY{p}{,}Z\PYZus{}hat\PYZus{}train\PYZus{}lasso\PY{p}{)}
                      corrs.beta\PY{p}{[}h\PY{p}{]} \PY{o}{\PYZlt{}\PYZhy{}} cor\PY{p}{(}\PY{k+kp}{beta}\PY{p}{[}h\PY{p}{,}\PY{p}{]}\PY{p}{,}beta.full\PY{p}{)}
          
                      Z\PYZus{}hat\PYZus{}test\PYZus{}lasso \PY{o}{\PYZlt{}\PYZhy{}} \PY{k+kp}{cbind}\PY{p}{(}\PY{k+kt}{numeric}\PY{p}{(}\PY{k+kp}{nrow}\PY{p}{(}test\PYZus{}X\PY{p}{)}\PY{p}{)}\PY{l+m}{+1}\PY{p}{,}test\PYZus{}X\PY{p}{[}\PY{p}{,}predictors\PY{p}{]}\PY{p}{)} \PY{o}{\PYZpc{}*\PYZpc{}} beta\PYZus{}lasso
                      corrs.test.real\PY{p}{[}h\PY{p}{]} \PY{o}{\PYZlt{}\PYZhy{}} cor\PY{p}{(}test\PYZus{}Z\PY{p}{[}\PY{p}{,}h\PY{p}{]}\PY{p}{,}Z\PYZus{}hat\PYZus{}test\PYZus{}lasso\PY{p}{)}            
                  \PY{p}{\PYZcb{}}
              \PY{p}{\PYZcb{}}
              \PY{c+c1}{\PYZsh{} Precision \PYZam{} Recall for lasso}
              Binary\PYZus{}True\PY{o}{=}\PY{p}{(}\PY{k+kp}{beta}\PY{o}{!=}\PY{l+m}{0}\PY{p}{)}
              Binary\PYZus{}Pred\PYZus{}Lasso\PY{o}{=}\PY{p}{(}beta\PYZus{}full\PYZus{}cell\PY{o}{!=}\PY{l+m}{0}\PY{p}{)}
              TP \PY{o}{=} \PY{k+kp}{do.call}\PY{p}{(}\PY{k+kp}{rbind}\PY{p}{,}\PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}params\PY{o}{\PYZdl{}}K\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} \PY{k+kp}{sum}\PY{p}{(}\PY{k+kp}{as.integer}\PY{p}{(}Binary\PYZus{}True\PY{p}{[}x\PY{p}{,}\PY{p}{]}\PY{o}{\PYZam{}}Binary\PYZus{}Pred\PYZus{}Lasso\PY{p}{[}x\PY{p}{,}\PY{p}{]}\PY{p}{)}\PY{p}{)}\PY{p}{)}\PY{p}{)}
              FP \PY{o}{=} \PY{k+kp}{do.call}\PY{p}{(}\PY{k+kp}{rbind}\PY{p}{,}\PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}params\PY{o}{\PYZdl{}}K\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} \PY{k+kp}{sum}\PY{p}{(}\PY{k+kp}{as.integer}\PY{p}{(}\PY{p}{(}\PY{o}{!}Binary\PYZus{}True\PY{p}{[}x\PY{p}{,}\PY{p}{]}\PY{p}{)}\PY{o}{\PYZam{}}Binary\PYZus{}Pred\PYZus{}Lasso\PY{p}{[}x\PY{p}{,}\PY{p}{]}\PY{p}{)}\PY{p}{)}\PY{p}{)}\PY{p}{)}
              FN \PY{o}{=} \PY{k+kp}{do.call}\PY{p}{(}\PY{k+kp}{rbind}\PY{p}{,}\PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}params\PY{o}{\PYZdl{}}K\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} \PY{k+kp}{sum}\PY{p}{(}\PY{k+kp}{as.integer}\PY{p}{(}Binary\PYZus{}True\PY{p}{[}x\PY{p}{,}\PY{p}{]}\PY{o}{\PYZam{}}\PY{p}{(}\PY{o}{!}Binary\PYZus{}Pred\PYZus{}Lasso\PY{p}{[}x\PY{p}{,}\PY{p}{]}\PY{p}{)}\PY{p}{)}\PY{p}{)}\PY{p}{)}\PY{p}{)}
              precision\PYZus{}lasso \PY{o}{=} TP\PY{o}{/}\PY{p}{(}TP\PY{o}{+}FP\PY{p}{)}
              recall\PYZus{}lasso \PY{o}{=} TP\PY{o}{/}\PY{p}{(}TP\PY{o}{+}FN\PY{p}{)}
              \PY{k+kr}{return}\PY{p}{(}\PY{k+kt}{list}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{Z\PYZus{}hat\PYZus{}cor\PYZus{}tca\PYZsq{}}\PY{o}{=}Z\PYZus{}hat\PYZus{}cor\PYZus{}tca\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{beta\PYZus{}hat\PYZus{}cor\PYZus{}tca\PYZsq{}}\PY{o}{=}beta\PYZus{}hat\PYZus{}cor\PYZus{}tca\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{gamma\PYZus{}hat\PYZus{}cor\PYZus{}tca\PYZsq{}}\PY{o}{=}gamma\PYZus{}hat\PYZus{}cor\PYZus{}tca\PY{p}{,}
                         \PY{l+s}{\PYZsq{}}\PY{l+s}{Z\PYZus{}hat\PYZus{}train\PYZus{}second\PYZus{}eq\PYZus{}cor\PYZus{}tca\PYZsq{}}\PY{o}{=}Z\PYZus{}hat\PYZus{}train\PYZus{}second\PYZus{}eq\PYZus{}cor\PYZus{}tca\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{Z\PYZus{}hat\PYZus{}test\PYZus{}second\PYZus{}eq\PYZus{}cor\PYZus{}tca\PYZsq{}}\PY{o}{=}Z\PYZus{}hat\PYZus{}test\PYZus{}second\PYZus{}eq\PYZus{}cor\PYZus{}tca\PY{p}{,}
                         \PY{l+s}{\PYZsq{}}\PY{l+s}{G\PYZus{}hat\PYZus{}train\PYZus{}cor\PYZus{}bulk\PYZsq{}}\PY{o}{=}G\PYZus{}hat\PYZus{}train\PYZus{}cor\PYZus{}bulk\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{G\PYZus{}hat\PYZus{}test\PYZus{}cor\PYZus{}bulk\PYZsq{}}\PY{o}{=}G\PYZus{}hat\PYZus{}test\PYZus{}cor\PYZus{}bulk\PY{p}{,}
                         \PY{l+s}{\PYZsq{}}\PY{l+s}{cor\PYZus{}lasso\PYZus{}tca\PYZsq{}}\PY{o}{=}corrs\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{cor\PYZus{}lasso\PYZus{}real\PYZus{}train\PYZsq{}}\PY{o}{=}corrs.real\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{cor\PYZus{}lasso\PYZus{}real\PYZus{}test\PYZsq{}}\PY{o}{=}corrs.test.real\PY{p}{,}
                         \PY{l+s}{\PYZsq{}}\PY{l+s}{cor\PYZus{}beta\PYZus{}lasso\PYZus{}real\PYZsq{}}\PY{o}{=}corrs.beta\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{beta\PYZus{}hat\PYZus{}lasso\PYZsq{}}\PY{o}{=}beta\PYZus{}full\PYZus{}cell\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{dev\PYZus{}rat\PYZsq{}}\PY{o}{=}dev\PYZus{}ratio\PY{p}{,}
                         \PY{l+s}{\PYZsq{}}\PY{l+s}{precision\PYZus{}lasso\PYZsq{}}\PY{o}{=}precision\PYZus{}lasso\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{recall\PYZus{}lasso\PYZsq{}}\PY{o}{=}recall\PYZus{}lasso\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{rmse\PYZus{}lasso\PYZsq{}}\PY{o}{=}rmse\PYZus{}lasso\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{rmse\PYZus{}tca\PYZsq{}}\PY{o}{=}rmse\PYZus{}tca\PY{p}{)}\PY{p}{)}
          \PY{p}{\PYZcb{}}
\end{Verbatim}


    \subsubsection{Plotting Begins for Overlap
Check}\label{plotting-begins-for-overlap-check}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}160}]:} params \PY{o}{=} generate\PYZus{}params\PY{p}{(}cont\PYZus{}her\PY{o}{=}\PY{k+kc}{FALSE}\PY{p}{,}seed\PY{o}{=}\PY{l+m}{1}\PY{p}{)}
          data \PY{o}{=} \PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}params\PY{o}{\PYZdl{}}M\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} one\PYZus{}gene\PY{p}{(}par\PY{o}{=}params\PY{p}{,}x\PY{p}{)}\PY{p}{)}
          overlap \PY{o}{=} \PY{k+kp}{t}\PY{p}{(}\PY{k+kp}{do.call}\PY{p}{(}\PY{k+kp}{rbind}\PY{p}{,}\PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}\PY{k+kp}{length}\PY{p}{(}data\PY{p}{)}\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} data\PY{p}{[[}x\PY{p}{]]}\PY{o}{\PYZdl{}}act\PYZus{}lap\PY{p}{)}\PY{p}{)}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}161}]:} \PY{c+c1}{\PYZsh{} do TCA\PYZhy{}TWAS for every gene}
          prop \PY{o}{=} \PY{l+m}{0.7}
          t\PYZus{}prop \PY{o}{=} \PY{k+kp}{floor}\PY{p}{(}prop\PY{o}{*}params\PY{o}{\PYZdl{}}N\PY{p}{)}
          li \PY{o}{=} \PY{k+kt}{list}\PY{p}{(}\PY{p}{)}
          \PY{k+kr}{for}\PY{p}{(}g \PY{k+kr}{in} \PY{l+m}{1}\PY{o}{:}\PY{k+kp}{length}\PY{p}{(}data\PY{p}{)}\PY{p}{)}\PY{p}{\PYZob{}}
              \PY{k+kp}{print}\PY{p}{(}\PY{k+kp}{paste}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{gene\PYZsq{}}\PY{p}{,}g\PY{p}{,}sep\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZus{}\PYZsq{}}\PY{p}{)}\PY{p}{)}
              train\PYZus{}X \PY{o}{=} \PY{p}{(}data\PY{p}{[[}g\PY{p}{]]}\PY{o}{\PYZdl{}}X\PY{p}{)}\PY{p}{[}\PY{l+m}{1}\PY{o}{:}t\PYZus{}prop\PY{p}{,}\PY{p}{]}
              test\PYZus{}X \PY{o}{=} data\PY{p}{[[}g\PY{p}{]]}\PY{o}{\PYZdl{}}X\PY{p}{[}\PY{p}{(}t\PYZus{}prop\PY{l+m}{+1}\PY{p}{)}\PY{o}{:}params\PY{o}{\PYZdl{}}N\PY{p}{,}\PY{p}{]}
              train\PYZus{}W \PY{o}{=} params\PY{o}{\PYZdl{}}W\PY{p}{[}\PY{l+m}{1}\PY{o}{:}t\PYZus{}prop\PY{p}{,}\PY{p}{]}
              test\PYZus{}W \PY{o}{=} params\PY{o}{\PYZdl{}}W\PY{p}{[}\PY{p}{(}t\PYZus{}prop\PY{l+m}{+1}\PY{p}{)}\PY{o}{:}params\PY{o}{\PYZdl{}}N\PY{p}{,}\PY{p}{]}
              train\PYZus{}G \PY{o}{=} data\PY{p}{[[}g\PY{p}{]]}\PY{o}{\PYZdl{}}G\PY{p}{[}\PY{p}{,}\PY{l+m}{1}\PY{o}{:}t\PYZus{}prop\PY{p}{]}
              test\PYZus{}G \PY{o}{=} data\PY{p}{[[}g\PY{p}{]]}\PY{o}{\PYZdl{}}G\PY{p}{[}\PY{p}{,}\PY{p}{(}t\PYZus{}prop\PY{l+m}{+1}\PY{p}{)}\PY{o}{:}params\PY{o}{\PYZdl{}}N\PY{p}{]}
              train\PYZus{}c1 \PY{o}{=} params\PY{o}{\PYZdl{}}c1\PY{p}{[}\PY{l+m}{1}\PY{o}{:}t\PYZus{}prop\PY{p}{,}\PY{p}{]}
              test\PYZus{}c1 \PY{o}{=} params\PY{o}{\PYZdl{}}c1\PY{p}{[}\PY{p}{(}t\PYZus{}prop\PY{l+m}{+1}\PY{p}{)}\PY{o}{:}params\PY{o}{\PYZdl{}}N\PY{p}{,}\PY{p}{]}
              train\PYZus{}c2 \PY{o}{=} params\PY{o}{\PYZdl{}}c2\PY{p}{[}\PY{l+m}{1}\PY{o}{:}t\PYZus{}prop\PY{p}{,}\PY{p}{]}
              test\PYZus{}c2 \PY{o}{=} params\PY{o}{\PYZdl{}}c2\PY{p}{[}\PY{p}{(}t\PYZus{}prop\PY{l+m}{+1}\PY{p}{)}\PY{o}{:}params\PY{o}{\PYZdl{}}N\PY{p}{,}\PY{p}{]}
              train\PYZus{}Z \PY{o}{=} data\PY{p}{[[}g\PY{p}{]]}\PY{o}{\PYZdl{}}Z\PY{p}{[}\PY{l+m}{1}\PY{o}{:}t\PYZus{}prop\PY{p}{,}\PY{p}{]}
              test\PYZus{}Z \PY{o}{=} data\PY{p}{[[}g\PY{p}{]]}\PY{o}{\PYZdl{}}Z\PY{p}{[}\PY{p}{(}t\PYZus{}prop\PY{l+m}{+1}\PY{p}{)}\PY{o}{:}params\PY{o}{\PYZdl{}}N\PY{p}{,}\PY{p}{]}
              beta \PY{o}{=} data\PY{p}{[[}g\PY{p}{]]}\PY{o}{\PYZdl{}}\PY{k+kp}{beta}
              gamma\PYZus{}c1 \PY{o}{=} data\PY{p}{[[}g\PY{p}{]]}\PY{o}{\PYZdl{}}gamma\PYZus{}c1
              gamma\PYZus{}c2 \PY{o}{=} data\PY{p}{[[}g\PY{p}{]]}\PY{o}{\PYZdl{}}gamma\PYZus{}c2
              tca.mdl1 \PY{o}{=} tca\PY{p}{(}X\PY{o}{=}train\PYZus{}G\PY{p}{,}W\PY{o}{=}train\PYZus{}W\PY{p}{,}C1\PY{o}{=}\PY{k+kp}{cbind}\PY{p}{(}train\PYZus{}X\PY{p}{,}train\PYZus{}c1\PY{p}{)}\PY{p}{,}verbose\PY{o}{=}\PY{k+kc}{FALSE}\PY{p}{)}
              tca.mdl2 \PY{o}{=} tca\PY{p}{(}X\PY{o}{=}train\PYZus{}G\PY{p}{,}W\PY{o}{=}train\PYZus{}W\PY{p}{,}C1\PY{o}{=}train\PYZus{}c1\PY{p}{,}verbose\PY{o}{=}\PY{k+kc}{FALSE}\PY{p}{)}
              tca.mdl1.summary \PY{o}{=} summary\PYZus{}statistics\PY{p}{(}mdl\PY{o}{=}tca.mdl1\PY{p}{,}train\PYZus{}X\PY{o}{=}train\PYZus{}X\PY{p}{,}test\PYZus{}X\PY{o}{=}test\PYZus{}X\PY{p}{,}
                                                    train\PYZus{}c1\PY{o}{=}train\PYZus{}c1\PY{p}{,}test\PYZus{}c1\PY{o}{=}test\PYZus{}c1\PY{p}{,}train\PYZus{}G\PY{o}{=}train\PYZus{}G\PY{p}{,}
                                                    test\PYZus{}G\PY{o}{=}test\PYZus{}G\PY{p}{,}train\PYZus{}Z\PY{o}{=}train\PYZus{}Z\PY{p}{,}test\PYZus{}Z\PY{o}{=}test\PYZus{}Z\PY{p}{,}
                                                    beta\PY{o}{=}\PY{k+kp}{beta}\PY{p}{,}gamma\PYZus{}c1\PY{o}{=}gamma\PYZus{}c1\PY{p}{,}gamma\PYZus{}c2\PY{o}{=}gamma\PYZus{}c2\PY{p}{,}model\PY{o}{=}\PY{l+m}{1}\PY{p}{)}
              tca.mdl2.summary \PY{o}{=} summary\PYZus{}statistics\PY{p}{(}mdl\PY{o}{=}tca.mdl2\PY{p}{,}train\PYZus{}X\PY{o}{=}train\PYZus{}X\PY{p}{,}test\PYZus{}X\PY{o}{=}test\PYZus{}X\PY{p}{,}
                                                    train\PYZus{}c1\PY{o}{=}train\PYZus{}c1\PY{p}{,}test\PYZus{}c1\PY{o}{=}test\PYZus{}c1\PY{p}{,}train\PYZus{}G\PY{o}{=}train\PYZus{}G\PY{p}{,}
                                                    test\PYZus{}G\PY{o}{=}test\PYZus{}G\PY{p}{,}train\PYZus{}Z\PY{o}{=}train\PYZus{}Z\PY{p}{,}test\PYZus{}Z\PY{o}{=}test\PYZus{}Z\PY{p}{,}
                                                    beta\PY{o}{=}\PY{k+kp}{beta}\PY{p}{,}gamma\PYZus{}c1\PY{o}{=}gamma\PYZus{}c1\PY{p}{,}gamma\PYZus{}c2\PY{o}{=}gamma\PYZus{}c2\PY{p}{,}model\PY{o}{=}\PY{l+m}{2}\PY{p}{)}
              li\PY{p}{[[}g\PY{p}{]]} \PY{o}{=} \PY{k+kt}{list}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{s1\PYZsq{}}\PY{o}{=}tca.mdl1.summary\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{s2\PYZsq{}}\PY{o}{=}tca.mdl2.summary\PY{p}{)}
          \PY{p}{\PYZcb{}}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
[1] "gene\_1"
[1] "gene\_2"
[1] "gene\_3"
[1] "gene\_4"
[1] "gene\_5"
[1] "gene\_6"
[1] "gene\_7"
[1] "gene\_8"
[1] "gene\_9"
[1] "gene\_10"
[1] "gene\_11"
[1] "gene\_12"
[1] "gene\_13"
[1] "gene\_14"
[1] "gene\_15"
[1] "gene\_16"
[1] "gene\_17"
[1] "gene\_18"
[1] "gene\_19"
[1] "gene\_20"
[1] "gene\_21"
[1] "gene\_22"
[1] "gene\_23"
[1] "gene\_24"
[1] "gene\_25"
[1] "gene\_26"
[1] "gene\_27"
[1] "gene\_28"
[1] "gene\_29"
[1] "gene\_30"
[1] "gene\_31"
[1] "gene\_32"
[1] "gene\_33"
[1] "gene\_34"
[1] "gene\_35"
[1] "gene\_36"
[1] "gene\_37"
[1] "gene\_38"
[1] "gene\_39"
[1] "gene\_40"
[1] "gene\_41"
[1] "gene\_42"
[1] "gene\_43"
[1] "gene\_44"
[1] "gene\_45"
[1] "gene\_46"
[1] "gene\_47"
[1] "gene\_48"
[1] "gene\_49"
[1] "gene\_50"

    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}162}]:} mean\PYZus{}weight \PY{o}{=} \PY{k+kp}{signif}\PY{p}{(}\PY{k+kp}{apply}\PY{p}{(}params\PY{o}{\PYZdl{}}W\PY{p}{,}\PY{l+m}{2}\PY{p}{,}\PY{k+kp}{mean}\PY{p}{)}\PY{p}{,}digits\PY{o}{=}\PY{l+m}{3}\PY{p}{)}
          Z\PYZus{}hat\PYZus{}cor\PYZus{}tca1 \PY{o}{=} \PY{k+kp}{do.call}\PY{p}{(}\PY{k+kp}{rbind}\PY{p}{,}\PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}\PY{k+kp}{length}\PY{p}{(}data\PY{p}{)}\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} li\PY{p}{[[}x\PY{p}{]]}\PY{o}{\PYZdl{}}s1\PY{o}{\PYZdl{}}Z\PYZus{}hat\PYZus{}cor\PYZus{}tca\PY{p}{)}\PY{p}{)}
          Z\PYZus{}hat\PYZus{}cor\PYZus{}tca2 \PY{o}{=} \PY{k+kp}{do.call}\PY{p}{(}\PY{k+kp}{rbind}\PY{p}{,}\PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}\PY{k+kp}{length}\PY{p}{(}data\PY{p}{)}\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} li\PY{p}{[[}x\PY{p}{]]}\PY{o}{\PYZdl{}}s2\PY{o}{\PYZdl{}}Z\PYZus{}hat\PYZus{}cor\PYZus{}tca\PY{p}{)}\PY{p}{)}                                      
          
          par\PY{p}{(}mfrow\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{2}\PY{p}{,}\PY{l+m}{2}\PY{p}{)}\PY{p}{,}mar\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{4}\PY{p}{,} \PY{l+m}{3.8}\PY{p}{,} \PY{l+m}{4}\PY{p}{,} \PY{l+m}{2}\PY{p}{)} \PY{o}{+} \PY{l+m}{0.1}\PY{p}{)}
          opts\PY{o}{=}params\PY{o}{\PYZdl{}}cell\PYZus{}name
          \PY{k+kr}{for}\PY{p}{(}i \PY{k+kr}{in} \PY{l+m}{1}\PY{o}{:}\PY{k+kp}{length}\PY{p}{(}params\PY{o}{\PYZdl{}}cell\PYZus{}name\PY{p}{)}\PY{p}{)}\PY{p}{\PYZob{}}
              heading \PY{o}{=} \PY{k+kp}{paste}\PY{p}{(}opts\PY{p}{[}i\PY{p}{]}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{mean weight\PYZsq{}}\PY{p}{,}mean\PYZus{}weight\PY{p}{[}i\PY{p}{]}\PY{p}{,}sep\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{ \PYZsq{}}\PY{p}{)}
              plot\PY{p}{(}overlap\PY{p}{,}Z\PYZus{}hat\PYZus{}cor\PYZus{}tca1\PY{p}{[}\PY{p}{,}i\PY{p}{]}\PY{p}{,}xlab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{SNPs overlap of gene\PYZsq{}}\PY{p}{,}
                   ylab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{cor\PYZsq{}}\PY{p}{,}cex.lab\PY{o}{=}\PY{l+m}{1.2}\PY{p}{,}ylim\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{1}\PY{p}{)}\PY{p}{,}yaxs\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{r\PYZsq{}}\PY{p}{,}type\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{o\PYZsq{}}\PY{p}{,}col\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{red\PYZsq{}}\PY{p}{)}
              title\PY{p}{(}main\PY{o}{=}heading\PY{p}{,}font.main\PY{o}{=}\PY{l+m}{2}\PY{p}{,}cex.main\PY{o}{=}\PY{l+m}{1}\PY{p}{,}line\PY{o}{=}\PY{l+m}{1}\PY{p}{,}cex.lab\PY{o}{=}\PY{l+m}{1}\PY{p}{)}
              lines\PY{p}{(}overlap\PY{p}{,}Z\PYZus{}hat\PYZus{}cor\PYZus{}tca2\PY{p}{[}\PY{p}{,}i\PY{p}{]}\PY{p}{,}col\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{green\PYZsq{}}\PY{p}{,}type\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{o\PYZsq{}}\PY{p}{)}
              
          \PY{p}{\PYZcb{}}
          mtext\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{TCA\PYZsq{}s Z\PYZus{}hat \PYZlt{}Cor\PYZgt{} Ground truth train Z\PYZdq{}}\PY{p}{,}side\PY{o}{=}\PY{l+m}{3}\PY{p}{,}adj\PY{o}{=}\PY{l+m}{6}\PY{p}{,}cex\PY{o}{=}\PY{l+m}{0.9}\PY{p}{,}line\PY{o}{=}\PY{l+m}{24}\PY{p}{,}font\PY{o}{=}\PY{l+m}{2}\PY{p}{)}
          par\PY{p}{(}mfrow\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{2}\PY{p}{,}\PY{l+m}{1}\PY{p}{)}\PY{p}{,}mar\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{0}\PY{p}{)}\PY{p}{)}
          plot\PY{p}{(}\PY{l+m}{1}\PY{p}{,}type\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{n\PYZsq{}}\PY{p}{,}axes\PY{o}{=}\PY{k+kc}{FALSE}\PY{p}{,}xlab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZsq{}}\PY{p}{,}ylab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZsq{}}\PY{p}{)}
          legend\PY{p}{(}x\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{top\PYZsq{}}\PY{p}{,}inset\PY{o}{=}\PY{l+m}{0}\PY{p}{,}legend\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{mdl1:SNPs+C1\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{mdl2:C1\PYZsq{}}\PY{p}{)}\PY{p}{,}
                 col\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{red\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{green\PYZsq{}}\PY{p}{)}\PY{p}{,}lwd\PY{o}{=}\PY{l+m}{2}\PY{p}{,}cex\PY{o}{=}\PY{l+m}{0.7}\PY{p}{,}horiz\PY{o}{=}\PY{k+kc}{TRUE}\PY{p}{)}
\end{Verbatim}


    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_7_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_7_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}163}]:} beta\PYZus{}hat\PYZus{}cor\PYZus{}tca \PY{o}{=} \PY{k+kp}{do.call}\PY{p}{(}\PY{k+kp}{rbind}\PY{p}{,}\PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}\PY{k+kp}{length}\PY{p}{(}data\PY{p}{)}\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} \PY{k+kp}{unlist}\PY{p}{(}li\PY{p}{[[}x\PY{p}{]]}\PY{o}{\PYZdl{}}s1\PY{o}{\PYZdl{}}beta\PYZus{}hat\PYZus{}cor\PYZus{}tca\PY{p}{)}\PY{p}{)}\PY{p}{)}
          \PY{k+kp}{colnames}\PY{p}{(}beta\PYZus{}hat\PYZus{}cor\PYZus{}tca\PY{p}{)} \PY{o}{=} \PY{k+kp}{paste}\PY{p}{(}params\PY{o}{\PYZdl{}}cell\PYZus{}name\PY{p}{,}mean\PYZus{}weight\PY{p}{,}sep\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZbs{}n\PYZsq{}}\PY{p}{)}
          cor\PYZus{}beta\PYZus{}lasso\PYZus{}real1 \PY{o}{=} \PY{k+kp}{do.call}\PY{p}{(}\PY{k+kp}{rbind}\PY{p}{,}\PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}\PY{k+kp}{length}\PY{p}{(}data\PY{p}{)}\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} li\PY{p}{[[}x\PY{p}{]]}\PY{o}{\PYZdl{}}s1\PY{o}{\PYZdl{}}cor\PYZus{}beta\PYZus{}lasso\PYZus{}real\PY{p}{)}\PY{p}{)}
          cor\PYZus{}beta\PYZus{}lasso\PYZus{}real2 \PY{o}{=} \PY{k+kp}{do.call}\PY{p}{(}\PY{k+kp}{rbind}\PY{p}{,}\PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}\PY{k+kp}{length}\PY{p}{(}data\PY{p}{)}\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} li\PY{p}{[[}x\PY{p}{]]}\PY{o}{\PYZdl{}}s2\PY{o}{\PYZdl{}}cor\PYZus{}beta\PYZus{}lasso\PYZus{}real\PY{p}{)}\PY{p}{)}
          \PY{k+kp}{colnames}\PY{p}{(}cor\PYZus{}beta\PYZus{}lasso\PYZus{}real1\PY{p}{)} \PY{o}{=} \PY{k+kp}{paste}\PY{p}{(}params\PY{o}{\PYZdl{}}cell\PYZus{}name\PY{p}{,}mean\PYZus{}weight\PY{p}{,}sep\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZbs{}n\PYZsq{}}\PY{p}{)}
          \PY{k+kp}{colnames}\PY{p}{(}cor\PYZus{}beta\PYZus{}lasso\PYZus{}real2\PY{p}{)} \PY{o}{=} \PY{k+kp}{paste}\PY{p}{(}params\PY{o}{\PYZdl{}}cell\PYZus{}name\PY{p}{,}mean\PYZus{}weight\PY{p}{,}sep\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZbs{}n\PYZsq{}}\PY{p}{)}
          \PY{c+c1}{\PYZsh{} Cell type weight and correlation}
          par\PY{p}{(}cex.axis\PY{o}{=}\PY{l+m}{.8}\PY{p}{)}
          boxplot\PY{p}{(}beta\PYZus{}hat\PYZus{}cor\PYZus{}tca\PY{p}{,}ylab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{correlation\PYZsq{}}\PY{p}{,}
                  xlab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{Each dot being correlation of real/estimated beta of length n*1\PYZsq{}}\PY{p}{,}
                  boxwex\PY{o}{=}\PY{l+m}{0.5}\PY{p}{,}main\PY{o}{=}\PY{l+s}{\PYZdq{}}\PY{l+s}{TCA\PYZsq{}s beta\PYZus{}hat \PYZlt{}Cor\PYZgt{} Ground truth beta\PYZdq{}}\PY{p}{)}
          \PY{c+c1}{\PYZsh{} Heritibility and correlation}
          par\PY{p}{(}mfrow\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{2}\PY{p}{,}\PY{l+m}{2}\PY{p}{)}\PY{p}{,}mar\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{4}\PY{p}{,} \PY{l+m}{3.8}\PY{p}{,} \PY{l+m}{4}\PY{p}{,} \PY{l+m}{2}\PY{p}{)} \PY{o}{+} \PY{l+m}{0.1}\PY{p}{)}
          opts\PY{o}{=}params\PY{o}{\PYZdl{}}cell\PYZus{}name
          \PY{k+kr}{for}\PY{p}{(}i \PY{k+kr}{in} \PY{l+m}{1}\PY{o}{:}\PY{k+kp}{length}\PY{p}{(}params\PY{o}{\PYZdl{}}cell\PYZus{}name\PY{p}{)}\PY{p}{)}\PY{p}{\PYZob{}}
              heading \PY{o}{=} \PY{k+kp}{paste}\PY{p}{(}opts\PY{p}{[}i\PY{p}{]}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{mean weight\PYZsq{}}\PY{p}{,}mean\PYZus{}weight\PY{p}{[}i\PY{p}{]}\PY{p}{,}sep\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{ \PYZsq{}}\PY{p}{)}
              plot\PY{p}{(}overlap\PY{p}{,}beta\PYZus{}hat\PYZus{}cor\PYZus{}tca\PY{p}{[}\PY{p}{,}i\PY{p}{]}\PY{p}{,}xlab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{SNPs overlap of gene\PYZsq{}}\PY{p}{,}
                   ylab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{cor\PYZsq{}}\PY{p}{,}cex.lab\PY{o}{=}\PY{l+m}{1.2}\PY{p}{,}ylim\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{1}\PY{p}{)}\PY{p}{,}yaxs\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{r\PYZsq{}}\PY{p}{,}type\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{o\PYZsq{}}\PY{p}{,}col\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{red\PYZsq{}}\PY{p}{)}
              lines\PY{p}{(}overlap\PY{p}{,}cor\PYZus{}beta\PYZus{}lasso\PYZus{}real1\PY{p}{[}\PY{p}{,}i\PY{p}{]}\PY{p}{,}type\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{o\PYZsq{}}\PY{p}{,}col\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{green\PYZsq{}}\PY{p}{)}
              lines\PY{p}{(}overlap\PY{p}{,}cor\PYZus{}beta\PYZus{}lasso\PYZus{}real2\PY{p}{[}\PY{p}{,}i\PY{p}{]}\PY{p}{,}type\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{o\PYZsq{}}\PY{p}{,}col\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{forestgreen\PYZsq{}}\PY{p}{)}
              title\PY{p}{(}main\PY{o}{=}heading\PY{p}{,}font.main\PY{o}{=}\PY{l+m}{2}\PY{p}{,}cex.main\PY{o}{=}\PY{l+m}{1}\PY{p}{,}line\PY{o}{=}\PY{l+m}{1}\PY{p}{,}cex.lab\PY{o}{=}\PY{l+m}{1}\PY{p}{)}
          \PY{p}{\PYZcb{}}
          mtext\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{Estimated Z\PYZus{}hat \PYZlt{}Cor\PYZgt{} Ground truth train Z\PYZdq{}}\PY{p}{,}side\PY{o}{=}\PY{l+m}{3}\PY{p}{,}adj\PY{o}{=}\PY{l+m}{3.5}\PY{p}{,}cex\PY{o}{=}\PY{l+m}{0.9}\PY{p}{,}line\PY{o}{=}\PY{l+m}{24}\PY{p}{,}font\PY{o}{=}\PY{l+m}{2}\PY{p}{)}
          par\PY{p}{(}mfrow\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{2}\PY{p}{,}\PY{l+m}{1}\PY{p}{)}\PY{p}{,}mar\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{0}\PY{p}{)}\PY{p}{)}
          plot\PY{p}{(}\PY{l+m}{1}\PY{p}{,}type\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{n\PYZsq{}}\PY{p}{,}axes\PY{o}{=}\PY{k+kc}{FALSE}\PY{p}{,}xlab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZsq{}}\PY{p}{,}ylab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZsq{}}\PY{p}{)}
          legend\PY{p}{(}x\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{top\PYZsq{}}\PY{p}{,}inset\PY{o}{=}\PY{l+m}{0}\PY{p}{,}legend\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{TCA\PYZsq{}s beta\PYZus{}hat mdl1:SNPs+C1\PYZdq{}}\PY{p}{,}\PY{l+s}{\PYZdq{}}\PY{l+s}{Lasso\PYZsq{}s beta\PYZus{}hat mdl1:SNPs+C1\PYZdq{}}\PY{p}{,}\PY{l+s}{\PYZdq{}}\PY{l+s}{Lasso\PYZsq{}s beta\PYZus{}hat mdl2:C1\PYZdq{}}\PY{p}{)}\PY{p}{,}
                 col\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{red\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{green\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{forestgreen\PYZsq{}}\PY{p}{)}\PY{p}{,}lwd\PY{o}{=}\PY{l+m}{2}\PY{p}{,}cex\PY{o}{=}\PY{l+m}{0.7}\PY{p}{,}horiz\PY{o}{=}\PY{k+kc}{TRUE}\PY{p}{)}
\end{Verbatim}


    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_8_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_8_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_8_2.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}164}]:} gamma\PYZus{}hat\PYZus{}cor\PYZus{}tca1 \PY{o}{=} \PY{k+kp}{do.call}\PY{p}{(}\PY{k+kp}{rbind}\PY{p}{,}\PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}\PY{k+kp}{length}\PY{p}{(}data\PY{p}{)}\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} li\PY{p}{[[}x\PY{p}{]]}\PY{o}{\PYZdl{}}s1\PY{o}{\PYZdl{}}gamma\PYZus{}hat\PYZus{}cor\PYZus{}tca\PY{p}{)}\PY{p}{)}
          gamma\PYZus{}hat\PYZus{}cor\PYZus{}tca2 \PY{o}{=} \PY{k+kp}{do.call}\PY{p}{(}\PY{k+kp}{rbind}\PY{p}{,}\PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}\PY{k+kp}{length}\PY{p}{(}data\PY{p}{)}\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} li\PY{p}{[[}x\PY{p}{]]}\PY{o}{\PYZdl{}}s2\PY{o}{\PYZdl{}}gamma\PYZus{}hat\PYZus{}cor\PYZus{}tca\PY{p}{)}\PY{p}{)}
          gamma\PYZus{}cor \PY{o}{=} \PY{k+kp}{cbind}\PY{p}{(}gamma\PYZus{}hat\PYZus{}cor\PYZus{}tca1\PY{p}{,}gamma\PYZus{}hat\PYZus{}cor\PYZus{}tca2\PY{p}{)}
          \PY{k+kp}{colnames}\PY{p}{(}gamma\PYZus{}cor\PY{p}{)} \PY{o}{=} \PY{k+kt}{c}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{mdl1:SNPs+C1\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{mdl2:C1\PYZsq{}}\PY{p}{)}
          boxplot\PY{p}{(}gamma\PYZus{}cor\PY{p}{,}main\PY{o}{=}\PY{l+s}{\PYZdq{}}\PY{l+s}{TCA\PYZsq{}s gamma\PYZus{}hat \PYZlt{}Cor\PYZgt{} Ground truth gamma\PYZus{}hat\PYZdq{}}\PY{p}{,}
                  ylab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{cor\PYZsq{}}\PY{p}{,}boxwex\PY{o}{=}\PY{l+m}{0.5}\PY{p}{,}
                  xlab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{correlation of effect size of smoking/age/gender\PYZsq{}}\PY{p}{)}
\end{Verbatim}


    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_9_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}165}]:} Z\PYZus{}hat\PYZus{}train\PYZus{}seq\PYZus{}eq\PYZus{}cor\PYZus{}tca1 \PY{o}{=} \PY{k+kp}{do.call}\PY{p}{(}\PY{k+kp}{rbind}\PY{p}{,}\PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}\PY{k+kp}{length}\PY{p}{(}data\PY{p}{)}\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} li\PY{p}{[[}x\PY{p}{]]}\PY{o}{\PYZdl{}}s1\PY{o}{\PYZdl{}}Z\PYZus{}hat\PYZus{}train\PYZus{}second\PYZus{}eq\PYZus{}cor\PYZus{}tca\PY{p}{)}\PY{p}{)}
          Z\PYZus{}hat\PYZus{}train\PYZus{}seq\PYZus{}eq\PYZus{}cor\PYZus{}tca2 \PY{o}{=} \PY{k+kp}{do.call}\PY{p}{(}\PY{k+kp}{rbind}\PY{p}{,}\PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}\PY{k+kp}{length}\PY{p}{(}data\PY{p}{)}\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} li\PY{p}{[[}x\PY{p}{]]}\PY{o}{\PYZdl{}}s2\PY{o}{\PYZdl{}}Z\PYZus{}hat\PYZus{}train\PYZus{}second\PYZus{}eq\PYZus{}cor\PYZus{}tca\PY{p}{)}\PY{p}{)}
          Z\PYZus{}hat\PYZus{}test\PYZus{}seq\PYZus{}eq\PYZus{}cor\PYZus{}tca1 \PY{o}{=} \PY{k+kp}{do.call}\PY{p}{(}\PY{k+kp}{rbind}\PY{p}{,}\PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}\PY{k+kp}{length}\PY{p}{(}data\PY{p}{)}\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} li\PY{p}{[[}x\PY{p}{]]}\PY{o}{\PYZdl{}}s1\PY{o}{\PYZdl{}}Z\PYZus{}hat\PYZus{}test\PYZus{}second\PYZus{}eq\PYZus{}cor\PYZus{}tca\PY{p}{)}\PY{p}{)}
          Z\PYZus{}hat\PYZus{}test\PYZus{}seq\PYZus{}eq\PYZus{}cor\PYZus{}tca2 \PY{o}{=} \PY{k+kp}{do.call}\PY{p}{(}\PY{k+kp}{rbind}\PY{p}{,}\PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}\PY{k+kp}{length}\PY{p}{(}data\PY{p}{)}\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} li\PY{p}{[[}x\PY{p}{]]}\PY{o}{\PYZdl{}}s2\PY{o}{\PYZdl{}}Z\PYZus{}hat\PYZus{}test\PYZus{}second\PYZus{}eq\PYZus{}cor\PYZus{}tca\PY{p}{)}\PY{p}{)}
          
          par\PY{p}{(}mfrow\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{2}\PY{p}{,}\PY{l+m}{2}\PY{p}{)}\PY{p}{,}mar\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{4}\PY{p}{,} \PY{l+m}{3.8}\PY{p}{,} \PY{l+m}{4}\PY{p}{,} \PY{l+m}{2}\PY{p}{)} \PY{o}{+} \PY{l+m}{0.1}\PY{p}{)}
          opts\PY{o}{=}params\PY{o}{\PYZdl{}}cell\PYZus{}name
          \PY{k+kr}{for}\PY{p}{(}i \PY{k+kr}{in} \PY{l+m}{1}\PY{o}{:}params\PY{o}{\PYZdl{}}K\PY{p}{)}\PY{p}{\PYZob{}}
              heading \PY{o}{=} \PY{k+kp}{paste}\PY{p}{(}opts\PY{p}{[}i\PY{p}{]}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{mean weight\PYZsq{}}\PY{p}{,}mean\PYZus{}weight\PY{p}{[}i\PY{p}{]}\PY{p}{,}sep\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{ \PYZsq{}}\PY{p}{)}
              plot\PY{p}{(}overlap\PY{p}{,}Z\PYZus{}hat\PYZus{}train\PYZus{}seq\PYZus{}eq\PYZus{}cor\PYZus{}tca1\PY{p}{[}\PY{p}{,}i\PY{p}{]}\PY{p}{,}xlab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{SNPs overlap of gene\PYZsq{}}\PY{p}{,}
                   ylab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{cor\PYZsq{}}\PY{p}{,}cex.lab\PY{o}{=}\PY{l+m}{1.2}\PY{p}{,}ylim\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{1}\PY{p}{)}\PY{p}{,}yaxs\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{r\PYZsq{}}\PY{p}{,}type\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{o\PYZsq{}}\PY{p}{,}col\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{red\PYZsq{}}\PY{p}{)}
              title\PY{p}{(}main\PY{o}{=}heading\PY{p}{,}font.main\PY{o}{=}\PY{l+m}{2}\PY{p}{,}cex.main\PY{o}{=}\PY{l+m}{1}\PY{p}{,}line\PY{o}{=}\PY{l+m}{1}\PY{p}{,}cex.lab\PY{o}{=}\PY{l+m}{1}\PY{p}{)}
              lines\PY{p}{(}overlap\PY{p}{,}Z\PYZus{}hat\PYZus{}train\PYZus{}seq\PYZus{}eq\PYZus{}cor\PYZus{}tca2\PY{p}{[}\PY{p}{,}i\PY{p}{]}\PY{p}{,}col\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{green\PYZsq{}}\PY{p}{,}type\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{o\PYZsq{}}\PY{p}{)}
              lines\PY{p}{(}overlap\PY{p}{,}Z\PYZus{}hat\PYZus{}test\PYZus{}seq\PYZus{}eq\PYZus{}cor\PYZus{}tca1\PY{p}{[}\PY{p}{,}i\PY{p}{]}\PY{p}{,}col\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{firebrick\PYZsq{}}\PY{p}{,}type\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{o\PYZsq{}}\PY{p}{)}
              lines\PY{p}{(}overlap\PY{p}{,}Z\PYZus{}hat\PYZus{}test\PYZus{}seq\PYZus{}eq\PYZus{}cor\PYZus{}tca2\PY{p}{[}\PY{p}{,}i\PY{p}{]}\PY{p}{,}col\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{forestgreen\PYZsq{}}\PY{p}{,}type\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{o\PYZsq{}}\PY{p}{)}
          \PY{p}{\PYZcb{}}
          mtext\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{TCA\PYZsq{}s Z\PYZus{}hat 2nd eq \PYZlt{}Cor\PYZgt{} Ground truth train Z\PYZdq{}}\PY{p}{,}side\PY{o}{=}\PY{l+m}{3}\PY{p}{,}adj\PY{o}{=}\PY{l+m}{3}\PY{p}{,}cex\PY{o}{=}\PY{l+m}{0.9}\PY{p}{,}line\PY{o}{=}\PY{l+m}{24}\PY{p}{,}font\PY{o}{=}\PY{l+m}{2}\PY{p}{)}
          par\PY{p}{(}mfrow\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{2}\PY{p}{,}\PY{l+m}{1}\PY{p}{)}\PY{p}{,}mar\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{0}\PY{p}{)}\PY{p}{)}
          plot\PY{p}{(}\PY{l+m}{1}\PY{p}{,}type\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{n\PYZsq{}}\PY{p}{,}axes\PY{o}{=}\PY{k+kc}{FALSE}\PY{p}{,}xlab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZsq{}}\PY{p}{,}ylab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZsq{}}\PY{p}{)}
          legend\PY{p}{(}x\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{top\PYZsq{}}\PY{p}{,}inset\PY{o}{=}\PY{l+m}{0}\PY{p}{,}legend\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{mdl1 train:SNPs+C1\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{mdl2 train:C1\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{mdl1 test:SNPs+C1\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{mdl2 test:C1\PYZsq{}}\PY{p}{)}\PY{p}{,}
                 col\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{red\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{green\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{firebrick\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{forestgreen\PYZsq{}}\PY{p}{)}\PY{p}{,}lwd\PY{o}{=}\PY{l+m}{1}\PY{p}{,}cex\PY{o}{=}\PY{l+m}{0.7}\PY{p}{,}horiz\PY{o}{=}\PY{k+kc}{TRUE}\PY{p}{)}
\end{Verbatim}


    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_10_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_10_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}166}]:} G\PYZus{}hat\PYZus{}train\PYZus{}cor\PYZus{}bulk \PY{o}{=} \PY{k+kp}{do.call}\PY{p}{(}\PY{k+kp}{rbind}\PY{p}{,}\PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}\PY{k+kp}{length}\PY{p}{(}data\PY{p}{)}\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} li\PY{p}{[[}x\PY{p}{]]}\PY{o}{\PYZdl{}}s1\PY{o}{\PYZdl{}}G\PYZus{}hat\PYZus{}train\PYZus{}cor\PYZus{}bulk\PY{p}{)}\PY{p}{)}
          G\PYZus{}hat\PYZus{}test\PYZus{}cor\PYZus{}bulk \PY{o}{=} \PY{k+kp}{do.call}\PY{p}{(}\PY{k+kp}{rbind}\PY{p}{,}\PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}\PY{k+kp}{length}\PY{p}{(}data\PY{p}{)}\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} li\PY{p}{[[}x\PY{p}{]]}\PY{o}{\PYZdl{}}s1\PY{o}{\PYZdl{}}G\PYZus{}hat\PYZus{}test\PYZus{}cor\PYZus{}bulk\PY{p}{)}\PY{p}{)}
          plot\PY{p}{(}overlap\PY{p}{,}G\PYZus{}hat\PYZus{}train\PYZus{}cor\PYZus{}bulk\PY{p}{,}type\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{o\PYZsq{}}\PY{p}{,}col\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{red\PYZsq{}}\PY{p}{,}xlab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{SNPs overlap of gene\PYZsq{}}\PY{p}{,}ylab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{cor\PYZsq{}}\PY{p}{,}ylim\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{1}\PY{p}{)}\PY{p}{)}
          mtext\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{Bulk level GE, lasso by SNPs directly\PYZdq{}}\PY{p}{,}font\PY{o}{=}\PY{l+m}{2}\PY{p}{,}line\PY{o}{=}\PY{l+m}{1}\PY{p}{)}
          lines\PY{p}{(}overlap\PY{p}{,}G\PYZus{}hat\PYZus{}test\PYZus{}cor\PYZus{}bulk\PY{p}{,}col\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{green\PYZsq{}}\PY{p}{,}type\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{o\PYZsq{}}\PY{p}{)}
          legend\PY{p}{(}x\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{topleft\PYZsq{}}\PY{p}{,}inset\PY{o}{=}\PY{l+m}{0}\PY{p}{,}legend\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{train\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{test\PYZsq{}}\PY{p}{)}\PY{p}{,}
                 col\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{red\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{green\PYZsq{}}\PY{p}{)}\PY{p}{,}lwd\PY{o}{=}\PY{l+m}{2}\PY{p}{,}cex\PY{o}{=}\PY{l+m}{1}\PY{p}{,}horiz\PY{o}{=}\PY{k+kc}{FALSE}\PY{p}{)}
\end{Verbatim}


    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_11_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}167}]:} cor\PYZus{}lasso\PYZus{}tca1 \PY{o}{=} \PY{k+kp}{do.call}\PY{p}{(}\PY{k+kp}{rbind}\PY{p}{,}\PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}\PY{k+kp}{length}\PY{p}{(}data\PY{p}{)}\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} li\PY{p}{[[}x\PY{p}{]]}\PY{o}{\PYZdl{}}s1\PY{o}{\PYZdl{}}cor\PYZus{}lasso\PYZus{}tca\PY{p}{)}\PY{p}{)}
          cor\PYZus{}lasso\PYZus{}tca2 \PY{o}{=} \PY{k+kp}{do.call}\PY{p}{(}\PY{k+kp}{rbind}\PY{p}{,}\PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}\PY{k+kp}{length}\PY{p}{(}data\PY{p}{)}\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} li\PY{p}{[[}x\PY{p}{]]}\PY{o}{\PYZdl{}}s2\PY{o}{\PYZdl{}}cor\PYZus{}lasso\PYZus{}tca\PY{p}{)}\PY{p}{)}
          par\PY{p}{(}mfrow\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{2}\PY{p}{,}\PY{l+m}{2}\PY{p}{)}\PY{p}{,}mar\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{4}\PY{p}{,} \PY{l+m}{3.8}\PY{p}{,} \PY{l+m}{4}\PY{p}{,} \PY{l+m}{2}\PY{p}{)} \PY{o}{+} \PY{l+m}{0.1}\PY{p}{)}
          opts\PY{o}{=}params\PY{o}{\PYZdl{}}cell\PYZus{}name
          \PY{k+kr}{for}\PY{p}{(}i \PY{k+kr}{in} \PY{l+m}{1}\PY{o}{:}\PY{k+kp}{length}\PY{p}{(}params\PY{o}{\PYZdl{}}cell\PYZus{}name\PY{p}{)}\PY{p}{)}\PY{p}{\PYZob{}}
              heading \PY{o}{=} \PY{k+kp}{paste}\PY{p}{(}opts\PY{p}{[}i\PY{p}{]}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{mean weight\PYZsq{}}\PY{p}{,}mean\PYZus{}weight\PY{p}{[}i\PY{p}{]}\PY{p}{,}sep\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{ \PYZsq{}}\PY{p}{)}
              plot\PY{p}{(}overlap\PY{p}{,}cor\PYZus{}lasso\PYZus{}tca1\PY{p}{[}\PY{p}{,}i\PY{p}{]}\PY{p}{,}xlab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{SNPs overlap of gene\PYZsq{}}\PY{p}{,}
                   ylab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{cor\PYZsq{}}\PY{p}{,}cex.lab\PY{o}{=}\PY{l+m}{1.2}\PY{p}{,}ylim\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{1}\PY{p}{)}\PY{p}{,}yaxs\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{r\PYZsq{}}\PY{p}{,}type\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{o\PYZsq{}}\PY{p}{,}col\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{red\PYZsq{}}\PY{p}{)}
              title\PY{p}{(}main\PY{o}{=}heading\PY{p}{,}font.main\PY{o}{=}\PY{l+m}{2}\PY{p}{,}cex.main\PY{o}{=}\PY{l+m}{1}\PY{p}{,}line\PY{o}{=}\PY{l+m}{1}\PY{p}{,}cex.lab\PY{o}{=}\PY{l+m}{1}\PY{p}{)}
              lines\PY{p}{(}overlap\PY{p}{,}cor\PYZus{}lasso\PYZus{}tca2\PY{p}{[}\PY{p}{,}i\PY{p}{]}\PY{p}{,}col\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{green\PYZsq{}}\PY{p}{,}type\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{o\PYZsq{}}\PY{p}{)}
              
          \PY{p}{\PYZcb{}}
          mtext\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{TCA\PYZsq{}s Z\PYZus{}hat \PYZlt{}Cor\PYZgt{} Lasso Z\PYZus{}hat\PYZdq{}}\PY{p}{,}side\PY{o}{=}\PY{l+m}{3}\PY{p}{,}adj\PY{o}{=}\PY{l+m}{\PYZhy{}7}\PY{p}{,}cex\PY{o}{=}\PY{l+m}{0.9}\PY{p}{,}line\PY{o}{=}\PY{l+m}{24}\PY{p}{,}font\PY{o}{=}\PY{l+m}{2}\PY{p}{)}
          par\PY{p}{(}mfrow\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{2}\PY{p}{,}\PY{l+m}{1}\PY{p}{)}\PY{p}{,}mar\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{0}\PY{p}{)}\PY{p}{)}
          plot\PY{p}{(}\PY{l+m}{1}\PY{p}{,}type\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{n\PYZsq{}}\PY{p}{,}axes\PY{o}{=}\PY{k+kc}{FALSE}\PY{p}{,}xlab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZsq{}}\PY{p}{,}ylab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZsq{}}\PY{p}{)}
          legend\PY{p}{(}x\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{top\PYZsq{}}\PY{p}{,}inset\PY{o}{=}\PY{l+m}{0}\PY{p}{,}legend\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{mdl1:SNPs+C1\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{mdl2:C1\PYZsq{}}\PY{p}{)}\PY{p}{,}
                 col\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{red\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{green\PYZsq{}}\PY{p}{)}\PY{p}{,}lwd\PY{o}{=}\PY{l+m}{2}\PY{p}{,}cex\PY{o}{=}\PY{l+m}{0.7}\PY{p}{,}horiz\PY{o}{=}\PY{k+kc}{TRUE}\PY{p}{)}
\end{Verbatim}


    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_12_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_12_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}168}]:} cor\PYZus{}lasso\PYZus{}real\PYZus{}train1 \PY{o}{=} \PY{k+kp}{do.call}\PY{p}{(}\PY{k+kp}{rbind}\PY{p}{,}\PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}\PY{k+kp}{length}\PY{p}{(}data\PY{p}{)}\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} li\PY{p}{[[}x\PY{p}{]]}\PY{o}{\PYZdl{}}s1\PY{o}{\PYZdl{}}cor\PYZus{}lasso\PYZus{}real\PYZus{}train\PY{p}{)}\PY{p}{)}
          cor\PYZus{}lasso\PYZus{}real\PYZus{}train2 \PY{o}{=} \PY{k+kp}{do.call}\PY{p}{(}\PY{k+kp}{rbind}\PY{p}{,}\PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}\PY{k+kp}{length}\PY{p}{(}data\PY{p}{)}\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} li\PY{p}{[[}x\PY{p}{]]}\PY{o}{\PYZdl{}}s2\PY{o}{\PYZdl{}}cor\PYZus{}lasso\PYZus{}real\PYZus{}train\PY{p}{)}\PY{p}{)}
          cor\PYZus{}lasso\PYZus{}real\PYZus{}test1 \PY{o}{=} \PY{k+kp}{do.call}\PY{p}{(}\PY{k+kp}{rbind}\PY{p}{,}\PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}\PY{k+kp}{length}\PY{p}{(}data\PY{p}{)}\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} li\PY{p}{[[}x\PY{p}{]]}\PY{o}{\PYZdl{}}s1\PY{o}{\PYZdl{}}cor\PYZus{}lasso\PYZus{}real\PYZus{}test\PY{p}{)}\PY{p}{)}
          cor\PYZus{}lasso\PYZus{}real\PYZus{}test2 \PY{o}{=} \PY{k+kp}{do.call}\PY{p}{(}\PY{k+kp}{rbind}\PY{p}{,}\PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}\PY{k+kp}{length}\PY{p}{(}data\PY{p}{)}\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} li\PY{p}{[[}x\PY{p}{]]}\PY{o}{\PYZdl{}}s2\PY{o}{\PYZdl{}}cor\PYZus{}lasso\PYZus{}real\PYZus{}test\PY{p}{)}\PY{p}{)}
          \PY{k+kp}{colnames}\PY{p}{(}cor\PYZus{}lasso\PYZus{}real\PYZus{}train1\PY{p}{)} \PY{o}{=} \PY{k+kp}{paste}\PY{p}{(}params\PY{o}{\PYZdl{}}cell\PYZus{}name\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZbs{}n\PYZsq{}}\PY{p}{,}mean\PYZus{}weight\PY{p}{)}
          \PY{k+kp}{colnames}\PY{p}{(}cor\PYZus{}lasso\PYZus{}real\PYZus{}train2\PY{p}{)} \PY{o}{=} \PY{k+kp}{paste}\PY{p}{(}params\PY{o}{\PYZdl{}}cell\PYZus{}name\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZbs{}n\PYZsq{}}\PY{p}{,}mean\PYZus{}weight\PY{p}{)}
          \PY{k+kp}{colnames}\PY{p}{(}cor\PYZus{}lasso\PYZus{}real\PYZus{}test1\PY{p}{)} \PY{o}{=} \PY{k+kp}{paste}\PY{p}{(}params\PY{o}{\PYZdl{}}cell\PYZus{}name\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZbs{}n\PYZsq{}}\PY{p}{,}mean\PYZus{}weight\PY{p}{)}
          \PY{k+kp}{colnames}\PY{p}{(}cor\PYZus{}lasso\PYZus{}real\PYZus{}test2\PY{p}{)} \PY{o}{=} \PY{k+kp}{paste}\PY{p}{(}params\PY{o}{\PYZdl{}}cell\PYZus{}name\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZbs{}n\PYZsq{}}\PY{p}{,}mean\PYZus{}weight\PY{p}{)}                                            
          par\PY{p}{(}mfrow\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{2}\PY{p}{,}\PY{l+m}{2}\PY{p}{)}\PY{p}{,}mar\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{4}\PY{p}{,} \PY{l+m}{3.8}\PY{p}{,} \PY{l+m}{4}\PY{p}{,} \PY{l+m}{2}\PY{p}{)} \PY{o}{+} \PY{l+m}{0.1}\PY{p}{)}
          opts\PY{o}{=}params\PY{o}{\PYZdl{}}cell\PYZus{}name
          \PY{k+kr}{for}\PY{p}{(}i \PY{k+kr}{in} \PY{l+m}{1}\PY{o}{:}\PY{k+kp}{length}\PY{p}{(}params\PY{o}{\PYZdl{}}cell\PYZus{}name\PY{p}{)}\PY{p}{)}\PY{p}{\PYZob{}}
              heading \PY{o}{=} \PY{k+kp}{paste}\PY{p}{(}opts\PY{p}{[}i\PY{p}{]}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{mean weight\PYZsq{}}\PY{p}{,}mean\PYZus{}weight\PY{p}{[}i\PY{p}{]}\PY{p}{,}sep\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{ \PYZsq{}}\PY{p}{)}
              plot\PY{p}{(}overlap\PY{p}{,}cor\PYZus{}lasso\PYZus{}real\PYZus{}train1\PY{p}{[}\PY{p}{,}i\PY{p}{]}\PY{p}{,}xlab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{SNPs overlap of gene\PYZsq{}}\PY{p}{,}
                   ylab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{cor\PYZsq{}}\PY{p}{,}cex.lab\PY{o}{=}\PY{l+m}{1.2}\PY{p}{,}ylim\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{1}\PY{p}{)}\PY{p}{,}yaxs\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{r\PYZsq{}}\PY{p}{,}type\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{o\PYZsq{}}\PY{p}{,}col\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{red\PYZsq{}}\PY{p}{)}
              title\PY{p}{(}main\PY{o}{=}heading\PY{p}{,}font.main\PY{o}{=}\PY{l+m}{2}\PY{p}{,}cex.main\PY{o}{=}\PY{l+m}{1}\PY{p}{,}line\PY{o}{=}\PY{l+m}{1}\PY{p}{,}cex.lab\PY{o}{=}\PY{l+m}{1}\PY{p}{)}
              lines\PY{p}{(}overlap\PY{p}{,}cor\PYZus{}lasso\PYZus{}real\PYZus{}train2\PY{p}{[}\PY{p}{,}i\PY{p}{]}\PY{p}{,}col\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{green\PYZsq{}}\PY{p}{,}type\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{o\PYZsq{}}\PY{p}{)}
              lines\PY{p}{(}overlap\PY{p}{,}cor\PYZus{}lasso\PYZus{}real\PYZus{}test1\PY{p}{[}\PY{p}{,}i\PY{p}{]}\PY{p}{,}col\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{firebrick\PYZsq{}}\PY{p}{,}type\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{o\PYZsq{}}\PY{p}{)}
              lines\PY{p}{(}overlap\PY{p}{,}cor\PYZus{}lasso\PYZus{}real\PYZus{}test2\PY{p}{[}\PY{p}{,}i\PY{p}{]}\PY{p}{,}col\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{forestgreen\PYZsq{}}\PY{p}{,}type\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{o\PYZsq{}}\PY{p}{)}
          \PY{p}{\PYZcb{}}
          mtext\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{Lasso Z\PYZus{}hat \PYZlt{}Cor\PYZgt{} Ground Truth Z\PYZdq{}}\PY{p}{,}side\PY{o}{=}\PY{l+m}{3}\PY{p}{,}adj\PY{o}{=}\PY{l+m}{7}\PY{p}{,}cex\PY{o}{=}\PY{l+m}{1}\PY{p}{,}line\PY{o}{=}\PY{l+m}{24}\PY{p}{,}font\PY{o}{=}\PY{l+m}{2}\PY{p}{)}
          par\PY{p}{(}mfrow\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{2}\PY{p}{,}\PY{l+m}{1}\PY{p}{)}\PY{p}{,}mar\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{0}\PY{p}{)}\PY{p}{)}
          plot\PY{p}{(}\PY{l+m}{1}\PY{p}{,}type\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{n\PYZsq{}}\PY{p}{,}axes\PY{o}{=}\PY{k+kc}{FALSE}\PY{p}{,}xlab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZsq{}}\PY{p}{,}ylab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZsq{}}\PY{p}{)}
          legend\PY{p}{(}x\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{top\PYZsq{}}\PY{p}{,}inset\PY{o}{=}\PY{l+m}{0}\PY{p}{,}legend\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{mdl1 train:SNPs+C1\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{mdl2 train:C1\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{mdl1 test:SNPs+C1\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{mdl2 test:C1\PYZsq{}}\PY{p}{)}\PY{p}{,}
                 col\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{red\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{green\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{firebrick\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{forestgreen\PYZsq{}}\PY{p}{)}\PY{p}{,}lwd\PY{o}{=}\PY{l+m}{2}\PY{p}{,}cex\PY{o}{=}\PY{l+m}{0.7}\PY{p}{,}horiz\PY{o}{=}\PY{k+kc}{TRUE}\PY{p}{)}
\end{Verbatim}


    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_13_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_13_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}169}]:} par\PY{p}{(}mar\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{0}\PY{p}{)}\PY{p}{,}cex.axis\PY{o}{=}\PY{l+m}{.7}\PY{p}{)}
          par\PY{p}{(}mfrow\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{2}\PY{p}{,}\PY{l+m}{2}\PY{p}{)}\PY{p}{,}mar\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{3.8}\PY{p}{,} \PY{l+m}{3.7}\PY{p}{,} \PY{l+m}{4}\PY{p}{,} \PY{l+m}{2}\PY{p}{)}\PY{p}{)}
          boxplot\PY{p}{(}cor\PYZus{}lasso\PYZus{}real\PYZus{}train1\PY{p}{,}ylab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{cor\PYZsq{}}\PY{p}{,}
                  xlab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{mdl1 train:SNPs+C1\PYZsq{}}\PY{p}{,}boxwex\PY{o}{=}\PY{l+m}{0.7}\PY{p}{,}ylim\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{1}\PY{p}{)}\PY{p}{)}
          boxplot\PY{p}{(}cor\PYZus{}lasso\PYZus{}real\PYZus{}train2\PY{p}{,}ylab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{cor\PYZsq{}}\PY{p}{,}
                  xlab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{mdl2 train:C1\PYZsq{}}\PY{p}{,}boxwex\PY{o}{=}\PY{l+m}{0.7}\PY{p}{,}ylim\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{1}\PY{p}{)}\PY{p}{)}
          boxplot\PY{p}{(}cor\PYZus{}lasso\PYZus{}real\PYZus{}test1\PY{p}{,}ylab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{cor\PYZsq{}}\PY{p}{,}
                  xlab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{mdl1 test:SNPs+C1\PYZsq{}}\PY{p}{,}ylim\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{1}\PY{p}{)}\PY{p}{,}boxwex\PY{o}{=}\PY{l+m}{0.7}\PY{p}{)}
          boxplot\PY{p}{(}cor\PYZus{}lasso\PYZus{}real\PYZus{}test2\PY{p}{,}ylab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{cor\PYZsq{}}\PY{p}{,}
                  xlab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{mdl2 test:C1\PYZsq{}}\PY{p}{,}boxwex\PY{o}{=}\PY{l+m}{0.7}\PY{p}{,}ylim\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{1}\PY{p}{)}\PY{p}{)}
          mtext\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{Lasso Z\PYZus{}hat \PYZlt{}Cor\PYZgt{} Ground Truth Z\PYZdq{}}\PY{p}{,}side\PY{o}{=}\PY{l+m}{3}\PY{p}{,}adj\PY{o}{=}\PY{l+m}{8}\PY{p}{,}cex\PY{o}{=}\PY{l+m}{1}\PY{p}{,}line\PY{o}{=}\PY{l+m}{23}\PY{p}{,}font\PY{o}{=}\PY{l+m}{2}\PY{p}{)}
\end{Verbatim}


    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_14_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}170}]:} lasso\PYZus{}dev\PYZus{}rat1 \PY{o}{=} \PY{k+kp}{do.call}\PY{p}{(}\PY{k+kp}{rbind}\PY{p}{,}\PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}\PY{k+kp}{length}\PY{p}{(}data\PY{p}{)}\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} li\PY{p}{[[}x\PY{p}{]]}\PY{o}{\PYZdl{}}s1\PY{o}{\PYZdl{}}dev\PYZus{}rat\PY{p}{)}\PY{p}{)}
          lasso\PYZus{}dev\PYZus{}rat2 \PY{o}{=} \PY{k+kp}{do.call}\PY{p}{(}\PY{k+kp}{rbind}\PY{p}{,}\PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}\PY{k+kp}{length}\PY{p}{(}data\PY{p}{)}\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} li\PY{p}{[[}x\PY{p}{]]}\PY{o}{\PYZdl{}}s2\PY{o}{\PYZdl{}}dev\PYZus{}rat\PY{p}{)}\PY{p}{)}
          \PY{k+kp}{colnames}\PY{p}{(}lasso\PYZus{}dev\PYZus{}rat1\PY{p}{)} \PY{o}{=} \PY{k+kp}{paste}\PY{p}{(}params\PY{o}{\PYZdl{}}cell\PYZus{}name\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZbs{}n\PYZsq{}}\PY{p}{,}mean\PYZus{}weight\PY{p}{)}
          \PY{k+kp}{colnames}\PY{p}{(}lasso\PYZus{}dev\PYZus{}rat2\PY{p}{)} \PY{o}{=} \PY{k+kp}{paste}\PY{p}{(}params\PY{o}{\PYZdl{}}cell\PYZus{}name\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZbs{}n\PYZsq{}}\PY{p}{,}mean\PYZus{}weight\PY{p}{)}
          par\PY{p}{(}mfrow\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{2}\PY{p}{,}\PY{l+m}{2}\PY{p}{)}\PY{p}{,}mar\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{4}\PY{p}{,} \PY{l+m}{3.8}\PY{p}{,} \PY{l+m}{4}\PY{p}{,} \PY{l+m}{2}\PY{p}{)} \PY{o}{+} \PY{l+m}{0.1}\PY{p}{)}
          opts\PY{o}{=}params\PY{o}{\PYZdl{}}cell\PYZus{}name
          \PY{k+kr}{for}\PY{p}{(}i \PY{k+kr}{in} \PY{l+m}{1}\PY{o}{:}params\PY{o}{\PYZdl{}}K\PY{p}{)}\PY{p}{\PYZob{}}
              heading \PY{o}{=} \PY{k+kp}{paste}\PY{p}{(}opts\PY{p}{[}i\PY{p}{]}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{mean weight\PYZsq{}}\PY{p}{,}mean\PYZus{}weight\PY{p}{[}i\PY{p}{]}\PY{p}{,}sep\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{ \PYZsq{}}\PY{p}{)}
              plot\PY{p}{(}overlap\PY{p}{,}lasso\PYZus{}dev\PYZus{}rat1\PY{p}{[}\PY{p}{,}i\PY{p}{]}\PY{p}{,}xlab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{SNPs overlap of gene\PYZsq{}}\PY{p}{,}
                   ylab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{var explained \PYZpc{}\PYZsq{}}\PY{p}{,}cex.lab\PY{o}{=}\PY{l+m}{1.2}\PY{p}{,}ylim\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{1}\PY{p}{)}\PY{p}{,}yaxs\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{r\PYZsq{}}\PY{p}{,}type\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{o\PYZsq{}}\PY{p}{,}col\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{red\PYZsq{}}\PY{p}{)}
              title\PY{p}{(}main\PY{o}{=}heading\PY{p}{,}font.main\PY{o}{=}\PY{l+m}{2}\PY{p}{,}cex.main\PY{o}{=}\PY{l+m}{1}\PY{p}{,}line\PY{o}{=}\PY{l+m}{1}\PY{p}{,}cex.lab\PY{o}{=}\PY{l+m}{1}\PY{p}{)}
              lines\PY{p}{(}overlap\PY{p}{,}lasso\PYZus{}dev\PYZus{}rat2\PY{p}{[}\PY{p}{,}i\PY{p}{]}\PY{p}{,}col\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{green\PYZsq{}}\PY{p}{,}type\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{o\PYZsq{}}\PY{p}{)}
          \PY{p}{\PYZcb{}}
          mtext\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{Lasso Z\PYZus{}hat \PYZlt{}dev exp\PYZgt{} Ground Truth Z\PYZdq{}}\PY{p}{,}side\PY{o}{=}\PY{l+m}{3}\PY{p}{,}adj\PY{o}{=}\PY{l+m}{3.5}\PY{p}{,}cex\PY{o}{=}\PY{l+m}{1}\PY{p}{,}line\PY{o}{=}\PY{l+m}{23.5}\PY{p}{,}font\PY{o}{=}\PY{l+m}{2}\PY{p}{)}
          par\PY{p}{(}mfrow\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{2}\PY{p}{,}\PY{l+m}{1}\PY{p}{)}\PY{p}{,}mar\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{0}\PY{p}{)}\PY{p}{)}
          plot\PY{p}{(}\PY{l+m}{1}\PY{p}{,}type\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{n\PYZsq{}}\PY{p}{,}axes\PY{o}{=}\PY{k+kc}{FALSE}\PY{p}{,}xlab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZsq{}}\PY{p}{,}ylab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZsq{}}\PY{p}{)}
          legend\PY{p}{(}x\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{top\PYZsq{}}\PY{p}{,}inset\PY{o}{=}\PY{l+m}{0}\PY{p}{,}legend\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{mdl1 train:SNPs+C1\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{mdl2 train:C1\PYZsq{}}\PY{p}{)}\PY{p}{,}
                 col\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{red\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{green\PYZsq{}}\PY{p}{)}\PY{p}{,}lwd\PY{o}{=}\PY{l+m}{2}\PY{p}{,}cex\PY{o}{=}\PY{l+m}{0.7}\PY{p}{,}horiz\PY{o}{=}\PY{k+kc}{TRUE}\PY{p}{)}
\end{Verbatim}


    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_15_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_15_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}171}]:} beta\PYZus{}precision\PYZus{}lasso1 \PY{o}{=}　\PY{k+kt}{matrix}\PY{p}{(}\PY{k+kp}{do.call}\PY{p}{(}\PY{k+kp}{rbind}\PY{p}{,}\PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}\PY{k+kp}{length}\PY{p}{(}data\PY{p}{)}\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} li\PY{p}{[[}x\PY{p}{]]}\PY{o}{\PYZdl{}}s1\PY{o}{\PYZdl{}}precision\PYZus{}lasso\PY{p}{)}\PY{p}{)}\PY{p}{,}nrow\PY{o}{=}params\PY{o}{\PYZdl{}}K\PY{p}{)}
          beta\PYZus{}precision\PYZus{}lasso2 \PY{o}{=} \PY{k+kt}{matrix}\PY{p}{(}\PY{k+kp}{do.call}\PY{p}{(}\PY{k+kp}{rbind}\PY{p}{,}\PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}\PY{k+kp}{length}\PY{p}{(}data\PY{p}{)}\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} li\PY{p}{[[}x\PY{p}{]]}\PY{o}{\PYZdl{}}s2\PY{o}{\PYZdl{}}precision\PYZus{}lasso\PY{p}{)}\PY{p}{)}\PY{p}{,}nrow\PY{o}{=}params\PY{o}{\PYZdl{}}K\PY{p}{)}
          beta\PYZus{}recall\PYZus{}lasso1 \PY{o}{=}　\PY{k+kt}{matrix}\PY{p}{(}\PY{k+kp}{do.call}\PY{p}{(}\PY{k+kp}{rbind}\PY{p}{,}\PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}\PY{k+kp}{length}\PY{p}{(}data\PY{p}{)}\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} li\PY{p}{[[}x\PY{p}{]]}\PY{o}{\PYZdl{}}s1\PY{o}{\PYZdl{}}recall\PYZus{}lasso\PY{p}{)}\PY{p}{)}\PY{p}{,}nrow\PY{o}{=}params\PY{o}{\PYZdl{}}K\PY{p}{)}
          beta\PYZus{}recall\PYZus{}lasso2 \PY{o}{=} \PY{k+kt}{matrix}\PY{p}{(}\PY{k+kp}{do.call}\PY{p}{(}\PY{k+kp}{rbind}\PY{p}{,}\PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}\PY{k+kp}{length}\PY{p}{(}data\PY{p}{)}\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} li\PY{p}{[[}x\PY{p}{]]}\PY{o}{\PYZdl{}}s2\PY{o}{\PYZdl{}}recall\PYZus{}lasso\PY{p}{)}\PY{p}{)}\PY{p}{,}nrow\PY{o}{=}params\PY{o}{\PYZdl{}}K\PY{p}{)}
          prec\PYZus{}rec\PYZus{}frame \PY{o}{=} \PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}params\PY{o}{\PYZdl{}}K\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} \PY{k+kp}{t}\PY{p}{(}\PY{k+kp}{rbind}\PY{p}{(}beta\PYZus{}precision\PYZus{}lasso1\PY{p}{[}x\PY{p}{,}\PY{p}{]}\PY{p}{,}beta\PYZus{}precision\PYZus{}lasso2\PY{p}{[}x\PY{p}{,}\PY{p}{]}\PY{p}{,}beta\PYZus{}recall\PYZus{}lasso1\PY{p}{[}x\PY{p}{,}\PY{p}{]}\PY{p}{,}beta\PYZus{}recall\PYZus{}lasso2\PY{p}{[}x\PY{p}{,}\PY{p}{]}\PY{p}{)}\PY{p}{)}\PY{p}{)}
          
          par\PY{p}{(}mfrow\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{2}\PY{p}{,}\PY{l+m}{2}\PY{p}{)}\PY{p}{,}mar\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{4}\PY{p}{,} \PY{l+m}{3.8}\PY{p}{,} \PY{l+m}{4}\PY{p}{,} \PY{l+m}{2}\PY{p}{)} \PY{o}{+} \PY{l+m}{0.1}\PY{p}{)}
          opts\PY{o}{=}\PY{k+kp}{paste}\PY{p}{(}params\PY{o}{\PYZdl{}}cell\PYZus{}name\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{ W:\PYZsq{}}\PY{p}{,}mean\PYZus{}weight\PY{p}{)}
          \PY{k+kr}{for}\PY{p}{(}i \PY{k+kr}{in} \PY{l+m}{1}\PY{o}{:}params\PY{o}{\PYZdl{}}K\PY{p}{)}\PY{p}{\PYZob{}}
              boxplot\PY{p}{(}prec\PYZus{}rec\PYZus{}frame\PY{p}{[[}i\PY{p}{]]}\PY{p}{,}ylab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{precision/recall\PYZsq{}}\PY{p}{,}
                  xlab\PY{o}{=}opts\PY{p}{[}i\PY{p}{]}\PY{p}{,}boxwex\PY{o}{=}\PY{l+m}{0.7}\PY{p}{,}ylim\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{1}\PY{p}{)}\PY{p}{,}col\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{red\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{green\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{firebrick\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{forestgreen\PYZsq{}}\PY{p}{)}\PY{p}{)}
          \PY{p}{\PYZcb{}}
          mtext\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{Precision/Recall for Lasso\PYZsq{}s beta\PYZus{}hat\PYZdq{}}\PY{p}{,}side\PY{o}{=}\PY{l+m}{3}\PY{p}{,}adj\PY{o}{=}\PY{l+m}{12.5}\PY{p}{,}cex\PY{o}{=}\PY{l+m}{0.9}\PY{p}{,}line\PY{o}{=}\PY{l+m}{22.5}\PY{p}{,}font\PY{o}{=}\PY{l+m}{2}\PY{p}{)}
          par\PY{p}{(}mfrow\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{2}\PY{p}{,}\PY{l+m}{1}\PY{p}{)}\PY{p}{,}mar\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{0}\PY{p}{)}\PY{p}{)}
          plot\PY{p}{(}\PY{l+m}{1}\PY{p}{,}type\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{n\PYZsq{}}\PY{p}{,}axes\PY{o}{=}\PY{k+kc}{FALSE}\PY{p}{,}xlab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZsq{}}\PY{p}{,}ylab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZsq{}}\PY{p}{)}
          legend\PY{p}{(}x\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{top\PYZsq{}}\PY{p}{,}inset\PY{o}{=}\PY{l+m}{0}\PY{p}{,}legend\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{precision mdl1:SNPs+C1\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{precision mdl2:C1\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{recall mdl1:SNPs+C1\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{recall mdl2:C1\PYZsq{}}\PY{p}{)}\PY{p}{,}
                 col\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{red\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{green\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{firebrick\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{forestgreen\PYZsq{}}\PY{p}{)}\PY{p}{,}lwd\PY{o}{=}\PY{l+m}{1}\PY{p}{,}cex\PY{o}{=}\PY{l+m}{0.65}\PY{p}{,}horiz\PY{o}{=}\PY{k+kc}{TRUE}\PY{p}{)}
\end{Verbatim}


    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_16_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_16_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}172}]:} par\PY{p}{(}mfrow\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{2}\PY{p}{,}\PY{l+m}{2}\PY{p}{)}\PY{p}{,}mar\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{4}\PY{p}{,} \PY{l+m}{3.8}\PY{p}{,} \PY{l+m}{4}\PY{p}{,} \PY{l+m}{2}\PY{p}{)} \PY{o}{+} \PY{l+m}{0.1}\PY{p}{)}
          \PY{k+kr}{for}\PY{p}{(}i \PY{k+kr}{in} \PY{l+m}{1}\PY{o}{:}params\PY{o}{\PYZdl{}}K\PY{p}{)}\PY{p}{\PYZob{}}
              plot\PY{p}{(}overlap\PY{p}{,}prec\PYZus{}rec\PYZus{}frame\PY{p}{[[}i\PY{p}{]]}\PY{p}{[}\PY{p}{,}\PY{l+m}{1}\PY{p}{]}\PY{p}{,}xlab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{SNPs overlap of gene\PYZsq{}}\PY{p}{,}
                   ylab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{precision/recall\PYZsq{}}\PY{p}{,}cex.lab\PY{o}{=}\PY{l+m}{1.2}\PY{p}{,}ylim\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{1}\PY{p}{)}\PY{p}{,}yaxs\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{r\PYZsq{}}\PY{p}{,}type\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{o\PYZsq{}}\PY{p}{,}col\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{red\PYZsq{}}\PY{p}{)}
              title\PY{p}{(}main\PY{o}{=}opts\PY{p}{[}i\PY{p}{]}\PY{p}{,}font.main\PY{o}{=}\PY{l+m}{2}\PY{p}{,}cex.main\PY{o}{=}\PY{l+m}{1}\PY{p}{,}line\PY{o}{=}\PY{l+m}{1}\PY{p}{,}cex.lab\PY{o}{=}\PY{l+m}{1}\PY{p}{)}
              lines\PY{p}{(}overlap\PY{p}{,}prec\PYZus{}rec\PYZus{}frame\PY{p}{[[}i\PY{p}{]]}\PY{p}{[}\PY{p}{,}\PY{l+m}{2}\PY{p}{]}\PY{p}{,}col\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{green\PYZsq{}}\PY{p}{,}type\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{o\PYZsq{}}\PY{p}{)}
              lines\PY{p}{(}overlap\PY{p}{,}prec\PYZus{}rec\PYZus{}frame\PY{p}{[[}i\PY{p}{]]}\PY{p}{[}\PY{p}{,}\PY{l+m}{3}\PY{p}{]}\PY{p}{,}col\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{firebrick\PYZsq{}}\PY{p}{,}type\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{o\PYZsq{}}\PY{p}{)}
              lines\PY{p}{(}overlap\PY{p}{,}prec\PYZus{}rec\PYZus{}frame\PY{p}{[[}i\PY{p}{]]}\PY{p}{[}\PY{p}{,}\PY{l+m}{4}\PY{p}{]}\PY{p}{,}col\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{forestgreen\PYZsq{}}\PY{p}{,}type\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{o\PYZsq{}}\PY{p}{)}
          \PY{p}{\PYZcb{}}
          mtext\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{Precision/Recall for Lasso\PYZsq{}s beta\PYZus{}hat\PYZdq{}}\PY{p}{,}side\PY{o}{=}\PY{l+m}{3}\PY{p}{,}adj\PY{o}{=}\PY{l+m}{3.5}\PY{p}{,}cex\PY{o}{=}\PY{l+m}{1}\PY{p}{,}line\PY{o}{=}\PY{l+m}{23.5}\PY{p}{,}font\PY{o}{=}\PY{l+m}{2}\PY{p}{)}
          par\PY{p}{(}mfrow\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{2}\PY{p}{,}\PY{l+m}{1}\PY{p}{)}\PY{p}{,}mar\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{0}\PY{p}{)}\PY{p}{)}
          plot\PY{p}{(}\PY{l+m}{1}\PY{p}{,}type\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{n\PYZsq{}}\PY{p}{,}axes\PY{o}{=}\PY{k+kc}{FALSE}\PY{p}{,}xlab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZsq{}}\PY{p}{,}ylab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZsq{}}\PY{p}{)}
          legend\PY{p}{(}x\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{top\PYZsq{}}\PY{p}{,}inset\PY{o}{=}\PY{l+m}{0}\PY{p}{,}legend\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{precision mdl1:SNPs+C1\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{precision mdl2:C1\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{recall mdl1:SNPs+C1\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{recall mdl2:C1\PYZsq{}}\PY{p}{)}\PY{p}{,}
                 col\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{red\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{green\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{firebrick\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{forestgreen\PYZsq{}}\PY{p}{)}\PY{p}{,}lwd\PY{o}{=}\PY{l+m}{1}\PY{p}{,}cex\PY{o}{=}\PY{l+m}{0.65}\PY{p}{,}horiz\PY{o}{=}\PY{k+kc}{TRUE}\PY{p}{)}
\end{Verbatim}


    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_17_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_17_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}173}]:} rmse\PYZus{}lasso1 \PY{o}{=}　\PY{k+kt}{matrix}\PY{p}{(}\PY{k+kp}{do.call}\PY{p}{(}\PY{k+kp}{rbind}\PY{p}{,}\PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}\PY{k+kp}{length}\PY{p}{(}data\PY{p}{)}\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} li\PY{p}{[[}x\PY{p}{]]}\PY{o}{\PYZdl{}}s1\PY{o}{\PYZdl{}}rmse\PYZus{}lasso\PY{p}{)}\PY{p}{)}\PY{p}{,}nrow\PY{o}{=}params\PY{o}{\PYZdl{}}K\PY{p}{)}
          rmse\PYZus{}lasso2 \PY{o}{=} \PY{k+kt}{matrix}\PY{p}{(}\PY{k+kp}{do.call}\PY{p}{(}\PY{k+kp}{rbind}\PY{p}{,}\PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}\PY{k+kp}{length}\PY{p}{(}data\PY{p}{)}\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} li\PY{p}{[[}x\PY{p}{]]}\PY{o}{\PYZdl{}}s2\PY{o}{\PYZdl{}}rmse\PYZus{}lasso\PY{p}{)}\PY{p}{)}\PY{p}{,}nrow\PY{o}{=}params\PY{o}{\PYZdl{}}K\PY{p}{)}
          rmse\PYZus{}tca1 \PY{o}{=}　\PY{k+kt}{matrix}\PY{p}{(}\PY{k+kp}{do.call}\PY{p}{(}\PY{k+kp}{rbind}\PY{p}{,}\PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}\PY{k+kp}{length}\PY{p}{(}data\PY{p}{)}\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} li\PY{p}{[[}x\PY{p}{]]}\PY{o}{\PYZdl{}}s1\PY{o}{\PYZdl{}}rmse\PYZus{}tca\PY{p}{)}\PY{p}{)}\PY{p}{,}nrow\PY{o}{=}params\PY{o}{\PYZdl{}}K\PY{p}{)}
          rmse\PYZus{}tca2 \PY{o}{=} \PY{k+kt}{matrix}\PY{p}{(}\PY{k+kp}{do.call}\PY{p}{(}\PY{k+kp}{rbind}\PY{p}{,}\PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}\PY{k+kp}{length}\PY{p}{(}data\PY{p}{)}\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} li\PY{p}{[[}x\PY{p}{]]}\PY{o}{\PYZdl{}}s2\PY{o}{\PYZdl{}}rmse\PYZus{}tca\PY{p}{)}\PY{p}{)}\PY{p}{,}nrow\PY{o}{=}params\PY{o}{\PYZdl{}}K\PY{p}{)}
          rmse\PYZus{}frame \PY{o}{=} \PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}params\PY{o}{\PYZdl{}}K\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} \PY{k+kp}{t}\PY{p}{(}\PY{k+kp}{rbind}\PY{p}{(}rmse\PYZus{}lasso1\PY{p}{[}x\PY{p}{,}\PY{p}{]}\PY{p}{,}rmse\PYZus{}lasso2\PY{p}{[}x\PY{p}{,}\PY{p}{]}\PY{p}{,}rmse\PYZus{}tca1\PY{p}{[}x\PY{p}{,}\PY{p}{]}\PY{p}{,}rmse\PYZus{}tca2\PY{p}{[}x\PY{p}{,}\PY{p}{]}\PY{p}{)}\PY{p}{)}\PY{p}{)}
          
          par\PY{p}{(}mfrow\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{2}\PY{p}{,}\PY{l+m}{2}\PY{p}{)}\PY{p}{,}mar\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{4}\PY{p}{,} \PY{l+m}{3.8}\PY{p}{,} \PY{l+m}{4}\PY{p}{,} \PY{l+m}{2}\PY{p}{)} \PY{o}{+} \PY{l+m}{0.1}\PY{p}{)}
          opts\PY{o}{=}\PY{k+kp}{paste}\PY{p}{(}params\PY{o}{\PYZdl{}}cell\PYZus{}name\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{ W:\PYZsq{}}\PY{p}{,}mean\PYZus{}weight\PY{p}{)}
          \PY{k+kr}{for}\PY{p}{(}i \PY{k+kr}{in} \PY{l+m}{1}\PY{o}{:}params\PY{o}{\PYZdl{}}K\PY{p}{)}\PY{p}{\PYZob{}}
              boxplot\PY{p}{(}rmse\PYZus{}frame\PY{p}{[[}i\PY{p}{]]}\PY{p}{,}ylab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{rmse\PYZsq{}}\PY{p}{,}
                  xlab\PY{o}{=}opts\PY{p}{[}i\PY{p}{]}\PY{p}{,}boxwex\PY{o}{=}\PY{l+m}{0.7}\PY{p}{,}ylim\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{1}\PY{p}{)}\PY{p}{,}col\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{red\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{green\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{firebrick\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{forestgreen\PYZsq{}}\PY{p}{)}\PY{p}{)}
          \PY{p}{\PYZcb{}}
          mtext\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{RMSE for lasso / TCA\PYZdq{}}\PY{p}{,}side\PY{o}{=}\PY{l+m}{3}\PY{p}{,}adj\PY{o}{=}\PY{l+m}{\PYZhy{}1.5}\PY{p}{,}cex\PY{o}{=}\PY{l+m}{0.9}\PY{p}{,}line\PY{o}{=}\PY{l+m}{22.5}\PY{p}{,}font\PY{o}{=}\PY{l+m}{2}\PY{p}{)}
          par\PY{p}{(}mfrow\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{2}\PY{p}{,}\PY{l+m}{1}\PY{p}{)}\PY{p}{,}mar\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{0}\PY{p}{)}\PY{p}{)}
          plot\PY{p}{(}\PY{l+m}{1}\PY{p}{,}type\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{n\PYZsq{}}\PY{p}{,}axes\PY{o}{=}\PY{k+kc}{FALSE}\PY{p}{,}xlab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZsq{}}\PY{p}{,}ylab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZsq{}}\PY{p}{)}
          legend\PY{p}{(}x\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{top\PYZsq{}}\PY{p}{,}inset\PY{o}{=}\PY{l+m}{0}\PY{p}{,}legend\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{lasso mdl1:SNPs+C1\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{lasso mdl2:C1\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{tca mdl1:SNPs+C1\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{tca mdl2:C1\PYZsq{}}\PY{p}{)}\PY{p}{,}
                 col\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{red\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{green\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{firebrick\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{forestgreen\PYZsq{}}\PY{p}{)}\PY{p}{,}lwd\PY{o}{=}\PY{l+m}{1}\PY{p}{,}cex\PY{o}{=}\PY{l+m}{0.65}\PY{p}{,}horiz\PY{o}{=}\PY{k+kc}{TRUE}\PY{p}{)}
\end{Verbatim}


    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_18_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_18_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}175}]:} par\PY{p}{(}mfrow\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{2}\PY{p}{,}\PY{l+m}{2}\PY{p}{)}\PY{p}{,}mar\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{4}\PY{p}{,} \PY{l+m}{3.8}\PY{p}{,} \PY{l+m}{4}\PY{p}{,} \PY{l+m}{2}\PY{p}{)} \PY{o}{+} \PY{l+m}{0.1}\PY{p}{)}
          \PY{k+kr}{for}\PY{p}{(}i \PY{k+kr}{in} \PY{l+m}{1}\PY{o}{:}params\PY{o}{\PYZdl{}}K\PY{p}{)}\PY{p}{\PYZob{}}
              plot\PY{p}{(}overlap\PY{p}{,}rmse\PYZus{}frame\PY{p}{[[}i\PY{p}{]]}\PY{p}{[}\PY{p}{,}\PY{l+m}{1}\PY{p}{]}\PY{p}{,}xlab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{SNPs overlap of gene\PYZsq{}}\PY{p}{,}
                   ylab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{rmse\PYZsq{}}\PY{p}{,}cex.lab\PY{o}{=}\PY{l+m}{1.2}\PY{p}{,}ylim\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{1}\PY{p}{)}\PY{p}{,}yaxs\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{r\PYZsq{}}\PY{p}{,}type\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{o\PYZsq{}}\PY{p}{,}col\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{red\PYZsq{}}\PY{p}{)}
              title\PY{p}{(}main\PY{o}{=}opts\PY{p}{[}i\PY{p}{]}\PY{p}{,}font.main\PY{o}{=}\PY{l+m}{2}\PY{p}{,}cex.main\PY{o}{=}\PY{l+m}{1}\PY{p}{,}line\PY{o}{=}\PY{l+m}{1}\PY{p}{,}cex.lab\PY{o}{=}\PY{l+m}{1}\PY{p}{)}
              lines\PY{p}{(}overlap\PY{p}{,}rmse\PYZus{}frame\PY{p}{[[}i\PY{p}{]]}\PY{p}{[}\PY{p}{,}\PY{l+m}{2}\PY{p}{]}\PY{p}{,}col\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{green\PYZsq{}}\PY{p}{,}type\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{o\PYZsq{}}\PY{p}{)}
              lines\PY{p}{(}overlap\PY{p}{,}rmse\PYZus{}frame\PY{p}{[[}i\PY{p}{]]}\PY{p}{[}\PY{p}{,}\PY{l+m}{3}\PY{p}{]}\PY{p}{,}col\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{firebrick\PYZsq{}}\PY{p}{,}type\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{o\PYZsq{}}\PY{p}{)}
              lines\PY{p}{(}overlap\PY{p}{,}rmse\PYZus{}frame\PY{p}{[[}i\PY{p}{]]}\PY{p}{[}\PY{p}{,}\PY{l+m}{4}\PY{p}{]}\PY{p}{,}col\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{forestgreen\PYZsq{}}\PY{p}{,}type\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{o\PYZsq{}}\PY{p}{)}
          \PY{p}{\PYZcb{}}
          mtext\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{RMSE for lasso \PYZam{} TCA\PYZdq{}}\PY{p}{,}side\PY{o}{=}\PY{l+m}{3}\PY{p}{,}adj\PY{o}{=}\PY{l+m}{\PYZhy{}1.5}\PY{p}{,}cex\PY{o}{=}\PY{l+m}{0.9}\PY{p}{,}line\PY{o}{=}\PY{l+m}{22.5}\PY{p}{,}font\PY{o}{=}\PY{l+m}{2}\PY{p}{)}
          par\PY{p}{(}mfrow\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{2}\PY{p}{,}\PY{l+m}{1}\PY{p}{)}\PY{p}{,}mar\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{0}\PY{p}{)}\PY{p}{)}
          plot\PY{p}{(}\PY{l+m}{1}\PY{p}{,}type\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{n\PYZsq{}}\PY{p}{,}axes\PY{o}{=}\PY{k+kc}{FALSE}\PY{p}{,}xlab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZsq{}}\PY{p}{,}ylab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZsq{}}\PY{p}{)}
          legend\PY{p}{(}x\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{top\PYZsq{}}\PY{p}{,}inset\PY{o}{=}\PY{l+m}{0}\PY{p}{,}legend\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{lasso mdl1:SNPs+C1\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{lasso mdl2:C1\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{tca mdl1:SNPs+C1\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{tca mdl2:C1\PYZsq{}}\PY{p}{)}\PY{p}{,}
                 col\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{red\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{green\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{firebrick\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{forestgreen\PYZsq{}}\PY{p}{)}\PY{p}{,}lwd\PY{o}{=}\PY{l+m}{1}\PY{p}{,}cex\PY{o}{=}\PY{l+m}{0.65}\PY{p}{,}horiz\PY{o}{=}\PY{k+kc}{TRUE}\PY{p}{)}
\end{Verbatim}


    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_19_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_19_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}122}]:} \PY{p}{)}\PY{l+s}{\PYZdq{}}
          \PY{l+s}{=================================================}
          \PY{l+s}{This file is used to generate data from specific |}
          \PY{l+s}{distribution to simulate the TCA+TWAS pipepine. |}
          \PY{l+s}{=================================================}
          \PY{l+s}{\PYZdq{}}
          
            \PY{l+s}{\PYZdq{}}
          \PY{l+s}{  Generate SNPs and Gene Expression Data.}
          \PY{l+s}{  @Params:}
          \PY{l+s}{      N:          \PYZsh{}samples}
          \PY{l+s}{      D:          \PYZsh{}SNP sequence length}
          \PY{l+s}{      MAF:        \PYZsh{}minor allele frequency}
          \PY{l+s}{      M:          \PYZsh{}gene expressions}
          \PY{l+s}{      K:          \PYZsh{}cell types}
          \PY{l+s}{      p\PYZus{}slap:     sparsity. Proportion of gene not related to GE}
          \PY{l+s}{      sigma\PYZus{}beta:         std of Beta (mu = X*beta+epsilon\PYZus{}\PYZob{}mu\PYZcb{},beta gaussian)}
          \PY{l+s}{      sigma\PYZus{}mu:           std of mu\PYZus{}z (mu = X*beta+epsilon\PYZus{}\PYZob{}mu\PYZcb{},epsilon\PYZus{}mu gaussian)}
          \PY{l+s}{      sigma\PYZus{}z:            std of Z (Z\PYZca{}\PYZob{}i\PYZcb{}\PYZus{}\PYZob{}km\PYZcb{}|mu\PYZca{}\PYZob{}i\PYZcb{}\PYZus{}\PYZob{}km\PYZcb{},epsilon\PYZca{}\PYZob{}i\PYZcb{}\PYZus{}\PYZob{}km\PYZcb{}\PYZti{}N\PYZob{}mu\PYZca{}\PYZob{}i\PYZcb{}\PYZus{}\PYZob{}km\PYZcb{},epsilon\PYZca{}\PYZob{}i\PYZcb{}\PYZus{}\PYZob{}km\PYZcb{})}
          \PY{l+s}{      sigma\PYZus{}g:            std of Gene Expression}
          \PY{l+s}{      alpha:              alpha for Cell Type Proportion, which follows dirichlet distribution}
          \PY{l+s}{      Q                   number of traits}
          \PY{l+s}{      train\PYZus{}proportion:   the proportion of training dataset}
          \PY{l+s}{  @Shape information:}
          \PY{l+s}{      This part tell us the shape information before we split them into training data and test data}
          \PY{l+s}{      X:          N*D Matrix SNPs}
          \PY{l+s}{      Z:          N*K*M Array cell type specific gene expression}
          \PY{l+s}{      G:          M*N Matrix mixed gene expressions}
          \PY{l+s}{      beta:       D*K*M Array effect size of SNPs on Z}
          \PY{l+s}{      W:          N*K Matrix cell type proportion}
          \PY{l+s}{      T:          Q Traits}
          \PY{l+s}{      c1:         N*3}
          \PY{l+s}{  @Returns:}
          \PY{l+s}{      traing\PYZus{}data: [\PYZsq{}X\PYZsq{}=X, \PYZsq{}Z\PYZsq{}=Z, \PYZsq{}G\PYZsq{}=G, \PYZsq{}beta\PYZsq{}=beta, \PYZsq{}W\PYZsq{}=W, \PYZsq{}T\PYZsq{}=T, \PYZsq{}c1\PYZsq{}=c1]}
          \PY{l+s}{      test\PYZus{}data:   [\PYZsq{}X\PYZsq{}=X, \PYZsq{}Z\PYZsq{}=Z, \PYZsq{}G\PYZsq{}=G, \PYZsq{}beta\PYZsq{}=beta, \PYZsq{}W\PYZsq{}=W, \PYZsq{}T\PYZsq{}=T, \PYZsq{}c1\PYZsq{}=c1]}
          \PY{l+s}{  \PYZdq{}}
          
          
          generate\PYZus{}data \PY{o}{\PYZlt{}\PYZhy{}} \PY{k+kr}{function}\PY{p}{(}N\PY{o}{=}\PY{l+m}{100}\PY{p}{,}
                                    D\PY{o}{=}\PY{l+m}{2000}\PY{p}{,}
                                    MAF\PY{o}{=}\PY{l+m}{0.1}\PY{p}{,}
                                    M\PY{o}{=}\PY{l+m}{10}\PY{p}{,}
                                    K\PY{o}{=}\PY{l+m}{6}\PY{p}{,}
                                    p\PYZus{}slab\PY{o}{=}\PY{l+m}{0.5}\PY{p}{,}
                                    sigma\PYZus{}beta\PY{o}{=}\PY{l+m}{0.3}\PY{p}{,}
                                    sigma\PYZus{}mu\PY{o}{=}\PY{l+m}{0.3}\PY{p}{,}
                                    sigma\PYZus{}z\PY{o}{=}\PY{l+m}{0.3}\PY{p}{,}
                                    sigma\PYZus{}g\PY{o}{=}\PY{l+m}{0.01}\PY{p}{,}
                                    alpha\PY{o}{=}\PY{l+m}{0.3}\PY{p}{,}
                                    Q\PY{o}{=}\PY{l+m}{5}\PY{p}{,}
                                    train\PYZus{}proportion\PY{o}{=}\PY{l+m}{0.7}\PY{p}{,}
                                    male\PYZus{}proportion\PY{o}{=}\PY{l+m}{0.5}\PY{p}{,}
                                    smoking\PYZus{}proportion\PY{o}{=}\PY{l+m}{0.2}\PY{p}{,}
                                    pc\PYZus{}num\PY{o}{=}\PY{l+m}{2}
                                    \PY{p}{)} \PY{p}{\PYZob{}}
              \PY{k+kn}{library}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{MCMCpack\PYZsq{}}\PY{p}{)}
              
              \PY{c+c1}{\PYZsh{}\PYZsh{}\PYZsh{}\PYZsh{} names}
              id\PYZus{}name \PY{o}{=} \PY{k+kp}{sapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}N\PY{p}{,} \PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} \PY{k+kp}{paste}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{SAMPLE\PYZsq{}}\PY{p}{,}\PY{k+kp}{toString}\PY{p}{(}x\PY{p}{)}\PY{p}{,}sep \PY{o}{=} \PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZsq{}}\PY{p}{)}\PY{p}{)}
              cell\PYZus{}type\PY{o}{=}\PY{k+kp}{sapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}K\PY{p}{,} \PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} \PY{k+kp}{paste}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{Cell\PYZus{}type\PYZsq{}}\PY{p}{,}x\PY{p}{,}sep \PY{o}{=} \PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZsq{}}\PY{p}{)}\PY{p}{)}
              snp\PYZus{}name\PY{o}{=}\PY{k+kp}{sapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}D\PY{p}{,} \PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} \PY{k+kp}{paste}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{SNP\PYZsq{}}\PY{p}{,}\PY{k+kp}{toString}\PY{p}{(}x\PY{p}{)}\PY{p}{,}sep \PY{o}{=} \PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZsq{}}\PY{p}{)}\PY{p}{)}
              ge\PYZus{}name\PY{o}{=}\PY{k+kp}{sapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}M\PY{p}{,} \PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} \PY{k+kp}{paste}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{GE\PYZsq{}}\PY{p}{,}\PY{k+kp}{toString}\PY{p}{(}x\PY{p}{)}\PY{p}{,}sep\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZsq{}}\PY{p}{)}\PY{p}{)}
                             
              \PY{c+c1}{\PYZsh{}\PYZsh{}\PYZsh{}\PYZsh{} generate X}
              X \PY{o}{=} \PY{k+kp}{sapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}D\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} rbinom\PY{p}{(}N\PY{p}{,} \PY{l+m}{2}\PY{p}{,}\PY{l+m}{0.1}\PY{p}{)}\PY{p}{)}
              \PY{k+kr}{while} \PY{p}{(}\PY{k+kp}{qr}\PY{p}{(}X\PY{p}{)}\PY{o}{\PYZdl{}}\PY{k+kp}{rank}\PY{o}{\PYZlt{}}\PY{k+kp}{min}\PY{p}{(}\PY{k+kp}{dim}\PY{p}{(}X\PY{p}{)}\PY{p}{)}\PY{p}{)}\PY{p}{\PYZob{}}
                  X \PY{o}{=} \PY{k+kp}{sapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}D\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} rbinom\PY{p}{(}N\PY{p}{,} \PY{l+m}{2}\PY{p}{,}MAF\PY{p}{)}\PY{p}{)}
              \PY{p}{\PYZcb{}}
              
              \PY{k+kp}{colnames}\PY{p}{(}X\PY{p}{,} do.NULL \PY{o}{=} \PY{k+kc}{TRUE}\PY{p}{,} prefix \PY{o}{=} \PY{l+s}{\PYZdq{}}\PY{l+s}{col\PYZdq{}}\PY{p}{)}
              \PY{k+kp}{colnames}\PY{p}{(}X\PY{p}{)} \PY{o}{\PYZlt{}\PYZhy{}} snp\PYZus{}name
              \PY{k+kp}{rownames}\PY{p}{(}X\PY{p}{,} do.NULL \PY{o}{=} \PY{k+kc}{TRUE}\PY{p}{,} prefix \PY{o}{=} \PY{l+s}{\PYZdq{}}\PY{l+s}{col\PYZdq{}}\PY{p}{)}
              \PY{k+kp}{rownames}\PY{p}{(}X\PY{p}{)} \PY{o}{\PYZlt{}\PYZhy{}} id\PYZus{}name
              
              \PY{c+c1}{\PYZsh{} mask a normal to form spikeslab}
              beta \PY{o}{=} rnorm\PY{p}{(}D\PY{o}{*}K\PY{o}{*}M\PY{p}{,} mean\PY{o}{=}\PY{l+m}{0}\PY{p}{,} sd\PY{o}{=}sigma\PYZus{}beta\PY{p}{)}
              mask \PY{o}{=} rbinom\PY{p}{(}D\PY{o}{*}K\PY{o}{*}M\PY{p}{,} \PY{l+m}{1}\PY{p}{,} \PY{l+m}{1}\PY{o}{\PYZhy{}}p\PYZus{}slab\PY{p}{)}
              beta \PY{o}{=} \PY{k+kt}{array}\PY{p}{(}\PY{k+kp}{beta}\PY{o}{*}mask\PY{p}{,} \PY{k+kt}{c}\PY{p}{(}D\PY{p}{,}K\PY{p}{,}M\PY{p}{)}\PY{p}{)}
              
              \PY{c+c1}{\PYZsh{} \PYZbs{}mu = X*\PYZbs{}beta+\PYZbs{}epsilon\PYZus{}mu}
              epsilon\PYZus{}mu \PY{o}{=} \PY{k+kt}{array}\PY{p}{(}rnorm\PY{p}{(}N\PY{o}{*}K\PY{o}{*}M\PY{p}{,} mean \PY{o}{=} \PY{l+m}{0}\PY{p}{,} sd\PY{o}{=}sigma\PYZus{}mu\PY{p}{)}\PY{p}{,} \PY{k+kt}{c}\PY{p}{(}N\PY{p}{,}K\PY{p}{,}M\PY{p}{)}\PY{p}{)}
              mu\PYZus{}z \PY{o}{=} \PY{k+kp}{lapply}\PY{p}{(}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}M\PY{p}{)}\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} X\PY{o}{\PYZpc{}*\PYZpc{}}\PY{k+kp}{beta}\PY{p}{[}\PY{p}{,}\PY{p}{,}x\PY{p}{]}\PY{p}{)}
              mu\PYZus{}z \PY{o}{=} \PY{k+kt}{array}\PY{p}{(}\PY{k+kp}{as.numeric}\PY{p}{(}\PY{k+kp}{unlist}\PY{p}{(}mu\PYZus{}z\PY{p}{)}\PY{p}{)}\PY{p}{,} dim\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}N\PY{p}{,}K\PY{p}{,}M\PY{p}{)}\PY{p}{)} \PY{o}{+} epsilon\PYZus{}mu
              \PY{c+c1}{\PYZsh{} Simulate mu\PYZus{}jh that is shared across individuals}
              mu \PY{o}{\PYZlt{}\PYZhy{}} \PY{k+kt}{array}\PY{p}{(}runif\PY{p}{(}M\PY{o}{*}K\PY{p}{,} min\PY{o}{=}\PY{l+m}{0}\PY{p}{,} max\PY{o}{=}\PY{l+m}{10}\PY{p}{)}\PY{p}{,} \PY{k+kt}{c}\PY{p}{(}M\PY{p}{,}K\PY{p}{)}\PY{p}{)}
              mu\PYZus{}stacked \PY{o}{\PYZlt{}\PYZhy{}} \PY{k+kp}{aperm}\PY{p}{(}abind\PY{p}{(}\PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}N\PY{p}{,} \PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} mu\PY{p}{)}\PY{p}{,} along \PY{o}{=} \PY{l+m}{3}\PY{p}{)}\PY{p}{,} \PY{k+kt}{c}\PY{p}{(}\PY{l+m}{3}\PY{p}{,}\PY{l+m}{2}\PY{p}{,}\PY{l+m}{1}\PY{p}{)}\PY{p}{)}
              mu \PY{o}{\PYZlt{}\PYZhy{}} mu\PYZus{}stacked
              \PY{c+c1}{\PYZsh{} mu\PYZus{}z \PYZlt{}\PYZhy{} mu\PYZus{}stacked　\PYZsh{} +mu\PYZus{}z}
              
              \PY{c+c1}{\PYZsh{}W = rdirichlet(N, rep(alpha,K))}
              W \PY{o}{\PYZlt{}\PYZhy{}} rdirichlet\PY{p}{(}N\PY{p}{,} runif\PY{p}{(}K\PY{p}{,} \PY{l+m}{0}\PY{p}{,} \PY{l+m}{1}\PY{p}{)}\PY{p}{)}
              \PY{k+kp}{colnames}\PY{p}{(}W\PY{p}{,} do.NULL \PY{o}{=} \PY{k+kc}{TRUE}\PY{p}{,} prefix \PY{o}{=} \PY{l+s}{\PYZdq{}}\PY{l+s}{col\PYZdq{}}\PY{p}{)}
              \PY{k+kp}{colnames}\PY{p}{(}W\PY{p}{)} \PY{o}{\PYZlt{}\PYZhy{}} cell\PYZus{}type
              \PY{k+kp}{rownames}\PY{p}{(}W\PY{p}{,} do.NULL \PY{o}{=} \PY{k+kc}{TRUE}\PY{p}{,} prefix \PY{o}{=} \PY{l+s}{\PYZdq{}}\PY{l+s}{col\PYZdq{}}\PY{p}{)}
              \PY{k+kp}{rownames}\PY{p}{(}W\PY{p}{)} \PY{o}{\PYZlt{}\PYZhy{}} id\PYZus{}name
            
              \PY{c+c1}{\PYZsh{} Beta :QxM}
              \PY{c+c1}{\PYZsh{} T: NxQ}
              \PY{c+c1}{\PYZsh{} epsilon: NxQ}
              
              \PY{c+c1}{\PYZsh{}\PYZsh{}\PYZsh{} generate C1 and C2}
              male \PY{o}{=} \PY{k+kt}{matrix}\PY{p}{(}rbinom\PY{p}{(}N\PY{p}{,} \PY{l+m}{1}\PY{p}{,} \PY{l+m}{0.5}\PY{p}{)}\PY{p}{,}nrow\PY{o}{=}N\PY{p}{)}
              smoking \PY{o}{=} \PY{k+kt}{matrix}\PY{p}{(}rbinom\PY{p}{(}N\PY{p}{,} \PY{l+m}{2}\PY{p}{,} \PY{l+m}{0.2}\PY{p}{)}\PY{p}{,}nrow\PY{o}{=}N\PY{p}{)}
              smoking \PY{o}{=} \PY{p}{(}smoking \PY{o}{\PYZhy{}} \PY{k+kp}{min}\PY{p}{(}smoking\PY{p}{)}\PY{p}{)}\PY{o}{/}\PY{p}{(}\PY{k+kp}{max}\PY{p}{(}smoking\PY{p}{)}\PY{p}{)}
              age \PY{o}{=}\PY{k+kt}{matrix}\PY{p}{(}\PY{k+kp}{sapply}\PY{p}{(}\PY{k+kp}{sapply}\PY{p}{(}rnorm\PY{p}{(}N\PY{p}{,}\PY{l+m}{50}\PY{p}{,} \PY{l+m}{20}\PY{p}{)}\PY{p}{,} \PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} \PY{k+kp}{floor}\PY{p}{(}x\PY{p}{)}\PY{p}{)}\PY{p}{,} \PY{k+kr}{function}\PY{p}{(}x\PY{p}{)}  \PY{k+kr}{if} \PY{p}{(}x\PY{o}{\PYZlt{}}\PY{l+m}{0}\PY{p}{)}\PY{p}{\PYZob{}}x\PY{o}{=}\PY{l+m}{20}\PY{p}{\PYZcb{}} \PY{k+kp}{else}\PY{p}{\PYZob{}}x\PY{o}{=}x\PY{p}{\PYZcb{}}\PY{p}{)}\PY{p}{,}nrow\PY{o}{=}N\PY{p}{)} 
              age \PY{o}{=} \PY{p}{(}age\PY{o}{\PYZhy{}}\PY{k+kp}{min}\PY{p}{(}age\PY{p}{)}\PY{p}{)}\PY{o}{/}\PY{p}{(}\PY{k+kp}{max}\PY{p}{(}age\PY{p}{)}\PY{o}{\PYZhy{}}\PY{k+kp}{min}\PY{p}{(}age\PY{p}{)}\PY{p}{)}
              c1\PY{o}{=} \PY{k+kp}{cbind}\PY{p}{(}male\PY{p}{,} smoking\PY{p}{,} age\PY{p}{)}
              c2\PY{o}{=}\PY{k+kt}{matrix}\PY{p}{(}rnorm\PY{p}{(}N\PY{o}{*}pc\PYZus{}num\PY{p}{)}\PY{p}{,} nrow\PY{o}{=}N\PY{p}{)}
              \PY{k+kp}{rownames}\PY{p}{(}c1\PY{p}{,} do.NULL \PY{o}{=} \PY{k+kc}{TRUE}\PY{p}{,} prefix \PY{o}{=} \PY{l+s}{\PYZdq{}}\PY{l+s}{col\PYZdq{}}\PY{p}{)}
              \PY{k+kp}{rownames}\PY{p}{(}c1\PY{p}{)} \PY{o}{\PYZlt{}\PYZhy{}} id\PYZus{}name
              \PY{c+c1}{\PYZsh{}colnames(c1, do.NULL = TRUE, prefix = \PYZdq{}col\PYZdq{})}
              \PY{c+c1}{\PYZsh{}colnames(c1) \PYZlt{}\PYZhy{} c(\PYZsq{}male\PYZsq{},\PYZsq{}smoking\PYZsq{},\PYZsq{}age\PYZsq{}, snp\PYZus{}name)}
              \PY{c+c1}{\PYZsh{}colnames(c1) \PYZlt{}\PYZhy{} snp\PYZus{}name}
              \PY{k+kp}{rownames}\PY{p}{(}c2\PY{p}{,} do.NULL \PY{o}{=} \PY{k+kc}{TRUE}\PY{p}{,} prefix \PY{o}{=} \PY{l+s}{\PYZdq{}}\PY{l+s}{col\PYZdq{}}\PY{p}{)}
              \PY{k+kp}{rownames}\PY{p}{(}c2\PY{p}{)} \PY{o}{\PYZlt{}\PYZhy{}} id\PYZus{}name
              \PY{k+kp}{colnames}\PY{p}{(}c2\PY{p}{,} do.NULL \PY{o}{=} \PY{k+kc}{TRUE}\PY{p}{,} prefix \PY{o}{=} \PY{l+s}{\PYZdq{}}\PY{l+s}{col\PYZdq{}}\PY{p}{)}
              \PY{k+kp}{colnames}\PY{p}{(}c2\PY{p}{)} \PY{o}{\PYZlt{}\PYZhy{}} \PY{k+kp}{sapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}pc\PYZus{}num\PY{p}{,} \PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} \PY{k+kp}{paste}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{PC\PYZsq{}}\PY{p}{,}\PY{k+kp}{toString}\PY{p}{(}x\PY{p}{)}\PY{p}{,}sep \PY{o}{=} \PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZsq{}}\PY{p}{)}\PY{p}{)}
                                     
              \PY{c+c1}{\PYZsh{}\PYZsh{}\PYZsh{} Generating Z}
              \PY{c+c1}{\PYZsh{} sample z from mu\PYZus{}z and epsilon\PYZus{}za and C1}
              \PY{c+c1}{\PYZsh{} epsilon\PYZus{}z = array(rnorm(N*K*M,mean=0,sd=sigma\PYZus{}z), c(N,K,M))}
              \PY{c+c1}{\PYZsh{}sigma\PYZus{}z \PYZlt{}\PYZhy{} runif(K*M, 0, 1)}
              \PY{c+c1}{\PYZsh{}epsilon\PYZus{}z \PYZlt{}\PYZhy{} array(sapply(1:K*M, function(x) rnorm(N, mean=0, sd = sigma\PYZus{}z[x])),c(N,K,M))}
          
              sigma\PYZus{}z \PY{o}{=} \PY{k+kt}{matrix}\PY{p}{(}runif\PY{p}{(}M\PY{o}{*}K\PY{p}{,}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{0.3}\PY{p}{)}\PY{p}{,}M\PY{p}{,}K\PY{p}{)}
              epsilon\PYZus{}z \PY{o}{=} \PY{k+kt}{array}\PY{p}{(}\PY{l+m}{0}\PY{p}{,}\PY{k+kt}{c}\PY{p}{(}N\PY{p}{,}K\PY{p}{,}M\PY{p}{)}\PY{p}{)}
              \PY{k+kr}{for}\PY{p}{(}i \PY{k+kr}{in} \PY{l+m}{1}\PY{o}{:}M\PY{p}{)}\PY{p}{\PYZob{}}
                  \PY{k+kr}{for} \PY{p}{(}j \PY{k+kr}{in} \PY{l+m}{1}\PY{o}{:}K\PY{p}{)}\PY{p}{\PYZob{}}
                      epsilon\PYZus{}z\PY{p}{[}\PY{p}{,}j\PY{p}{,}i\PY{p}{]} \PY{o}{=} rnorm\PY{p}{(}N\PY{p}{,} \PY{l+m}{0} \PY{p}{,}sigma\PYZus{}z\PY{p}{[}i\PY{p}{,}j\PY{p}{]}\PY{p}{)}
                  \PY{p}{\PYZcb{}}
              \PY{p}{\PYZcb{}}
              Z \PY{o}{=} epsilon\PYZus{}z \PY{o}{+}mu\PYZus{}stacked
              \PY{k+kp}{dimnames}\PY{p}{(}Z\PY{p}{)}\PY{p}{[[}\PY{l+m}{1}\PY{p}{]]} \PY{o}{\PYZlt{}\PYZhy{}} id\PYZus{}name
              \PY{k+kp}{dimnames}\PY{p}{(}Z\PY{p}{)}\PY{p}{[[}\PY{l+m}{2}\PY{p}{]]} \PY{o}{\PYZlt{}\PYZhy{}} cell\PYZus{}type
              \PY{k+kp}{dimnames}\PY{p}{(}Z\PY{p}{)}\PY{p}{[[}\PY{l+m}{3}\PY{p}{]]} \PY{o}{\PYZlt{}\PYZhy{}} ge\PYZus{}name
              \PY{c+c1}{\PYZsh{} sample gama}
              gama \PY{o}{=} \PY{k+kt}{array}\PY{p}{(}\PY{k+kp}{sapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}K\PY{o}{*}M\PY{p}{,} \PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} runif\PY{p}{(}\PY{l+m}{3}\PY{p}{,} \PY{l+m}{0}\PY{p}{,} \PY{l+m}{1}\PY{p}{)}\PY{p}{)}\PY{p}{,} dim \PY{o}{=} \PY{k+kt}{c}\PY{p}{(}K\PY{p}{,} \PY{l+m}{3}\PY{p}{,} M\PY{p}{)}\PY{p}{)}
              c\PYZus{}gama \PY{o}{=} \PY{k+kt}{array}\PY{p}{(}\PY{k+kp}{rep}\PY{p}{(}\PY{l+m}{0}\PY{p}{,} N\PY{o}{*}K\PY{o}{*}M\PY{p}{)}\PY{p}{,} \PY{k+kt}{c}\PY{p}{(}N\PY{p}{,}K\PY{p}{,}M\PY{p}{)}\PY{p}{)}
              \PY{k+kr}{for} \PY{p}{(}i \PY{k+kr}{in} \PY{l+m}{1}\PY{o}{:}K\PY{p}{)} \PY{p}{\PYZob{}}
                c\PYZus{}gama\PY{p}{[}\PY{p}{,}i\PY{p}{,}\PY{p}{]} \PY{o}{=} c1 \PY{o}{\PYZpc{}*\PYZpc{}} gama\PY{p}{[}i\PY{p}{,}\PY{p}{,}\PY{p}{]}
              \PY{p}{\PYZcb{}}
              Z \PY{o}{=} mu\PYZus{}z \PY{o}{+} Z\PY{c+c1}{\PYZsh{} + c\PYZus{}gama}
                                  
              \PY{c+c1}{\PYZsh{}\PYZsh{}\PYZsh{} Generate Gene expressions}
              G \PY{o}{=} \PY{k+kp}{sapply}\PY{p}{(}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}M\PY{p}{)}\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} \PY{k+kp}{rowSums}\PY{p}{(}W\PY{o}{*}Z\PY{p}{[}\PY{p}{,}\PY{p}{,}\PY{k+kt}{c}\PY{p}{(}x\PY{p}{)}\PY{p}{]}\PY{p}{)}\PY{p}{)}
              epsilon\PYZus{}G \PY{o}{=} \PY{k+kp}{replicate}\PY{p}{(}M\PY{p}{,}rnorm\PY{p}{(}N\PY{p}{,}mean\PY{o}{=}\PY{l+m}{0}\PY{p}{,}sd\PY{o}{=}sigma\PYZus{}g\PY{p}{)}\PY{p}{)}
              G \PY{o}{=} G \PY{o}{+}epsilon\PYZus{}G
              T\PYZus{}t \PY{o}{=} runif\PY{p}{(}\PY{l+m}{1}\PY{p}{)}
              epsilon\PYZus{}G \PY{o}{=} \PY{k+kp}{replicate}\PY{p}{(}Q\PY{p}{,}rnorm\PY{p}{(}N\PY{p}{)}\PY{p}{)}\PY{o}{*}T\PYZus{}t\PY{o}{*}T\PYZus{}t
              beta\PYZus{}t \PY{o}{=} \PY{k+kt}{matrix}\PY{p}{(}runif\PY{p}{(}Q\PY{o}{*}M\PY{p}{)}\PY{p}{,}ncol\PY{o}{=}M\PY{p}{)}
              \PY{n+nb+bp}{T} \PY{o}{=} G\PY{o}{\PYZpc{}*\PYZpc{}}\PY{k+kp}{t}\PY{p}{(}beta\PYZus{}t\PY{p}{)}\PY{o}{+}epsilon\PYZus{}G
              \PY{c+c1}{\PYZsh{}generate delta}
              delta \PY{o}{=} \PY{k+kt}{matrix}\PY{p}{(}\PY{k+kp}{sapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}M\PY{o}{*}pc\PYZus{}num\PY{p}{,} \PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} runif\PY{p}{(}pc\PYZus{}num\PY{p}{,}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{1}\PY{p}{)}\PY{p}{)}\PY{p}{,} nrow \PY{o}{=} pc\PYZus{}num\PY{p}{)}
              c\PYZus{}delta \PY{o}{=} c2\PY{o}{\PYZpc{}*\PYZpc{}}delta
              G \PY{o}{=} G \PY{o}{+} c\PYZus{}delta
              
              \PY{k+kp}{rownames}\PY{p}{(}G\PY{p}{,} do.NULL \PY{o}{=} \PY{k+kc}{TRUE}\PY{p}{,} prefix \PY{o}{=} \PY{l+s}{\PYZdq{}}\PY{l+s}{col\PYZdq{}}\PY{p}{)}
              \PY{k+kp}{rownames}\PY{p}{(}G\PY{p}{)} \PY{o}{\PYZlt{}\PYZhy{}} id\PYZus{}name
              \PY{k+kp}{colnames}\PY{p}{(}G\PY{p}{,} do.NULL \PY{o}{=} \PY{k+kc}{TRUE}\PY{p}{,} prefix \PY{o}{=} \PY{l+s}{\PYZdq{}}\PY{l+s}{col\PYZdq{}}\PY{p}{)}
              \PY{k+kp}{colnames}\PY{p}{(}G\PY{p}{)} \PY{o}{\PYZlt{}\PYZhy{}} ge\PYZus{}name
              G \PY{o}{=} \PY{k+kp}{t}\PY{p}{(}G\PY{p}{)}                      
              \PY{c+c1}{\PYZsh{}\PYZsh{}\PYZsh{} split into train and test data}
              prop \PY{o}{=} \PY{k+kp}{floor}\PY{p}{(}train\PYZus{}proportion\PY{o}{*}\PY{k+kp}{dim}\PY{p}{(}X\PY{p}{)}\PY{p}{[}\PY{l+m}{1}\PY{p}{]}\PY{p}{)}
              train\PYZus{}data \PY{o}{=} \PY{k+kt}{list}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{X\PYZsq{}}\PY{o}{=}X\PY{p}{[}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}prop\PY{p}{)}\PY{p}{,}\PY{p}{]}\PY{p}{,}
                                \PY{l+s}{\PYZsq{}}\PY{l+s}{Z\PYZsq{}}\PY{o}{=}Z\PY{p}{[}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}prop\PY{p}{)}\PY{p}{,}\PY{p}{,}\PY{p}{]}\PY{p}{,}
                                \PY{l+s}{\PYZsq{}}\PY{l+s}{G\PYZsq{}}\PY{o}{=}G\PY{p}{[}\PY{p}{,}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}prop\PY{p}{)}\PY{p}{]}\PY{p}{,}
                                \PY{l+s}{\PYZsq{}}\PY{l+s}{beta\PYZsq{}}\PY{o}{=}\PY{k+kp}{beta}\PY{p}{,}
                                \PY{l+s}{\PYZsq{}}\PY{l+s}{W\PYZsq{}}\PY{o}{=}W\PY{p}{[}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}prop\PY{p}{)}\PY{p}{,}\PY{p}{]}\PY{p}{,}
                                \PY{l+s}{\PYZsq{}}\PY{l+s}{T\PYZsq{}}\PY{o}{=}\PY{n+nb+bp}{T}\PY{p}{[}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}prop\PY{p}{)}\PY{p}{,}\PY{p}{]}\PY{p}{,}
                                \PY{l+s}{\PYZsq{}}\PY{l+s}{C1\PYZsq{}}\PY{o}{=}c1\PY{p}{[}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}prop\PY{p}{)}\PY{p}{,}\PY{p}{]}\PY{p}{,}
                                \PY{l+s}{\PYZsq{}}\PY{l+s}{C2\PYZsq{}}\PY{o}{=}c2\PY{p}{[}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}prop\PY{p}{)}\PY{p}{,}\PY{p}{]}\PY{p}{,}
                                \PY{l+s}{\PYZsq{}}\PY{l+s}{MU\PYZsq{}}\PY{o}{=}mu\PY{p}{,}
                                \PY{l+s}{\PYZsq{}}\PY{l+s}{SIGMA\PYZus{}Z\PYZsq{}}\PY{o}{=}sigma\PYZus{}z\PY{p}{)}
              test\PYZus{}data \PY{o}{=} \PY{k+kt}{list}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{X\PYZsq{}}\PY{o}{=}X\PY{p}{[}\PY{o}{\PYZhy{}}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}prop\PY{p}{)}\PY{p}{,}\PY{p}{]}\PY{p}{,}
                               \PY{l+s}{\PYZsq{}}\PY{l+s}{Z\PYZsq{}}\PY{o}{=}Z\PY{p}{[}\PY{o}{\PYZhy{}}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}prop\PY{p}{)}\PY{p}{,}\PY{p}{,}\PY{p}{]}\PY{p}{,}
                               \PY{l+s}{\PYZsq{}}\PY{l+s}{G\PYZsq{}}\PY{o}{=}G\PY{p}{[}\PY{p}{,}\PY{o}{\PYZhy{}}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}prop\PY{p}{)}\PY{p}{]}\PY{p}{,}
                               \PY{l+s}{\PYZsq{}}\PY{l+s}{beta\PYZsq{}}\PY{o}{=}\PY{k+kp}{beta}\PY{p}{,}
                               \PY{l+s}{\PYZsq{}}\PY{l+s}{W\PYZsq{}}\PY{o}{=}W\PY{p}{[}\PY{o}{\PYZhy{}}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}prop\PY{p}{)}\PY{p}{,}\PY{p}{]}\PY{p}{,}
                               \PY{l+s}{\PYZsq{}}\PY{l+s}{T\PYZsq{}}\PY{o}{=}\PY{n+nb+bp}{T}\PY{p}{[}\PY{o}{\PYZhy{}}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}prop\PY{p}{)}\PY{p}{,}\PY{p}{]}\PY{p}{,}
                               \PY{l+s}{\PYZsq{}}\PY{l+s}{C1\PYZsq{}}\PY{o}{=}c1\PY{p}{[}\PY{o}{\PYZhy{}}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}prop\PY{p}{)}\PY{p}{,}\PY{p}{]}\PY{p}{,}
                               \PY{l+s}{\PYZsq{}}\PY{l+s}{C2\PYZsq{}}\PY{o}{=}c2\PY{p}{[}\PY{o}{\PYZhy{}}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}prop\PY{p}{)}\PY{p}{,}\PY{p}{]}\PY{p}{,}
                               \PY{l+s}{\PYZsq{}}\PY{l+s}{MU\PYZsq{}}\PY{o}{=}mu\PY{p}{,}
                               \PY{l+s}{\PYZsq{}}\PY{l+s}{SIGMA\PYZus{}Z\PYZsq{}}\PY{o}{=}sigma\PYZus{}z\PY{p}{)}
              
              \PY{k+kr}{return}\PY{p}{(}\PY{k+kt}{list}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{train\PYZus{}data\PYZsq{}}\PY{o}{=}train\PYZus{}data\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{test\PYZus{}data\PYZsq{}}\PY{o}{=}test\PYZus{}data\PY{p}{)}\PY{p}{)}
          \PY{p}{\PYZcb{}}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]

        Error in parse(text = x, srcfile = src): <text>:1:1: unexpected ')'
    1: )
        \^{}
    Traceback:


    \end{Verbatim}

    \section{TCA Simulation}\label{tca-simulation}

\subsubsection{I. Generate Data}\label{i.-generate-data}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}290}]:} D \PY{o}{=} \PY{l+m}{200}
          K \PY{o}{=} \PY{l+m}{4}
          M \PY{o}{=} \PY{l+m}{10}
          data\PY{o}{=}generate\PYZus{}data\PY{p}{(}N\PY{o}{=}\PY{l+m}{1400}\PY{p}{,}D\PY{o}{=}D\PY{p}{,}p\PYZus{}slab\PY{o}{=}\PY{l+m}{0.5}\PY{p}{,}M\PY{o}{=}M\PY{p}{,}K\PY{o}{=}K\PY{p}{,}MAF\PY{o}{=}\PY{l+m}{0.18}\PY{p}{,}train\PYZus{}proportion\PY{o}{=}\PY{l+m}{0.7}\PY{p}{)}
          train\PYZus{}data\PY{o}{=}data\PY{p}{[[}\PY{l+s}{\PYZsq{}}\PY{l+s}{train\PYZus{}data\PYZsq{}}\PY{p}{]]}
          test\PYZus{}data \PY{o}{=} data\PY{p}{[[}\PY{l+s}{\PYZsq{}}\PY{l+s}{test\PYZus{}data\PYZsq{}}\PY{p}{]]}
          train\PYZus{}X\PY{o}{=}train\PYZus{}data\PY{p}{[[}\PY{l+s}{\PYZsq{}}\PY{l+s}{X\PYZsq{}}\PY{p}{]]}
          train\PYZus{}W\PY{o}{=}train\PYZus{}data\PY{p}{[[}\PY{l+s}{\PYZsq{}}\PY{l+s}{W\PYZsq{}}\PY{p}{]]}
          train\PYZus{}G \PY{o}{=} train\PYZus{}data\PY{p}{[[}\PY{l+s}{\PYZsq{}}\PY{l+s}{G\PYZsq{}}\PY{p}{]]}
          train\PYZus{}c1\PY{o}{=}train\PYZus{}data\PY{p}{[[}\PY{l+s}{\PYZsq{}}\PY{l+s}{C1\PYZsq{}}\PY{p}{]]}
          train\PYZus{}c2\PY{o}{=}train\PYZus{}data\PY{p}{[[}\PY{l+s}{\PYZsq{}}\PY{l+s}{C2\PYZsq{}}\PY{p}{]]}
          train\PYZus{}Z\PY{o}{=}train\PYZus{}data\PY{p}{[[}\PY{l+s}{\PYZsq{}}\PY{l+s}{Z\PYZsq{}}\PY{p}{]]}
          beta\PY{o}{=}train\PYZus{}data\PY{p}{[[}\PY{l+s}{\PYZsq{}}\PY{l+s}{beta\PYZsq{}}\PY{p}{]]}
          
          test\PYZus{}X\PY{o}{=}test\PYZus{}data\PY{p}{[[}\PY{l+s}{\PYZsq{}}\PY{l+s}{X\PYZsq{}}\PY{p}{]]}
          test\PYZus{}W\PY{o}{=}test\PYZus{}data\PY{p}{[[}\PY{l+s}{\PYZsq{}}\PY{l+s}{W\PYZsq{}}\PY{p}{]]}
          test\PYZus{}G \PY{o}{=} test\PYZus{}data\PY{p}{[[}\PY{l+s}{\PYZsq{}}\PY{l+s}{G\PYZsq{}}\PY{p}{]]}
          test\PYZus{}Z \PY{o}{=} test\PYZus{}data\PY{p}{[[}\PY{l+s}{\PYZsq{}}\PY{l+s}{Z\PYZsq{}}\PY{p}{]]}
          test\PYZus{}c1\PY{o}{=}test\PYZus{}data\PY{p}{[[}\PY{l+s}{\PYZsq{}}\PY{l+s}{C1\PYZsq{}}\PY{p}{]]}
          test\PYZus{}c2\PY{o}{=}test\PYZus{}data\PY{p}{[[}\PY{l+s}{\PYZsq{}}\PY{l+s}{C2\PYZsq{}}\PY{p}{]]}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}291}]:} \PY{k+kp}{print}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{whether D is a fat or a thin matrix\PYZsq{}}\PY{p}{)}
          N\PYZus{} \PY{o}{=} \PY{k+kp}{dim}\PY{p}{(}train\PYZus{}X\PY{p}{)}\PY{p}{[}\PY{l+m}{1}\PY{p}{]}
          K\PYZus{} \PY{o}{=} K
          D\PYZus{} \PY{o}{=} D
          W\PYZus{} \PY{o}{=} \PY{k+kp}{ncol}\PY{p}{(}train\PYZus{}W\PY{p}{)}
          \PY{k+kr}{if}\PY{p}{(}N\PYZus{} \PY{o}{\PYZlt{}} \PY{p}{(}K\PYZus{}\PY{o}{*}D\PYZus{}\PY{o}{+}W\PYZus{}\PY{p}{)}\PY{p}{)}\PY{p}{\PYZob{}}
              \PY{k+kp}{print}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{fat matrix, null space not null. semi definite. fail the test\PYZsq{}}\PY{p}{)}
              \PY{k+kp}{paste}\PY{p}{(}N\PYZus{}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZlt{}\PYZsq{}}\PY{p}{,}K\PYZus{}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{*\PYZsq{}}\PY{p}{,}D\PYZus{}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{+\PYZsq{}}\PY{p}{,}W\PYZus{}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{=\PYZsq{}}\PY{p}{,}K\PYZus{}\PY{o}{*}D\PYZus{}\PY{o}{+}W\PYZus{}\PY{p}{,}sep\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{ \PYZsq{}}\PY{p}{)}
          \PY{p}{\PYZcb{}} \PY{k+kp}{else}\PY{p}{\PYZob{}}
              \PY{k+kp}{print}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{tall matrx, null space might be zero. MAY/MAY NOT pass the test\PYZsq{}}\PY{p}{)}
              \PY{k+kp}{paste}\PY{p}{(}N\PYZus{}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZgt{}\PYZsq{}}\PY{p}{,}K\PYZus{}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{*\PYZsq{}}\PY{p}{,}D\PYZus{}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{+\PYZsq{}}\PY{p}{,}W\PYZus{}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{=\PYZsq{}}\PY{p}{,}K\PYZus{}\PY{o}{*}D\PYZus{}\PY{o}{+}W\PYZus{}\PY{p}{,}sep\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{ \PYZsq{}}\PY{p}{)}
          \PY{p}{\PYZcb{}}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
[1] "whether D is a fat or a thin matrix"
[1] "tall matrx, null space might be zero. MAY/MAY NOT pass the test"

    \end{Verbatim}

    '979 > 4 * 200 + 4 = 804'

    
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}293}]:} tca.mdl \PY{o}{\PYZlt{}\PYZhy{}} tca\PY{p}{(}X\PY{o}{=}\PY{k+kp}{t}\PY{p}{(}\PY{k+kp}{as.data.frame}\PY{p}{(}train\PYZus{}G\PY{p}{[}\PY{l+m}{1}\PY{p}{,}\PY{p}{]}\PY{p}{)}\PY{p}{)}\PY{p}{,} W\PY{o}{=}train\PYZus{}W\PY{p}{,}C1\PY{o}{=}train\PYZus{}X\PY{p}{,}verbose\PY{o}{=}\PY{k+kc}{TRUE}\PY{p}{,}debug\PY{o}{=}\PY{k+kc}{TRUE}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
INFO [2019-08-12 12:28:41] Starting tca{\ldots}
INFO [2019-08-12 12:28:41] Validating input{\ldots}
DEBUG [2019-08-12 12:28:41] Validating input types{\ldots}
DEBUG [2019-08-12 12:28:41] Validating input stucture and values{\ldots}
DEBUG [2019-08-12 12:28:41] Validating input conditions{\ldots}
DEBUG [2019-08-12 12:28:41] Validating matrix dimensions{\ldots}
DEBUG [2019-08-12 12:28:41] Validating the order of observations across matrices{\ldots}
DEBUG [2019-08-12 12:28:41] Validating that W is non-negative and each row sums up to 1{\ldots}
INFO [2019-08-12 12:28:41] Fitting the TCA model{\ldots}
DEBUG [2019-08-12 12:28:41] Starting function 'tca.fit'{\ldots}
INFO [2019-08-12 12:28:41] Fitting means and variances{\ldots}
DEBUG [2019-08-12 12:28:41] Starting function 'tca.fit\_means\_vars'{\ldots}
INFO [2019-08-12 12:28:41] Iteration 1 out of 10 internal iterations{\ldots}
DEBUG [2019-08-12 12:28:41] Calculate W\_norms and related quantities
DEBUG [2019-08-12 12:28:41] Estimate mus, deltas, gammas.
  |++++++++++++++++++++++++++++++++++++++++++++++++++| 100\%
DEBUG [2019-08-12 12:28:42] Get initial estimates of sigmas
DEBUG [2019-08-12 12:28:42] Estimate sigmas.
  |++++++++++++++++++++++++++++++++++++++++++++++++++| 100\%
DEBUG [2019-08-12 12:28:42] Estimate tau.
DEBUG [2019-08-12 12:28:42] Test for convergence.
DEBUG [2019-08-12 12:28:42] ll\_new=-346.020338938581, ll\_prev=-Inf, ll\_diff=Inf, diff\_threshold=0.346020338938581
INFO [2019-08-12 12:28:42] Iteration 2 out of 10 internal iterations{\ldots}
DEBUG [2019-08-12 12:28:42] Calculate W\_norms and related quantities
DEBUG [2019-08-12 12:28:42] Calculate W\_norms
DEBUG [2019-08-12 12:28:42] Estimate mus, deltas, gammas.
  |++++++++++++++++++++++++++++++++++++++++++++++++++| 100\%
DEBUG [2019-08-12 12:28:42] Estimate sigmas.
  |++++++++++++++++++++++++++++++++++++++++++++++++++| 100\%
DEBUG [2019-08-12 12:28:42] Estimate tau.
DEBUG [2019-08-12 12:28:42] Test for convergence.
DEBUG [2019-08-12 12:28:42] ll\_new=-269.311164049603, ll\_prev=-346.020338938581, ll\_diff=76.7091748889783, diff\_threshold=0.269311164049603
INFO [2019-08-12 12:28:42] Iteration 3 out of 10 internal iterations{\ldots}
DEBUG [2019-08-12 12:28:42] Calculate W\_norms and related quantities
DEBUG [2019-08-12 12:28:42] Calculate W\_norms
DEBUG [2019-08-12 12:28:42] Estimate mus, deltas, gammas.
  |++++++++++++++++++++++++++++++++++++++++++++++++++| 100\%
DEBUG [2019-08-12 12:28:43] Estimate sigmas.
  |++++++++++++++++++++++++++++++++++++++++++++++++++| 100\%
DEBUG [2019-08-12 12:28:43] Estimate tau.
DEBUG [2019-08-12 12:28:43] Test for convergence.
DEBUG [2019-08-12 12:28:43] ll\_new=-210.61438694123, ll\_prev=-269.311164049603, ll\_diff=58.6967771083731, diff\_threshold=0.21061438694123
INFO [2019-08-12 12:28:43] Iteration 4 out of 10 internal iterations{\ldots}
DEBUG [2019-08-12 12:28:43] Calculate W\_norms and related quantities
DEBUG [2019-08-12 12:28:43] Calculate W\_norms
DEBUG [2019-08-12 12:28:43] Estimate mus, deltas, gammas.
  |++++++++++++++++++++++++++++++++++++++++++++++++++| 100\%
DEBUG [2019-08-12 12:28:43] Estimate sigmas.
  |++++++++++++++++++++++++++++++++++++++++++++++++++| 100\%
DEBUG [2019-08-12 12:28:43] Estimate tau.
DEBUG [2019-08-12 12:28:43] Test for convergence.
DEBUG [2019-08-12 12:28:43] ll\_new=-121.410647374051, ll\_prev=-210.61438694123, ll\_diff=89.2037395671784, diff\_threshold=0.121410647374051
INFO [2019-08-12 12:28:43] Iteration 5 out of 10 internal iterations{\ldots}
DEBUG [2019-08-12 12:28:43] Calculate W\_norms and related quantities
DEBUG [2019-08-12 12:28:43] Calculate W\_norms
DEBUG [2019-08-12 12:28:43] Estimate mus, deltas, gammas.
  |++++++++++++++++++++++++++++++++++++++++++++++++++| 100\%
DEBUG [2019-08-12 12:28:44] Estimate sigmas.
  |++++++++++++++++++++++++++++++++++++++++++++++++++| 100\%
DEBUG [2019-08-12 12:28:44] Estimate tau.
DEBUG [2019-08-12 12:28:44] Test for convergence.
DEBUG [2019-08-12 12:28:44] ll\_new=-76.2392554562477, ll\_prev=-121.410647374051, ll\_diff=45.1713919178037, diff\_threshold=0.0762392554562477
INFO [2019-08-12 12:28:44] Iteration 6 out of 10 internal iterations{\ldots}
DEBUG [2019-08-12 12:28:44] Calculate W\_norms and related quantities
DEBUG [2019-08-12 12:28:44] Calculate W\_norms
DEBUG [2019-08-12 12:28:44] Estimate mus, deltas, gammas.
  |++++++++++++++++++++++++++++++++++++++++++++++++++| 100\%
DEBUG [2019-08-12 12:28:44] Estimate sigmas.
  |++++++++++++++++++++++++++++++++++++++++++++++++++| 100\%
DEBUG [2019-08-12 12:28:44] Estimate tau.
DEBUG [2019-08-12 12:28:44] Test for convergence.
DEBUG [2019-08-12 12:28:44] ll\_new=-63.5934246523248, ll\_prev=-76.2392554562477, ll\_diff=12.6458308039229, diff\_threshold=0.0635934246523248
INFO [2019-08-12 12:28:44] Iteration 7 out of 10 internal iterations{\ldots}
DEBUG [2019-08-12 12:28:44] Calculate W\_norms and related quantities
DEBUG [2019-08-12 12:28:45] Calculate W\_norms
DEBUG [2019-08-12 12:28:45] Estimate mus, deltas, gammas.
  |++++++++++++++++++++++++++++++++++++++++++++++++++| 100\%
DEBUG [2019-08-12 12:28:45] Estimate sigmas.
  |++++++++++++++++++++++++++++++++++++++++++++++++++| 100\%
DEBUG [2019-08-12 12:28:45] Estimate tau.
DEBUG [2019-08-12 12:28:45] Test for convergence.
DEBUG [2019-08-12 12:28:45] ll\_new=-39.776894227627, ll\_prev=-63.5934246523248, ll\_diff=23.8165304246978, diff\_threshold=0.039776894227627
INFO [2019-08-12 12:28:45] Iteration 8 out of 10 internal iterations{\ldots}
DEBUG [2019-08-12 12:28:45] Calculate W\_norms and related quantities
DEBUG [2019-08-12 12:28:45] Calculate W\_norms
DEBUG [2019-08-12 12:28:45] Estimate mus, deltas, gammas.
  |++++++++++++++++++++++++++++++++++++++++++++++++++| 100\%
DEBUG [2019-08-12 12:28:45] Estimate sigmas.
  |++++++++++++++++++++++++++++++++++++++++++++++++++| 100\%
DEBUG [2019-08-12 12:28:45] Estimate tau.
DEBUG [2019-08-12 12:28:45] Test for convergence.
DEBUG [2019-08-12 12:28:45] ll\_new=8.5274038790202, ll\_prev=-39.776894227627, ll\_diff=48.3042981066472, diff\_threshold=0.0085274038790202
INFO [2019-08-12 12:28:45] Iteration 9 out of 10 internal iterations{\ldots}
DEBUG [2019-08-12 12:28:46] Calculate W\_norms and related quantities
DEBUG [2019-08-12 12:28:46] Calculate W\_norms
DEBUG [2019-08-12 12:28:46] Estimate mus, deltas, gammas.
  |++++++++++++++++++++++++++++++++++++++++++++++++++| 100\%
DEBUG [2019-08-12 12:28:46] Estimate sigmas.
  |++++++++++++++++++++++++++++++++++++++++++++++++++| 100\%
DEBUG [2019-08-12 12:28:46] Estimate tau.
DEBUG [2019-08-12 12:28:46] Test for convergence.
DEBUG [2019-08-12 12:28:46] ll\_new=112.282411233272, ll\_prev=8.5274038790202, ll\_diff=103.755007354252, diff\_threshold=0.112282411233272
INFO [2019-08-12 12:28:46] Iteration 10 out of 10 internal iterations{\ldots}
DEBUG [2019-08-12 12:28:46] Calculate W\_norms and related quantities
DEBUG [2019-08-12 12:28:46] Calculate W\_norms
DEBUG [2019-08-12 12:28:46] Estimate mus, deltas, gammas.
  |++++++++++++++++++++++++++++++++++++++++++++++++++| 100\%
DEBUG [2019-08-12 12:28:47] Estimate sigmas.
  |++++++++++++++++++++++++++++++++++++++++++++++++++| 100\%
DEBUG [2019-08-12 12:28:47] Estimate tau.
DEBUG [2019-08-12 12:28:47] Test for convergence.
DEBUG [2019-08-12 12:28:47] ll\_new=296.783265979774, ll\_prev=112.282411233272, ll\_diff=184.500854746502, diff\_threshold=0.296783265979774
INFO [2019-08-12 12:28:47] Finished tca.

    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}214}]:} W \PY{o}{=} train\PYZus{}W\PY{c+c1}{\PYZsh{} + rnm}
          k \PY{o}{=} \PY{k+kp}{ncol}\PY{p}{(}W\PY{p}{)}
          W\PYZus{}norms \PY{o}{\PYZlt{}\PYZhy{}} \PY{k+kp}{rowSums}\PY{p}{(}W\PY{o}{*}\PY{o}{*}\PY{l+m}{2}\PY{p}{)}\PY{o}{*}\PY{o}{*}\PY{l+m}{0.5}
          W\PYZus{}tilde \PY{o}{\PYZlt{}\PYZhy{}} W\PY{o}{/}\PY{k+kp}{t}\PY{p}{(}repmat\PY{p}{(}W\PYZus{}norms\PY{p}{,}k\PY{p}{,}\PY{l+m}{1}\PY{p}{)}\PY{p}{)}
          C2 \PY{o}{\PYZlt{}\PYZhy{}} \PY{k+kt}{matrix}\PY{p}{(}\PY{l+m}{0}\PY{p}{,} nrow\PY{o}{=}\PY{k+kp}{ncol}\PY{p}{(}train\PYZus{}G\PY{p}{)}\PY{p}{,} ncol\PY{o}{=}\PY{l+m}{0}\PY{p}{)}
          train\PYZus{}X\PYZus{} \PY{o}{=} train\PYZus{}X
          n \PY{o}{=} \PY{k+kp}{nrow}\PY{p}{(}W\PY{p}{)}
          k \PY{o}{=} \PY{k+kp}{ncol}\PY{p}{(}W\PY{p}{)}
          p1 \PY{o}{=} \PY{k+kp}{ncol}\PY{p}{(}train\PYZus{}X\PYZus{}\PY{p}{)}
          C1\PYZus{} \PY{o}{=} hadamard.prod\PY{p}{(}Reshape\PY{p}{(}Reshape\PY{p}{(}\PY{k+kp}{apply}\PY{p}{(}W\PY{p}{,} \PY{l+m}{2}\PY{p}{,} \PY{k+kr}{function}\PY{p}{(}v\PY{p}{)} repmat\PY{p}{(}v\PY{p}{,}\PY{l+m}{1}\PY{p}{,}p1\PY{p}{)}\PY{p}{)}\PY{p}{,} n\PY{o}{*}p1\PY{o}{*}k\PY{p}{,}\PY{l+m}{1}\PY{p}{)}\PY{p}{,} n\PY{p}{,}p1\PY{o}{*}k\PY{p}{)}\PY{p}{,} repmat\PY{p}{(}train\PYZus{}X\PYZus{}\PY{p}{,} \PY{l+m}{1}\PY{p}{,} k\PY{p}{)}\PY{p}{)}
          C1\PYZus{}tilde \PY{o}{\PYZlt{}\PYZhy{}} C1\PYZus{}\PY{o}{/}\PY{k+kp}{t}\PY{p}{(}repmat\PY{p}{(}W\PYZus{}norms\PY{p}{,}k\PY{o}{*}p1\PY{p}{,}\PY{l+m}{1}\PY{p}{)}\PY{p}{)}
          D \PY{o}{=} \PY{k+kp}{as.matrix}\PY{p}{(}\PY{k+kp}{cbind}\PY{p}{(}W\PYZus{}tilde\PY{p}{,}C2\PY{p}{,}C1\PYZus{}tilde\PY{p}{)}\PY{p}{)}\PY{c+c1}{\PYZsh{}5:ncol(C1\PYZus{}tilde)]))}
          Dmat \PY{o}{\PYZlt{}\PYZhy{}} \PY{k+kp}{t}\PY{p}{(}D\PY{p}{)} \PY{o}{\PYZpc{}*\PYZpc{}} D
          Dmat \PY{o}{=} \PY{k+kp}{round}\PY{p}{(}Dmat\PY{p}{,}\PY{l+m}{10}\PY{p}{)}
          \PY{k+kp}{print}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{W\PYZus{}tilde\PYZsq{}}\PY{p}{)}
          \PY{k+kp}{dim}\PY{p}{(}W\PYZus{}tilde\PY{p}{)}
          \PY{k+kp}{qr}\PY{p}{(}W\PYZus{}tilde\PY{p}{)}\PY{o}{\PYZdl{}}\PY{k+kp}{rank}
          \PY{k+kp}{print}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{C1\PYZus{}tilde\PYZsq{}}\PY{p}{)}
          \PY{k+kp}{dim}\PY{p}{(}C1\PYZus{}tilde\PY{p}{)}
          \PY{k+kp}{qr}\PY{p}{(}C1\PYZus{}tilde\PY{p}{)}\PY{o}{\PYZdl{}}\PY{k+kp}{rank}
          \PY{k+kp}{print}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{D\PYZsq{}}\PY{p}{)}
          \PY{k+kp}{dim}\PY{p}{(}D\PY{p}{)}
          \PY{k+kp}{qr}\PY{p}{(}D\PY{p}{)}\PY{o}{\PYZdl{}}\PY{k+kp}{rank}
          \PY{k+kp}{print}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{dependent columns of D\PYZsq{}}\PY{p}{)}
          \PY{c+c1}{\PYZsh{}rankifremoved \PYZlt{}\PYZhy{} sapply(1:ncol(D), function (x) qr(D[,\PYZhy{}x])\PYZdl{}rank)}
          \PY{c+c1}{\PYZsh{}rankifremoved}
          \PY{c+c1}{\PYZsh{}which(rankifremoved == max(rankifremoved))}
          \PY{k+kp}{print}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{positive definite Dmat\PYZsq{}}\PY{p}{)}
          is.positive.definite\PY{p}{(}Dmat\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
[1] "W\_tilde"

    \end{Verbatim}

    \begin{enumerate*}
\item 979
\item 4
\end{enumerate*}


    
    4

    
    \begin{Verbatim}[commandchars=\\\{\}]
[1] "C1\_tilde"

    \end{Verbatim}

    \begin{enumerate*}
\item 979
\item 800
\end{enumerate*}


    
    800

    
    \begin{Verbatim}[commandchars=\\\{\}]
[1] "D"

    \end{Verbatim}

    \begin{enumerate*}
\item 979
\item 804
\end{enumerate*}


    
    804

    
    \begin{Verbatim}[commandchars=\\\{\}]
[1] "dependent columns of D"
[1] "positive definite Dmat"

    \end{Verbatim}

    TRUE

    
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}215}]:} rnm \PY{o}{=} \PY{k+kt}{matrix}\PY{p}{(}rnorm\PY{p}{(}\PY{k+kp}{nrow}\PY{p}{(}W\PY{p}{)}\PY{o}{*}\PY{k+kp}{ncol}\PY{p}{(}W\PY{p}{)}\PY{p}{,}mean\PY{o}{=}\PY{l+m}{0}\PY{p}{,}sd\PY{o}{=}\PY{l+m}{0.1}\PY{p}{)}\PY{p}{,}nrow\PY{o}{=}\PY{k+kp}{nrow}\PY{p}{(}W\PY{p}{)}\PY{p}{,}ncol\PY{o}{=}\PY{k+kp}{ncol}\PY{p}{(}W\PY{p}{)}\PY{p}{)}
          
          W \PY{o}{=} train\PYZus{}W\PY{c+c1}{\PYZsh{} + rnm}
          k \PY{o}{=} \PY{k+kp}{ncol}\PY{p}{(}W\PY{p}{)}
          W\PYZus{}norms \PY{o}{\PYZlt{}\PYZhy{}} \PY{k+kp}{rowSums}\PY{p}{(}W\PY{o}{*}\PY{o}{*}\PY{l+m}{2}\PY{p}{)}\PY{o}{*}\PY{o}{*}\PY{l+m}{0.5}
          W\PYZus{}tilde \PY{o}{\PYZlt{}\PYZhy{}} W\PY{o}{/}\PY{k+kp}{t}\PY{p}{(}repmat\PY{p}{(}W\PYZus{}norms\PY{p}{,}k\PY{p}{,}\PY{l+m}{1}\PY{p}{)}\PY{p}{)}
          C2 \PY{o}{\PYZlt{}\PYZhy{}} \PY{k+kt}{matrix}\PY{p}{(}\PY{l+m}{0}\PY{p}{,} nrow\PY{o}{=}\PY{k+kp}{ncol}\PY{p}{(}train\PYZus{}G\PY{p}{)}\PY{p}{,} ncol\PY{o}{=}\PY{l+m}{0}\PY{p}{)}
          
          \PY{c+c1}{\PYZsh{} bad\PYZus{}rows = 10 34 40 80 117 121 217 226}
          bad\PYZus{}rows \PY{o}{=} \PY{k+kt}{array}\PY{p}{(}\PY{l+m}{0}\PY{p}{,}\PY{k+kp}{ncol}\PY{p}{(}train\PYZus{}X\PY{p}{)}\PY{p}{)}
          rankD \PY{o}{=} \PY{k+kt}{array}\PY{p}{(}\PY{l+m}{0}\PY{p}{,}\PY{k+kp}{ncol}\PY{p}{(}train\PYZus{}X\PY{p}{)}\PY{p}{)}
          dependent\PYZus{}row\PYZus{}number \PY{o}{=} \PY{k+kt}{list}\PY{p}{(}\PY{p}{)}
          \PY{k+kr}{for} \PY{p}{(}i \PY{k+kr}{in} \PY{l+m}{1}\PY{o}{:}\PY{k+kp}{ncol}\PY{p}{(}train\PYZus{}X\PY{p}{)}\PY{p}{)}\PY{p}{\PYZob{}}
              train\PYZus{}X\PYZus{} \PY{o}{=} \PY{k+kt}{matrix}\PY{p}{(}train\PYZus{}X\PY{p}{[}\PY{p}{,}i\PY{p}{]}\PY{p}{,}nrow\PY{o}{=}\PY{k+kp}{nrow}\PY{p}{(}train\PYZus{}X\PY{p}{)}\PY{p}{,}ncol\PY{o}{=}\PY{l+m}{1}\PY{p}{)}
              n \PY{o}{=} \PY{k+kp}{nrow}\PY{p}{(}W\PY{p}{)}
              k \PY{o}{=} \PY{k+kp}{ncol}\PY{p}{(}W\PY{p}{)}
              p1 \PY{o}{=} \PY{k+kp}{ncol}\PY{p}{(}train\PYZus{}X\PYZus{}\PY{p}{)}
              C1\PYZus{} \PY{o}{=} hadamard.prod\PY{p}{(}Reshape\PY{p}{(}Reshape\PY{p}{(}\PY{k+kp}{apply}\PY{p}{(}W\PY{p}{,} \PY{l+m}{2}\PY{p}{,} \PY{k+kr}{function}\PY{p}{(}v\PY{p}{)} repmat\PY{p}{(}v\PY{p}{,}\PY{l+m}{1}\PY{p}{,}p1\PY{p}{)}\PY{p}{)}\PY{p}{,} n\PY{o}{*}p1\PY{o}{*}k\PY{p}{,}\PY{l+m}{1}\PY{p}{)}\PY{p}{,} n\PY{p}{,}p1\PY{o}{*}k\PY{p}{)}\PY{p}{,} repmat\PY{p}{(}train\PYZus{}X\PYZus{}\PY{p}{,} \PY{l+m}{1}\PY{p}{,} k\PY{p}{)}\PY{p}{)}
              C1\PYZus{}tilde \PY{o}{\PYZlt{}\PYZhy{}} C1\PYZus{}\PY{o}{/}\PY{k+kp}{t}\PY{p}{(}repmat\PY{p}{(}W\PYZus{}norms\PY{p}{,}k\PY{o}{*}p1\PY{p}{,}\PY{l+m}{1}\PY{p}{)}\PY{p}{)}
              D \PY{o}{=} \PY{k+kp}{as.matrix}\PY{p}{(}\PY{k+kp}{cbind}\PY{p}{(}W\PYZus{}tilde\PY{p}{,}C2\PY{p}{,}C1\PYZus{}tilde\PY{p}{)}\PY{p}{)}\PY{c+c1}{\PYZsh{}5:ncol(C1\PYZus{}tilde)]))}
              Dmat \PY{o}{\PYZlt{}\PYZhy{}} \PY{k+kp}{t}\PY{p}{(}D\PY{p}{)} \PY{o}{\PYZpc{}*\PYZpc{}} D
              Dmat \PY{o}{=} \PY{k+kp}{round}\PY{p}{(}Dmat\PY{p}{,}\PY{l+m}{10}\PY{p}{)}
              \PY{k+kr}{if} \PY{p}{(}\PY{o}{!}is.positive.definite\PY{p}{(}Dmat\PY{p}{)}\PY{p}{)}\PY{p}{\PYZob{}}
                  bad\PYZus{}rows\PY{p}{[}i\PY{p}{]} \PY{o}{=} \PY{l+m}{1}
                  rankD\PY{p}{[}i\PY{p}{]} \PY{o}{=} \PY{k+kp}{qr}\PY{p}{(}D\PY{p}{)}\PY{o}{\PYZdl{}}\PY{k+kp}{rank}
                  \PY{c+c1}{\PYZsh{}rankifremoved \PYZlt{}\PYZhy{} sapply(1:ncol(D), function (x) qr(D[,\PYZhy{}x])\PYZdl{}rank)}
                  \PY{c+c1}{\PYZsh{}dependent\PYZus{}row\PYZus{}number[length(dependent\PYZus{}row\PYZus{}number)+1] =  c(which(rankifremoved == max(rankifremoved)))}
              \PY{p}{\PYZcb{}}
          \PY{p}{\PYZcb{}}
          \PY{k+kp}{print}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{all snps that fails postive definite tests\PYZsq{}}\PY{p}{)}
          \PY{c+c1}{\PYZsh{} which(bad\PYZus{}rows==1)}
          rankD\PY{p}{[}rankD\PY{o}{!=}\PY{l+m}{0}\PY{p}{]} \PY{c+c1}{\PYZsh{} Their D matrix\PYZsq{}s rank}
          \PY{c+c1}{\PYZsh{} how many unique elements in 0/1/2/3 in these rows}
          \PY{k+kp}{unlist}\PY{p}{(}\PY{k+kp}{apply}\PY{p}{(}train\PYZus{}X\PY{p}{[}\PY{p}{,}\PY{k+kt}{c}\PY{p}{(}\PY{k+kp}{which}\PY{p}{(}bad\PYZus{}rows\PY{o}{==}\PY{l+m}{1}\PY{p}{)}\PY{p}{)}\PY{p}{]}\PY{p}{,}\PY{l+m}{2}\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} \PY{k+kp}{length}\PY{p}{(}\PY{k+kp}{unique}\PY{p}{(}x\PY{p}{)}\PY{p}{)}\PY{p}{)}\PY{p}{)}
          \PY{c+c1}{\PYZsh{}dependent\PYZus{}row\PYZus{}number}
                                          
                                          
          W \PY{o}{=} train\PYZus{}W \PY{o}{+} rnm
          k \PY{o}{=} \PY{k+kp}{ncol}\PY{p}{(}W\PY{p}{)}
          W\PYZus{}norms \PY{o}{\PYZlt{}\PYZhy{}} \PY{k+kp}{rowSums}\PY{p}{(}W\PY{o}{*}\PY{o}{*}\PY{l+m}{2}\PY{p}{)}\PY{o}{*}\PY{o}{*}\PY{l+m}{0.5}
          W\PYZus{}tilde \PY{o}{\PYZlt{}\PYZhy{}} W\PY{o}{/}\PY{k+kp}{t}\PY{p}{(}repmat\PY{p}{(}W\PYZus{}norms\PY{p}{,}k\PY{p}{,}\PY{l+m}{1}\PY{p}{)}\PY{p}{)}
          C2 \PY{o}{\PYZlt{}\PYZhy{}} \PY{k+kt}{matrix}\PY{p}{(}\PY{l+m}{0}\PY{p}{,} nrow\PY{o}{=}\PY{k+kp}{ncol}\PY{p}{(}train\PYZus{}G\PY{p}{)}\PY{p}{,} ncol\PY{o}{=}\PY{l+m}{0}\PY{p}{)}
          
          \PY{c+c1}{\PYZsh{} bad\PYZus{}rows = 34, 10}
          bad\PYZus{}rows \PY{o}{=} \PY{k+kt}{array}\PY{p}{(}\PY{l+m}{0}\PY{p}{,}\PY{k+kp}{ncol}\PY{p}{(}train\PYZus{}X\PY{p}{)}\PY{p}{)}
          rankD \PY{o}{=} \PY{k+kt}{array}\PY{p}{(}\PY{l+m}{0}\PY{p}{,}\PY{k+kp}{ncol}\PY{p}{(}train\PYZus{}X\PY{p}{)}\PY{p}{)}
          dependent\PYZus{}row\PYZus{}number \PY{o}{=} \PY{k+kt}{list}\PY{p}{(}\PY{p}{)}
          \PY{k+kr}{for} \PY{p}{(}i \PY{k+kr}{in} \PY{l+m}{1}\PY{o}{:}\PY{k+kp}{ncol}\PY{p}{(}train\PYZus{}X\PY{p}{)}\PY{p}{)}\PY{p}{\PYZob{}}
              train\PYZus{}X\PYZus{} \PY{o}{=} \PY{k+kt}{matrix}\PY{p}{(}train\PYZus{}X\PY{p}{[}\PY{p}{,}i\PY{p}{]}\PY{p}{,}nrow\PY{o}{=}\PY{k+kp}{nrow}\PY{p}{(}train\PYZus{}X\PY{p}{)}\PY{p}{,}ncol\PY{o}{=}\PY{l+m}{1}\PY{p}{)}
              n \PY{o}{=} \PY{k+kp}{nrow}\PY{p}{(}W\PY{p}{)}
              k \PY{o}{=} \PY{k+kp}{ncol}\PY{p}{(}W\PY{p}{)}
              p1 \PY{o}{=} \PY{k+kp}{ncol}\PY{p}{(}train\PYZus{}X\PYZus{}\PY{p}{)}
              C1\PYZus{} \PY{o}{=} hadamard.prod\PY{p}{(}Reshape\PY{p}{(}Reshape\PY{p}{(}\PY{k+kp}{apply}\PY{p}{(}W\PY{p}{,} \PY{l+m}{2}\PY{p}{,} \PY{k+kr}{function}\PY{p}{(}v\PY{p}{)} repmat\PY{p}{(}v\PY{p}{,}\PY{l+m}{1}\PY{p}{,}p1\PY{p}{)}\PY{p}{)}\PY{p}{,} n\PY{o}{*}p1\PY{o}{*}k\PY{p}{,}\PY{l+m}{1}\PY{p}{)}\PY{p}{,} n\PY{p}{,}p1\PY{o}{*}k\PY{p}{)}\PY{p}{,} repmat\PY{p}{(}train\PYZus{}X\PYZus{}\PY{p}{,} \PY{l+m}{1}\PY{p}{,} k\PY{p}{)}\PY{p}{)}
              C1\PYZus{}tilde \PY{o}{\PYZlt{}\PYZhy{}} C1\PYZus{}\PY{o}{/}\PY{k+kp}{t}\PY{p}{(}repmat\PY{p}{(}W\PYZus{}norms\PY{p}{,}k\PY{o}{*}p1\PY{p}{,}\PY{l+m}{1}\PY{p}{)}\PY{p}{)}
              D \PY{o}{=} \PY{k+kp}{as.matrix}\PY{p}{(}\PY{k+kp}{cbind}\PY{p}{(}W\PYZus{}tilde\PY{p}{,}C2\PY{p}{,}C1\PYZus{}tilde\PY{p}{)}\PY{p}{)}\PY{c+c1}{\PYZsh{}5:ncol(C1\PYZus{}tilde)]))}
              Dmat \PY{o}{\PYZlt{}\PYZhy{}} \PY{k+kp}{t}\PY{p}{(}D\PY{p}{)} \PY{o}{\PYZpc{}*\PYZpc{}} D
              Dmat \PY{o}{=} \PY{k+kp}{round}\PY{p}{(}Dmat\PY{p}{,}\PY{l+m}{10}\PY{p}{)}
              \PY{k+kr}{if} \PY{p}{(}\PY{o}{!}is.positive.definite\PY{p}{(}Dmat\PY{p}{)}\PY{p}{)}\PY{p}{\PYZob{}}
                  bad\PYZus{}rows\PY{p}{[}i\PY{p}{]} \PY{o}{=} \PY{l+m}{1}
                  rankD\PY{p}{[}i\PY{p}{]} \PY{o}{=} \PY{k+kp}{qr}\PY{p}{(}D\PY{p}{)}\PY{o}{\PYZdl{}}\PY{k+kp}{rank}
                  \PY{c+c1}{\PYZsh{}rankifremoved \PYZlt{}\PYZhy{} sapply(1:ncol(D), function (x) qr(D[,\PYZhy{}x])\PYZdl{}rank)}
                  \PY{c+c1}{\PYZsh{}dependent\PYZus{}row\PYZus{}number[length(dependent\PYZus{}row\PYZus{}number)+1] =  (which(rankifremoved == max(rankifremoved)))}
              \PY{p}{\PYZcb{}}
          
          \PY{p}{\PYZcb{}}
          \PY{k+kp}{print}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{after random noise to weight, snps that fails\PYZsq{}}\PY{p}{)}
          \PY{k+kp}{which}\PY{p}{(}bad\PYZus{}rows\PY{o}{==}\PY{l+m}{1}\PY{p}{)}
          rankD\PY{p}{[}rankD\PY{o}{!=}\PY{l+m}{0}\PY{p}{]}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
[1] "all snps that fails postive definite tests"

    \end{Verbatim}

    

    
    

    
    \begin{Verbatim}[commandchars=\\\{\}]
[1] "after random noise to weight, snps that fails"

    \end{Verbatim}

    

    
    

    
    \subsubsection{II. TCA model}\label{ii.-tca-model}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}199}]:} D \PY{o}{=} \PY{l+m}{200}
          K \PY{o}{=} \PY{l+m}{4}
          M \PY{o}{=} \PY{l+m}{10}
          data\PY{o}{=}generate\PYZus{}data\PY{p}{(}N\PY{o}{=}\PY{l+m}{5000}\PY{p}{,}D\PY{o}{=}D\PY{p}{,}p\PYZus{}slab\PY{o}{=}\PY{l+m}{0.5}\PY{p}{,}M\PY{o}{=}M\PY{p}{,}K\PY{o}{=}K\PY{p}{,}MAF\PY{o}{=}\PY{l+m}{0.18}\PY{p}{,}train\PYZus{}proportion\PY{o}{=}\PY{l+m}{0.7}\PY{p}{,}sigma\PYZus{}g\PY{o}{=}\PY{l+m}{0.3}\PY{p}{)}
          train\PYZus{}data\PY{o}{=}data\PY{p}{[[}\PY{l+s}{\PYZsq{}}\PY{l+s}{train\PYZus{}data\PYZsq{}}\PY{p}{]]}
          test\PYZus{}data \PY{o}{=} data\PY{p}{[[}\PY{l+s}{\PYZsq{}}\PY{l+s}{test\PYZus{}data\PYZsq{}}\PY{p}{]]}
          train\PYZus{}X\PY{o}{=}train\PYZus{}data\PY{p}{[[}\PY{l+s}{\PYZsq{}}\PY{l+s}{X\PYZsq{}}\PY{p}{]]}
          train\PYZus{}W\PY{o}{=}train\PYZus{}data\PY{p}{[[}\PY{l+s}{\PYZsq{}}\PY{l+s}{W\PYZsq{}}\PY{p}{]]}
          train\PYZus{}G \PY{o}{=} train\PYZus{}data\PY{p}{[[}\PY{l+s}{\PYZsq{}}\PY{l+s}{G\PYZsq{}}\PY{p}{]]}
          train\PYZus{}c1\PY{o}{=}train\PYZus{}data\PY{p}{[[}\PY{l+s}{\PYZsq{}}\PY{l+s}{C1\PYZsq{}}\PY{p}{]]}
          train\PYZus{}c2\PY{o}{=}train\PYZus{}data\PY{p}{[[}\PY{l+s}{\PYZsq{}}\PY{l+s}{C2\PYZsq{}}\PY{p}{]]}
          train\PYZus{}Z\PY{o}{=}train\PYZus{}data\PY{p}{[[}\PY{l+s}{\PYZsq{}}\PY{l+s}{Z\PYZsq{}}\PY{p}{]]}
          beta\PY{o}{=}train\PYZus{}data\PY{p}{[[}\PY{l+s}{\PYZsq{}}\PY{l+s}{beta\PYZsq{}}\PY{p}{]]}
          
          test\PYZus{}X\PY{o}{=}test\PYZus{}data\PY{p}{[[}\PY{l+s}{\PYZsq{}}\PY{l+s}{X\PYZsq{}}\PY{p}{]]}
          test\PYZus{}W\PY{o}{=}test\PYZus{}data\PY{p}{[[}\PY{l+s}{\PYZsq{}}\PY{l+s}{W\PYZsq{}}\PY{p}{]]}
          test\PYZus{}G \PY{o}{=} test\PYZus{}data\PY{p}{[[}\PY{l+s}{\PYZsq{}}\PY{l+s}{G\PYZsq{}}\PY{p}{]]}
          test\PYZus{}Z \PY{o}{=} test\PYZus{}data\PY{p}{[[}\PY{l+s}{\PYZsq{}}\PY{l+s}{Z\PYZsq{}}\PY{p}{]]}
          test\PYZus{}c1\PY{o}{=}test\PYZus{}data\PY{p}{[[}\PY{l+s}{\PYZsq{}}\PY{l+s}{C1\PYZsq{}}\PY{p}{]]}
          test\PYZus{}c2\PY{o}{=}test\PYZus{}data\PY{p}{[[}\PY{l+s}{\PYZsq{}}\PY{l+s}{C2\PYZsq{}}\PY{p}{]]}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}200}]:} rnm \PY{o}{=} \PY{k+kt}{matrix}\PY{p}{(}rnorm\PY{p}{(}\PY{k+kp}{nrow}\PY{p}{(}train\PYZus{}X\PY{p}{)}\PY{o}{*}\PY{k+kp}{ncol}\PY{p}{(}train\PYZus{}X\PY{p}{)}\PY{p}{,}mean\PY{o}{=}\PY{l+m}{0}\PY{p}{,}sd\PY{o}{=}\PY{l+m}{0.1}\PY{p}{)}\PY{p}{,}nrow\PY{o}{=}\PY{k+kp}{nrow}\PY{p}{(}train\PYZus{}X\PY{p}{)}\PY{p}{,}ncol\PY{o}{=}\PY{k+kp}{ncol}\PY{p}{(}train\PYZus{}X\PY{p}{)}\PY{p}{)}
          tca.mdl \PY{o}{\PYZlt{}\PYZhy{}} tca\PY{p}{(}X\PY{o}{=}train\PYZus{}G\PY{p}{,} W\PY{o}{=}train\PYZus{}W\PY{p}{,} C1\PY{o}{=}train\PYZus{}X\PY{p}{,} C2\PY{o}{=}train\PYZus{}c2\PY{p}{,}verbose\PY{o}{=}\PY{k+kc}{FALSE}\PY{p}{)}
          \PY{c+c1}{\PYZsh{}tca.mdl \PYZlt{}\PYZhy{} tca(X=train\PYZus{}G, W=train\PYZus{}W,C1=train\PYZus{}c1,C2=train\PYZus{}c2,verbose=FALSE)}
          \PY{c+c1}{\PYZsh{} tca.mdl \PYZlt{}\PYZhy{} tca(X=train\PYZus{}G, W=train\PYZus{}W,verbose=FALSE)}
          mu\PYZus{}hat\PY{o}{=}tca.mdl\PY{p}{[[}\PY{l+s}{\PYZsq{}}\PY{l+s}{mus\PYZus{}hat\PYZsq{}}\PY{p}{]]}
          sigma\PYZus{}hat\PY{o}{=}tca.mdl\PY{p}{[[}\PY{l+s}{\PYZsq{}}\PY{l+s}{sigmas\PYZus{}hat\PYZsq{}}\PY{p}{]]}
          
          \PY{c+c1}{\PYZsh{} tca model summary statistics}
          z\PYZus{}hat\PY{o}{=}mu\PYZus{}hat\PY{c+c1}{\PYZsh{}+sigma\PYZus{}hat}
          
          z\PYZus{} \PY{o}{=} \PY{k+kp}{colSums}\PY{p}{(}train\PYZus{}Z\PY{p}{)}\PY{o}{/}\PY{k+kp}{dim}\PY{p}{(}train\PYZus{}Z\PY{p}{)}\PY{p}{[[}\PY{l+m}{1}\PY{p}{]]}
          z\PYZus{}\PY{o}{=}\PY{k+kp}{t}\PY{p}{(}z\PYZus{}\PY{p}{)}
          cor.test\PY{p}{(}z\PYZus{}\PY{p}{,} z\PYZus{}hat\PY{p}{)}
          cor\PY{p}{(}z\PYZus{}\PY{p}{,} z\PYZus{}hat\PY{p}{)}
\end{Verbatim}


    
    \begin{verbatim}

	Pearson's product-moment correlation

data:  z_ and z_hat
t = 5.7698, df = 38, p-value = 1.178e-06
alternative hypothesis: true correlation is not equal to 0
95 percent confidence interval:
 0.4724062 0.8202547
sample estimates:
      cor 
0.6833539 

    \end{verbatim}

    
    A matrix: 4 × 4 of type dbl
\begin{tabular}{r|llll}
  & Cell\_type1 & Cell\_type2 & Cell\_type3 & Cell\_type4\\
\hline
	Cell\_type1 &  0.9824847 & -0.19472108 & -0.28811985 & -0.622327505\\
	Cell\_type2 & -0.1487512 &  0.98390742 &  0.06534361 & -0.212794786\\
	Cell\_type3 & -0.4283274 &  0.09539096 &  0.92877144 &  0.001409613\\
	Cell\_type4 & -0.3026210 & -0.22275811 &  0.03637195 &  0.270610825\\
\end{tabular}


    
    TCA models \[Z^{i}_{hj}\sim N(\mu_{hj},\sigma_{hj})\] Same value across
all samples. The test is the correlation between predicted
\(Z_{hj} \subseteq R_{MxK}\) and the real value

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}201}]:} \PY{c+c1}{\PYZsh{} correlation of the PCA prediction and the ground truth}
          \PY{c+c1}{\PYZsh{} tca predicted z and the real z}
          \PY{k+kr}{for} \PY{p}{(}gene\PYZus{}exp \PY{k+kr}{in} \PY{k+kt}{c}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}\PY{k+kp}{dim}\PY{p}{(}train\PYZus{}G\PY{p}{)}\PY{p}{[[}\PY{l+m}{1}\PY{p}{]]}\PY{p}{)}\PY{p}{)}\PY{p}{\PYZob{}}
              ge\PYZus{}name \PY{o}{\PYZlt{}\PYZhy{}} \PY{k+kp}{rownames}\PY{p}{(}train\PYZus{}G\PY{p}{)}\PY{p}{[}gene\PYZus{}exp\PY{p}{]}
              tca.mdl.ge \PY{o}{\PYZlt{}\PYZhy{}} tcasub\PY{p}{(}tca.mdl\PY{p}{,}ge\PYZus{}name\PY{p}{,}log\PYZus{}file\PY{o}{=}\PY{k+kc}{NULL}\PY{p}{,}verbose\PY{o}{=}\PY{k+kc}{FALSE}\PY{p}{)}
              Z\PYZus{}hat \PY{o}{\PYZlt{}\PYZhy{}} tensor\PY{p}{(}\PY{k+kp}{t}\PY{p}{(}train\PYZus{}G\PY{p}{[}gene\PYZus{}exp\PY{p}{,}\PY{p}{]}\PY{p}{)}\PY{p}{,}tca.mdl.ge\PY{p}{,}log\PYZus{}file\PY{o}{=}\PY{k+kc}{NULL}\PY{p}{,}verbose\PY{o}{=}\PY{k+kc}{FALSE}\PY{p}{)}
              \PY{k+kp}{print}\PY{p}{(}\PY{k+kp}{sapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}\PY{k+kp}{length}\PY{p}{(}Z\PYZus{}hat\PY{p}{)}\PY{p}{,} \PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} cor\PY{p}{(}\PY{k+kp}{unlist}\PY{p}{(}Z\PYZus{}hat\PY{p}{[}x\PY{p}{]}\PY{p}{)}\PY{p}{,}\PY{k+kp}{unlist}\PY{p}{(}train\PYZus{}data\PY{p}{[[}\PY{l+s}{\PYZsq{}}\PY{l+s}{Z\PYZsq{}}\PY{p}{]]}\PY{p}{[}\PY{p}{,}x\PY{p}{,}gene\PYZus{}exp\PY{p}{]}\PY{p}{)}\PY{p}{)}\PY{p}{)}\PY{p}{)}
          \PY{p}{\PYZcb{}}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
[1] 0.8077872 0.7961064 0.8923311 0.2126965
[1] 0.6891876 0.6733700 0.8853929 0.1400134
[1] 0.55029543 0.49733547 0.74151487 0.01952763
[1] 0.5470466 0.5513850 0.7981101 0.1060033
[1] 0.609346194 0.540931856 0.816991929 0.008268835
[1] 0.7371731 0.6879743 0.8369080 0.0425594
[1] 0.6947268 0.6694169 0.8546228 0.1518756
[1] 0.562270931 0.550720472 0.887063255 0.003382284
[1] 0.78024756 0.79538859 0.85766763 0.07978051
[1] 0.7823855 0.7863335 0.8293514 0.1022495

    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}202}]:} \PY{k+kp}{colSums}\PY{p}{(}tca.mdl\PY{o}{\PYZdl{}}W\PY{p}{)}\PY{o}{/}\PY{k+kp}{dim}\PY{p}{(}tca.mdl\PY{o}{\PYZdl{}}W\PY{p}{)}\PY{p}{[}\PY{l+m}{1}\PY{p}{]}
\end{Verbatim}


    \begin{description*}
\item[Cell\textbackslash{}\_type1] 0.37815933352591
\item[Cell\textbackslash{}\_type2] 0.508879791266052
\item[Cell\textbackslash{}\_type3] 0.099978433988963
\item[Cell\textbackslash{}\_type4] 0.0129824412190746
\end{description*}


    
    The above \(MXK\) table is the correlation between tca predicted
\(z^{i}_{hj}\) and the real value. Each \(ELE_{hj}\) in the table is
correlation between real \(z_{hj} \subseteq R^{N}\) and tca predicted
value \(z_{hj} \subseteq R^{N}\)

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}203}]:} cor.test\PY{p}{(}tca.mdl\PY{o}{\PYZdl{}}sigmas\PYZus{}hat\PY{p}{,}train\PYZus{}data\PY{p}{[[}\PY{l+s}{\PYZsq{}}\PY{l+s}{SIGMA\PYZus{}Z\PYZsq{}}\PY{p}{]]}\PY{p}{)}
\end{Verbatim}


    
    \begin{verbatim}

	Pearson's product-moment correlation

data:  tca.mdl$sigmas_hat and train_data[["SIGMA_Z"]]
t = 0.74354, df = 38, p-value = 0.4617
alternative hypothesis: true correlation is not equal to 0
95 percent confidence interval:
 -0.1991889  0.4157513
sample estimates:
      cor 
0.1197509 

    \end{verbatim}

    
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}204}]:} beta\PYZus{}train \PY{o}{=} \PY{k+kp}{aperm}\PY{p}{(}train\PYZus{}data\PY{p}{[[}\PY{l+s}{\PYZsq{}}\PY{l+s}{beta\PYZsq{}}\PY{p}{]]}\PY{p}{,}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{3}\PY{p}{,}\PY{l+m}{1}\PY{p}{,}\PY{l+m}{2}\PY{p}{)}\PY{p}{)}
          gamma\PYZus{}p \PY{o}{=} \PY{k+kt}{array}\PY{p}{(}tca.mdl\PY{o}{\PYZdl{}}gammas\PYZus{}hat\PY{p}{,} dim \PY{o}{=} \PY{k+kt}{c}\PY{p}{(}M\PY{p}{,} D\PY{p}{,} K\PY{p}{)}\PY{p}{)}
          cor\PYZus{}gamma\PYZus{}beta \PY{o}{=} \PY{k+kt}{matrix}\PY{p}{(}\PY{l+m}{0}\PY{p}{,}M\PY{p}{,}K\PY{p}{)}
          \PY{k+kr}{for} \PY{p}{(}i \PY{k+kr}{in} \PY{l+m}{1}\PY{o}{:}M\PY{p}{)}\PY{p}{\PYZob{}}
              \PY{k+kr}{for} \PY{p}{(}j \PY{k+kr}{in} \PY{l+m}{1}\PY{o}{:}K\PY{p}{)}\PY{p}{\PYZob{}}
                  cor\PYZus{}gamma\PYZus{}beta\PY{p}{[}i\PY{p}{,}j\PY{p}{]} \PY{o}{\PYZlt{}\PYZhy{}} cor\PY{p}{(}beta\PYZus{}train\PY{p}{[}i\PY{p}{,}\PY{p}{,}j\PY{p}{]}\PY{p}{,}gamma\PYZus{}p\PY{p}{[}i\PY{p}{,}\PY{p}{,}j\PY{p}{]}\PY{p}{)}
              \PY{p}{\PYZcb{}}
          \PY{p}{\PYZcb{}}
          cor\PYZus{}gamma\PYZus{}beta
\end{Verbatim}


    A matrix: 10 × 4 of type dbl
\begin{tabular}{llll}
	 0.9827177 & 0.9890665 & 0.9222846 &  0.2481555800\\
	 0.9780070 & 0.9861204 & 0.9191402 &  0.1426478149\\
	 0.9836049 & 0.9916022 & 0.8720735 & -0.0005804779\\
	 0.9689516 & 0.9895263 & 0.8970043 &  0.1001337762\\
	 0.9850551 & 0.9867198 & 0.8930724 & -0.0024709921\\
	 0.9793592 & 0.9864795 & 0.9039294 &  0.0290540722\\
	 0.9839140 & 0.9896388 & 0.9082814 &  0.1459397122\\
	 0.9735277 & 0.9864784 & 0.9235121 & -0.0064327625\\
	 0.9813457 & 0.9890656 & 0.8990125 &  0.0737133954\\
	 0.9837014 & 0.9918791 & 0.8870136 &  0.0967320961\\
\end{tabular}


    
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}205}]:} c\PYZus{}gamma \PY{o}{=} \PY{k+kt}{array}\PY{p}{(}\PY{l+m}{0}\PY{p}{,} \PY{k+kt}{c}\PY{p}{(}\PY{k+kp}{dim}\PY{p}{(}train\PYZus{}X\PY{p}{)}\PY{p}{[}\PY{l+m}{1}\PY{p}{]}\PY{p}{,}K\PY{p}{,}M\PY{p}{)}\PY{p}{)}
          \PY{k+kr}{for} \PY{p}{(}i \PY{k+kr}{in} \PY{l+m}{1}\PY{o}{:}K\PY{p}{)} \PY{p}{\PYZob{}}
             c\PYZus{}gamma\PY{p}{[}\PY{p}{,}i\PY{p}{,}\PY{p}{]} \PY{o}{=} train\PYZus{}X \PY{o}{\PYZpc{}*\PYZpc{}} \PY{k+kp}{t}\PY{p}{(}\PY{k+kp}{gamma}\PY{p}{[}\PY{p}{,}\PY{p}{,}i\PY{p}{]}\PY{p}{)}
          \PY{p}{\PYZcb{}}
          p1 \PY{o}{=} c\PYZus{}gamma\PY{o}{+}train\PYZus{}data\PY{p}{[[}\PY{l+s}{\PYZsq{}}\PY{l+s}{MU\PYZsq{}}\PY{p}{]]}\PY{p}{[}\PY{l+m}{1}\PY{o}{:}\PY{k+kp}{dim}\PY{p}{(}c\PYZus{}gamma\PY{p}{)}\PY{p}{,}\PY{p}{,}\PY{p}{]}
          cor.test\PY{p}{(}p1\PY{p}{,}train\PYZus{}Z\PY{p}{)}
          
          p\PYZus{}mu \PY{o}{=} \PY{k+kp}{aperm}\PY{p}{(}abind\PY{p}{(}\PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}\PY{k+kp}{dim}\PY{p}{(}train\PYZus{}X\PY{p}{)}\PY{p}{[}\PY{l+m}{1}\PY{p}{]}\PY{p}{,} \PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} tca.mdl\PY{o}{\PYZdl{}}mus\PYZus{}hat\PY{p}{)}\PY{p}{,} along \PY{o}{=} \PY{l+m}{3}\PY{p}{)}\PY{p}{,} \PY{k+kt}{c}\PY{p}{(}\PY{l+m}{3}\PY{p}{,}\PY{l+m}{2}\PY{p}{,}\PY{l+m}{1}\PY{p}{)}\PY{p}{)}
          p1 \PY{o}{=} c\PYZus{}gamma\PY{o}{+}p\PYZus{}mu
          cor.test\PY{p}{(}p1\PY{p}{,}train\PYZus{}Z\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
Warning message in 1:dim(c\_gamma):
“numerical expression has 3 elements: only the first used”
    \end{Verbatim}

    
    \begin{verbatim}

	Pearson's product-moment correlation

data:  p1 and train_Z
t = 363.93, df = 140000, p-value < 2.2e-16
alternative hypothesis: true correlation is not equal to 0
95 percent confidence interval:
 0.6945396 0.6999231
sample estimates:
      cor 
0.6972412 

    \end{verbatim}

    
    
    \begin{verbatim}

	Pearson's product-moment correlation

data:  p1 and train_Z
t = 235.37, df = 140000, p-value < 2.2e-16
alternative hypothesis: true correlation is not equal to 0
95 percent confidence interval:
 0.5286983 0.5362046
sample estimates:
      cor 
0.5324619 

    \end{verbatim}

    
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}206}]:} c\PYZus{}gamma\PYZus{}test \PY{o}{=} \PY{k+kt}{array}\PY{p}{(}\PY{l+m}{0}\PY{p}{,} \PY{k+kt}{c}\PY{p}{(}\PY{k+kp}{dim}\PY{p}{(}test\PYZus{}X\PY{p}{)}\PY{p}{[}\PY{l+m}{1}\PY{p}{]}\PY{p}{,}K\PY{p}{,}M\PY{p}{)}\PY{p}{)}
          \PY{k+kr}{for} \PY{p}{(}i \PY{k+kr}{in} \PY{l+m}{1}\PY{o}{:}K\PY{p}{)} \PY{p}{\PYZob{}}
             c\PYZus{}gamma\PYZus{}test\PY{p}{[}\PY{p}{,}i\PY{p}{,}\PY{p}{]} \PY{o}{=} test\PYZus{}X \PY{o}{\PYZpc{}*\PYZpc{}} \PY{k+kp}{t}\PY{p}{(}\PY{k+kp}{gamma}\PY{p}{[}\PY{p}{,}\PY{p}{,}i\PY{p}{]}\PY{p}{)}
          \PY{p}{\PYZcb{}}
          p1 \PY{o}{=} c\PYZus{}gamma\PYZus{}test\PY{o}{+}test\PYZus{}data\PY{p}{[[}\PY{l+s}{\PYZsq{}}\PY{l+s}{MU\PYZsq{}}\PY{p}{]]}\PY{p}{[}\PY{l+m}{1}\PY{o}{:}\PY{k+kp}{dim}\PY{p}{(}c\PYZus{}gamma\PYZus{}test\PY{p}{)}\PY{p}{,}\PY{p}{,}\PY{p}{]}
          cor.test\PY{p}{(}p1\PY{p}{,}test\PYZus{}Z\PY{p}{)}
          
          p\PYZus{}mu \PY{o}{=} \PY{k+kp}{aperm}\PY{p}{(}abind\PY{p}{(}\PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}\PY{k+kp}{dim}\PY{p}{(}test\PYZus{}X\PY{p}{)}\PY{p}{[}\PY{l+m}{1}\PY{p}{]}\PY{p}{,} \PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} tca.mdl\PY{o}{\PYZdl{}}mus\PYZus{}hat\PY{p}{)}\PY{p}{,} along \PY{o}{=} \PY{l+m}{3}\PY{p}{)}\PY{p}{,} \PY{k+kt}{c}\PY{p}{(}\PY{l+m}{3}\PY{p}{,}\PY{l+m}{2}\PY{p}{,}\PY{l+m}{1}\PY{p}{)}\PY{p}{)}
          p1 \PY{o}{=} c\PYZus{}gamma\PYZus{}test\PY{o}{+}p\PYZus{}mu
          cor.test\PY{p}{(}p1\PY{p}{,}test\PYZus{}Z\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
Warning message in 1:dim(c\_gamma\_test):
“numerical expression has 3 elements: only the first used”
    \end{Verbatim}

    
    \begin{verbatim}

	Pearson's product-moment correlation

data:  p1 and test_Z
t = 235.44, df = 59998, p-value < 2.2e-16
alternative hypothesis: true correlation is not equal to 0
95 percent confidence interval:
 0.6888024 0.6971206
sample estimates:
      cor 
0.6929845 

    \end{verbatim}

    
    
    \begin{verbatim}

	Pearson's product-moment correlation

data:  p1 and test_Z
t = 152.86, df = 59998, p-value < 2.2e-16
alternative hypothesis: true correlation is not equal to 0
95 percent confidence interval:
 0.5236305 0.5351485
sample estimates:
      cor 
0.5294139 

    \end{verbatim}

    
    \subsubsection{iii. Lasso \& correlation}\label{iii.-lasso-correlation}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}207}]:} corrs.bulk \PY{o}{\PYZlt{}\PYZhy{}} \PY{k+kt}{numeric}\PY{p}{(}\PY{k+kp}{nrow}\PY{p}{(}train\PYZus{}G\PY{p}{)}\PY{p}{)}
          corrs \PY{o}{\PYZlt{}\PYZhy{}} \PY{k+kt}{matrix}\PY{p}{(}\PY{l+m}{0}\PY{p}{,}\PY{k+kp}{nrow}\PY{p}{(}train\PYZus{}G\PY{p}{)}\PY{p}{,}\PY{k+kp}{ncol}\PY{p}{(}tca.mdl\PY{o}{\PYZdl{}}W\PY{p}{)}\PY{p}{)}
          corrs.real \PY{o}{\PYZlt{}\PYZhy{}} \PY{k+kt}{matrix}\PY{p}{(}\PY{l+m}{0}\PY{p}{,}\PY{k+kp}{nrow}\PY{p}{(}train\PYZus{}G\PY{p}{)}\PY{p}{,}\PY{k+kp}{ncol}\PY{p}{(}tca.mdl\PY{o}{\PYZdl{}}W\PY{p}{)}\PY{p}{)}
          corrs.beta \PY{o}{\PYZlt{}\PYZhy{}} \PY{k+kt}{matrix}\PY{p}{(}\PY{l+m}{0}\PY{p}{,}\PY{k+kp}{nrow}\PY{p}{(}train\PYZus{}G\PY{p}{)}\PY{p}{,}\PY{k+kp}{ncol}\PY{p}{(}tca.mdl\PY{o}{\PYZdl{}}W\PY{p}{)}\PY{p}{)}
          G.scaled \PY{o}{\PYZlt{}\PYZhy{}} \PY{k+kp}{scale}\PY{p}{(}train\PYZus{}X\PY{p}{,}center\PY{o}{=}\PY{k+kc}{TRUE}\PY{p}{,}scale\PY{o}{=}\PY{k+kc}{TRUE}\PY{p}{)}
          
          corrs.test.bulk \PY{o}{\PYZlt{}\PYZhy{}} \PY{k+kt}{numeric}\PY{p}{(}\PY{k+kp}{nrow}\PY{p}{(}test\PYZus{}G\PY{p}{)}\PY{p}{)}
          corrs.test \PY{o}{\PYZlt{}\PYZhy{}} \PY{k+kt}{matrix}\PY{p}{(}\PY{l+m}{0}\PY{p}{,}\PY{k+kp}{nrow}\PY{p}{(}test\PYZus{}G\PY{p}{)}\PY{p}{,}\PY{k+kp}{ncol}\PY{p}{(}tca.mdl\PY{o}{\PYZdl{}}W\PY{p}{)}\PY{p}{)}
          corrs.test.real \PY{o}{\PYZlt{}\PYZhy{}} \PY{k+kt}{matrix}\PY{p}{(}\PY{l+m}{0}\PY{p}{,}\PY{k+kp}{nrow}\PY{p}{(}test\PYZus{}G\PY{p}{)}\PY{p}{,}\PY{k+kp}{ncol}\PY{p}{(}tca.mdl\PY{o}{\PYZdl{}}W\PY{p}{)}\PY{p}{)}
          G.test.scaled \PY{o}{\PYZlt{}\PYZhy{}} \PY{k+kp}{scale}\PY{p}{(}test\PYZus{}X\PY{p}{,}center\PY{o}{=}\PY{k+kc}{TRUE}\PY{p}{,}scale\PY{o}{=}\PY{k+kc}{TRUE}\PY{p}{)}
          
          ge\PYZus{}names \PY{o}{=} \PY{k+kp}{rownames}\PY{p}{(}train\PYZus{}G\PY{p}{)}
          \PY{c+c1}{\PYZsh{} loop through 10 gene expressions}
          \PY{k+kr}{for} \PY{p}{(}i \PY{k+kr}{in} \PY{l+m}{1}\PY{o}{:}\PY{k+kp}{nrow}\PY{p}{(}train\PYZus{}G\PY{p}{)}\PY{p}{)}\PY{p}{\PYZob{}}
          
              \PY{c+c1}{\PYZsh{} run bulk data regression first    }
              glmnet.mdl.X.cv \PY{o}{\PYZlt{}\PYZhy{}} cv.glmnet\PY{p}{(}x\PY{o}{=}G.scaled\PY{p}{,}y\PY{o}{=}train\PYZus{}G\PY{p}{[}i\PY{p}{,}\PY{p}{]}\PY{p}{,}nfolds\PY{o}{=}\PY{l+m}{5}\PY{p}{)}
              glmnet.mdl.X \PY{o}{\PYZlt{}\PYZhy{}} glmnet\PY{p}{(}x\PY{o}{=}G.scaled\PY{p}{,}y\PY{o}{=}train\PYZus{}G\PY{p}{[}i\PY{p}{,}\PY{p}{]}\PY{p}{,}lambda\PY{o}{=}glmnet.mdl.X.cv\PY{o}{\PYZdl{}}lambda.min\PY{p}{)}
              beta.full.X \PY{o}{\PYZlt{}\PYZhy{}} \PY{k+kp}{as.numeric}\PY{p}{(}glmnet.mdl.X\PY{o}{\PYZdl{}}\PY{k+kp}{beta}\PY{p}{)}
              \PY{c+c1}{\PYZsh{} extract non zero predictors and recorrelate}
              predictors.X \PY{o}{\PYZlt{}\PYZhy{}} \PY{k+kp}{colnames}\PY{p}{(}G.scaled\PY{p}{)}\PY{p}{[}\PY{k+kp}{which}\PY{p}{(}beta.full.X\PY{o}{!=}\PY{l+m}{0}\PY{p}{)}\PY{p}{]}
              beta.X \PY{o}{\PYZlt{}\PYZhy{}} \PY{k+kp}{as.matrix}\PY{p}{(}\PY{k+kt}{c}\PY{p}{(}glmnet.mdl.X\PY{o}{\PYZdl{}}a0\PY{p}{,}\PY{k+kp}{as.matrix}\PY{p}{(}glmnet.mdl.X\PY{o}{\PYZdl{}}\PY{k+kp}{beta}\PY{p}{[}predictors.X\PY{p}{,}\PY{p}{]}\PY{p}{)}\PY{p}{)}\PY{p}{)}
              bias\PYZus{}one \PY{o}{\PYZlt{}\PYZhy{}} \PY{k+kt}{numeric}\PY{p}{(}\PY{k+kp}{nrow}\PY{p}{(}G.scaled\PY{p}{)}\PY{p}{)}\PY{l+m}{+1}
              pred \PY{o}{\PYZlt{}\PYZhy{}} \PY{k+kp}{cbind}\PY{p}{(}bias\PYZus{}one\PY{p}{,}G.scaled\PY{p}{[}\PY{p}{,}predictors.X\PY{p}{]}\PY{p}{)} \PY{o}{\PYZpc{}*\PYZpc{}} beta.X
              corrs.bulk\PY{p}{[}i\PY{p}{]} \PY{o}{\PYZlt{}\PYZhy{}} cor.test\PY{p}{(}train\PYZus{}G\PY{p}{[}i\PY{p}{,}\PY{p}{]}\PY{p}{,}pred\PY{p}{)}\PY{p}{[[}\PY{l+s}{\PYZsq{}}\PY{l+s}{estimate\PYZsq{}}\PY{p}{]]}\PY{p}{[[}\PY{l+s}{\PYZsq{}}\PY{l+s}{cor\PYZsq{}}\PY{p}{]]}
              pred.test \PY{o}{\PYZlt{}\PYZhy{}} \PY{k+kp}{cbind}\PY{p}{(}\PY{k+kt}{numeric}\PY{p}{(}\PY{k+kp}{nrow}\PY{p}{(}G.test.scaled\PY{p}{)}\PY{p}{)}\PY{l+m}{+1}\PY{p}{,}G.test.scaled\PY{p}{[}\PY{p}{,}predictors.X\PY{p}{]}\PY{p}{)} \PY{o}{\PYZpc{}*\PYZpc{}} beta.X
              corrs.test.bulk\PY{p}{[}i\PY{p}{]} \PY{o}{\PYZlt{}\PYZhy{}} cor.test\PY{p}{(}test\PYZus{}G\PY{p}{[}i\PY{p}{,}\PY{p}{]}\PY{p}{,}pred.test\PY{p}{)}\PY{p}{[[}\PY{l+s}{\PYZsq{}}\PY{l+s}{estimate\PYZsq{}}\PY{p}{]]}\PY{p}{[[}\PY{l+s}{\PYZsq{}}\PY{l+s}{cor\PYZsq{}}\PY{p}{]]}
              \PY{k+kp}{cat}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{gene expression \PYZsq{}}\PY{p}{,}i\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{ cell type:\PYZsq{}}\PY{p}{)}
          
              ge\PYZus{}name \PY{o}{\PYZlt{}\PYZhy{}} ge\PYZus{}names\PY{p}{[}i\PY{p}{]}
              tca.mdl.ge \PY{o}{\PYZlt{}\PYZhy{}} tcasub\PY{p}{(}tca.mdl\PY{p}{,}ge\PYZus{}name\PY{p}{,}log\PYZus{}file\PY{o}{=}\PY{k+kc}{NULL}\PY{p}{,}verbose\PY{o}{=}\PY{k+kc}{FALSE}\PY{p}{)}
              Z\PYZus{}hat \PY{o}{\PYZlt{}\PYZhy{}} tensor\PY{p}{(}\PY{k+kp}{t}\PY{p}{(}train\PYZus{}G\PY{p}{[}i\PY{p}{,}\PY{p}{]}\PY{p}{)}\PY{p}{,}tca.mdl.ge\PY{p}{,}log\PYZus{}file\PY{o}{=}\PY{k+kc}{NULL}\PY{p}{,}verbose\PY{o}{=}\PY{k+kc}{FALSE}\PY{p}{)}
              \PY{c+c1}{\PYZsh{}Z\PYZus{}hat.test \PYZlt{}\PYZhy{} tensor(t(test\PYZus{}G[i,]),tca.mdl.ge,log\PYZus{}file=NULL,verbose=FALSE)}
              \PY{c+c1}{\PYZsh{} cell type specific}
              \PY{k+kr}{for} \PY{p}{(}h \PY{k+kr}{in} \PY{l+m}{1}\PY{o}{:}\PY{k+kp}{ncol}\PY{p}{(}tca.mdl\PY{o}{\PYZdl{}}W\PY{p}{)}\PY{p}{)}\PY{p}{\PYZob{}}
                  \PY{k+kp}{cat}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{..\PYZsq{}}\PY{p}{,}h\PY{p}{)}
                  celltype \PY{o}{\PYZlt{}\PYZhy{}} \PY{k+kp}{colnames}\PY{p}{(}tca.mdl\PY{o}{\PYZdl{}}W\PY{p}{)}\PY{p}{[}h\PY{p}{]}
                  glmnet.mdl.cv \PY{o}{\PYZlt{}\PYZhy{}} cv.glmnet\PY{p}{(}x\PY{o}{=}G.scaled\PY{p}{,}y\PY{o}{=}Z\PYZus{}hat\PY{p}{[[}h\PY{p}{]]}\PY{p}{,}standardize\PY{o}{=}\PY{k+kc}{FALSE}\PY{p}{,}alpha\PY{o}{=}\PY{l+m}{1}\PY{p}{,}nfolds\PY{o}{=}\PY{l+m}{5}\PY{p}{)}
                  glmnet.mdl \PY{o}{\PYZlt{}\PYZhy{}} glmnet\PY{p}{(}x\PY{o}{=}G.scaled\PY{p}{,}y\PY{o}{=}Z\PYZus{}hat\PY{p}{[[}h\PY{p}{]]}\PY{p}{,}standardize\PY{o}{=}\PY{k+kc}{FALSE}\PY{p}{,}alpha\PY{o}{=}\PY{l+m}{1}\PY{p}{,}lambda\PY{o}{=}glmnet.mdl.cv\PY{o}{\PYZdl{}}lambda.min\PY{p}{)}
                  beta.full \PY{o}{\PYZlt{}\PYZhy{}} \PY{k+kp}{as.numeric}\PY{p}{(}glmnet.mdl\PY{o}{\PYZdl{}}\PY{k+kp}{beta}\PY{p}{)}
                  predictors \PY{o}{\PYZlt{}\PYZhy{}} \PY{k+kp}{colnames}\PY{p}{(}G.scaled\PY{p}{)}\PY{p}{[}\PY{k+kp}{which}\PY{p}{(}beta.full \PY{o}{!=} \PY{l+m}{0}\PY{p}{)}\PY{p}{]}
                  beta \PY{o}{\PYZlt{}\PYZhy{}} \PY{k+kp}{as.matrix}\PY{p}{(}\PY{k+kt}{c}\PY{p}{(}glmnet.mdl\PY{o}{\PYZdl{}}a0\PY{p}{,}\PY{k+kp}{as.matrix}\PY{p}{(}glmnet.mdl\PY{o}{\PYZdl{}}\PY{k+kp}{beta}\PY{p}{[}predictors\PY{p}{,}\PY{p}{]}\PY{p}{)}\PY{p}{)}\PY{p}{)}
                  Z\PYZus{}hat.h.pred \PY{o}{\PYZlt{}\PYZhy{}} \PY{k+kp}{cbind}\PY{p}{(}\PY{k+kt}{numeric}\PY{p}{(}\PY{k+kp}{nrow}\PY{p}{(}G.scaled\PY{p}{)}\PY{p}{)}\PY{l+m}{+1}\PY{p}{,}G.scaled\PY{p}{[}\PY{p}{,}predictors\PY{p}{]}\PY{p}{)} \PY{o}{\PYZpc{}*\PYZpc{}} \PY{k+kp}{beta}
                  corrs\PY{p}{[}i\PY{p}{,}h\PY{p}{]} \PY{o}{\PYZlt{}\PYZhy{}} cor\PY{p}{(}\PY{k+kp}{t}\PY{p}{(}Z\PYZus{}hat\PY{p}{[[}h\PY{p}{]]}\PY{p}{)}\PY{p}{,}Z\PYZus{}hat.h.pred\PY{p}{)}
                  corrs.real\PY{p}{[}i\PY{p}{,}h\PY{p}{]} \PY{o}{\PYZlt{}\PYZhy{}} cor\PY{p}{(}train\PYZus{}Z\PY{p}{[}\PY{p}{,}h\PY{p}{,}i\PY{p}{]}\PY{p}{,}Z\PYZus{}hat.h.pred\PY{p}{)}
                  corrs.beta\PY{p}{[}i\PY{p}{,}h\PY{p}{]} \PY{o}{\PYZlt{}\PYZhy{}} cor\PY{p}{(}train\PYZus{}data\PY{p}{[[}\PY{l+s}{\PYZsq{}}\PY{l+s}{beta\PYZsq{}}\PY{p}{]]}\PY{p}{[}\PY{p}{,}h\PY{p}{,}i\PY{p}{]}\PY{p}{,}beta.full\PY{p}{)}
                  
                  Z\PYZus{}hat.h.test.pred \PY{o}{\PYZlt{}\PYZhy{}} \PY{k+kp}{cbind}\PY{p}{(}\PY{k+kt}{numeric}\PY{p}{(}\PY{k+kp}{nrow}\PY{p}{(}G.test.scaled\PY{p}{)}\PY{p}{)}\PY{l+m}{+1}\PY{p}{,}G.test.scaled\PY{p}{[}\PY{p}{,}predictors\PY{p}{]}\PY{p}{)} \PY{o}{\PYZpc{}*\PYZpc{}} \PY{k+kp}{beta}
                  \PY{c+c1}{\PYZsh{}corrs.test[i,h] \PYZlt{}\PYZhy{} cor(Z\PYZus{}hat.test[,h,i],Z\PYZus{}hat.h.test.pred)}
                  corrs.test.real\PY{p}{[}i\PY{p}{,}h\PY{p}{]} \PY{o}{\PYZlt{}\PYZhy{}} cor\PY{p}{(}test\PYZus{}Z\PY{p}{[}\PY{p}{,}h\PY{p}{,}i\PY{p}{]}\PY{p}{,}Z\PYZus{}hat.h.test.pred\PY{p}{)}
              \PY{p}{\PYZcb{}}
              \PY{k+kp}{print}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZsq{}}\PY{p}{)}
          \PY{p}{\PYZcb{}}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
gene expression  1  cell type:.. 1.. 2.. 3.. 4[1] ""
gene expression  2  cell type:.. 1.. 2.. 3.. 4[1] ""
gene expression  3  cell type:.. 1.. 2.. 3.. 4[1] ""
gene expression  4  cell type:.. 1.. 2.. 3.. 4[1] ""
gene expression  5  cell type:.. 1.. 2.. 3.. 4[1] ""
gene expression  6  cell type:.. 1.. 2.. 3.. 4[1] ""
gene expression  7  cell type:.. 1.. 2.. 3.. 4[1] ""
gene expression  8  cell type:.. 1.. 2.. 3.. 4[1] ""
gene expression  9  cell type:.. 1.. 2.. 3.. 4[1] ""
gene expression  10  cell type:.. 1.. 2.. 3.. 4[1] ""

    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}208}]:} corrs.bulk
          corrs.test.bulk
\end{Verbatim}


    \begin{enumerate*}
\item 0.405947094775413
\item 0.365965262609215
\item 0.383587385215091
\item 0.486196061430833
\item 0.542939427598351
\item 0.466890247526731
\item 0.394616509833186
\item 0.415451267714935
\item 0.573187421484972
\item 0.532960024300532
\end{enumerate*}


    
    \begin{enumerate*}
\item 0.319528811686246
\item 0.259288696848173
\item 0.262312870035525
\item 0.375717933922902
\item 0.443409526755626
\item 0.386206252506782
\item 0.251202728839345
\item 0.369101288531092
\item 0.471834373468261
\item 0.438575756529746
\end{enumerate*}


    
    For each Gene Expression, fit a lasso model from SNPs to bulk level
mixed GE. Final predictions are made with the none-zero lasso
predictors. The above vector is correlation between lasso's predicion
and real value. The uppe rine being train statistics, lowerline test
statistics

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}209}]:} corrs.real
          \PY{c+c1}{\PYZsh{}corrs.test.real}
\end{Verbatim}


    A matrix: 10 × 4 of type dbl
\begin{tabular}{llll}
	 0.9453641 & 0.9612620 & 0.9070996 & 0.211916736\\
	 0.9179348 & 0.9415840 & 0.9013875 & 0.140598356\\
	 0.9193619 & 0.9008419 & 0.8403678 & 0.019771155\\
	 0.9026811 & 0.9157163 & 0.8767548 & 0.107094699\\
	 0.9245241 & 0.9118108 & 0.8712207 & 0.007210433\\
	 0.9368232 & 0.9428232 & 0.8671899 & 0.044628295\\
	 0.9318626 & 0.9463059 & 0.8840634 & 0.151823202\\
	 0.8982425 & 0.9151180 & 0.9099859 & 0.004055627\\
	 0.9422043 & 0.9627611 & 0.8768885 & 0.078692776\\
	 0.9397827 & 0.9632895 & 0.8577969 & 0.100069338\\
\end{tabular}


    
    The above \(MXK\) table is the correlation between lasso predicted
\(z^{i}_{hj}\) and the real value. Prediction is made with none-zero
effect size estimators. Each \(ELE_{hj}\) in the table is correlation
between real \(z_{hj} \subseteq R^{N}\) and lasso predicted value
\(z_{hj} \subseteq R^{N}\). NA occurs when lasso prediction has
almost-zero variance The uppe rine being train statistics, lowerline
test statistics

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}210}]:} corrs.beta
\end{Verbatim}


    A matrix: 10 × 4 of type dbl
\begin{tabular}{llll}
	 0.9746481 & 0.9806891 & 0.9211536 &  0.247710540\\
	 0.9559923 & 0.9700569 & 0.9197128 &  0.143900746\\
	 0.9340943 & 0.9137575 & 0.8655679 & -0.001816845\\
	 0.9290723 & 0.9341807 & 0.8940879 &  0.100036535\\
	 0.9524584 & 0.9375970 & 0.8913610 & -0.004330933\\
	 0.9655738 & 0.9677115 & 0.9036112 &  0.031672880\\
	 0.9598441 & 0.9648873 & 0.9056257 &  0.144359043\\
	 0.9352416 & 0.9444519 & 0.9225054 & -0.006015329\\
	 0.9709010 & 0.9795497 & 0.8962832 &  0.072365966\\
	 0.9717284 & 0.9822356 & 0.8835417 &  0.092661759\\
\end{tabular}


    
    The above \(MXK\) table is the correlation between lasso effect-size
\(\beta\) and the real \(\beta\). Each \(ELE_{hj}\) in the table is
correlation between real \(\beta_{hj}\) and lasso predicted value. NA
occurs when lasso prediction has almost-zero variance

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}629}]:} par\PY{p}{(}mfrow\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{2}\PY{p}{,}\PY{l+m}{2}\PY{p}{)}\PY{p}{,}mar\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{4}\PY{p}{,} \PY{l+m}{3.8}\PY{p}{,} \PY{l+m}{4}\PY{p}{,} \PY{l+m}{2}\PY{p}{)} \PY{o}{+} \PY{l+m}{0.1}\PY{p}{)}
          opts\PY{o}{=}params\PY{o}{\PYZdl{}}cell\PYZus{}name
          \PY{k+kr}{for}\PY{p}{(}i \PY{k+kr}{in} \PY{l+m}{1}\PY{o}{:}\PY{k+kp}{length}\PY{p}{(}params\PY{o}{\PYZdl{}}cell\PYZus{}name\PY{p}{)}\PY{p}{)}\PY{p}{\PYZob{}}
              heading \PY{o}{=} \PY{k+kp}{paste}\PY{p}{(}opts\PY{p}{[}i\PY{p}{]}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{mean weight\PYZsq{}}\PY{p}{,}mean\PYZus{}weight\PY{p}{[}i\PY{p}{]}\PY{p}{,}sep\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{ \PYZsq{}}\PY{p}{)}
              plot\PY{p}{(}params\PY{o}{\PYZdl{}}her\PY{p}{[}i\PY{p}{,}\PY{p}{]}\PY{p}{,}Z\PYZus{}hat\PYZus{}cor\PYZus{}tca1\PY{p}{[}\PY{p}{,}i\PY{p}{]}\PY{p}{,}xlab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{heritibility of gene\PYZsq{}}\PY{p}{,}
                   ylab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{cor\PYZsq{}}\PY{p}{,}cex.lab\PY{o}{=}\PY{l+m}{1.2}\PY{p}{,}ylim\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{1}\PY{p}{)}\PY{p}{,}yaxs\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{r\PYZsq{}}\PY{p}{,}type\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{o\PYZsq{}}\PY{p}{,}col\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{red\PYZsq{}}\PY{p}{)}
              title\PY{p}{(}main\PY{o}{=}heading\PY{p}{,}font.main\PY{o}{=}\PY{l+m}{2}\PY{p}{,}cex.main\PY{o}{=}\PY{l+m}{1}\PY{p}{,}line\PY{o}{=}\PY{l+m}{1}\PY{p}{,}cex.lab\PY{o}{=}\PY{l+m}{1}\PY{p}{)}
              lines\PY{p}{(}params\PY{o}{\PYZdl{}}her\PY{p}{[}i\PY{p}{,}\PY{p}{]}\PY{p}{,}Z\PYZus{}hat\PYZus{}cor\PYZus{}tca2\PY{p}{[}\PY{p}{,}i\PY{p}{]}\PY{p}{,}col\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{green\PYZsq{}}\PY{p}{,}type\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{o\PYZsq{}}\PY{p}{)}
              
          \PY{p}{\PYZcb{}}
          mtext\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{TCA\PYZsq{}s Z\PYZus{}hat \PYZlt{}Cor\PYZgt{} Ground truth train Z\PYZdq{}}\PY{p}{,}side\PY{o}{=}\PY{l+m}{3}\PY{p}{,}adj\PY{o}{=}\PY{l+m}{6}\PY{p}{,}cex\PY{o}{=}\PY{l+m}{0.9}\PY{p}{,}line\PY{o}{=}\PY{l+m}{24}\PY{p}{,}font\PY{o}{=}\PY{l+m}{2}\PY{p}{)}
          par\PY{p}{(}mfrow\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{2}\PY{p}{,}\PY{l+m}{1}\PY{p}{)}\PY{p}{,}mar\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{0}\PY{p}{)}\PY{p}{)}
          plot\PY{p}{(}\PY{l+m}{1}\PY{p}{,}type\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{n\PYZsq{}}\PY{p}{,}axes\PY{o}{=}\PY{k+kc}{FALSE}\PY{p}{,}xlab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZsq{}}\PY{p}{,}ylab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZsq{}}\PY{p}{)}
          legend\PY{p}{(}x\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{top\PYZsq{}}\PY{p}{,}inset\PY{o}{=}\PY{l+m}{0}\PY{p}{,}legend\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{mdl1:SNPs+C1\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{mdl2:C1\PYZsq{}}\PY{p}{)}\PY{p}{,}
                 col\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{red\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{green\PYZsq{}}\PY{p}{)}\PY{p}{,}lwd\PY{o}{=}\PY{l+m}{2}\PY{p}{,}cex\PY{o}{=}\PY{l+m}{0.7}\PY{p}{,}horiz\PY{o}{=}\PY{k+kc}{TRUE}\PY{p}{)}
          
          Z\PYZus{}hat\PYZus{}tca \PY{o}{=} tensor\PY{p}{(}train\PYZus{}G\PY{p}{,}tca.mdl1\PY{p}{,}log\PYZus{}file\PY{o}{=}\PY{k+kc}{NULL}\PY{p}{,}verbose\PY{o}{=}\PY{k+kc}{FALSE}\PY{p}{,}debug\PY{o}{=}\PY{k+kc}{FALSE}\PY{p}{)}
          Z\PYZus{}hat\PYZus{}cor\PYZus{}tca \PY{o}{=} \PY{k+kp}{sapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}\PY{k+kp}{length}\PY{p}{(}Z\PYZus{}hat\PY{p}{)}\PY{p}{,} \PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} cor\PY{p}{(}\PY{k+kp}{unlist}\PY{p}{(}Z\PYZus{}hat\PY{p}{[}x\PY{p}{]}\PY{p}{)}\PY{p}{,}train\PYZus{}Z\PY{p}{[}\PY{p}{,}x\PY{p}{]}\PY{p}{)}\PY{p}{)}
          beta\PYZus{}hat\PYZus{}cor\PYZus{}tca \PY{o}{=} \PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}cell\PYZus{}type\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} 
              cor\PY{p}{(}\PY{k+kp}{beta}\PY{p}{[}x\PY{p}{,}\PY{p}{]}\PY{p}{,}tca.mdl1\PY{o}{\PYZdl{}}gammas\PYZus{}hat\PY{p}{[}\PY{p}{,}\PY{k+kp}{grepl}\PY{p}{(}\PY{k+kp}{paste}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{Cell\PYZus{}type\PYZdq{}}\PY{p}{,}x\PY{p}{,}\PY{l+s}{\PYZdq{}}\PY{l+s}{.G\PYZdq{}}\PY{p}{,}sep\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZsq{}}\PY{p}{)}\PY{p}{,}\PY{k+kp}{colnames}\PY{p}{(}tca.mdl1\PY{o}{\PYZdl{}}gammas\PYZus{}hat\PY{p}{)}\PY{p}{)}\PY{p}{]}\PY{p}{)}\PY{p}{)}
          gamma\PYZus{}hat\PYZus{}cor\PYZus{}tca \PY{o}{=} cor\PY{p}{(}\PY{k+kt}{array}\PY{p}{(}gamma\PYZus{}c1\PY{p}{)}\PY{p}{,}
                                  tca.mdl1\PY{o}{\PYZdl{}}gammas\PYZus{}hat\PY{p}{[}\PY{p}{,}\PY{k+kp}{grepl}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{male|smok|age\PYZsq{}}\PY{p}{,} \PY{k+kp}{colnames}\PY{p}{(}tca.mdl1\PY{o}{\PYZdl{}}gammas\PYZus{}hat\PY{p}{)}\PY{p}{)}\PY{p}{]}\PY{p}{)}
          \PY{c+c1}{\PYZsh{} second equation for tca prediction model 1}
          pred \PY{o}{=} \PY{k+kp}{cbind}\PY{p}{(}train\PYZus{}X\PY{p}{,}train\PYZus{}c1\PY{p}{)}
          Z\PYZus{}hat\PYZus{}train\PYZus{}second\PYZus{}eq\PYZus{}tca \PY{o}{=} \PY{k+kp}{sapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}cell\PYZus{}type\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} pred \PY{o}{\PYZpc{}*\PYZpc{}} tca.mdl1\PY{o}{\PYZdl{}}gammas\PYZus{}hat\PY{p}{[}\PY{p}{,}\PY{p}{(}\PY{p}{(}x\PY{l+m}{\PYZhy{}1}\PY{p}{)}\PY{o}{*}\PY{k+kp}{dim}\PY{p}{(}pred\PY{p}{)}\PY{p}{[}\PY{l+m}{2}\PY{p}{]}\PY{l+m}{+1}\PY{p}{)}\PY{o}{:}\PY{p}{(}x\PY{o}{*}\PY{k+kp}{dim}\PY{p}{(}pred\PY{p}{)}\PY{p}{[}\PY{l+m}{2}\PY{p}{]}\PY{p}{)}\PY{p}{]}\PY{p}{)}
          z\PYZus{}hat\PYZus{}train\PYZus{}second\PYZus{}eq\PYZus{}cor\PYZus{}tca \PY{o}{=} \PY{k+kp}{diag}\PY{p}{(}cor\PY{p}{(}train\PYZus{}Z\PY{p}{,}Z\PYZus{}hat\PYZus{}second\PYZus{}eq\PYZus{}tca\PY{p}{)}\PY{p}{)}
          \PY{c+c1}{\PYZsh{} second equation for tca prediction model 2}
          \PY{c+c1}{\PYZsh{} pred = train\PYZus{}c1}
          \PY{c+c1}{\PYZsh{} Z\PYZus{}hat\PYZus{}second\PYZus{}eq\PYZus{}tca = sapply(1:cell\PYZus{}type,function(x) pred \PYZpc{}*\PYZpc{} tca.mdl2\PYZdl{}gammas\PYZus{}hat[,((x\PYZhy{}1)*dim(pred)[2]+1):(x*dim(pred)[2])])}
          \PY{c+c1}{\PYZsh{} z\PYZus{}hat\PYZus{}second\PYZus{}eq\PYZus{}cor\PYZus{}tca = diag(cor(train\PYZus{}Z,Z\PYZus{}hat\PYZus{}second\PYZus{}eq\PYZus{}tca))}
          
          \PY{c+c1}{\PYZsh{} second equation for tca prediction model 1 TEST}
          pred \PY{o}{=} \PY{k+kp}{cbind}\PY{p}{(}test\PYZus{}X\PY{p}{,}test\PYZus{}c1\PY{p}{)}
          Z\PYZus{}hat\PYZus{}test\PYZus{}second\PYZus{}eq\PYZus{}tca \PY{o}{=} \PY{k+kp}{sapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}cell\PYZus{}type\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} pred \PY{o}{\PYZpc{}*\PYZpc{}} tca.mdl1\PY{o}{\PYZdl{}}gammas\PYZus{}hat\PY{p}{[}\PY{p}{,}\PY{p}{(}\PY{p}{(}x\PY{l+m}{\PYZhy{}1}\PY{p}{)}\PY{o}{*}\PY{k+kp}{dim}\PY{p}{(}pred\PY{p}{)}\PY{p}{[}\PY{l+m}{2}\PY{p}{]}\PY{l+m}{+1}\PY{p}{)}\PY{o}{:}\PY{p}{(}x\PY{o}{*}\PY{k+kp}{dim}\PY{p}{(}pred\PY{p}{)}\PY{p}{[}\PY{l+m}{2}\PY{p}{]}\PY{p}{)}\PY{p}{]}\PY{p}{)}
          z\PYZus{}hat\PYZus{}test\PYZus{}second\PYZus{}eq\PYZus{}cor\PYZus{}tca \PY{o}{=} \PY{k+kp}{diag}\PY{p}{(}cor\PY{p}{(}test\PYZus{}Z\PY{p}{,}Z\PYZus{}hat\PYZus{}second\PYZus{}eq\PYZus{}tca\PY{p}{)}\PY{p}{)}
                                            
          \PY{c+c1}{\PYZsh{} second equation for tca prediction model ２ TEST}
          \PY{c+c1}{\PYZsh{} pred = test\PYZus{}c1}
          \PY{c+c1}{\PYZsh{} Z\PYZus{}hat\PYZus{}test\PYZus{}second\PYZus{}eq\PYZus{}tca = sapply(1:cell\PYZus{}type,function(x) pred \PYZpc{}*\PYZpc{} tca.mdl２\PYZdl{}gammas\PYZus{}hat[,((x\PYZhy{}1)*dim(pred)[2]+1):(x*dim(pred)[2])])}
          \PY{c+c1}{\PYZsh{} z\PYZus{}hat\PYZus{}test\PYZus{}second\PYZus{}eq\PYZus{}cor\PYZus{}tca = diag(cor(test\PYZus{}Z,Z\PYZus{}hat\PYZus{}second\PYZus{}eq\PYZus{}tca))}
          
          \PY{c+c1}{\PYZsh{} Lasso}
          \PY{c+c1}{\PYZsh{} run bulk data regression first}
          pred \PY{o}{=} \PY{k+kp}{cbind}\PY{p}{(}train\PYZus{}X\PY{p}{,}train\PYZus{}c1\PY{p}{)}
          glmnet.mdl.X.cv \PY{o}{\PYZlt{}\PYZhy{}} cv.glmnet\PY{p}{(}x\PY{o}{=}pred\PY{p}{,}y\PY{o}{=}\PY{k+kp}{t}\PY{p}{(}train\PYZus{}G\PY{p}{)}\PY{p}{,}nfolds\PY{o}{=}\PY{l+m}{5}\PY{p}{)}
          glmnet.mdl.X \PY{o}{\PYZlt{}\PYZhy{}} glmnet\PY{p}{(}x\PY{o}{=}pred\PY{p}{,}y\PY{o}{=}\PY{k+kp}{t}\PY{p}{(}train\PYZus{}G\PY{p}{)}\PY{p}{,}lambda\PY{o}{=}glmnet.mdl.X.cv\PY{o}{\PYZdl{}}lambda.min\PY{p}{)}
          beta.full.X \PY{o}{\PYZlt{}\PYZhy{}} \PY{k+kp}{as.numeric}\PY{p}{(}glmnet.mdl.X\PY{o}{\PYZdl{}}\PY{k+kp}{beta}\PY{p}{)}
          \PY{c+c1}{\PYZsh{} extract non zero predictors and recorrelate}
          predictors.X \PY{o}{\PYZlt{}\PYZhy{}} \PY{k+kp}{colnames}\PY{p}{(}pred\PY{p}{)}\PY{p}{[}\PY{k+kp}{which}\PY{p}{(}beta.full.X\PY{o}{!=}\PY{l+m}{0}\PY{p}{)}\PY{p}{]}
          beta.X \PY{o}{\PYZlt{}\PYZhy{}} \PY{k+kp}{as.matrix}\PY{p}{(}\PY{k+kt}{c}\PY{p}{(}glmnet.mdl.X\PY{o}{\PYZdl{}}a0\PY{p}{,}\PY{k+kp}{as.matrix}\PY{p}{(}glmnet.mdl.X\PY{o}{\PYZdl{}}\PY{k+kp}{beta}\PY{p}{[}predictors.X\PY{p}{,}\PY{p}{]}\PY{p}{)}\PY{p}{)}\PY{p}{)}
          bias\PYZus{}one \PY{o}{\PYZlt{}\PYZhy{}} \PY{k+kt}{numeric}\PY{p}{(}\PY{k+kp}{nrow}\PY{p}{(}pred\PY{p}{)}\PY{p}{)}\PY{l+m}{+1}
          G\PYZus{}hat\PYZus{}train\PYZus{}lasso \PY{o}{\PYZlt{}\PYZhy{}} \PY{k+kp}{cbind}\PY{p}{(}bias\PYZus{}one\PY{p}{,}pred\PY{p}{[}\PY{p}{,}predictors.X\PY{p}{]}\PY{p}{)} \PY{o}{\PYZpc{}*\PYZpc{}} beta.X
          G\PYZus{}hat\PYZus{}train\PYZus{}cor\PYZus{}bulk \PY{o}{\PYZlt{}\PYZhy{}} cor\PY{p}{(}\PY{k+kp}{t}\PY{p}{(}train\PYZus{}G\PY{p}{)}\PY{p}{,}G\PYZus{}hat\PYZus{}train\PYZus{}lasso\PY{p}{)}
          pred \PY{o}{=} \PY{k+kp}{cbind}\PY{p}{(}test\PYZus{}X\PY{p}{,}test\PYZus{}c1\PY{p}{)}
          G\PYZus{}hat\PYZus{}test\PYZus{}lasso \PY{o}{\PYZlt{}\PYZhy{}} \PY{k+kp}{cbind}\PY{p}{(}\PY{k+kt}{numeric}\PY{p}{(}\PY{k+kp}{nrow}\PY{p}{(}pred\PY{p}{)}\PY{p}{)}\PY{l+m}{+1}\PY{p}{,}pred\PY{p}{[}\PY{p}{,}predictors.X\PY{p}{]}\PY{p}{)} \PY{o}{\PYZpc{}*\PYZpc{}} beta.X
          G\PYZus{}hat\PYZus{}test\PYZus{}cor\PYZus{}bulk \PY{o}{\PYZlt{}\PYZhy{}} cor\PY{p}{(}\PY{k+kp}{t}\PY{p}{(}test\PYZus{}G\PY{p}{)}\PY{p}{,}G\PYZus{}hat\PYZus{}test\PYZus{}lasso\PY{p}{)}
          
          \PY{c+c1}{\PYZsh{}Z\PYZus{}hat.test \PYZlt{}\PYZhy{} tensor(t(test\PYZus{}G[i,]),tca.mdl.ge,log\PYZus{}file=NULL,verbose=FALSE)}
          \PY{c+c1}{\PYZsh{} cell type specific}
          \PY{k+kr}{for} \PY{p}{(}h \PY{k+kr}{in} \PY{l+m}{1}\PY{o}{:}\PY{k+kp}{ncol}\PY{p}{(}tca.mdl1\PY{o}{\PYZdl{}}W\PY{p}{)}\PY{p}{)}\PY{p}{\PYZob{}}
              pred \PY{o}{=} \PY{k+kp}{cbind}\PY{p}{(}train\PYZus{}X\PY{p}{,}train\PYZus{}c1\PY{p}{)}
              beta\PYZus{}cell\PYZus{}real \PY{o}{=} \PY{k+kt}{c}\PY{p}{(}\PY{k+kp}{beta}\PY{p}{[}h\PY{p}{,}\PY{p}{]}\PY{p}{,}gamma\PYZus{}c1\PY{p}{[}h\PY{p}{,}\PY{p}{]}\PY{p}{)}
              
              celltype \PY{o}{\PYZlt{}\PYZhy{}} \PY{k+kp}{colnames}\PY{p}{(}tca.mdl\PY{o}{\PYZdl{}}W\PY{p}{)}\PY{p}{[}h\PY{p}{]}
              glmnet.mdl.cv \PY{o}{\PYZlt{}\PYZhy{}} cv.glmnet\PY{p}{(}x\PY{o}{=}pred\PY{p}{,}y\PY{o}{=}Z\PYZus{}hat\PYZus{}tca\PY{p}{[[}h\PY{p}{]]}\PY{p}{,}standardize\PY{o}{=}\PY{k+kc}{FALSE}\PY{p}{,}alpha\PY{o}{=}\PY{l+m}{1}\PY{p}{,}nfolds\PY{o}{=}\PY{l+m}{5}\PY{p}{)}
              glmnet.mdl \PY{o}{\PYZlt{}\PYZhy{}} glmnet\PY{p}{(}x\PY{o}{=}pred\PY{p}{,}y\PY{o}{=}Z\PYZus{}hat\PYZus{}tca\PY{p}{[[}h\PY{p}{]]}\PY{p}{,}standardize\PY{o}{=}\PY{k+kc}{FALSE}\PY{p}{,}alpha\PY{o}{=}\PY{l+m}{1}\PY{p}{,}lambda\PY{o}{=}glmnet.mdl.cv\PY{o}{\PYZdl{}}lambda.min\PY{p}{)}
              beta.full \PY{o}{\PYZlt{}\PYZhy{}} \PY{k+kp}{as.numeric}\PY{p}{(}glmnet.mdl\PY{o}{\PYZdl{}}\PY{k+kp}{beta}\PY{p}{)}
              predictors \PY{o}{\PYZlt{}\PYZhy{}} \PY{k+kp}{colnames}\PY{p}{(}pred\PY{p}{)}\PY{p}{[}\PY{k+kp}{which}\PY{p}{(}beta.full \PY{o}{!=} \PY{l+m}{0}\PY{p}{)}\PY{p}{]}
              beta\PYZus{}lasso \PY{o}{\PYZlt{}\PYZhy{}} \PY{k+kp}{as.matrix}\PY{p}{(}\PY{k+kt}{c}\PY{p}{(}glmnet.mdl\PY{o}{\PYZdl{}}a0\PY{p}{,}\PY{k+kp}{as.matrix}\PY{p}{(}glmnet.mdl\PY{o}{\PYZdl{}}\PY{k+kp}{beta}\PY{p}{[}predictors\PY{p}{,}\PY{p}{]}\PY{p}{)}\PY{p}{)}\PY{p}{)}
              Z\PYZus{}hat\PYZus{}train\PYZus{}lasso \PY{o}{\PYZlt{}\PYZhy{}} \PY{k+kp}{cbind}\PY{p}{(}\PY{k+kt}{numeric}\PY{p}{(}\PY{k+kp}{nrow}\PY{p}{(}pred\PY{p}{)}\PY{p}{)}\PY{l+m}{+1}\PY{p}{,}pred\PY{p}{[}\PY{p}{,}predictors\PY{p}{]}\PY{p}{)} \PY{o}{\PYZpc{}*\PYZpc{}} beta\PYZus{}lasso
              corrs \PY{o}{\PYZlt{}\PYZhy{}} cor\PY{p}{(}\PY{k+kp}{t}\PY{p}{(}Z\PYZus{}hat\PYZus{}tca\PY{p}{[[}h\PY{p}{]]}\PY{p}{)}\PY{p}{,}Z\PYZus{}hat\PYZus{}train\PYZus{}lasso\PY{p}{)}
              corrs.real \PY{o}{\PYZlt{}\PYZhy{}} cor\PY{p}{(}train\PYZus{}Z\PY{p}{,}Z\PYZus{}hat\PYZus{}train\PYZus{}lasso\PY{p}{)}
              corrs.beta \PY{o}{\PYZlt{}\PYZhy{}} cor\PY{p}{(}beta\PYZus{}cell\PYZus{}real\PY{p}{,}beta.full\PY{p}{)}
              
              pred \PY{o}{=} \PY{k+kp}{cbind}\PY{p}{(}test\PYZus{}X\PY{p}{,}test\PYZus{}c1\PY{p}{)}
              Z\PYZus{}hat\PYZus{}test\PYZus{}lasso \PY{o}{\PYZlt{}\PYZhy{}} \PY{k+kp}{cbind}\PY{p}{(}\PY{k+kt}{numeric}\PY{p}{(}\PY{k+kp}{nrow}\PY{p}{(}pred\PY{p}{)}\PY{p}{)}\PY{l+m}{+1}\PY{p}{,}pred\PY{p}{[}\PY{p}{,}predictors\PY{p}{]}\PY{p}{)} \PY{o}{\PYZpc{}*\PYZpc{}} beta\PYZus{}lasso
              \PY{c+c1}{\PYZsh{}corrs.test[i,h] \PYZlt{}\PYZhy{} cor(Z\PYZus{}hat.test[,h,i],Z\PYZus{}hat.h.test.pred)}
              corrs.test.real \PY{o}{\PYZlt{}\PYZhy{}} cor\PY{p}{(}test\PYZus{}Z\PY{p}{,}Z\PYZus{}hat\PYZus{}test\PYZus{}lasso\PY{p}{)}
          \PY{p}{\PYZcb{}}
\end{Verbatim}



    % Add a bibliography block to the postdoc
    
    
    
    \end{document}
