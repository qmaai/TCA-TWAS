
% Default to the notebook output style

    


% Inherit from the specified cell style.




    
\documentclass[11pt]{article}

    
    
    \usepackage[T1]{fontenc}
    % Nicer default font (+ math font) than Computer Modern for most use cases
    \usepackage{mathpazo}

    % Basic figure setup, for now with no caption control since it's done
    % automatically by Pandoc (which extracts ![](path) syntax from Markdown).
    \usepackage{graphicx}
    % We will generate all images so they have a width \maxwidth. This means
    % that they will get their normal width if they fit onto the page, but
    % are scaled down if they would overflow the margins.
    \makeatletter
    \def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth
    \else\Gin@nat@width\fi}
    \makeatother
    \let\Oldincludegraphics\includegraphics
    % Set max figure width to be 80% of text width, for now hardcoded.
    \renewcommand{\includegraphics}[1]{\Oldincludegraphics[width=.8\maxwidth]{#1}}
    % Ensure that by default, figures have no caption (until we provide a
    % proper Figure object with a Caption API and a way to capture that
    % in the conversion process - todo).
    \usepackage{caption}
    \DeclareCaptionLabelFormat{nolabel}{}
    \captionsetup{labelformat=nolabel}

    \usepackage{adjustbox} % Used to constrain images to a maximum size 
    \usepackage{xcolor} % Allow colors to be defined
    \usepackage{enumerate} % Needed for markdown enumerations to work
    \usepackage{geometry} % Used to adjust the document margins
    \usepackage{amsmath} % Equations
    \usepackage{amssymb} % Equations
    \usepackage{textcomp} % defines textquotesingle
    % Hack from http://tex.stackexchange.com/a/47451/13684:
    \AtBeginDocument{%
        \def\PYZsq{\textquotesingle}% Upright quotes in Pygmentized code
    }
    \usepackage{upquote} % Upright quotes for verbatim code
    \usepackage{eurosym} % defines \euro
    \usepackage[mathletters]{ucs} % Extended unicode (utf-8) support
    \usepackage[utf8x]{inputenc} % Allow utf-8 characters in the tex document
    \usepackage{fancyvrb} % verbatim replacement that allows latex
    \usepackage{grffile} % extends the file name processing of package graphics 
                         % to support a larger range 
    % The hyperref package gives us a pdf with properly built
    % internal navigation ('pdf bookmarks' for the table of contents,
    % internal cross-reference links, web links for URLs, etc.)
    \usepackage{hyperref}
    \usepackage{longtable} % longtable support required by pandoc >1.10
    \usepackage{booktabs}  % table support for pandoc > 1.12.2
    \usepackage[inline]{enumitem} % IRkernel/repr support (it uses the enumerate* environment)
    \usepackage[normalem]{ulem} % ulem is needed to support strikethroughs (\sout)
                                % normalem makes italics be italics, not underlines
    

    
    
    % Colors for the hyperref package
    \definecolor{urlcolor}{rgb}{0,.145,.698}
    \definecolor{linkcolor}{rgb}{.71,0.21,0.01}
    \definecolor{citecolor}{rgb}{.12,.54,.11}

    % ANSI colors
    \definecolor{ansi-black}{HTML}{3E424D}
    \definecolor{ansi-black-intense}{HTML}{282C36}
    \definecolor{ansi-red}{HTML}{E75C58}
    \definecolor{ansi-red-intense}{HTML}{B22B31}
    \definecolor{ansi-green}{HTML}{00A250}
    \definecolor{ansi-green-intense}{HTML}{007427}
    \definecolor{ansi-yellow}{HTML}{DDB62B}
    \definecolor{ansi-yellow-intense}{HTML}{B27D12}
    \definecolor{ansi-blue}{HTML}{208FFB}
    \definecolor{ansi-blue-intense}{HTML}{0065CA}
    \definecolor{ansi-magenta}{HTML}{D160C4}
    \definecolor{ansi-magenta-intense}{HTML}{A03196}
    \definecolor{ansi-cyan}{HTML}{60C6C8}
    \definecolor{ansi-cyan-intense}{HTML}{258F8F}
    \definecolor{ansi-white}{HTML}{C5C1B4}
    \definecolor{ansi-white-intense}{HTML}{A1A6B2}

    % commands and environments needed by pandoc snippets
    % extracted from the output of `pandoc -s`
    \providecommand{\tightlist}{%
      \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
    \DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
    % Add ',fontsize=\small' for more characters per line
    \newenvironment{Shaded}{}{}
    \newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{\textbf{{#1}}}}
    \newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.56,0.13,0.00}{{#1}}}
    \newcommand{\DecValTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\FloatTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\CharTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\StringTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\CommentTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textit{{#1}}}}
    \newcommand{\OtherTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{{#1}}}
    \newcommand{\AlertTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{{#1}}}}
    \newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.02,0.16,0.49}{{#1}}}
    \newcommand{\RegionMarkerTok}[1]{{#1}}
    \newcommand{\ErrorTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{{#1}}}}
    \newcommand{\NormalTok}[1]{{#1}}
    
    % Additional commands for more recent versions of Pandoc
    \newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.53,0.00,0.00}{{#1}}}
    \newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.73,0.40,0.53}{{#1}}}
    \newcommand{\ImportTok}[1]{{#1}}
    \newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.73,0.13,0.13}{\textit{{#1}}}}
    \newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\VariableTok}[1]{\textcolor[rgb]{0.10,0.09,0.49}{{#1}}}
    \newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{\textbf{{#1}}}}
    \newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.40,0.40,0.40}{{#1}}}
    \newcommand{\BuiltInTok}[1]{{#1}}
    \newcommand{\ExtensionTok}[1]{{#1}}
    \newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.74,0.48,0.00}{{#1}}}
    \newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.49,0.56,0.16}{{#1}}}
    \newcommand{\InformationTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\WarningTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    
    
    % Define a nice break command that doesn't care if a line doesn't already
    % exist.
    \def\br{\hspace*{\fill} \\* }
    % Math Jax compatability definitions
    \def\gt{>}
    \def\lt{<}
    % Document parameters
    \title{TCA\_genetic\_correlation\_check}
    
    
    

    % Pygments definitions
    
\makeatletter
\def\PY@reset{\let\PY@it=\relax \let\PY@bf=\relax%
    \let\PY@ul=\relax \let\PY@tc=\relax%
    \let\PY@bc=\relax \let\PY@ff=\relax}
\def\PY@tok#1{\csname PY@tok@#1\endcsname}
\def\PY@toks#1+{\ifx\relax#1\empty\else%
    \PY@tok{#1}\expandafter\PY@toks\fi}
\def\PY@do#1{\PY@bc{\PY@tc{\PY@ul{%
    \PY@it{\PY@bf{\PY@ff{#1}}}}}}}
\def\PY#1#2{\PY@reset\PY@toks#1+\relax+\PY@do{#2}}

\expandafter\def\csname PY@tok@w\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.73,0.73}{##1}}}
\expandafter\def\csname PY@tok@c\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@cp\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.74,0.48,0.00}{##1}}}
\expandafter\def\csname PY@tok@k\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@kp\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@kt\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.69,0.00,0.25}{##1}}}
\expandafter\def\csname PY@tok@o\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@ow\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.67,0.13,1.00}{##1}}}
\expandafter\def\csname PY@tok@nb\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@nf\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\expandafter\def\csname PY@tok@nc\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\expandafter\def\csname PY@tok@nn\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\expandafter\def\csname PY@tok@ne\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.82,0.25,0.23}{##1}}}
\expandafter\def\csname PY@tok@nv\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@no\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.53,0.00,0.00}{##1}}}
\expandafter\def\csname PY@tok@nl\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.63,0.63,0.00}{##1}}}
\expandafter\def\csname PY@tok@ni\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.60,0.60,0.60}{##1}}}
\expandafter\def\csname PY@tok@na\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.49,0.56,0.16}{##1}}}
\expandafter\def\csname PY@tok@nt\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@nd\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.67,0.13,1.00}{##1}}}
\expandafter\def\csname PY@tok@s\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@sd\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@si\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.73,0.40,0.53}{##1}}}
\expandafter\def\csname PY@tok@se\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.73,0.40,0.13}{##1}}}
\expandafter\def\csname PY@tok@sr\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.40,0.53}{##1}}}
\expandafter\def\csname PY@tok@ss\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@sx\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@m\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@gh\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,0.50}{##1}}}
\expandafter\def\csname PY@tok@gu\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.50,0.00,0.50}{##1}}}
\expandafter\def\csname PY@tok@gd\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.63,0.00,0.00}{##1}}}
\expandafter\def\csname PY@tok@gi\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.63,0.00}{##1}}}
\expandafter\def\csname PY@tok@gr\endcsname{\def\PY@tc##1{\textcolor[rgb]{1.00,0.00,0.00}{##1}}}
\expandafter\def\csname PY@tok@ge\endcsname{\let\PY@it=\textit}
\expandafter\def\csname PY@tok@gs\endcsname{\let\PY@bf=\textbf}
\expandafter\def\csname PY@tok@gp\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,0.50}{##1}}}
\expandafter\def\csname PY@tok@go\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.53,0.53,0.53}{##1}}}
\expandafter\def\csname PY@tok@gt\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.27,0.87}{##1}}}
\expandafter\def\csname PY@tok@err\endcsname{\def\PY@bc##1{\setlength{\fboxsep}{0pt}\fcolorbox[rgb]{1.00,0.00,0.00}{1,1,1}{\strut ##1}}}
\expandafter\def\csname PY@tok@kc\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@kd\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@kn\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@kr\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@bp\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@fm\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\expandafter\def\csname PY@tok@vc\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@vg\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@vi\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@vm\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@sa\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@sb\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@sc\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@dl\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@s2\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@sh\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@s1\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@mb\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@mf\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@mh\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@mi\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@il\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@mo\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@ch\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@cm\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@cpf\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@c1\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@cs\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}

\def\PYZbs{\char`\\}
\def\PYZus{\char`\_}
\def\PYZob{\char`\{}
\def\PYZcb{\char`\}}
\def\PYZca{\char`\^}
\def\PYZam{\char`\&}
\def\PYZlt{\char`\<}
\def\PYZgt{\char`\>}
\def\PYZsh{\char`\#}
\def\PYZpc{\char`\%}
\def\PYZdl{\char`\$}
\def\PYZhy{\char`\-}
\def\PYZsq{\char`\'}
\def\PYZdq{\char`\"}
\def\PYZti{\char`\~}
% for compatibility with earlier versions
\def\PYZat{@}
\def\PYZlb{[}
\def\PYZrb{]}
\makeatother


    % Exact colors from NB
    \definecolor{incolor}{rgb}{0.0, 0.0, 0.5}
    \definecolor{outcolor}{rgb}{0.545, 0.0, 0.0}



    
    % Prevent overflowing lines due to hard-to-break entities
    \sloppy 
    % Setup hyperref package
    \hypersetup{
      breaklinks=true,  % so long urls are correctly broken across lines
      colorlinks=true,
      urlcolor=urlcolor,
      linkcolor=linkcolor,
      citecolor=citecolor,
      }
    % Slightly bigger margins than the latex defaults
    
    \geometry{verbose,tmargin=1in,bmargin=1in,lmargin=1in,rmargin=1in}
    
    

    \begin{document}
    
    
    \maketitle
    
    

    
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}1}]:} \PY{k+kn}{library}\PY{p}{(}glmnet\PY{p}{)}
        \PY{k+kn}{library}\PY{p}{(}matrixStats\PY{p}{)}
        \PY{k+kn}{library}\PY{p}{(}abind\PY{p}{)}
        \PY{k+kn}{library}\PY{p}{(}pracma\PY{p}{)}
        \PY{k+kn}{library}\PY{p}{(}matrixcalc\PY{p}{)}
        \PY{k+kn}{library}\PY{p}{(}TCA\PY{p}{)}
        \PY{k+kn}{library}\PY{p}{(}MCMCpack\PY{p}{)}
        \PY{k+kn}{library}\PY{p}{(}ggplot2\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
Loading required package: Matrix
Loading required package: foreach
Loaded glmnet 2.0-18


Attaching package: ‘pracma’

The following objects are masked from ‘package:Matrix’:

    expm, lu, tril, triu

Loading required package: coda
Loading required package: MASS
\#\#
\#\# Markov Chain Monte Carlo Package (MCMCpack)
\#\# Copyright (C) 2003-2019 Andrew D. Martin, Kevin M. Quinn, and Jong Hee Park
\#\#
\#\# Support provided by the U.S. National Science Foundation
\#\# (Grants SES-0350646 and SES-0350613)
\#\#

Attaching package: ‘MCMCpack’

The following object is masked from ‘package:matrixcalc’:

    vech

The following object is masked from ‘package:pracma’:

    procrustes


    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}34}]:} summary\PYZus{}statistics \PY{o}{\PYZlt{}\PYZhy{}} \PY{k+kr}{function}\PY{p}{(}mdl\PY{p}{,}train\PYZus{}X\PY{p}{,}test\PYZus{}X\PY{p}{,}train\PYZus{}c1\PY{p}{,}test\PYZus{}c1\PY{p}{,}
                                        train\PYZus{}G\PY{p}{,}test\PYZus{}G\PY{p}{,}train\PYZus{}Z\PY{p}{,}test\PYZus{}Z\PY{p}{,}\PY{k+kp}{beta}\PY{p}{,}
                                        gamma\PYZus{}c1\PY{p}{,}gamma\PYZus{}c2\PY{p}{,}model\PY{o}{=}\PY{l+m}{1}\PY{p}{)}\PY{p}{\PYZob{}}
             \PY{c+c1}{\PYZsh{} TCA estimation \PYZam{} parameters}
             Z\PYZus{}hat\PYZus{}tca \PY{o}{=} tensor\PY{p}{(}train\PYZus{}G\PY{p}{,}mdl\PY{p}{,}log\PYZus{}file\PY{o}{=}\PY{k+kc}{NULL}\PY{p}{,}verbose\PY{o}{=}\PY{k+kc}{FALSE}\PY{p}{,}debug\PY{o}{=}\PY{k+kc}{FALSE}\PY{p}{)}
             rmse\PYZus{}tca \PY{o}{=} \PY{k+kp}{t}\PY{p}{(}\PY{k+kp}{do.call}\PY{p}{(}\PY{k+kp}{rbind}\PY{p}{,}\PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}\PY{k+kp}{length}\PY{p}{(}Z\PYZus{}hat\PYZus{}tca\PY{p}{)}\PY{p}{,}
                                             \PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} \PY{k+kp}{sqrt}\PY{p}{(}\PY{k+kp}{sum}\PY{p}{(}\PY{p}{(}Z\PYZus{}hat\PYZus{}tca\PY{p}{[[}x\PY{p}{]]}\PY{o}{\PYZhy{}}train\PYZus{}Z\PY{p}{[}\PY{p}{,}x\PY{p}{]}\PY{p}{)}\PY{o}{\PYZca{}}\PY{l+m}{2}\PY{p}{)}\PY{o}{/}\PY{k+kp}{length}\PY{p}{(}train\PYZus{}Z\PY{p}{[}\PY{p}{,}x\PY{p}{]}\PY{p}{)}\PY{p}{)}\PY{p}{)}\PY{p}{)}\PY{p}{)}
             Z\PYZus{}hat\PYZus{}cor\PYZus{}tca \PY{o}{=} \PY{k+kp}{sapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}\PY{k+kp}{length}\PY{p}{(}Z\PYZus{}hat\PYZus{}tca\PY{p}{)}\PY{p}{,} \PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} cor\PY{p}{(}\PY{k+kp}{unlist}\PY{p}{(}Z\PYZus{}hat\PYZus{}tca\PY{p}{[}x\PY{p}{]}\PY{p}{)}\PY{p}{,}train\PYZus{}Z\PY{p}{[}\PY{p}{,}x\PY{p}{]}\PY{p}{)}\PY{p}{)}
             cell\PYZus{}type \PY{o}{=} \PY{k+kp}{ncol}\PY{p}{(}mdl\PY{o}{\PYZdl{}}W\PY{p}{)}
             \PY{k+kr}{if}\PY{p}{(}model\PY{o}{==}\PY{l+m}{1}\PY{p}{)}\PY{p}{\PYZob{}}
                 tca\PYZus{}beta \PY{o}{=} \PY{k+kp}{t}\PY{p}{(}\PY{k+kt}{matrix}\PY{p}{(}mdl\PY{o}{\PYZdl{}}gammas\PYZus{}hat\PY{p}{[}\PY{p}{,}\PY{k+kp}{grepl}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{\PYZus{}SNP\PYZdq{}}\PY{p}{,}\PY{k+kp}{colnames}\PY{p}{(}mdl\PY{o}{\PYZdl{}}gammas\PYZus{}hat\PY{p}{)}\PY{p}{)}\PY{p}{]}\PY{p}{,}ncol\PY{o}{=}cell\PYZus{}type\PY{p}{)}\PY{p}{)}
                 beta\PYZus{}hat\PYZus{}cor\PYZus{}tca \PY{o}{=} \PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}cell\PYZus{}type\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} 
                     cor\PY{p}{(}\PY{k+kp}{beta}\PY{p}{[}x\PY{p}{,}\PY{p}{]}\PY{p}{,}mdl\PY{o}{\PYZdl{}}gammas\PYZus{}hat\PY{p}{[}\PY{p}{,}\PY{k+kp}{grepl}\PY{p}{(}\PY{k+kp}{paste}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{Cell\PYZus{}type\PYZdq{}}\PY{p}{,}x\PY{p}{,}\PY{l+s}{\PYZdq{}}\PY{l+s}{.G\PYZdq{}}\PY{p}{,}sep\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZsq{}}\PY{p}{)}\PY{p}{,}\PY{k+kp}{colnames}\PY{p}{(}mdl\PY{o}{\PYZdl{}}gammas\PYZus{}hat\PY{p}{)}\PY{p}{)}\PY{p}{]}\PY{p}{)}\PY{p}{)}        
             \PY{p}{\PYZcb{}}\PY{k+kp}{else}\PY{p}{\PYZob{}} \PY{c+c1}{\PYZsh{} model 2 does not predict beta for snps}
                 tca\PYZus{}beta \PY{o}{=} \PY{k+kc}{NULL}
                 beta\PYZus{}hat\PYZus{}cor\PYZus{}tca \PY{o}{=} \PY{k+kc}{NULL}
             \PY{p}{\PYZcb{}}
             gamma\PYZus{}hat\PYZus{}cor\PYZus{}tca \PY{o}{=} cor\PY{p}{(}\PY{k+kt}{array}\PY{p}{(}gamma\PYZus{}c1\PY{p}{)}\PY{p}{,}
                                 mdl\PY{o}{\PYZdl{}}gammas\PYZus{}hat\PY{p}{[}\PY{p}{,}\PY{k+kp}{grepl}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{male|smok|age|nerd|self\PYZsq{}}\PY{p}{,} \PY{k+kp}{colnames}\PY{p}{(}mdl\PY{o}{\PYZdl{}}gammas\PYZus{}hat\PY{p}{)}\PY{p}{)}\PY{p}{]}\PY{p}{)}
             \PY{k+kr}{if}\PY{p}{(}model\PY{o}{==}\PY{l+m}{1}\PY{p}{)}\PY{p}{\PYZob{}}
                 pred \PY{o}{=} \PY{k+kp}{cbind}\PY{p}{(}train\PYZus{}X\PY{p}{,}train\PYZus{}c1\PY{p}{)}
                 test\PYZus{}pred \PY{o}{=} \PY{k+kp}{cbind}\PY{p}{(}test\PYZus{}X\PY{p}{,}test\PYZus{}c1\PY{p}{)}        
             \PY{p}{\PYZcb{}}\PY{k+kp}{else}\PY{p}{\PYZob{}} \PY{c+c1}{\PYZsh{} model 2 does not use train\PYZus{}X/test\PYZus{}X as C1}
                 pred \PY{o}{=} train\PYZus{}c1
                 test\PYZus{}pred \PY{o}{=} test\PYZus{}c1
             \PY{p}{\PYZcb{}}
             \PY{c+c1}{\PYZsh{} TCA parameter direct estimation \PYZlt{}\PYZhy{}\PYZhy{}\PYZhy{}\PYZhy{}\PYZgt{} C1 \PYZam{} X}
             Z\PYZus{}hat\PYZus{}train\PYZus{}second\PYZus{}eq\PYZus{}tca \PY{o}{=} \PY{k+kp}{sapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}cell\PYZus{}type\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} pred \PY{o}{\PYZpc{}*\PYZpc{}} mdl\PY{o}{\PYZdl{}}gammas\PYZus{}hat\PY{p}{[}\PY{p}{,}\PY{p}{(}\PY{p}{(}x\PY{l+m}{\PYZhy{}1}\PY{p}{)}\PY{o}{*}\PY{k+kp}{dim}\PY{p}{(}pred\PY{p}{)}\PY{p}{[}\PY{l+m}{2}\PY{p}{]}\PY{l+m}{+1}\PY{p}{)}\PY{o}{:}\PY{p}{(}x\PY{o}{*}\PY{k+kp}{dim}\PY{p}{(}pred\PY{p}{)}\PY{p}{[}\PY{l+m}{2}\PY{p}{]}\PY{p}{)}\PY{p}{]}\PY{p}{)}
             Z\PYZus{}hat\PYZus{}train\PYZus{}second\PYZus{}eq\PYZus{}cor\PYZus{}tca \PY{o}{=} \PY{k+kp}{diag}\PY{p}{(}cor\PY{p}{(}train\PYZus{}Z\PY{p}{,}Z\PYZus{}hat\PYZus{}train\PYZus{}second\PYZus{}eq\PYZus{}tca\PY{p}{)}\PY{p}{)}
             Z\PYZus{}hat\PYZus{}test\PYZus{}second\PYZus{}eq\PYZus{}tca \PY{o}{=} \PY{k+kp}{sapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}cell\PYZus{}type\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} test\PYZus{}pred \PY{o}{\PYZpc{}*\PYZpc{}} mdl\PY{o}{\PYZdl{}}gammas\PYZus{}hat\PY{p}{[}\PY{p}{,}\PY{p}{(}\PY{p}{(}x\PY{l+m}{\PYZhy{}1}\PY{p}{)}\PY{o}{*}\PY{k+kp}{dim}\PY{p}{(}test\PYZus{}pred\PY{p}{)}\PY{p}{[}\PY{l+m}{2}\PY{p}{]}\PY{l+m}{+1}\PY{p}{)}\PY{o}{:}\PY{p}{(}x\PY{o}{*}\PY{k+kp}{dim}\PY{p}{(}test\PYZus{}pred\PY{p}{)}\PY{p}{[}\PY{l+m}{2}\PY{p}{]}\PY{p}{)}\PY{p}{]}\PY{p}{)}
             Z\PYZus{}hat\PYZus{}test\PYZus{}second\PYZus{}eq\PYZus{}cor\PYZus{}tca \PY{o}{=} \PY{k+kp}{diag}\PY{p}{(}cor\PY{p}{(}test\PYZus{}Z\PY{p}{,}Z\PYZus{}hat\PYZus{}test\PYZus{}second\PYZus{}eq\PYZus{}tca\PY{p}{)}\PY{p}{)}
             
             \PY{c+c1}{\PYZsh{} Lasso bulk data regression \PYZlt{}\PYZhy{}\PYZhy{}\PYZhy{}\PYZhy{}\PYZgt{} X only}
             glmnet.mdl.X.cv \PY{o}{\PYZlt{}\PYZhy{}} cv.glmnet\PY{p}{(}x\PY{o}{=}train\PYZus{}X\PY{p}{,}y\PY{o}{=}\PY{k+kp}{t}\PY{p}{(}train\PYZus{}G\PY{p}{)}\PY{p}{,}nfolds\PY{o}{=}\PY{l+m}{5}\PY{p}{)}
             glmnet.mdl.X \PY{o}{\PYZlt{}\PYZhy{}} glmnet\PY{p}{(}x\PY{o}{=}train\PYZus{}X\PY{p}{,}y\PY{o}{=}\PY{k+kp}{t}\PY{p}{(}train\PYZus{}G\PY{p}{)}\PY{p}{,}lambda\PY{o}{=}glmnet.mdl.X.cv\PY{o}{\PYZdl{}}lambda.min\PY{p}{)}
             beta\PYZus{}full\PYZus{}X\PYZus{}bulk \PY{o}{\PYZlt{}\PYZhy{}} \PY{k+kp}{as.numeric}\PY{p}{(}glmnet.mdl.X\PY{o}{\PYZdl{}}\PY{k+kp}{beta}\PY{p}{)}
             \PY{c+c1}{\PYZsh{} extract non zero predictors and recorrelate}
             predictors.X \PY{o}{\PYZlt{}\PYZhy{}} \PY{k+kp}{colnames}\PY{p}{(}train\PYZus{}X\PY{p}{)}\PY{p}{[}\PY{k+kp}{which}\PY{p}{(}beta\PYZus{}full\PYZus{}X\PYZus{}bulk\PY{o}{!=}\PY{l+m}{0}\PY{p}{)}\PY{p}{]}
             beta\PYZus{}X \PY{o}{\PYZlt{}\PYZhy{}} \PY{k+kp}{as.matrix}\PY{p}{(}\PY{k+kt}{c}\PY{p}{(}glmnet.mdl.X\PY{o}{\PYZdl{}}a0\PY{p}{,}\PY{k+kp}{as.matrix}\PY{p}{(}glmnet.mdl.X\PY{o}{\PYZdl{}}\PY{k+kp}{beta}\PY{p}{[}predictors.X\PY{p}{,}\PY{p}{]}\PY{p}{)}\PY{p}{)}\PY{p}{)}
             bias\PYZus{}one \PY{o}{\PYZlt{}\PYZhy{}} \PY{k+kt}{numeric}\PY{p}{(}\PY{k+kp}{nrow}\PY{p}{(}train\PYZus{}X\PY{p}{)}\PY{p}{)}\PY{l+m}{+1}
             G\PYZus{}hat\PYZus{}train\PYZus{}lasso \PY{o}{\PYZlt{}\PYZhy{}} \PY{k+kp}{cbind}\PY{p}{(}bias\PYZus{}one\PY{p}{,}train\PYZus{}X\PY{p}{[}\PY{p}{,}predictors.X\PY{p}{]}\PY{p}{)} \PY{o}{\PYZpc{}*\PYZpc{}} beta\PYZus{}X
             G\PYZus{}hat\PYZus{}train\PYZus{}cor\PYZus{}bulk \PY{o}{\PYZlt{}\PYZhy{}} cor\PY{p}{(}\PY{k+kp}{t}\PY{p}{(}train\PYZus{}G\PY{p}{)}\PY{p}{,}G\PYZus{}hat\PYZus{}train\PYZus{}lasso\PY{p}{)}
             G\PYZus{}hat\PYZus{}test\PYZus{}lasso \PY{o}{\PYZlt{}\PYZhy{}} \PY{k+kp}{cbind}\PY{p}{(}\PY{k+kt}{numeric}\PY{p}{(}\PY{k+kp}{nrow}\PY{p}{(}test\PYZus{}X\PY{p}{)}\PY{p}{)}\PY{l+m}{+1}\PY{p}{,}test\PYZus{}X\PY{p}{[}\PY{p}{,}predictors.X\PY{p}{]}\PY{p}{)} \PY{o}{\PYZpc{}*\PYZpc{}} beta\PYZus{}X
             G\PYZus{}hat\PYZus{}test\PYZus{}cor\PYZus{}bulk \PY{o}{\PYZlt{}\PYZhy{}} cor\PY{p}{(}\PY{k+kp}{t}\PY{p}{(}test\PYZus{}G\PY{p}{)}\PY{p}{,}G\PYZus{}hat\PYZus{}test\PYZus{}lasso\PY{p}{)}
             
             \PY{c+c1}{\PYZsh{} cell type specific lasso}
             corrs \PY{o}{=} \PY{k+kt}{numeric}\PY{p}{(}\PY{k+kp}{ncol}\PY{p}{(}mdl\PY{o}{\PYZdl{}}W\PY{p}{)}\PY{p}{)}
             corrs.real \PY{o}{=} \PY{k+kt}{numeric}\PY{p}{(}\PY{k+kp}{ncol}\PY{p}{(}mdl\PY{o}{\PYZdl{}}W\PY{p}{)}\PY{p}{)}
             corrs.beta \PY{o}{=} \PY{k+kt}{numeric}\PY{p}{(}\PY{k+kp}{ncol}\PY{p}{(}mdl\PY{o}{\PYZdl{}}W\PY{p}{)}\PY{p}{)}
             corrs.test.real \PY{o}{=} \PY{k+kt}{numeric}\PY{p}{(}\PY{k+kp}{ncol}\PY{p}{(}mdl\PY{o}{\PYZdl{}}W\PY{p}{)}\PY{p}{)}
             dev\PYZus{}ratio \PY{o}{=} \PY{k+kt}{numeric}\PY{p}{(}\PY{k+kp}{ncol}\PY{p}{(}mdl\PY{o}{\PYZdl{}}W\PY{p}{)}\PY{p}{)}
             rmse\PYZus{}lasso \PY{o}{=} \PY{k+kt}{numeric}\PY{p}{(}\PY{k+kp}{ncol}\PY{p}{(}mdl\PY{o}{\PYZdl{}}W\PY{p}{)}\PY{p}{)}
             beta\PYZus{}full\PYZus{}cell \PY{o}{=} \PY{k+kt}{matrix}\PY{p}{(}\PY{l+m}{0}\PY{p}{,}nrow\PY{o}{=}\PY{k+kp}{ncol}\PY{p}{(}mdl\PY{o}{\PYZdl{}}W\PY{p}{)}\PY{p}{,}ncol\PY{o}{=}\PY{k+kp}{dim}\PY{p}{(}train\PYZus{}X\PY{p}{)}\PY{p}{[}\PY{l+m}{2}\PY{p}{]}\PY{p}{)}
             Z\PYZus{}hat\PYZus{}test\PYZus{}lasso \PY{o}{=} \PY{k+kt}{matrix}\PY{p}{(}\PY{l+m}{0}\PY{p}{,}nrow\PY{o}{=}\PY{k+kp}{nrow}\PY{p}{(}test\PYZus{}Z\PY{p}{)}\PY{p}{,}ncol\PY{o}{=}\PY{k+kp}{ncol}\PY{p}{(}test\PYZus{}Z\PY{p}{)}\PY{p}{)}
             \PY{k+kr}{for} \PY{p}{(}h \PY{k+kr}{in} \PY{l+m}{1}\PY{o}{:}\PY{k+kp}{ncol}\PY{p}{(}mdl\PY{o}{\PYZdl{}}W\PY{p}{)}\PY{p}{)}\PY{p}{\PYZob{}}
                 
                 glmnet.mdl.cv \PY{o}{\PYZlt{}\PYZhy{}} cv.glmnet\PY{p}{(}x\PY{o}{=}train\PYZus{}X\PY{p}{,}y\PY{o}{=}Z\PYZus{}hat\PYZus{}tca\PY{p}{[[}h\PY{p}{]]}\PY{p}{,}standardize\PY{o}{=}\PY{k+kc}{FALSE}\PY{p}{,}alpha\PY{o}{=}\PY{l+m}{1}\PY{p}{,}nfolds\PY{o}{=}\PY{l+m}{5}\PY{p}{)}
                 rmse\PYZus{}lasso\PY{p}{[}h\PY{p}{]} \PY{o}{=} \PY{k+kp}{sqrt}\PY{p}{(}glmnet.mdl.cv\PY{o}{\PYZdl{}}cvm\PY{p}{[}glmnet.mdl.cv\PY{o}{\PYZdl{}}lambda \PY{o}{==} glmnet.mdl.cv\PY{o}{\PYZdl{}}lambda.min\PY{p}{]}\PY{p}{)}
                 glmnet.mdl \PY{o}{\PYZlt{}\PYZhy{}} glmnet\PY{p}{(}x\PY{o}{=}train\PYZus{}X\PY{p}{,}y\PY{o}{=}Z\PYZus{}hat\PYZus{}tca\PY{p}{[[}h\PY{p}{]]}\PY{p}{,}standardize\PY{o}{=}\PY{k+kc}{FALSE}\PY{p}{,}alpha\PY{o}{=}\PY{l+m}{1}\PY{p}{,}lambda\PY{o}{=}glmnet.mdl.cv\PY{o}{\PYZdl{}}lambda.min\PY{p}{)}
                 dev\PYZus{}ratio\PY{p}{[}h\PY{p}{]} \PY{o}{\PYZlt{}\PYZhy{}} glmnet.mdl\PY{o}{\PYZdl{}}dev.ratio
                 beta.full \PY{o}{\PYZlt{}\PYZhy{}} \PY{k+kp}{as.numeric}\PY{p}{(}glmnet.mdl\PY{o}{\PYZdl{}}\PY{k+kp}{beta}\PY{p}{)}
                 beta\PYZus{}full\PYZus{}cell\PY{p}{[}h\PY{p}{,}\PY{p}{]} \PY{o}{\PYZlt{}\PYZhy{}} beta.full
                 predictors \PY{o}{\PYZlt{}\PYZhy{}} \PY{k+kp}{colnames}\PY{p}{(}train\PYZus{}X\PY{p}{)}\PY{p}{[}\PY{k+kp}{which}\PY{p}{(}beta.full \PY{o}{!=} \PY{l+m}{0}\PY{p}{)}\PY{p}{]}
                 beta\PYZus{}lasso \PY{o}{\PYZlt{}\PYZhy{}} \PY{k+kp}{as.matrix}\PY{p}{(}\PY{k+kt}{c}\PY{p}{(}glmnet.mdl\PY{o}{\PYZdl{}}a0\PY{p}{,}\PY{k+kp}{as.matrix}\PY{p}{(}glmnet.mdl\PY{o}{\PYZdl{}}\PY{k+kp}{beta}\PY{p}{[}predictors\PY{p}{,}\PY{p}{]}\PY{p}{)}\PY{p}{)}\PY{p}{)}
                 Z\PYZus{}hat\PYZus{}train\PYZus{}lasso \PY{o}{\PYZlt{}\PYZhy{}} \PY{k+kp}{cbind}\PY{p}{(}\PY{k+kt}{numeric}\PY{p}{(}\PY{k+kp}{nrow}\PY{p}{(}train\PYZus{}X\PY{p}{)}\PY{p}{)}\PY{l+m}{+1}\PY{p}{,}train\PYZus{}X\PY{p}{[}\PY{p}{,}predictors\PY{p}{]}\PY{p}{)} \PY{o}{\PYZpc{}*\PYZpc{}} beta\PYZus{}lasso
                 Z\PYZus{}hat\PYZus{}test\PYZus{}lasso\PY{p}{[}\PY{p}{,}h\PY{p}{]} \PY{o}{\PYZlt{}\PYZhy{}} \PY{k+kp}{cbind}\PY{p}{(}\PY{k+kt}{numeric}\PY{p}{(}\PY{k+kp}{nrow}\PY{p}{(}test\PYZus{}X\PY{p}{)}\PY{p}{)}\PY{l+m}{+1}\PY{p}{,}test\PYZus{}X\PY{p}{[}\PY{p}{,}predictors\PY{p}{]}\PY{p}{)} \PY{o}{\PYZpc{}*\PYZpc{}} beta\PYZus{}lasso
                 Z\PYZus{}hat\PYZus{}test\PYZus{}lasso\PY{p}{[}\PY{p}{,}h\PY{p}{]} \PY{o}{=} \PY{k+kp}{signif}\PY{p}{(}Z\PYZus{}hat\PYZus{}test\PYZus{}lasso\PY{p}{[}\PY{p}{,}h\PY{p}{]}\PY{p}{,} digits \PY{o}{=} \PY{l+m}{5}\PY{p}{)}
                 \PY{k+kr}{if}\PY{p}{(}\PY{k+kp}{sum}\PY{p}{(}beta\PYZus{}lasso\PY{p}{)}\PY{o}{==}\PY{l+m}{0} \PY{o}{|} sd\PY{p}{(}Z\PYZus{}hat\PYZus{}train\PYZus{}lasso\PY{p}{)}\PY{o}{==}\PY{l+m}{0}\PY{p}{)}\PY{p}{\PYZob{}}
                     \PY{c+c1}{\PYZsh{} model 2 lasso forces SNPs effect to become zero.}
                     \PY{c+c1}{\PYZsh{} If there were no predictors, then cor would be NaN. Which also means}
                     \PY{c+c1}{\PYZsh{} no snps is correlated with Z. cor just set to 0.}
                     corrs\PY{p}{[}h\PY{p}{]} \PY{o}{=} \PY{l+m}{0}
                     corrs.real\PY{p}{[}h\PY{p}{]} \PY{o}{=} \PY{l+m}{0}
                     corrs.beta\PY{p}{[}h\PY{p}{]} \PY{o}{=} \PY{l+m}{0}
                     corrs.test.real\PY{p}{[}h\PY{p}{]} \PY{o}{=} \PY{l+m}{0}
                 \PY{p}{\PYZcb{}}\PY{k+kp}{else}\PY{p}{\PYZob{}}
                     corrs\PY{p}{[}h\PY{p}{]} \PY{o}{\PYZlt{}\PYZhy{}} cor\PY{p}{(}\PY{k+kp}{t}\PY{p}{(}Z\PYZus{}hat\PYZus{}tca\PY{p}{[[}h\PY{p}{]]}\PY{p}{)}\PY{p}{,}Z\PYZus{}hat\PYZus{}train\PYZus{}lasso\PY{p}{)}
                     corrs.real\PY{p}{[}h\PY{p}{]} \PY{o}{\PYZlt{}\PYZhy{}} cor\PY{p}{(}train\PYZus{}Z\PY{p}{[}\PY{p}{,}h\PY{p}{]}\PY{p}{,}Z\PYZus{}hat\PYZus{}train\PYZus{}lasso\PY{p}{)}
                     corrs.beta\PY{p}{[}h\PY{p}{]} \PY{o}{\PYZlt{}\PYZhy{}} cor\PY{p}{(}\PY{k+kp}{beta}\PY{p}{[}h\PY{p}{,}\PY{p}{]}\PY{p}{,}beta.full\PY{p}{)}
                     corrs.test.real\PY{p}{[}h\PY{p}{]} \PY{o}{\PYZlt{}\PYZhy{}} cor\PY{p}{(}test\PYZus{}Z\PY{p}{[}\PY{p}{,}h\PY{p}{]}\PY{p}{,}Z\PYZus{}hat\PYZus{}test\PYZus{}lasso\PY{p}{[}\PY{p}{,}h\PY{p}{]}\PY{p}{)}
                 \PY{p}{\PYZcb{}}
             \PY{p}{\PYZcb{}}
             \PY{c+c1}{\PYZsh{} Precision \PYZam{} Recall for lasso}
             Binary\PYZus{}True\PY{o}{=}\PY{p}{(}\PY{k+kp}{beta}\PY{o}{!=}\PY{l+m}{0}\PY{p}{)}
             Binary\PYZus{}Pred\PYZus{}Lasso\PY{o}{=}\PY{p}{(}beta\PYZus{}full\PYZus{}cell\PY{o}{!=}\PY{l+m}{0}\PY{p}{)}
             TP \PY{o}{=} \PY{k+kp}{do.call}\PY{p}{(}\PY{k+kp}{rbind}\PY{p}{,}\PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}cell\PYZus{}type\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} \PY{k+kp}{sum}\PY{p}{(}\PY{k+kp}{as.integer}\PY{p}{(}Binary\PYZus{}True\PY{p}{[}x\PY{p}{,}\PY{p}{]}\PY{o}{\PYZam{}}Binary\PYZus{}Pred\PYZus{}Lasso\PY{p}{[}x\PY{p}{,}\PY{p}{]}\PY{p}{)}\PY{p}{)}\PY{p}{)}\PY{p}{)}
             FP \PY{o}{=} \PY{k+kp}{do.call}\PY{p}{(}\PY{k+kp}{rbind}\PY{p}{,}\PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}cell\PYZus{}type\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} \PY{k+kp}{sum}\PY{p}{(}\PY{k+kp}{as.integer}\PY{p}{(}\PY{p}{(}\PY{o}{!}Binary\PYZus{}True\PY{p}{[}x\PY{p}{,}\PY{p}{]}\PY{p}{)}\PY{o}{\PYZam{}}Binary\PYZus{}Pred\PYZus{}Lasso\PY{p}{[}x\PY{p}{,}\PY{p}{]}\PY{p}{)}\PY{p}{)}\PY{p}{)}\PY{p}{)}
             FN \PY{o}{=} \PY{k+kp}{do.call}\PY{p}{(}\PY{k+kp}{rbind}\PY{p}{,}\PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}cell\PYZus{}type\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} \PY{k+kp}{sum}\PY{p}{(}\PY{k+kp}{as.integer}\PY{p}{(}Binary\PYZus{}True\PY{p}{[}x\PY{p}{,}\PY{p}{]}\PY{o}{\PYZam{}}\PY{p}{(}\PY{o}{!}Binary\PYZus{}Pred\PYZus{}Lasso\PY{p}{[}x\PY{p}{,}\PY{p}{]}\PY{p}{)}\PY{p}{)}\PY{p}{)}\PY{p}{)}\PY{p}{)}
             precision\PYZus{}lasso \PY{o}{=} TP\PY{o}{/}\PY{p}{(}TP\PY{o}{+}FP\PY{p}{)}
             recall\PYZus{}lasso \PY{o}{=} TP\PY{o}{/}\PY{p}{(}TP\PY{o}{+}FN\PY{p}{)}
             
             \PY{k+kr}{return}\PY{p}{(}\PY{k+kt}{list}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{Z\PYZus{}hat\PYZus{}test\PYZus{}lasso\PYZsq{}}\PY{o}{=}Z\PYZus{}hat\PYZus{}test\PYZus{}lasso\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{Z\PYZus{}hat\PYZus{}tca\PYZsq{}}\PY{o}{=}Z\PYZus{}hat\PYZus{}tca\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{Z\PYZus{}hat\PYZus{}cor\PYZus{}tca\PYZsq{}}\PY{o}{=}Z\PYZus{}hat\PYZus{}cor\PYZus{}tca\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{beta\PYZus{}hat\PYZus{}cor\PYZus{}tca\PYZsq{}}\PY{o}{=}beta\PYZus{}hat\PYZus{}cor\PYZus{}tca\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{gamma\PYZus{}hat\PYZus{}cor\PYZus{}tca\PYZsq{}}\PY{o}{=}gamma\PYZus{}hat\PYZus{}cor\PYZus{}tca\PY{p}{,}
                        \PY{l+s}{\PYZsq{}}\PY{l+s}{Z\PYZus{}hat\PYZus{}train\PYZus{}second\PYZus{}eq\PYZus{}cor\PYZus{}tca\PYZsq{}}\PY{o}{=}Z\PYZus{}hat\PYZus{}train\PYZus{}second\PYZus{}eq\PYZus{}cor\PYZus{}tca\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{Z\PYZus{}hat\PYZus{}test\PYZus{}second\PYZus{}eq\PYZus{}cor\PYZus{}tca\PYZsq{}}\PY{o}{=}Z\PYZus{}hat\PYZus{}test\PYZus{}second\PYZus{}eq\PYZus{}cor\PYZus{}tca\PY{p}{,}
                        \PY{l+s}{\PYZsq{}}\PY{l+s}{G\PYZus{}hat\PYZus{}train\PYZus{}cor\PYZus{}bulk\PYZsq{}}\PY{o}{=}G\PYZus{}hat\PYZus{}train\PYZus{}cor\PYZus{}bulk\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{G\PYZus{}hat\PYZus{}test\PYZus{}cor\PYZus{}bulk\PYZsq{}}\PY{o}{=}G\PYZus{}hat\PYZus{}test\PYZus{}cor\PYZus{}bulk\PY{p}{,}
                        \PY{l+s}{\PYZsq{}}\PY{l+s}{cor\PYZus{}lasso\PYZus{}tca\PYZsq{}}\PY{o}{=}corrs\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{cor\PYZus{}lasso\PYZus{}real\PYZus{}train\PYZsq{}}\PY{o}{=}corrs.real\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{cor\PYZus{}lasso\PYZus{}real\PYZus{}test\PYZsq{}}\PY{o}{=}corrs.test.real\PY{p}{,}
                        \PY{l+s}{\PYZsq{}}\PY{l+s}{cor\PYZus{}beta\PYZus{}lasso\PYZus{}real\PYZsq{}}\PY{o}{=}corrs.beta\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{beta\PYZus{}hat\PYZus{}lasso\PYZsq{}}\PY{o}{=}beta\PYZus{}full\PYZus{}cell\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{dev\PYZus{}rat\PYZsq{}}\PY{o}{=}dev\PYZus{}ratio\PY{p}{,}
                        \PY{l+s}{\PYZsq{}}\PY{l+s}{precision\PYZus{}lasso\PYZsq{}}\PY{o}{=}precision\PYZus{}lasso\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{recall\PYZus{}lasso\PYZsq{}}\PY{o}{=}recall\PYZus{}lasso\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{rmse\PYZus{}lasso\PYZsq{}}\PY{o}{=}rmse\PYZus{}lasso\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{rmse\PYZus{}tca\PYZsq{}}\PY{o}{=}rmse\PYZus{}tca\PY{p}{)}\PY{p}{)}
         \PY{p}{\PYZcb{}}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}35}]:} generateCorrelationMatrix \PY{o}{\PYZlt{}\PYZhy{}} \PY{k+kr}{function}\PY{p}{(}k\PY{p}{,} lambda\PY{p}{)} \PY{p}{\PYZob{}}
           \PY{k+kr}{return}\PY{p}{(}\PY{k+kp}{sapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}k\PY{p}{,} \PY{k+kr}{function}\PY{p}{(}i\PY{p}{)} \PY{p}{\PYZob{}}\PY{k+kp}{sapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}k\PY{p}{,} \PY{k+kr}{function}\PY{p}{(}j\PY{p}{)} \PY{p}{\PYZob{}}lambda\PY{o}{\PYZca{}}\PY{p}{(}\PY{k+kp}{abs}\PY{p}{(}i\PY{o}{\PYZhy{}}j\PY{p}{)}\PY{p}{)}\PY{p}{\PYZcb{}}\PY{p}{)}\PY{p}{\PYZcb{}}\PY{p}{)}\PY{p}{)}
         \PY{p}{\PYZcb{}}
         
         generate\PYZus{}params \PY{o}{\PYZlt{}\PYZhy{}} \PY{k+kr}{function}\PY{p}{(}cell\PYZus{}her\PY{o}{=}\PY{k+kc}{FALSE}\PY{p}{,}gene\PYZus{}cor\PY{o}{=}\PY{k+kc}{FALSE}\PY{p}{,}bulk\PYZus{}her\PY{o}{=}\PY{k+kc}{FALSE}\PY{p}{,}seed\PY{o}{=}\PY{l+m}{1}\PY{p}{,}N\PY{o}{=}\PY{l+m}{5000}\PY{p}{,}M\PY{o}{=}\PY{l+m}{100}\PY{p}{,}herr\PYZus{}arr\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{p}{)}\PY{p}{,}D\PY{o}{=}\PY{l+m}{20}\PY{p}{,}pslab\PY{o}{=}\PY{l+m}{0.5}\PY{p}{,}her\PY{o}{=}\PY{l+m}{0.05}\PY{p}{,}her\PYZus{}bulk\PY{o}{=}\PY{l+m}{0.8}\PY{p}{)}\PY{p}{\PYZob{}}
             \PY{k+kp}{set.seed}\PY{p}{(}\PY{l+m}{1}\PY{p}{)}
             \PY{k+kr}{if}\PY{p}{(}\PY{k+kp}{length}\PY{p}{(}herr\PYZus{}arr\PY{p}{)}\PY{o}{!=}\PY{l+m}{0}\PY{p}{)}\PY{p}{\PYZob{}}
                 M \PY{o}{=} \PY{k+kp}{length}\PY{p}{(}herr\PYZus{}arr\PY{p}{)}
             \PY{p}{\PYZcb{}}\PY{k+kp}{else}\PY{p}{\PYZob{}}
                 M \PY{o}{=} M
             \PY{p}{\PYZcb{}}
             K \PY{o}{=} \PY{l+m}{4}
             N \PY{o}{=} N
             pc\PYZus{}num \PY{o}{=} \PY{l+m}{2}
             \PY{c+c1}{\PYZsh{} cis\PYZus{}snps\PYZus{}nums = floor(runif(M, min = 150, max = 400))}
             D \PY{o}{=} D
             cis\PYZus{}snps\PYZus{}nums \PY{o}{=} \PY{k+kt}{array}\PY{p}{(}D\PY{p}{,}M\PY{p}{)}
             sigma\PYZus{}g \PY{o}{=} \PY{l+m}{0.01}
             sigma\PYZus{}z \PY{o}{=} \PY{l+m}{0.1}
             
             \PY{k+kr}{if}\PY{p}{(}gene\PYZus{}cor\PY{p}{)}\PY{p}{\PYZob{}} \PY{c+c1}{\PYZsh{} varing genetic correlation across genes}
                 corr\PYZus{}seq \PY{o}{=} \PY{k+kp}{seq}\PY{p}{(}from\PY{o}{=}\PY{l+m}{0}\PY{p}{,}to\PY{o}{=}pslab\PY{p}{,}length.out\PY{o}{=}M\PY{p}{)}
             \PY{p}{\PYZcb{}}\PY{k+kp}{else}\PY{p}{\PYZob{}}
                 corr\PYZus{}seq \PY{o}{=} \PY{k+kp}{seq}\PY{p}{(}from\PY{o}{=}\PY{l+m}{0}\PY{p}{,}to\PY{o}{=}\PY{l+m}{0}\PY{p}{,}length.out\PY{o}{=}M\PY{p}{)}
             \PY{p}{\PYZcb{}}
             pslab \PY{o}{=} \PY{k+kt}{matrix}\PY{p}{(}pslab\PY{p}{,}nrow\PY{o}{=}M\PY{p}{,}ncol\PY{o}{=}K\PY{p}{)}
             \PY{c+c1}{\PYZsh{}corr\PYZus{}matrix = lapply(1:M,function(x) generateCorrelationMatrix(K,corr\PYZus{}seq[x]))}
             corr\PYZus{}matrix \PY{o}{=} \PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}M\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} \PY{k+kt}{matrix}\PY{p}{(}corr\PYZus{}seq\PY{p}{[}x\PY{p}{]}\PY{p}{,}nrow\PY{o}{=}K\PY{p}{,}ncol\PY{o}{=}K\PY{p}{)}\PY{p}{)}
             \PY{k+kr}{for}\PY{p}{(}i \PY{k+kr}{in} \PY{l+m}{1}\PY{o}{:}M\PY{p}{)}\PY{p}{\PYZob{}}
                 \PY{k+kp}{diag}\PY{p}{(}corr\PYZus{}matrix\PY{p}{[[}i\PY{p}{]]}\PY{p}{)}\PY{o}{=}\PY{l+m}{1}
             \PY{p}{\PYZcb{}}
             
             \PY{k+kr}{if}\PY{p}{(}cell\PYZus{}her\PY{p}{)}\PY{p}{\PYZob{}} \PY{c+c1}{\PYZsh{} varing heribility across genes}
                 heritibility\PYZus{}cell\PYZus{}specific \PY{o}{=} \PY{k+kp}{do.call}\PY{p}{(}\PY{k+kp}{rbind}\PY{p}{,}\PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}K\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} herr\PYZus{}arr\PY{p}{)}\PY{p}{)}
             \PY{p}{\PYZcb{}}\PY{k+kp}{else}\PY{p}{\PYZob{}}
                 heritibility\PYZus{}cell\PYZus{}specific \PY{o}{=} \PY{k+kt}{matrix}\PY{p}{(}her\PY{p}{,}nrow\PY{o}{=}K\PY{p}{,}ncol\PY{o}{=}M\PY{p}{)}
             \PY{p}{\PYZcb{}}
             
             \PY{k+kr}{if}\PY{p}{(}bulk\PYZus{}her\PY{p}{)}\PY{p}{\PYZob{}} \PY{c+c1}{\PYZsh{} varing bulk heritibility across genes}
                 heritibility\PYZus{}bulk \PY{o}{=} \PY{k+kp}{seq}\PY{p}{(}from\PY{o}{=}\PY{l+m}{0.1}\PY{p}{,}to\PY{o}{=}her\PYZus{}bulk\PY{p}{,}length.out\PY{o}{=}M\PY{p}{)}
             \PY{p}{\PYZcb{}}\PY{k+kp}{else}\PY{p}{\PYZob{}}
                 heritibility\PYZus{}bulk \PY{o}{=} \PY{k+kt}{array}\PY{p}{(}her\PYZus{}bulk\PY{p}{,}M\PY{p}{)}
             \PY{p}{\PYZcb{}}
                 
             MAF \PY{o}{=} \PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}\PY{k+kp}{length}\PY{p}{(}cis\PYZus{}snps\PYZus{}nums\PY{p}{)}\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} runif\PY{p}{(}cis\PYZus{}snps\PYZus{}nums\PY{p}{[}x\PY{p}{]}\PY{p}{,}min\PY{o}{=}\PY{l+m}{0.1}\PY{p}{,}max\PY{o}{=}\PY{l+m}{0.5}\PY{p}{)}\PY{p}{)}
             id\PYZus{}name \PY{o}{=} \PY{k+kp}{sapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}N\PY{p}{,} \PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} \PY{k+kp}{paste}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{SAMPLE\PYZsq{}}\PY{p}{,}\PY{k+kp}{toString}\PY{p}{(}x\PY{p}{)}\PY{p}{,}sep \PY{o}{=} \PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZsq{}}\PY{p}{)}\PY{p}{)}
             cell\PYZus{}type\PYZus{}name\PY{o}{=}\PY{k+kp}{sapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}K\PY{p}{,} \PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} \PY{k+kp}{paste}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{Cell\PYZus{}type\PYZsq{}}\PY{p}{,}x\PY{p}{,}sep \PY{o}{=} \PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZsq{}}\PY{p}{)}\PY{p}{)}
             
             \PY{c+c1}{\PYZsh{}\PYZsh{}\PYZsh{} generate C1 and C2}
             male \PY{o}{=} \PY{k+kt}{matrix}\PY{p}{(}rbinom\PY{p}{(}N\PY{p}{,} \PY{l+m}{1}\PY{p}{,} \PY{l+m}{0.5}\PY{p}{)}\PY{p}{,}nrow\PY{o}{=}N\PY{p}{)}
             smoking \PY{o}{=} \PY{k+kt}{matrix}\PY{p}{(}rbinom\PY{p}{(}N\PY{p}{,} \PY{l+m}{2}\PY{p}{,} \PY{l+m}{0.2}\PY{p}{)}\PY{p}{,}nrow\PY{o}{=}N\PY{p}{)}
             smoking \PY{o}{=} \PY{p}{(}smoking \PY{o}{\PYZhy{}} \PY{k+kp}{min}\PY{p}{(}smoking\PY{p}{)}\PY{p}{)}\PY{o}{/}\PY{p}{(}\PY{k+kp}{max}\PY{p}{(}smoking\PY{p}{)}\PY{p}{)}
             age \PY{o}{=} \PY{k+kt}{matrix}\PY{p}{(}\PY{k+kp}{sapply}\PY{p}{(}\PY{k+kp}{sapply}\PY{p}{(}rnorm\PY{p}{(}N\PY{p}{,}\PY{l+m}{50}\PY{p}{,}\PY{l+m}{20}\PY{p}{)}\PY{p}{,} \PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} \PY{k+kp}{floor}\PY{p}{(}x\PY{p}{)}\PY{p}{)}\PY{p}{,} \PY{k+kr}{function}\PY{p}{(}x\PY{p}{)}  \PY{k+kr}{if} \PY{p}{(}x\PY{o}{\PYZlt{}}\PY{l+m}{0}\PY{p}{)}\PY{p}{\PYZob{}}x\PY{o}{=}\PY{l+m}{20}\PY{p}{\PYZcb{}} \PY{k+kp}{else}\PY{p}{\PYZob{}}x\PY{o}{=}x\PY{p}{\PYZcb{}}\PY{p}{)}\PY{p}{,}nrow\PY{o}{=}N\PY{p}{)} 
             age \PY{o}{=} \PY{p}{(}age\PY{o}{\PYZhy{}}\PY{k+kp}{min}\PY{p}{(}age\PY{p}{)}\PY{p}{)}\PY{o}{/}\PY{p}{(}\PY{k+kp}{max}\PY{p}{(}age\PY{p}{)}\PY{o}{\PYZhy{}}\PY{k+kp}{min}\PY{p}{(}age\PY{p}{)}\PY{p}{)}
             nerdiness \PY{o}{=} \PY{k+kt}{matrix}\PY{p}{(}rbinom\PY{p}{(}N\PY{p}{,}\PY{l+m}{2}\PY{p}{,}\PY{l+m}{0.2}\PY{p}{)}\PY{p}{,}nrow\PY{o}{=}N\PY{p}{)}
             nerdiness \PY{o}{=} \PY{p}{(}nerdiness\PY{o}{\PYZhy{}}\PY{k+kp}{min}\PY{p}{(}nerdiness\PY{p}{)}\PY{p}{)}\PY{o}{/}\PY{k+kp}{max}\PY{p}{(}nerdiness\PY{p}{)}
             selfishness \PY{o}{=} \PY{k+kt}{matrix}\PY{p}{(}rbinom\PY{p}{(}N\PY{p}{,}\PY{l+m}{2}\PY{p}{,}\PY{l+m}{0.2}\PY{p}{)}\PY{p}{,}nrow\PY{o}{=}N\PY{p}{)}
             selfishness \PY{o}{=} \PY{p}{(}selfishness\PY{o}{\PYZhy{}}\PY{k+kp}{min}\PY{p}{(}selfishness\PY{p}{)}\PY{p}{)}\PY{o}{/}\PY{k+kp}{max}\PY{p}{(}selfishness\PY{p}{)}
             c1 \PY{o}{=} \PY{k+kp}{scale}\PY{p}{(}\PY{k+kp}{cbind}\PY{p}{(}male\PY{p}{,} smoking\PY{p}{,} age\PY{p}{,}nerdiness\PY{p}{,}selfishness\PY{p}{)}\PY{p}{)}
             c2 \PY{o}{=} \PY{k+kp}{scale}\PY{p}{(}\PY{k+kt}{matrix}\PY{p}{(}rnorm\PY{p}{(}N\PY{o}{*}pc\PYZus{}num\PY{p}{)}\PY{p}{,} nrow\PY{o}{=}N\PY{p}{)}\PY{p}{)}
                                     
             \PY{k+kp}{rownames}\PY{p}{(}c1\PY{p}{)} \PY{o}{=} id\PYZus{}name
             \PY{k+kp}{colnames}\PY{p}{(}c1\PY{p}{)} \PY{o}{=} \PY{k+kt}{c}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{male\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{smoking\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{age\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{nerdiness\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{selfishness\PYZsq{}}\PY{p}{)}
             \PY{k+kp}{rownames}\PY{p}{(}c2\PY{p}{)} \PY{o}{=} id\PYZus{}name
             \PY{k+kp}{colnames}\PY{p}{(}c2\PY{p}{)} \PY{o}{=} \PY{k+kp}{sapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}pc\PYZus{}num\PY{p}{,} \PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} \PY{k+kp}{paste}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{PC\PYZsq{}}\PY{p}{,}\PY{k+kp}{toString}\PY{p}{(}x\PY{p}{)}\PY{p}{,}sep \PY{o}{=} \PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZsq{}}\PY{p}{)}\PY{p}{)}
                                   
             p1 \PY{o}{=} \PY{k+kp}{dim}\PY{p}{(}c1\PY{p}{)}\PY{p}{[}\PY{l+m}{2}\PY{p}{]}
             sigma\PYZus{}gamma \PY{o}{=} \PY{k+kp}{sqrt}\PY{p}{(}\PY{p}{(}\PY{l+m}{1}\PY{o}{\PYZhy{}}heritibility\PYZus{}cell\PYZus{}specific\PY{p}{[}\PY{l+m}{1}\PY{p}{,}\PY{p}{]}\PY{o}{\PYZhy{}}sigma\PYZus{}z\PY{o}{\PYZca{}}\PY{l+m}{2}\PY{p}{)}\PY{o}{/}p1\PY{p}{)}
             var\PYZus{}beta \PY{o}{=} heritibility\PYZus{}cell\PYZus{}specific\PY{p}{[}\PY{l+m}{1}\PY{p}{,}\PY{p}{]}\PY{o}{*}\PY{p}{(}p1\PY{o}{*}sigma\PYZus{}gamma\PY{o}{\PYZca{}}\PY{l+m}{2}\PY{o}{+}sigma\PYZus{}z\PY{o}{\PYZca{}}\PY{l+m}{2}\PY{p}{)}\PY{o}{/}\PY{p}{(}\PY{l+m}{1}\PY{o}{\PYZhy{}}heritibility\PYZus{}cell\PYZus{}specific\PY{p}{[}\PY{l+m}{1}\PY{p}{,}\PY{p}{]}\PY{p}{)}\PY{o}{/}D
             
             \PY{c+c1}{\PYZsh{} cell type proportion, from the real data estimated}
             W\PYZus{}alpha \PY{o}{=} \PY{k+kt}{c}\PY{p}{(}\PY{l+m}{26.553683792256}\PY{p}{,}\PY{l+m}{17.6621467979005}\PY{p}{,}\PY{l+m}{4.48671525658667}\PY{p}{,}\PY{l+m}{1.56874856517803}\PY{p}{)}\PY{c+c1}{\PYZsh{},0.178797663350679)}
             \PY{c+c1}{\PYZsh{}W\PYZus{}alpha = 50.4500920752719}
             W\PYZus{}xsi \PY{o}{=} \PY{k+kt}{c}\PY{p}{(}\PY{l+m}{0.526335685426257}\PY{p}{,}\PY{l+m}{0.350091468050216}\PY{p}{,}\PY{l+m}{0.088933737720289}\PY{p}{,}\PY{l+m}{0.0310950585152043}\PY{p}{,}\PY{l+m}{0.00354405028803339}\PY{p}{)}
             \PY{k+kr}{if}\PY{p}{(}K \PY{o}{\PYZlt{}=} \PY{k+kp}{length}\PY{p}{(}W\PYZus{}alpha\PY{p}{)}\PY{p}{)}\PY{p}{\PYZob{}}
                 W \PY{o}{=} rdirichlet\PY{p}{(}N\PY{p}{,} W\PYZus{}alpha\PY{p}{[}\PY{l+m}{1}\PY{o}{:}K\PY{p}{]}\PY{p}{)}
             \PY{p}{\PYZcb{}}\PY{k+kp}{else}\PY{p}{\PYZob{}} \PY{c+c1}{\PYZsh{}more cell type prop}
                 W \PY{o}{=} rdirichlet\PY{p}{(}N\PY{p}{,} runif\PY{p}{(}K\PY{p}{,} \PY{l+m}{0}\PY{p}{,} \PY{l+m}{1}\PY{p}{)}\PY{p}{)}
             \PY{p}{\PYZcb{}}
             \PY{k+kp}{colnames}\PY{p}{(}W\PY{p}{)} \PY{o}{=} cell\PYZus{}type\PYZus{}name
             \PY{k+kp}{rownames}\PY{p}{(}W\PY{p}{)} \PY{o}{=} id\PYZus{}name
             
             alpha \PY{o}{=} W\PYZus{}alpha
             alpha\PYZus{}0 \PY{o}{=} \PY{k+kp}{sum}\PY{p}{(}alpha\PY{p}{)}
             alpha\PYZus{}tilde \PY{o}{=} alpha\PY{o}{/}alpha\PYZus{}0
             m2\PYZus{}alpha \PY{o}{=} alpha\PYZus{}tilde \PY{o}{\PYZpc{}*\PYZpc{}} \PY{k+kp}{t}\PY{p}{(}alpha\PYZus{}tilde\PY{p}{)}\PY{o}{*}alpha\PYZus{}0\PY{o}{/}\PY{p}{(}alpha\PYZus{}0\PY{l+m}{+1}\PY{p}{)}
             \PY{k+kp}{diag}\PY{p}{(}m2\PYZus{}alpha\PY{p}{)} \PY{o}{=} alpha\PYZus{}tilde\PY{o}{*}\PY{p}{(}\PY{l+m}{1}\PY{o}{\PYZhy{}}alpha\PYZus{}tilde\PY{p}{)}\PY{o}{/}\PY{p}{(}alpha\PYZus{}0\PY{l+m}{+1}\PY{p}{)}\PY{o}{+}alpha\PYZus{}tilde\PY{o}{\PYZca{}}\PY{l+m}{2}
             
             \PY{k+kr}{return}\PY{p}{(}\PY{k+kt}{list}\PY{p}{(}
                 \PY{l+s}{\PYZsq{}}\PY{l+s}{M\PYZsq{}}\PY{o}{=}M\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{K\PYZsq{}}\PY{o}{=}K\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{N\PYZsq{}}\PY{o}{=}N\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{pc\PYZus{}num\PYZsq{}}\PY{o}{=}pc\PYZus{}num\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{D\PYZsq{}}\PY{o}{=}D\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{id\PYZus{}name\PYZsq{}}\PY{o}{=}id\PYZus{}name\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{cell\PYZus{}name\PYZsq{}}\PY{o}{=}cell\PYZus{}type\PYZus{}name\PY{p}{,}
                 \PY{l+s}{\PYZsq{}}\PY{l+s}{her\PYZsq{}}\PY{o}{=}heritibility\PYZus{}cell\PYZus{}specific\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{her\PYZus{}bulk\PYZsq{}}\PY{o}{=}heritibility\PYZus{}bulk\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{pslab\PYZsq{}}\PY{o}{=}pslab\PY{p}{,}
                 \PY{l+s}{\PYZsq{}}\PY{l+s}{MAF\PYZsq{}}\PY{o}{=}MAF\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{c1\PYZsq{}}\PY{o}{=}c1\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{c2\PYZsq{}}\PY{o}{=}c2\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{W\PYZsq{}}\PY{o}{=}W\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{sigma\PYZus{}gamma\PYZsq{}}\PY{o}{=}sigma\PYZus{}gamma\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{sigma\PYZus{}g\PYZsq{}}\PY{o}{=}sigma\PYZus{}g\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{m2\PYZus{}alpha\PYZsq{}}\PY{o}{=}m2\PYZus{}alpha\PY{p}{,}
                 \PY{l+s}{\PYZsq{}}\PY{l+s}{sigma\PYZus{}z\PYZsq{}}\PY{o}{=}sigma\PYZus{}z\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{gene\PYZus{}cor\PYZsq{}}\PY{o}{=}corr\PYZus{}seq\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{beta\PYZus{}cor\PYZsq{}}\PY{o}{=}corr\PYZus{}matrix\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{var\PYZus{}beta\PYZsq{}}\PY{o}{=}var\PYZus{}beta\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{W\PYZus{}alpha\PYZsq{}}\PY{o}{=}W\PYZus{}alpha\PY{p}{[}\PY{l+m}{1}\PY{o}{:}K\PY{p}{]}\PY{p}{)}\PY{p}{)}
         \PY{p}{\PYZcb{}}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}36}]:} one\PYZus{}gene \PY{o}{\PYZlt{}\PYZhy{}} \PY{k+kr}{function}\PY{p}{(}par\PY{p}{,}g\PY{p}{,}seed\PY{o}{=}\PY{l+m}{1}\PY{p}{)}\PY{p}{\PYZob{}}
             \PY{k+kp}{set.seed}\PY{p}{(}seed\PY{p}{)}
             cell\PYZus{}type \PY{o}{=} par\PY{o}{\PYZdl{}}K
             n\PYZus{}snps \PY{o}{=} par\PY{o}{\PYZdl{}}D
             her \PY{o}{=} par\PY{o}{\PYZdl{}}her\PY{p}{[}\PY{p}{,}g\PY{p}{]}
             cor \PY{o}{=} par\PY{o}{\PYZdl{}}beta\PYZus{}cor\PY{p}{[[}g\PY{p}{]]}
             pslab \PY{o}{=} par\PY{o}{\PYZdl{}}pslab\PY{p}{[}g\PY{p}{,}\PY{p}{]}
             var\PYZus{}beta \PY{o}{=} \PY{k+kt}{array}\PY{p}{(}par\PY{o}{\PYZdl{}}var\PYZus{}beta\PY{p}{[}g\PY{p}{]}\PY{p}{,}par\PY{o}{\PYZdl{}}K\PY{p}{)}
             
             maf \PY{o}{=} par\PY{o}{\PYZdl{}}MAF\PY{p}{[[}g\PY{p}{]]}
             dummy\PYZus{}var \PY{o}{=} \PY{l+m}{10}
             
             var\PYZus{}matrix\PY{o}{=}\PY{k+kp}{sqrt}\PY{p}{(}var\PYZus{}beta\PY{o}{\PYZpc{}*\PYZpc{}}\PY{k+kp}{t}\PY{p}{(}var\PYZus{}beta\PY{p}{)}\PY{p}{)}
             Sigma\PYZus{}beta \PY{o}{=} cor\PY{o}{*}var\PYZus{}matrix\PY{o}{/}\PY{p}{(}\PY{l+m}{1}\PY{o}{\PYZhy{}}pslab\PY{p}{)}\PY{o}{\PYZca{}}\PY{l+m}{2}
             \PY{k+kp}{diag}\PY{p}{(}Sigma\PYZus{}beta\PY{p}{)} \PY{o}{=} \PY{k+kp}{diag}\PY{p}{(}Sigma\PYZus{}beta\PY{p}{)} \PY{o}{*}\PY{p}{(}\PY{l+m}{1}\PY{o}{\PYZhy{}}pslab\PY{p}{)}
             \PY{k+kp}{print}\PY{p}{(}Sigma\PYZus{}beta\PY{p}{)}
             beta\PYZus{} \PY{o}{=} mvrnorm\PY{p}{(}n\PYZus{}snps\PY{p}{,}mu\PY{o}{=}\PY{k+kp}{rep}\PY{p}{(}\PY{l+m}{0}\PY{p}{,}par\PY{o}{\PYZdl{}}K\PY{p}{)}\PY{p}{,}Sigma\PY{o}{=}Sigma\PYZus{}beta\PY{p}{,}tol\PY{o}{=}\PY{l+m}{1e\PYZhy{}4}\PY{p}{,}empirical\PY{o}{=}\PY{k+kc}{TRUE}\PY{p}{)}
             rmask \PY{o}{=} \PY{k+kp}{do.call}\PY{p}{(}\PY{k+kp}{rbind}\PY{p}{,}\PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}cell\PYZus{}type\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} rbinom\PY{p}{(}n\PYZus{}snps\PY{p}{,}\PY{l+m}{1}\PY{p}{,}\PY{l+m}{1}\PY{o}{\PYZhy{}}pslab\PY{p}{[}x\PY{p}{]}\PY{p}{)}\PY{p}{)}\PY{p}{)}
             beta \PY{o}{=} \PY{k+kp}{t}\PY{p}{(}beta\PYZus{}\PY{p}{)}\PY{o}{*}rmask
         
             X \PY{o}{=} \PY{k+kp}{t}\PY{p}{(}\PY{k+kp}{do.call}\PY{p}{(}\PY{k+kp}{rbind}\PY{p}{,}\PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}n\PYZus{}snps\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} rbinom\PY{p}{(}par\PY{o}{\PYZdl{}}N\PY{p}{,}\PY{l+m}{2}\PY{p}{,}maf\PY{p}{[}x\PY{p}{]}\PY{p}{)}\PY{p}{)}\PY{p}{)}\PY{p}{)}
             \PY{k+kp}{colnames}\PY{p}{(}X\PY{p}{)} \PY{o}{=} \PY{k+kp}{sapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}n\PYZus{}snps\PY{p}{,} \PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} \PY{k+kp}{paste}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{G\PYZsq{}}\PY{p}{,}g\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZus{}SNP\PYZsq{}}\PY{p}{,}\PY{k+kp}{toString}\PY{p}{(}x\PY{p}{)}\PY{p}{,}sep \PY{o}{=} \PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZsq{}}\PY{p}{)}\PY{p}{)}
             \PY{k+kp}{rownames}\PY{p}{(}X\PY{p}{)} \PY{o}{=} par\PY{o}{\PYZdl{}}id\PYZus{}name
             X \PY{o}{=} \PY{k+kp}{scale}\PY{p}{(}X\PY{p}{)}
             \PY{c+c1}{\PYZsh{} enforce variance of samples by adjusting sd of beta}
             xbeta\PYZus{}var \PY{o}{=} n\PYZus{}snps\PY{o}{*}var\PYZus{}beta\PY{p}{[}\PY{l+m}{1}\PY{p}{]}
             beta \PY{o}{=} \PY{k+kp}{do.call}\PY{p}{(}\PY{k+kp}{rbind}\PY{p}{,}
                               \PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}cell\PYZus{}type\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} \PY{k+kp}{beta}\PY{p}{[}x\PY{p}{,}\PY{p}{]}\PY{o}{*}\PY{p}{(}\PY{k+kp}{sqrt}\PY{p}{(}xbeta\PYZus{}var\PY{p}{)}\PY{o}{/}sd\PY{p}{(}X \PY{o}{\PYZpc{}*\PYZpc{}} \PY{k+kp}{beta}\PY{p}{[}x\PY{p}{,}\PY{p}{]}\PY{p}{)}\PY{p}{)}\PY{p}{)}\PY{p}{)}
         
             mu\PYZus{}z \PY{o}{=} X\PY{o}{\PYZpc{}*\PYZpc{}}\PY{k+kp}{t}\PY{p}{(}\PY{k+kp}{beta}\PY{p}{)}
             epsilon\PYZus{}z \PY{o}{=} \PY{k+kt}{array}\PY{p}{(}rnorm\PY{p}{(}par\PY{o}{\PYZdl{}}N\PY{o}{*}cell\PYZus{}type\PY{p}{,}mean\PY{o}{=}\PY{l+m}{0}\PY{p}{,}sd\PY{o}{=}par\PY{o}{\PYZdl{}}sigma\PYZus{}z\PY{p}{)}\PY{p}{,} \PY{k+kt}{c}\PY{p}{(}par\PY{o}{\PYZdl{}}N\PY{p}{,}cell\PYZus{}type\PY{p}{)}\PY{p}{)}
             epsilon\PYZus{}z \PY{o}{=} \PY{k+kp}{apply}\PY{p}{(}epsilon\PYZus{}z\PY{p}{,}\PY{l+m}{2}\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} x\PY{o}{*}par\PY{o}{\PYZdl{}}sigma\PYZus{}z\PY{o}{/}sd\PY{p}{(}x\PY{p}{)}\PY{p}{)}
             Sigma\PYZus{}gamma\PYZus{}c1 \PY{o}{=} \PY{k+kt}{matrix}\PY{p}{(}\PY{l+m}{0}\PY{p}{,}nrow\PY{o}{=}cell\PYZus{}type\PY{p}{,}ncol\PY{o}{=}cell\PYZus{}type\PY{p}{)}
             \PY{k+kp}{diag}\PY{p}{(}Sigma\PYZus{}gamma\PYZus{}c1\PY{p}{)} \PY{o}{=} par\PY{o}{\PYZdl{}}sigma\PYZus{}gamma\PY{p}{[}g\PY{p}{]}\PY{o}{\PYZca{}}\PY{l+m}{2}
             gamma\PYZus{}c1 \PY{o}{=} mvrnorm\PY{p}{(}\PY{k+kp}{dim}\PY{p}{(}par\PY{o}{\PYZdl{}}c1\PY{p}{)}\PY{p}{[}\PY{l+m}{2}\PY{p}{]}\PY{p}{,}mu\PY{o}{=}\PY{k+kp}{rep}\PY{p}{(}\PY{l+m}{0}\PY{p}{,}cell\PYZus{}type\PY{p}{)}\PY{p}{,}Sigma\PY{o}{=}Sigma\PYZus{}gamma\PYZus{}c1\PY{p}{,}tol\PY{o}{=}\PY{l+m}{1e\PYZhy{}6}\PY{p}{,}empirical\PY{o}{=}\PY{k+kc}{TRUE}\PY{p}{)}
             \PY{c+c1}{\PYZsh{} gamma\PYZus{}c1 = do.call(rbind,lapply(1:cell\PYZus{}type,function(x) rnorm(dim(par\PYZdl{}c1)[2],mean=0,sd=par\PYZdl{}sigma\PYZus{}gamma)))}
             \PY{c+c1}{\PYZsh{} enforce variance of samples by adjusting sd of gamma\PYZus{}c1}
             \PY{c+c1}{\PYZsh{} enforce the c1\PYZus{}gamma variance}
             c1gamma\PYZus{}var \PY{o}{=} \PY{k+kp}{dim}\PY{p}{(}par\PY{o}{\PYZdl{}}c1\PY{p}{)}\PY{p}{[}\PY{l+m}{2}\PY{p}{]}\PY{o}{*}\PY{p}{(}par\PY{o}{\PYZdl{}}sigma\PYZus{}gamma\PY{p}{[}g\PY{p}{]}\PY{p}{)}\PY{o}{\PYZca{}}\PY{l+m}{2}
             gamma\PYZus{}c1 \PY{o}{=} \PY{k+kp}{do.call}\PY{p}{(}\PY{k+kp}{rbind}\PY{p}{,}
                                \PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}cell\PYZus{}type\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} gamma\PYZus{}c1\PY{p}{[}\PY{p}{,}x\PY{p}{]}\PY{o}{*}\PY{p}{(}\PY{k+kp}{sqrt}\PY{p}{(}c1gamma\PYZus{}var\PY{p}{)}\PY{o}{/}sd\PY{p}{(}par\PY{o}{\PYZdl{}}c1 \PY{o}{\PYZpc{}*\PYZpc{}} gamma\PYZus{}c1\PY{p}{[}\PY{p}{,}x\PY{p}{]}\PY{p}{)}\PY{p}{)}\PY{p}{)}\PY{p}{)}
             c1\PYZus{}gamma \PY{o}{=} par\PY{o}{\PYZdl{}}c1 \PY{o}{\PYZpc{}*\PYZpc{}} \PY{k+kp}{t}\PY{p}{(}gamma\PYZus{}c1\PY{p}{)}
         
             Z \PY{o}{=} mu\PYZus{}z \PY{o}{+} epsilon\PYZus{}z \PY{o}{+} c1\PYZus{}gamma\PY{c+c1}{\PYZsh{}  }
             \PY{k+kp}{rownames}\PY{p}{(}Z\PY{p}{)} \PY{o}{=} par\PY{o}{\PYZdl{}}id\PYZus{}name
             \PY{k+kp}{colnames}\PY{p}{(}Z\PY{p}{)} \PY{o}{=} par\PY{o}{\PYZdl{}}cell\PYZus{}name
             
             \PY{c+c1}{\PYZsh{}\PYZsh{}\PYZsh{} Generate Gene expressions}
             G \PY{o}{=} \PY{k+kp}{rowSums}\PY{p}{(}\PY{p}{(}par\PY{o}{\PYZdl{}}W\PY{p}{)}\PY{o}{*}Z\PY{p}{)}
             epsilon\PYZus{}G \PY{o}{=} rnorm\PY{p}{(}par\PY{o}{\PYZdl{}}N\PY{p}{,}mean\PY{o}{=}\PY{l+m}{0}\PY{p}{,}sd\PY{o}{=}par\PY{o}{\PYZdl{}}sigma\PYZus{}g\PY{p}{)}
             epsilon\PYZus{}G \PY{o}{=} epsilon\PYZus{}G\PY{o}{*}par\PY{o}{\PYZdl{}}sigma\PYZus{}g\PY{o}{/}sd\PY{p}{(}epsilon\PYZus{}G\PY{p}{)}
             
             \PY{c+c1}{\PYZsh{} use bulk level heritability to calculate sigma\PYZus{}gamma}
             bulk\PYZus{}her\PYZus{}nom \PY{o}{=} \PY{k+kp}{sum}\PY{p}{(}hadamard.prod\PY{p}{(}par\PY{o}{\PYZdl{}}m2\PYZus{}alpha\PY{p}{,}var\PY{p}{(}mu\PYZus{}z\PY{p}{)}\PY{p}{)}\PY{p}{)}
             bulk\PYZus{}her\PYZus{}c1\PYZus{}gamma \PY{o}{=} \PY{k+kp}{sum}\PY{p}{(}hadamard.prod\PY{p}{(}par\PY{o}{\PYZdl{}}m2\PYZus{}alpha\PY{p}{,}var\PY{p}{(}c1\PYZus{}gamma\PY{p}{)}\PY{p}{)}\PY{p}{)}
             bulk\PYZus{}her\PYZus{}epsilon\PYZus{}z \PY{o}{=} \PY{k+kp}{sum}\PY{p}{(}hadamard.prod\PY{p}{(}par\PY{o}{\PYZdl{}}m2\PYZus{}alpha\PY{p}{,}var\PY{p}{(}epsilon\PYZus{}z\PY{p}{)}\PY{p}{)}\PY{p}{)}
             bulk\PYZus{}her\PYZus{}z \PY{o}{=} \PY{k+kp}{sum}\PY{p}{(}hadamard.prod\PY{p}{(}par\PY{o}{\PYZdl{}}m2\PYZus{}alpha\PY{p}{,}var\PY{p}{(}Z\PY{p}{)}\PY{p}{)}\PY{p}{)}
             
             bulk\PYZus{}her\PYZus{}denom \PY{o}{=} \PY{k+kp}{sum}\PY{p}{(}hadamard.prod\PY{p}{(}par\PY{o}{\PYZdl{}}m2\PYZus{}alpha\PY{p}{,}var\PY{p}{(}Z\PY{p}{)}\PY{p}{)}\PY{p}{)}\PY{o}{+}var\PY{p}{(}epsilon\PYZus{}G\PY{p}{)}
             bulk\PYZus{}her\PYZus{}val \PY{o}{=} par\PY{o}{\PYZdl{}}her\PYZus{}bulk\PY{p}{[}g\PY{p}{]}\PY{o}{*}her\PY{p}{[}\PY{l+m}{1}\PY{p}{]}
             sd\PYZus{}gamma\PYZus{}c2 \PY{o}{=} \PY{k+kp}{sqrt}\PY{p}{(}\PY{p}{(}bulk\PYZus{}her\PYZus{}nom\PY{o}{/}bulk\PYZus{}her\PYZus{}val\PY{o}{\PYZhy{}}bulk\PYZus{}her\PYZus{}denom\PY{p}{)}\PY{o}{/}par\PY{o}{\PYZdl{}}pc\PYZus{}num\PY{p}{)}
             
             gamma\PYZus{}c2 \PY{o}{=} \PY{k+kt}{matrix}\PY{p}{(}rnorm\PY{p}{(}par\PY{o}{\PYZdl{}}pc\PYZus{}num\PY{p}{,}mean\PY{o}{=}\PY{l+m}{0}\PY{p}{,}sd\PY{o}{=}sd\PYZus{}gamma\PYZus{}c2\PY{p}{)}\PY{p}{,}nrow\PY{o}{=}par\PY{o}{\PYZdl{}}pc\PYZus{}num\PY{p}{,}ncol\PY{o}{=}\PY{l+m}{1}\PY{p}{)}
             c2gamma\PYZus{}var \PY{o}{=} par\PY{o}{\PYZdl{}}pc\PYZus{}num \PY{o}{*} \PY{p}{(}sd\PYZus{}gamma\PYZus{}c2\PY{p}{)}\PY{o}{\PYZca{}}\PY{l+m}{2}
             gamma\PYZus{}c2 \PY{o}{=} gamma\PYZus{}c2\PY{o}{*}\PY{p}{(}\PY{k+kp}{sqrt}\PY{p}{(}c2gamma\PYZus{}var\PY{p}{)}\PY{o}{/}sd\PY{p}{(}par\PY{o}{\PYZdl{}}c2\PY{o}{\PYZpc{}*\PYZpc{}}gamma\PYZus{}c2\PY{p}{)}\PY{p}{)}
             c2\PYZus{}gamma \PY{o}{=} par\PY{o}{\PYZdl{}}c2 \PY{o}{\PYZpc{}*\PYZpc{}} gamma\PYZus{}c2
             
             G \PY{o}{=} \PY{k+kp}{t}\PY{p}{(}G \PY{o}{+} epsilon\PYZus{}G\PY{p}{)}\PY{c+c1}{\PYZsh{} + c2\PYZus{}gamma)}
             real\PYZus{}denom \PY{o}{=} var\PY{p}{(}\PY{k+kp}{t}\PY{p}{(}G\PY{p}{)}\PY{p}{)}
             \PY{k+kp}{colnames}\PY{p}{(}G\PY{p}{)} \PY{o}{\PYZlt{}\PYZhy{}} par\PY{o}{\PYZdl{}}id\PYZus{}name
             \PY{k+kp}{rownames}\PY{p}{(}G\PY{p}{)} \PY{o}{\PYZlt{}\PYZhy{}} \PY{k+kp}{paste}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{gene\PYZsq{}}\PY{p}{,}g\PY{p}{,}sep\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZus{}\PYZsq{}}\PY{p}{)}
             G \PY{o}{=} \PY{k+kp}{as.data.frame}\PY{p}{(}G\PY{p}{)}
             
             real\PYZus{}bulk\PYZus{}her \PY{o}{=} bulk\PYZus{}her\PYZus{}nom\PY{o}{/}\PY{p}{(}bulk\PYZus{}her\PYZus{}denom\PY{o}{+}var\PY{p}{(}c2\PYZus{}gamma\PY{p}{)}\PY{p}{)}
                                       
             \PY{k+kr}{return}\PY{p}{(}\PY{k+kt}{list}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{X\PYZsq{}}\PY{o}{=}X\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{beta\PYZsq{}}\PY{o}{=}\PY{k+kp}{beta}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{gamma\PYZus{}c1\PYZsq{}}\PY{o}{=}gamma\PYZus{}c1\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{bulk\PYZus{}her\PYZsq{}}\PY{o}{=}real\PYZus{}bulk\PYZus{}her\PY{p}{,}
                        \PY{l+s}{\PYZsq{}}\PY{l+s}{gamma\PYZus{}c2\PYZsq{}}\PY{o}{=}gamma\PYZus{}c2\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{Z\PYZsq{}}\PY{o}{=}Z\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{G\PYZsq{}}\PY{o}{=}G\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{epsilon\PYZus{}z\PYZsq{}}\PY{o}{=}epsilon\PYZus{}z\PY{p}{)}\PY{p}{)}
         \PY{p}{\PYZcb{}}
         \PY{c+c1}{\PYZsh{}data = one\PYZus{}gene(par=params,1)}
\end{Verbatim}


    \subsubsection{Plotting Begins for Genetic Correlation
Check}\label{plotting-begins-for-genetic-correlation-check}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}54}]:} params \PY{o}{=} generate\PYZus{}params\PY{p}{(}cell\PYZus{}her\PY{o}{=}\PY{k+kc}{FALSE}\PY{p}{,}gene\PYZus{}cor\PY{o}{=}\PY{k+kc}{TRUE}\PY{p}{,}bulk\PYZus{}her\PY{o}{=}\PY{k+kc}{FALSE}\PY{p}{,}
                                  seed\PY{o}{=}\PY{l+m}{1}\PY{p}{,}N\PY{o}{=}\PY{l+m}{5000}\PY{p}{,}M\PY{o}{=}\PY{l+m}{10}\PY{p}{,}
                                  D\PY{o}{=}\PY{l+m}{250}\PY{p}{,}pslab\PY{o}{=}\PY{l+m}{0.5}\PY{p}{,}her\PY{o}{=}\PY{l+m}{0.5}\PY{p}{,}
                                  her\PYZus{}bulk\PY{o}{=}\PY{l+m}{0.6}\PY{p}{)}
         data \PY{o}{=} \PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}params\PY{o}{\PYZdl{}}M\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} one\PYZus{}gene\PY{p}{(}par\PY{o}{=}params\PY{p}{,}x\PY{p}{)}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
      [,1]  [,2]  [,3]  [,4]
[1,] 0.004 0.000 0.000 0.000
[2,] 0.000 0.004 0.000 0.000
[3,] 0.000 0.000 0.004 0.000
[4,] 0.000 0.000 0.000 0.004
             [,1]         [,2]         [,3]         [,4]
[1,] 0.0040000000 0.0004444444 0.0004444444 0.0004444444
[2,] 0.0004444444 0.0040000000 0.0004444444 0.0004444444
[3,] 0.0004444444 0.0004444444 0.0040000000 0.0004444444
[4,] 0.0004444444 0.0004444444 0.0004444444 0.0040000000
             [,1]         [,2]         [,3]         [,4]
[1,] 0.0040000000 0.0008888889 0.0008888889 0.0008888889
[2,] 0.0008888889 0.0040000000 0.0008888889 0.0008888889
[3,] 0.0008888889 0.0008888889 0.0040000000 0.0008888889
[4,] 0.0008888889 0.0008888889 0.0008888889 0.0040000000
            [,1]        [,2]        [,3]        [,4]
[1,] 0.004000000 0.001333333 0.001333333 0.001333333
[2,] 0.001333333 0.004000000 0.001333333 0.001333333
[3,] 0.001333333 0.001333333 0.004000000 0.001333333
[4,] 0.001333333 0.001333333 0.001333333 0.004000000
            [,1]        [,2]        [,3]        [,4]
[1,] 0.004000000 0.001777778 0.001777778 0.001777778
[2,] 0.001777778 0.004000000 0.001777778 0.001777778
[3,] 0.001777778 0.001777778 0.004000000 0.001777778
[4,] 0.001777778 0.001777778 0.001777778 0.004000000
            [,1]        [,2]        [,3]        [,4]
[1,] 0.004000000 0.002222222 0.002222222 0.002222222
[2,] 0.002222222 0.004000000 0.002222222 0.002222222
[3,] 0.002222222 0.002222222 0.004000000 0.002222222
[4,] 0.002222222 0.002222222 0.002222222 0.004000000
            [,1]        [,2]        [,3]        [,4]
[1,] 0.004000000 0.002666667 0.002666667 0.002666667
[2,] 0.002666667 0.004000000 0.002666667 0.002666667
[3,] 0.002666667 0.002666667 0.004000000 0.002666667
[4,] 0.002666667 0.002666667 0.002666667 0.004000000
            [,1]        [,2]        [,3]        [,4]
[1,] 0.004000000 0.003111111 0.003111111 0.003111111
[2,] 0.003111111 0.004000000 0.003111111 0.003111111
[3,] 0.003111111 0.003111111 0.004000000 0.003111111
[4,] 0.003111111 0.003111111 0.003111111 0.004000000
            [,1]        [,2]        [,3]        [,4]
[1,] 0.004000000 0.003555556 0.003555556 0.003555556
[2,] 0.003555556 0.004000000 0.003555556 0.003555556
[3,] 0.003555556 0.003555556 0.004000000 0.003555556
[4,] 0.003555556 0.003555556 0.003555556 0.004000000
      [,1]  [,2]  [,3]  [,4]
[1,] 0.004 0.004 0.004 0.004
[2,] 0.004 0.004 0.004 0.004
[3,] 0.004 0.004 0.004 0.004
[4,] 0.004 0.004 0.004 0.004

    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}55}]:} params\PY{o}{\PYZdl{}}gene\PYZus{}cor \PY{o}{=} \PY{k+kp}{t}\PY{p}{(}\PY{k+kp}{do.call}\PY{p}{(}\PY{k+kp}{rbind}\PY{p}{,}\PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}\PY{k+kp}{length}\PY{p}{(}data\PY{p}{)}\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} params\PY{o}{\PYZdl{}}beta\PYZus{}cor\PY{p}{[[}x\PY{p}{]]}\PY{p}{[}\PY{l+m}{2}\PY{p}{,}\PY{l+m}{1}\PY{p}{]}\PY{p}{)}\PY{p}{)}\PY{p}{)}
         temp \PY{o}{=} \PY{k+kt}{array}\PY{p}{(}\PY{l+m}{0}\PY{p}{,}\PY{k+kp}{length}\PY{p}{(}data\PY{p}{)}\PY{p}{)}
         \PY{k+kr}{for}\PY{p}{(}i \PY{k+kr}{in} \PY{l+m}{1}\PY{o}{:}\PY{k+kp}{length}\PY{p}{(}data\PY{p}{)}\PY{p}{)}\PY{p}{\PYZob{}}
             cor\PYZus{}act \PY{o}{=} cor\PY{p}{(}data\PY{p}{[[}i\PY{p}{]]}\PY{o}{\PYZdl{}}X \PY{o}{\PYZpc{}*\PYZpc{}} \PY{k+kp}{t}\PY{p}{(}data\PY{p}{[[}i\PY{p}{]]}\PY{o}{\PYZdl{}}\PY{k+kp}{beta}\PY{p}{)}\PY{p}{)}
             \PY{k+kp}{diag}\PY{p}{(}cor\PYZus{}act\PY{p}{)} \PY{o}{=} params\PY{o}{\PYZdl{}}gene\PYZus{}cor\PY{p}{[}i\PY{p}{]}
             temp\PY{p}{[}i\PY{p}{]} \PY{o}{=} \PY{k+kp}{signif}\PY{p}{(}\PY{k+kp}{mean}\PY{p}{(}cor\PYZus{}act\PY{p}{)}\PY{p}{,}\PY{l+m}{3}\PY{p}{)}
             \PY{k+kp}{print}\PY{p}{(}\PY{k+kp}{paste}\PY{p}{(}temp\PY{p}{[}i\PY{p}{]}\PY{p}{,}\PY{k+kp}{signif}\PY{p}{(}params\PY{o}{\PYZdl{}}gene\PYZus{}cor\PY{p}{[}i\PY{p}{]}\PY{p}{,}\PY{l+m}{3}\PY{p}{)}\PY{p}{)}\PY{p}{)}
         \PY{p}{\PYZcb{}}
         params\PY{o}{\PYZdl{}}gene\PYZus{}cor\PYZus{}real \PY{o}{=} temp
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
[1] "0.00328 0"
[1] "0.0725 0.0556"
[1] "0.119 0.111"
[1] "0.184 0.167"
[1] "0.23 0.222"
[1] "0.301 0.278"
[1] "0.342 0.333"
[1] "0.403 0.389"
[1] "0.451 0.444"
[1] "0.498 0.5"

    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}56}]:} \PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}\PY{k+kp}{length}\PY{p}{(}data\PY{p}{)}\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} cor\PY{p}{(}data\PY{p}{[[}x\PY{p}{]]}\PY{o}{\PYZdl{}}Z\PY{p}{)}\PY{p}{)}
         \PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}\PY{k+kp}{length}\PY{p}{(}data\PY{p}{)}\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} cor\PY{p}{(}data\PY{p}{[[}x\PY{p}{]]}\PY{o}{\PYZdl{}}X\PY{o}{\PYZpc{}*\PYZpc{}}\PY{k+kp}{t}\PY{p}{(}data\PY{p}{[[}x\PY{p}{]]}\PY{o}{\PYZdl{}}\PY{k+kp}{beta}\PY{p}{)}\PY{p}{)}\PY{p}{)}
         \PY{c+c1}{\PYZsh{} lapply(1:length(data),function(x) cor(params\PYZdl{}c1\PYZpc{}*\PYZpc{}t(data[[x]]\PYZdl{}gamma\PYZus{}c1)))}
\end{Verbatim}


    \begin{enumerate}
\item A matrix: 4 × 4 of type dbl
\begin{tabular}{r|llll}
  & Cell\_type1 & Cell\_type2 & Cell\_type3 & Cell\_type4\\
\hline
	Cell\_type1 &  1.000000000 & -0.008774358 & -0.00495438 & -0.01106592\\
	Cell\_type2 & -0.008774358 &  1.000000000 &  0.00627968 &  0.02154489\\
	Cell\_type3 & -0.004954380 &  0.006279680 &  1.00000000 & -0.04008659\\
	Cell\_type4 & -0.011065916 &  0.021544886 & -0.04008659 &  1.00000000\\
\end{tabular}

\item A matrix: 4 × 4 of type dbl
\begin{tabular}{r|llll}
  & Cell\_type1 & Cell\_type2 & Cell\_type3 & Cell\_type4\\
\hline
	Cell\_type1 &  1.000000000 & -0.005057005 & 0.04490835 & 0.04525581\\
	Cell\_type2 & -0.005057005 &  1.000000000 & 0.02821963 & 0.07066990\\
	Cell\_type3 &  0.044908347 &  0.028219627 & 1.00000000 & 0.05147322\\
	Cell\_type4 &  0.045255807 &  0.070669901 & 0.05147322 & 1.00000000\\
\end{tabular}

\item A matrix: 4 × 4 of type dbl
\begin{tabular}{r|llll}
  & Cell\_type1 & Cell\_type2 & Cell\_type3 & Cell\_type4\\
\hline
	Cell\_type1 & 1.00000000 & 0.03449340 & 0.04610938 & 0.07359739\\
	Cell\_type2 & 0.03449340 & 1.00000000 & 0.05106789 & 0.08648892\\
	Cell\_type3 & 0.04610938 & 0.05106789 & 1.00000000 & 0.06268790\\
	Cell\_type4 & 0.07359739 & 0.08648892 & 0.06268790 & 1.00000000\\
\end{tabular}

\item A matrix: 4 × 4 of type dbl
\begin{tabular}{r|llll}
  & Cell\_type1 & Cell\_type2 & Cell\_type3 & Cell\_type4\\
\hline
	Cell\_type1 & 1.0000000 & 0.06713720 & 0.07713880 & 0.1130286\\
	Cell\_type2 & 0.0671372 & 1.00000000 & 0.08434666 & 0.1171366\\
	Cell\_type3 & 0.0771388 & 0.08434666 & 1.00000000 & 0.1074489\\
	Cell\_type4 & 0.1130286 & 0.11713663 & 0.10744885 & 1.0000000\\
\end{tabular}

\item A matrix: 4 × 4 of type dbl
\begin{tabular}{r|llll}
  & Cell\_type1 & Cell\_type2 & Cell\_type3 & Cell\_type4\\
\hline
	Cell\_type1 & 1.00000000 & 0.06800655 & 0.06922313 & 0.1416902\\
	Cell\_type2 & 0.06800655 & 1.00000000 & 0.12815907 & 0.1388506\\
	Cell\_type3 & 0.06922313 & 0.12815907 & 1.00000000 & 0.1214404\\
	Cell\_type4 & 0.14169016 & 0.13885056 & 0.12144042 & 1.0000000\\
\end{tabular}

\item A matrix: 4 × 4 of type dbl
\begin{tabular}{r|llll}
  & Cell\_type1 & Cell\_type2 & Cell\_type3 & Cell\_type4\\
\hline
	Cell\_type1 & 1.00000000 & 0.09634105 & 0.1336270 & 0.1720471\\
	Cell\_type2 & 0.09634105 & 1.00000000 & 0.1445335 & 0.1941880\\
	Cell\_type3 & 0.13362698 & 0.14453351 & 1.0000000 & 0.1728379\\
	Cell\_type4 & 0.17204709 & 0.19418800 & 0.1728379 & 1.0000000\\
\end{tabular}

\item A matrix: 4 × 4 of type dbl
\begin{tabular}{r|llll}
  & Cell\_type1 & Cell\_type2 & Cell\_type3 & Cell\_type4\\
\hline
	Cell\_type1 & 1.0000000 & 0.1173949 & 0.1563684 & 0.2051605\\
	Cell\_type2 & 0.1173949 & 1.0000000 & 0.1690917 & 0.2065798\\
	Cell\_type3 & 0.1563684 & 0.1690917 & 1.0000000 & 0.1783519\\
	Cell\_type4 & 0.2051605 & 0.2065798 & 0.1783519 & 1.0000000\\
\end{tabular}

\item A matrix: 4 × 4 of type dbl
\begin{tabular}{r|llll}
  & Cell\_type1 & Cell\_type2 & Cell\_type3 & Cell\_type4\\
\hline
	Cell\_type1 & 1.0000000 & 0.1528799 & 0.1711256 & 0.2444181\\
	Cell\_type2 & 0.1528799 & 1.0000000 & 0.2250085 & 0.2284560\\
	Cell\_type3 & 0.1711256 & 0.2250085 & 1.0000000 & 0.2048144\\
	Cell\_type4 & 0.2444181 & 0.2284560 & 0.2048144 & 1.0000000\\
\end{tabular}

\item A matrix: 4 × 4 of type dbl
\begin{tabular}{r|llll}
  & Cell\_type1 & Cell\_type2 & Cell\_type3 & Cell\_type4\\
\hline
	Cell\_type1 & 1.0000000 & 0.1696397 & 0.2059517 & 0.2659920\\
	Cell\_type2 & 0.1696397 & 1.0000000 & 0.2435473 & 0.2474968\\
	Cell\_type3 & 0.2059517 & 0.2435473 & 1.0000000 & 0.2388641\\
	Cell\_type4 & 0.2659920 & 0.2474968 & 0.2388641 & 1.0000000\\
\end{tabular}

\item A matrix: 4 × 4 of type dbl
\begin{tabular}{r|llll}
  & Cell\_type1 & Cell\_type2 & Cell\_type3 & Cell\_type4\\
\hline
	Cell\_type1 & 1.0000000 & 0.1852143 & 0.2046392 & 0.2970363\\
	Cell\_type2 & 0.1852143 & 1.0000000 & 0.2496931 & 0.2836071\\
	Cell\_type3 & 0.2046392 & 0.2496931 & 1.0000000 & 0.2468234\\
	Cell\_type4 & 0.2970363 & 0.2836071 & 0.2468234 & 1.0000000\\
\end{tabular}

\end{enumerate}


    
    \begin{enumerate}
\item A matrix: 4 × 4 of type dbl
\begin{tabular}{llll}
	  1.000000000 & 0.002289842 & -0.001864556 &  0.02211653\\
	  0.002289842 & 1.000000000 &  0.039548699 &  0.03978192\\
	 -0.001864556 & 0.039548699 &  1.000000000 & -0.07563841\\
	  0.022116530 & 0.039781920 & -0.075638410 &  1.00000000\\
\end{tabular}

\item A matrix: 4 × 4 of type dbl
\begin{tabular}{llll}
	 1.00000000 & 0.02326817 & 0.06416324 & 0.07521895\\
	 0.02326817 & 1.00000000 & 0.07335991 & 0.12549054\\
	 0.06416324 & 0.07335991 & 1.00000000 & 0.10749218\\
	 0.07521895 & 0.12549054 & 0.10749218 & 1.00000000\\
\end{tabular}

\item A matrix: 4 × 4 of type dbl
\begin{tabular}{llll}
	 1.00000000 & 0.1027956 & 0.09144727 & 0.1288701\\
	 0.10279565 & 1.0000000 & 0.10778292 & 0.1477207\\
	 0.09144727 & 0.1077829 & 1.00000000 & 0.1499510\\
	 0.12887007 & 0.1477207 & 0.14995103 & 1.0000000\\
\end{tabular}

\item A matrix: 4 × 4 of type dbl
\begin{tabular}{llll}
	 1.0000000 & 0.1528732 & 0.1535678 & 0.2084219\\
	 0.1528732 & 1.0000000 & 0.1786212 & 0.2156668\\
	 0.1535678 & 0.1786212 & 1.0000000 & 0.2294313\\
	 0.2084219 & 0.2156668 & 0.2294313 & 1.0000000\\
\end{tabular}

\item A matrix: 4 × 4 of type dbl
\begin{tabular}{llll}
	 1.0000000 & 0.1670924 & 0.1577132 & 0.2782752\\
	 0.1670924 & 1.0000000 & 0.2497392 & 0.2624882\\
	 0.1577132 & 0.2497392 & 1.0000000 & 0.2790718\\
	 0.2782752 & 0.2624882 & 0.2790718 & 1.0000000\\
\end{tabular}

\item A matrix: 4 × 4 of type dbl
\begin{tabular}{llll}
	 1.0000000 & 0.2133726 & 0.2786246 & 0.3290599\\
	 0.2133726 & 1.0000000 & 0.3043185 & 0.3615313\\
	 0.2786246 & 0.3043185 & 1.0000000 & 0.3670588\\
	 0.3290599 & 0.3615313 & 0.3670588 & 1.0000000\\
\end{tabular}

\item A matrix: 4 × 4 of type dbl
\begin{tabular}{llll}
	 1.0000000 & 0.2431734 & 0.3097100 & 0.3856408\\
	 0.2431734 & 1.0000000 & 0.3437067 & 0.3932945\\
	 0.3097100 & 0.3437067 & 1.0000000 & 0.3972763\\
	 0.3856408 & 0.3932945 & 0.3972763 & 1.0000000\\
\end{tabular}

\item A matrix: 4 × 4 of type dbl
\begin{tabular}{llll}
	 1.0000000 & 0.3190876 & 0.3182576 & 0.4957096\\
	 0.3190876 & 1.0000000 & 0.4402766 & 0.4527890\\
	 0.3182576 & 0.4402766 & 1.0000000 & 0.4220161\\
	 0.4957096 & 0.4527890 & 0.4220161 & 1.0000000\\
\end{tabular}

\item A matrix: 4 × 4 of type dbl
\begin{tabular}{llll}
	 1.0000000 & 0.3457115 & 0.3862223 & 0.5345910\\
	 0.3457115 & 1.0000000 & 0.4812647 & 0.4973188\\
	 0.3862223 & 0.4812647 & 1.0000000 & 0.4765402\\
	 0.5345910 & 0.4973188 & 0.4765402 & 1.0000000\\
\end{tabular}

\item A matrix: 4 × 4 of type dbl
\begin{tabular}{llll}
	 1.0000000 & 0.3711668 & 0.4469332 & 0.5756336\\
	 0.3711668 & 1.0000000 & 0.5082334 & 0.5446554\\
	 0.4469332 & 0.5082334 & 1.0000000 & 0.5336249\\
	 0.5756336 & 0.5446554 & 0.5336249 & 1.0000000\\
\end{tabular}

\end{enumerate}


    
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}57}]:} \PY{c+c1}{\PYZsh{} do TCA\PYZhy{}TWAS for every gene}
         prop \PY{o}{=} \PY{l+m}{0.7}
         t\PYZus{}prop \PY{o}{=} \PY{k+kp}{floor}\PY{p}{(}prop\PY{o}{*}params\PY{o}{\PYZdl{}}N\PY{p}{)}
         li \PY{o}{=} \PY{k+kt}{list}\PY{p}{(}\PY{p}{)}
         \PY{k+kr}{for}\PY{p}{(}g \PY{k+kr}{in} \PY{l+m}{1}\PY{o}{:}\PY{k+kp}{length}\PY{p}{(}data\PY{p}{)}\PY{p}{)}\PY{p}{\PYZob{}}
             \PY{k+kp}{print}\PY{p}{(}\PY{k+kp}{paste}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{gene\PYZsq{}}\PY{p}{,}g\PY{p}{,}sep\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZus{}\PYZsq{}}\PY{p}{)}\PY{p}{)}
             train\PYZus{}X \PY{o}{=} \PY{p}{(}data\PY{p}{[[}g\PY{p}{]]}\PY{o}{\PYZdl{}}X\PY{p}{)}\PY{p}{[}\PY{l+m}{1}\PY{o}{:}t\PYZus{}prop\PY{p}{,}\PY{p}{]}
             test\PYZus{}X \PY{o}{=} data\PY{p}{[[}g\PY{p}{]]}\PY{o}{\PYZdl{}}X\PY{p}{[}\PY{p}{(}t\PYZus{}prop\PY{l+m}{+1}\PY{p}{)}\PY{o}{:}params\PY{o}{\PYZdl{}}N\PY{p}{,}\PY{p}{]}
             train\PYZus{}W \PY{o}{=} params\PY{o}{\PYZdl{}}W\PY{p}{[}\PY{l+m}{1}\PY{o}{:}t\PYZus{}prop\PY{p}{,}\PY{p}{]}
             test\PYZus{}W \PY{o}{=} params\PY{o}{\PYZdl{}}W\PY{p}{[}\PY{p}{(}t\PYZus{}prop\PY{l+m}{+1}\PY{p}{)}\PY{o}{:}params\PY{o}{\PYZdl{}}N\PY{p}{,}\PY{p}{]}
             train\PYZus{}G \PY{o}{=} data\PY{p}{[[}g\PY{p}{]]}\PY{o}{\PYZdl{}}G\PY{p}{[}\PY{p}{,}\PY{l+m}{1}\PY{o}{:}t\PYZus{}prop\PY{p}{]}
             test\PYZus{}G \PY{o}{=} data\PY{p}{[[}g\PY{p}{]]}\PY{o}{\PYZdl{}}G\PY{p}{[}\PY{p}{,}\PY{p}{(}t\PYZus{}prop\PY{l+m}{+1}\PY{p}{)}\PY{o}{:}params\PY{o}{\PYZdl{}}N\PY{p}{]}
             train\PYZus{}c1 \PY{o}{=} params\PY{o}{\PYZdl{}}c1\PY{p}{[}\PY{l+m}{1}\PY{o}{:}t\PYZus{}prop\PY{p}{,}\PY{p}{]}
             test\PYZus{}c1 \PY{o}{=} params\PY{o}{\PYZdl{}}c1\PY{p}{[}\PY{p}{(}t\PYZus{}prop\PY{l+m}{+1}\PY{p}{)}\PY{o}{:}params\PY{o}{\PYZdl{}}N\PY{p}{,}\PY{p}{]}
             train\PYZus{}c2 \PY{o}{=} params\PY{o}{\PYZdl{}}c2\PY{p}{[}\PY{l+m}{1}\PY{o}{:}t\PYZus{}prop\PY{p}{,}\PY{p}{]}
             test\PYZus{}c2 \PY{o}{=} params\PY{o}{\PYZdl{}}c2\PY{p}{[}\PY{p}{(}t\PYZus{}prop\PY{l+m}{+1}\PY{p}{)}\PY{o}{:}params\PY{o}{\PYZdl{}}N\PY{p}{,}\PY{p}{]}
             train\PYZus{}Z \PY{o}{=} data\PY{p}{[[}g\PY{p}{]]}\PY{o}{\PYZdl{}}Z\PY{p}{[}\PY{l+m}{1}\PY{o}{:}t\PYZus{}prop\PY{p}{,}\PY{p}{]}
             test\PYZus{}Z \PY{o}{=} data\PY{p}{[[}g\PY{p}{]]}\PY{o}{\PYZdl{}}Z\PY{p}{[}\PY{p}{(}t\PYZus{}prop\PY{l+m}{+1}\PY{p}{)}\PY{o}{:}params\PY{o}{\PYZdl{}}N\PY{p}{,}\PY{p}{]}
             beta \PY{o}{=} data\PY{p}{[[}g\PY{p}{]]}\PY{o}{\PYZdl{}}\PY{k+kp}{beta}
             gamma\PYZus{}c1 \PY{o}{=} data\PY{p}{[[}g\PY{p}{]]}\PY{o}{\PYZdl{}}gamma\PYZus{}c1
             gamma\PYZus{}c2 \PY{o}{=} data\PY{p}{[[}g\PY{p}{]]}\PY{o}{\PYZdl{}}gamma\PYZus{}c2
             tca.mdl1 \PY{o}{=} tca\PY{p}{(}X\PY{o}{=}train\PYZus{}G\PY{p}{,}W\PY{o}{=}train\PYZus{}W\PY{p}{,}C1\PY{o}{=}\PY{k+kp}{cbind}\PY{p}{(}train\PYZus{}X\PY{p}{,}train\PYZus{}c1\PY{p}{)}\PY{p}{,}verbose\PY{o}{=}\PY{k+kc}{FALSE}\PY{p}{)}
             tca.mdl2 \PY{o}{=} tca\PY{p}{(}X\PY{o}{=}train\PYZus{}G\PY{p}{,}W\PY{o}{=}train\PYZus{}W\PY{p}{,}C1\PY{o}{=}train\PYZus{}c1\PY{p}{,}verbose\PY{o}{=}\PY{k+kc}{FALSE}\PY{p}{)}
             tca.mdl1.summary \PY{o}{=} summary\PYZus{}statistics\PY{p}{(}mdl\PY{o}{=}tca.mdl1\PY{p}{,}train\PYZus{}X\PY{o}{=}train\PYZus{}X\PY{p}{,}test\PYZus{}X\PY{o}{=}test\PYZus{}X\PY{p}{,}
                                                   train\PYZus{}c1\PY{o}{=}train\PYZus{}c1\PY{p}{,}test\PYZus{}c1\PY{o}{=}test\PYZus{}c1\PY{p}{,}train\PYZus{}G\PY{o}{=}train\PYZus{}G\PY{p}{,}
                                                   test\PYZus{}G\PY{o}{=}test\PYZus{}G\PY{p}{,}train\PYZus{}Z\PY{o}{=}train\PYZus{}Z\PY{p}{,}test\PYZus{}Z\PY{o}{=}test\PYZus{}Z\PY{p}{,}
                                                   beta\PY{o}{=}\PY{k+kp}{beta}\PY{p}{,}gamma\PYZus{}c1\PY{o}{=}gamma\PYZus{}c1\PY{p}{,}gamma\PYZus{}c2\PY{o}{=}gamma\PYZus{}c2\PY{p}{,}model\PY{o}{=}\PY{l+m}{1}\PY{p}{)}
             tca.mdl2.summary \PY{o}{=} summary\PYZus{}statistics\PY{p}{(}mdl\PY{o}{=}tca.mdl2\PY{p}{,}train\PYZus{}X\PY{o}{=}train\PYZus{}X\PY{p}{,}test\PYZus{}X\PY{o}{=}test\PYZus{}X\PY{p}{,}
                                                   train\PYZus{}c1\PY{o}{=}train\PYZus{}c1\PY{p}{,}test\PYZus{}c1\PY{o}{=}test\PYZus{}c1\PY{p}{,}train\PYZus{}G\PY{o}{=}train\PYZus{}G\PY{p}{,}
                                                   test\PYZus{}G\PY{o}{=}test\PYZus{}G\PY{p}{,}train\PYZus{}Z\PY{o}{=}train\PYZus{}Z\PY{p}{,}test\PYZus{}Z\PY{o}{=}test\PYZus{}Z\PY{p}{,}
                                                   beta\PY{o}{=}\PY{k+kp}{beta}\PY{p}{,}gamma\PYZus{}c1\PY{o}{=}gamma\PYZus{}c1\PY{p}{,}gamma\PYZus{}c2\PY{o}{=}gamma\PYZus{}c2\PY{p}{,}model\PY{o}{=}\PY{l+m}{2}\PY{p}{)}
             li\PY{p}{[[}g\PY{p}{]]} \PY{o}{=} \PY{k+kt}{list}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{s1\PYZsq{}}\PY{o}{=}tca.mdl1.summary\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{s2\PYZsq{}}\PY{o}{=}tca.mdl2.summary\PY{p}{)}
         \PY{p}{\PYZcb{}}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
[1] "gene\_1"
[1] "gene\_2"
[1] "gene\_3"
[1] "gene\_4"
[1] "gene\_5"
[1] "gene\_6"
[1] "gene\_7"
[1] "gene\_8"
[1] "gene\_9"
[1] "gene\_10"

    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}58}]:} mean\PYZus{}weight \PY{o}{=} \PY{k+kp}{signif}\PY{p}{(}\PY{k+kp}{apply}\PY{p}{(}params\PY{o}{\PYZdl{}}W\PY{p}{,}\PY{l+m}{2}\PY{p}{,}\PY{k+kp}{mean}\PY{p}{)}\PY{p}{,}digits\PY{o}{=}\PY{l+m}{3}\PY{p}{)}
         Z\PYZus{}hat\PYZus{}cor\PYZus{}tca1 \PY{o}{=} \PY{k+kp}{do.call}\PY{p}{(}\PY{k+kp}{rbind}\PY{p}{,}\PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}\PY{k+kp}{length}\PY{p}{(}data\PY{p}{)}\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} li\PY{p}{[[}x\PY{p}{]]}\PY{o}{\PYZdl{}}s1\PY{o}{\PYZdl{}}Z\PYZus{}hat\PYZus{}cor\PYZus{}tca\PY{p}{)}\PY{p}{)}
         Z\PYZus{}hat\PYZus{}cor\PYZus{}tca2 \PY{o}{=} \PY{k+kp}{do.call}\PY{p}{(}\PY{k+kp}{rbind}\PY{p}{,}\PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}\PY{k+kp}{length}\PY{p}{(}data\PY{p}{)}\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} li\PY{p}{[[}x\PY{p}{]]}\PY{o}{\PYZdl{}}s2\PY{o}{\PYZdl{}}Z\PYZus{}hat\PYZus{}cor\PYZus{}tca\PY{p}{)}\PY{p}{)}                                      
         
         par\PY{p}{(}mfrow\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{2}\PY{p}{,}\PY{l+m}{2}\PY{p}{)}\PY{p}{,}mar\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{4}\PY{p}{,} \PY{l+m}{3.8}\PY{p}{,} \PY{l+m}{4}\PY{p}{,} \PY{l+m}{2}\PY{p}{)} \PY{o}{+} \PY{l+m}{0.1}\PY{p}{)}
         opts\PY{o}{=}params\PY{o}{\PYZdl{}}cell\PYZus{}name
         \PY{k+kr}{for}\PY{p}{(}i \PY{k+kr}{in} \PY{l+m}{1}\PY{o}{:}\PY{k+kp}{length}\PY{p}{(}params\PY{o}{\PYZdl{}}cell\PYZus{}name\PY{p}{)}\PY{p}{)}\PY{p}{\PYZob{}}
             heading \PY{o}{=} \PY{k+kp}{paste}\PY{p}{(}opts\PY{p}{[}i\PY{p}{]}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{mean weight\PYZsq{}}\PY{p}{,}mean\PYZus{}weight\PY{p}{[}i\PY{p}{]}\PY{p}{,}sep\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{ \PYZsq{}}\PY{p}{)}
             plot\PY{p}{(}params\PY{o}{\PYZdl{}}gene\PYZus{}cor\PY{p}{,}Z\PYZus{}hat\PYZus{}cor\PYZus{}tca1\PY{p}{[}\PY{p}{,}i\PY{p}{]}\PY{p}{,}xlab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{genetic cor of gene\PYZsq{}}\PY{p}{,}
                  ylab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{cor\PYZsq{}}\PY{p}{,}cex.lab\PY{o}{=}\PY{l+m}{1.2}\PY{p}{,}ylim\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{1}\PY{p}{)}\PY{p}{,}yaxs\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{r\PYZsq{}}\PY{p}{,}type\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{o\PYZsq{}}\PY{p}{,}col\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{red\PYZsq{}}\PY{p}{)}
             title\PY{p}{(}main\PY{o}{=}heading\PY{p}{,}font.main\PY{o}{=}\PY{l+m}{2}\PY{p}{,}cex.main\PY{o}{=}\PY{l+m}{1}\PY{p}{,}line\PY{o}{=}\PY{l+m}{1}\PY{p}{,}cex.lab\PY{o}{=}\PY{l+m}{1}\PY{p}{)}
             lines\PY{p}{(}params\PY{o}{\PYZdl{}}gene\PYZus{}cor\PY{p}{,}Z\PYZus{}hat\PYZus{}cor\PYZus{}tca2\PY{p}{[}\PY{p}{,}i\PY{p}{]}\PY{p}{,}col\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{green\PYZsq{}}\PY{p}{,}type\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{o\PYZsq{}}\PY{p}{)}
             
         \PY{p}{\PYZcb{}}
         mtext\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{TCA\PYZsq{}s Z\PYZus{}hat \PYZlt{}Cor\PYZgt{} Ground truth train Z\PYZdq{}}\PY{p}{,}side\PY{o}{=}\PY{l+m}{3}\PY{p}{,}adj\PY{o}{=}\PY{l+m}{6}\PY{p}{,}cex\PY{o}{=}\PY{l+m}{0.9}\PY{p}{,}line\PY{o}{=}\PY{l+m}{24}\PY{p}{,}font\PY{o}{=}\PY{l+m}{2}\PY{p}{)}
         par\PY{p}{(}mfrow\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{2}\PY{p}{,}\PY{l+m}{1}\PY{p}{)}\PY{p}{,}mar\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{0}\PY{p}{)}\PY{p}{)}
         plot\PY{p}{(}\PY{l+m}{1}\PY{p}{,}type\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{n\PYZsq{}}\PY{p}{,}axes\PY{o}{=}\PY{k+kc}{FALSE}\PY{p}{,}xlab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZsq{}}\PY{p}{,}ylab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZsq{}}\PY{p}{)}
         legend\PY{p}{(}x\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{top\PYZsq{}}\PY{p}{,}inset\PY{o}{=}\PY{l+m}{0}\PY{p}{,}legend\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{mdl1:SNPs+C1\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{mdl2:C1\PYZsq{}}\PY{p}{)}\PY{p}{,}
                col\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{red\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{green\PYZsq{}}\PY{p}{)}\PY{p}{,}lwd\PY{o}{=}\PY{l+m}{2}\PY{p}{,}cex\PY{o}{=}\PY{l+m}{0.7}\PY{p}{,}horiz\PY{o}{=}\PY{k+kc}{TRUE}\PY{p}{)}
\end{Verbatim}


    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_9_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_9_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}59}]:} beta\PYZus{}hat\PYZus{}cor\PYZus{}tca \PY{o}{=} \PY{k+kp}{do.call}\PY{p}{(}\PY{k+kp}{rbind}\PY{p}{,}\PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}\PY{k+kp}{length}\PY{p}{(}data\PY{p}{)}\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} \PY{k+kp}{unlist}\PY{p}{(}li\PY{p}{[[}x\PY{p}{]]}\PY{o}{\PYZdl{}}s1\PY{o}{\PYZdl{}}beta\PYZus{}hat\PYZus{}cor\PYZus{}tca\PY{p}{)}\PY{p}{)}\PY{p}{)}
         \PY{k+kp}{colnames}\PY{p}{(}beta\PYZus{}hat\PYZus{}cor\PYZus{}tca\PY{p}{)} \PY{o}{=} \PY{k+kp}{paste}\PY{p}{(}params\PY{o}{\PYZdl{}}cell\PYZus{}name\PY{p}{,}mean\PYZus{}weight\PY{p}{,}sep\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZbs{}n\PYZsq{}}\PY{p}{)}
         cor\PYZus{}beta\PYZus{}lasso\PYZus{}real1 \PY{o}{=} \PY{k+kp}{do.call}\PY{p}{(}\PY{k+kp}{rbind}\PY{p}{,}\PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}\PY{k+kp}{length}\PY{p}{(}data\PY{p}{)}\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} li\PY{p}{[[}x\PY{p}{]]}\PY{o}{\PYZdl{}}s1\PY{o}{\PYZdl{}}cor\PYZus{}beta\PYZus{}lasso\PYZus{}real\PY{p}{)}\PY{p}{)}
         cor\PYZus{}beta\PYZus{}lasso\PYZus{}real2 \PY{o}{=} \PY{k+kp}{do.call}\PY{p}{(}\PY{k+kp}{rbind}\PY{p}{,}\PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}\PY{k+kp}{length}\PY{p}{(}data\PY{p}{)}\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} li\PY{p}{[[}x\PY{p}{]]}\PY{o}{\PYZdl{}}s2\PY{o}{\PYZdl{}}cor\PYZus{}beta\PYZus{}lasso\PYZus{}real\PY{p}{)}\PY{p}{)}
         \PY{c+c1}{\PYZsh{}colnames(cor\PYZus{}beta\PYZus{}lasso\PYZus{}real1) = paste(params\PYZdl{}cell\PYZus{}name,mean\PYZus{}weight,sep=\PYZsq{}\PYZbs{}n\PYZsq{})}
         \PY{c+c1}{\PYZsh{}colnames(cor\PYZus{}beta\PYZus{}lasso\PYZus{}real2) = paste(params\PYZdl{}cell\PYZus{}name,mean\PYZus{}weight,sep=\PYZsq{}\PYZbs{}n\PYZsq{})}
         \PY{c+c1}{\PYZsh{} Cell type weight and correlation}
         par\PY{p}{(}cex.axis\PY{o}{=}\PY{l+m}{.8}\PY{p}{)}
         boxplot\PY{p}{(}beta\PYZus{}hat\PYZus{}cor\PYZus{}tca\PY{p}{,}ylab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{correlation\PYZsq{}}\PY{p}{,}
                 xlab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{Each dot being correlation of real/estimated beta of length n*1\PYZsq{}}\PY{p}{,}
                 boxwex\PY{o}{=}\PY{l+m}{0.5}\PY{p}{,}main\PY{o}{=}\PY{l+s}{\PYZdq{}}\PY{l+s}{TCA\PYZsq{}s beta\PYZus{}hat \PYZlt{}Cor\PYZgt{} Ground truth beta\PYZdq{}}\PY{p}{)}
         \PY{c+c1}{\PYZsh{} Heritibility and correlation}
         par\PY{p}{(}mfrow\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{2}\PY{p}{,}\PY{l+m}{2}\PY{p}{)}\PY{p}{,}mar\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{4}\PY{p}{,} \PY{l+m}{3.8}\PY{p}{,} \PY{l+m}{4}\PY{p}{,} \PY{l+m}{2}\PY{p}{)} \PY{o}{+} \PY{l+m}{0.1}\PY{p}{)}
         opts\PY{o}{=}params\PY{o}{\PYZdl{}}cell\PYZus{}name
         \PY{k+kr}{for}\PY{p}{(}i \PY{k+kr}{in} \PY{l+m}{1}\PY{o}{:}\PY{k+kp}{length}\PY{p}{(}params\PY{o}{\PYZdl{}}cell\PYZus{}name\PY{p}{)}\PY{p}{)}\PY{p}{\PYZob{}}
             heading \PY{o}{=} \PY{k+kp}{paste}\PY{p}{(}opts\PY{p}{[}i\PY{p}{]}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{mean weight\PYZsq{}}\PY{p}{,}mean\PYZus{}weight\PY{p}{[}i\PY{p}{]}\PY{p}{,}sep\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{ \PYZsq{}}\PY{p}{)}
             plot\PY{p}{(}params\PY{o}{\PYZdl{}}gene\PYZus{}cor\PY{p}{,}beta\PYZus{}hat\PYZus{}cor\PYZus{}tca\PY{p}{[}\PY{p}{,}i\PY{p}{]}\PY{p}{,}xlab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{genetic cor of gene\PYZsq{}}\PY{p}{,}
                  ylab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{cor\PYZsq{}}\PY{p}{,}cex.lab\PY{o}{=}\PY{l+m}{1.2}\PY{p}{,}ylim\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{1}\PY{p}{)}\PY{p}{,}yaxs\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{r\PYZsq{}}\PY{p}{,}type\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{o\PYZsq{}}\PY{p}{,}col\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{red\PYZsq{}}\PY{p}{)}
             lines\PY{p}{(}params\PY{o}{\PYZdl{}}gene\PYZus{}cor\PY{p}{,}cor\PYZus{}beta\PYZus{}lasso\PYZus{}real1\PY{p}{[}\PY{p}{,}i\PY{p}{]}\PY{p}{,}type\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{o\PYZsq{}}\PY{p}{,}col\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{green\PYZsq{}}\PY{p}{)}
             lines\PY{p}{(}params\PY{o}{\PYZdl{}}gene\PYZus{}cor\PY{p}{,}cor\PYZus{}beta\PYZus{}lasso\PYZus{}real2\PY{p}{[}\PY{p}{,}i\PY{p}{]}\PY{p}{,}type\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{o\PYZsq{}}\PY{p}{,}col\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{forestgreen\PYZsq{}}\PY{p}{)}
             title\PY{p}{(}main\PY{o}{=}heading\PY{p}{,}font.main\PY{o}{=}\PY{l+m}{2}\PY{p}{,}cex.main\PY{o}{=}\PY{l+m}{1}\PY{p}{,}line\PY{o}{=}\PY{l+m}{1}\PY{p}{,}cex.lab\PY{o}{=}\PY{l+m}{1}\PY{p}{)}
         \PY{p}{\PYZcb{}}
         mtext\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{Estimated beta\PYZus{}hat \PYZlt{}Cor\PYZgt{} Ground truth beta hat\PYZdq{}}\PY{p}{,}side\PY{o}{=}\PY{l+m}{3}\PY{p}{,}adj\PY{o}{=}\PY{l+m}{2}\PY{p}{,}cex\PY{o}{=}\PY{l+m}{0.9}\PY{p}{,}line\PY{o}{=}\PY{l+m}{24}\PY{p}{,}font\PY{o}{=}\PY{l+m}{2}\PY{p}{)}
         par\PY{p}{(}mfrow\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{2}\PY{p}{,}\PY{l+m}{1}\PY{p}{)}\PY{p}{,}mar\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{0}\PY{p}{)}\PY{p}{)}
         plot\PY{p}{(}\PY{l+m}{1}\PY{p}{,}type\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{n\PYZsq{}}\PY{p}{,}axes\PY{o}{=}\PY{k+kc}{FALSE}\PY{p}{,}xlab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZsq{}}\PY{p}{,}ylab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZsq{}}\PY{p}{)}
         legend\PY{p}{(}x\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{top\PYZsq{}}\PY{p}{,}inset\PY{o}{=}\PY{l+m}{0}\PY{p}{,}legend\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{TCA\PYZsq{}s beta\PYZus{}hat mdl1:SNPs+C1\PYZdq{}}\PY{p}{,}\PY{l+s}{\PYZdq{}}\PY{l+s}{Lasso\PYZsq{}s beta\PYZus{}hat mdl1:SNPs+C1\PYZdq{}}\PY{p}{,}\PY{l+s}{\PYZdq{}}\PY{l+s}{Lasso\PYZsq{}s beta\PYZus{}hat mdl2:C1\PYZdq{}}\PY{p}{)}\PY{p}{,}
                col\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{red\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{green\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{forestgreen\PYZsq{}}\PY{p}{)}\PY{p}{,}lwd\PY{o}{=}\PY{l+m}{2}\PY{p}{,}cex\PY{o}{=}\PY{l+m}{0.7}\PY{p}{,}horiz\PY{o}{=}\PY{k+kc}{TRUE}\PY{p}{)}
\end{Verbatim}


    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_10_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_10_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_10_2.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}60}]:} mean\PYZus{}weight \PY{o}{=} \PY{k+kp}{signif}\PY{p}{(}\PY{k+kp}{apply}\PY{p}{(}params\PY{o}{\PYZdl{}}W\PY{p}{,}\PY{l+m}{2}\PY{p}{,}\PY{k+kp}{mean}\PY{p}{)}\PY{p}{,}digits\PY{o}{=}\PY{l+m}{3}\PY{p}{)}
         Z\PYZus{}hat\PYZus{}cor\PYZus{}tca1 \PY{o}{=} \PY{k+kp}{do.call}\PY{p}{(}\PY{k+kp}{rbind}\PY{p}{,}\PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}\PY{k+kp}{length}\PY{p}{(}data\PY{p}{)}\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} li\PY{p}{[[}x\PY{p}{]]}\PY{o}{\PYZdl{}}s1\PY{o}{\PYZdl{}}Z\PYZus{}hat\PYZus{}cor\PYZus{}tca\PY{p}{)}\PY{p}{)}
         Z\PYZus{}hat\PYZus{}cor\PYZus{}tca2 \PY{o}{=} \PY{k+kp}{do.call}\PY{p}{(}\PY{k+kp}{rbind}\PY{p}{,}\PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}\PY{k+kp}{length}\PY{p}{(}data\PY{p}{)}\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} li\PY{p}{[[}x\PY{p}{]]}\PY{o}{\PYZdl{}}s2\PY{o}{\PYZdl{}}Z\PYZus{}hat\PYZus{}cor\PYZus{}tca\PY{p}{)}\PY{p}{)}                                      
         
         par\PY{p}{(}mfrow\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{2}\PY{p}{,}\PY{l+m}{2}\PY{p}{)}\PY{p}{,}mar\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{4}\PY{p}{,} \PY{l+m}{3.8}\PY{p}{,} \PY{l+m}{4}\PY{p}{,} \PY{l+m}{2}\PY{p}{)} \PY{o}{+} \PY{l+m}{0.1}\PY{p}{)}
         opts\PY{o}{=}params\PY{o}{\PYZdl{}}cell\PYZus{}name
         \PY{k+kr}{for}\PY{p}{(}i \PY{k+kr}{in} \PY{l+m}{1}\PY{o}{:}\PY{k+kp}{length}\PY{p}{(}params\PY{o}{\PYZdl{}}cell\PYZus{}name\PY{p}{)}\PY{p}{)}\PY{p}{\PYZob{}}
             heading \PY{o}{=} \PY{k+kp}{paste}\PY{p}{(}opts\PY{p}{[}i\PY{p}{]}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{mean weight\PYZsq{}}\PY{p}{,}mean\PYZus{}weight\PY{p}{[}i\PY{p}{]}\PY{p}{,}sep\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{ \PYZsq{}}\PY{p}{)}
             plot\PY{p}{(}params\PY{o}{\PYZdl{}}gene\PYZus{}cor\PY{p}{,}Z\PYZus{}hat\PYZus{}cor\PYZus{}tca1\PY{p}{[}\PY{p}{,}i\PY{p}{]}\PY{p}{,}xlab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{genetic cor of gene\PYZsq{}}\PY{p}{,}
                  ylab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{cor\PYZsq{}}\PY{p}{,}cex.lab\PY{o}{=}\PY{l+m}{1.2}\PY{p}{,}ylim\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{1}\PY{p}{)}\PY{p}{,}yaxs\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{r\PYZsq{}}\PY{p}{,}type\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{o\PYZsq{}}\PY{p}{,}col\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{red\PYZsq{}}\PY{p}{)}
             title\PY{p}{(}main\PY{o}{=}heading\PY{p}{,}font.main\PY{o}{=}\PY{l+m}{2}\PY{p}{,}cex.main\PY{o}{=}\PY{l+m}{1}\PY{p}{,}line\PY{o}{=}\PY{l+m}{1}\PY{p}{,}cex.lab\PY{o}{=}\PY{l+m}{1}\PY{p}{)}
             lines\PY{p}{(}params\PY{o}{\PYZdl{}}gene\PYZus{}cor\PY{p}{,}Z\PYZus{}hat\PYZus{}cor\PYZus{}tca2\PY{p}{[}\PY{p}{,}i\PY{p}{]}\PY{p}{,}col\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{green\PYZsq{}}\PY{p}{,}type\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{o\PYZsq{}}\PY{p}{)}
             
         \PY{p}{\PYZcb{}}
         mtext\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{TCA\PYZsq{}s Z\PYZus{}hat \PYZlt{}Cor\PYZgt{} Ground truth train Z\PYZdq{}}\PY{p}{,}side\PY{o}{=}\PY{l+m}{3}\PY{p}{,}adj\PY{o}{=}\PY{l+m}{6}\PY{p}{,}cex\PY{o}{=}\PY{l+m}{0.9}\PY{p}{,}line\PY{o}{=}\PY{l+m}{24}\PY{p}{,}font\PY{o}{=}\PY{l+m}{2}\PY{p}{)}
         par\PY{p}{(}mfrow\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{2}\PY{p}{,}\PY{l+m}{1}\PY{p}{)}\PY{p}{,}mar\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{0}\PY{p}{)}\PY{p}{)}
         plot\PY{p}{(}\PY{l+m}{1}\PY{p}{,}type\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{n\PYZsq{}}\PY{p}{,}axes\PY{o}{=}\PY{k+kc}{FALSE}\PY{p}{,}xlab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZsq{}}\PY{p}{,}ylab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZsq{}}\PY{p}{)}
         legend\PY{p}{(}x\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{top\PYZsq{}}\PY{p}{,}inset\PY{o}{=}\PY{l+m}{0}\PY{p}{,}legend\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{mdl1:SNPs+C1\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{mdl2:C1\PYZsq{}}\PY{p}{)}\PY{p}{,}
                col\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{red\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{green\PYZsq{}}\PY{p}{)}\PY{p}{,}lwd\PY{o}{=}\PY{l+m}{2}\PY{p}{,}cex\PY{o}{=}\PY{l+m}{0.7}\PY{p}{,}horiz\PY{o}{=}\PY{k+kc}{TRUE}\PY{p}{)}
\end{Verbatim}


    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_11_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_11_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}61}]:} gamma\PYZus{}hat\PYZus{}cor\PYZus{}tca1 \PY{o}{=} \PY{k+kp}{do.call}\PY{p}{(}\PY{k+kp}{rbind}\PY{p}{,}\PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}\PY{k+kp}{length}\PY{p}{(}data\PY{p}{)}\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} li\PY{p}{[[}x\PY{p}{]]}\PY{o}{\PYZdl{}}s1\PY{o}{\PYZdl{}}gamma\PYZus{}hat\PYZus{}cor\PYZus{}tca\PY{p}{)}\PY{p}{)}
         gamma\PYZus{}hat\PYZus{}cor\PYZus{}tca2 \PY{o}{=} \PY{k+kp}{do.call}\PY{p}{(}\PY{k+kp}{rbind}\PY{p}{,}\PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}\PY{k+kp}{length}\PY{p}{(}data\PY{p}{)}\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} li\PY{p}{[[}x\PY{p}{]]}\PY{o}{\PYZdl{}}s2\PY{o}{\PYZdl{}}gamma\PYZus{}hat\PYZus{}cor\PYZus{}tca\PY{p}{)}\PY{p}{)}
         gamma\PYZus{}cor \PY{o}{=} \PY{k+kp}{cbind}\PY{p}{(}gamma\PYZus{}hat\PYZus{}cor\PYZus{}tca1\PY{p}{,}gamma\PYZus{}hat\PYZus{}cor\PYZus{}tca2\PY{p}{)}
         \PY{k+kp}{colnames}\PY{p}{(}gamma\PYZus{}cor\PY{p}{)} \PY{o}{=} \PY{k+kt}{c}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{mdl1:SNPs+C1\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{mdl2:C1\PYZsq{}}\PY{p}{)}
         boxplot\PY{p}{(}gamma\PYZus{}cor\PY{p}{,}main\PY{o}{=}\PY{l+s}{\PYZdq{}}\PY{l+s}{TCA\PYZsq{}s gamma\PYZus{}hat \PYZlt{}Cor\PYZgt{} Ground truth gamma\PYZus{}hat\PYZdq{}}\PY{p}{,}
                 ylab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{cor\PYZsq{}}\PY{p}{,}boxwex\PY{o}{=}\PY{l+m}{0.5}\PY{p}{,}
                 xlab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{correlation of effect size of smoking/age/gender\PYZsq{}}\PY{p}{)}
         plot\PY{p}{(}params\PY{o}{\PYZdl{}}gene\PYZus{}cor\PY{p}{,}gamma\PYZus{}hat\PYZus{}cor\PYZus{}tca1\PY{p}{,}xlab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{genetic cor of gene\PYZsq{}}\PY{p}{,}ylab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{cor\PYZsq{}}\PY{p}{,}cex.lab\PY{o}{=}\PY{l+m}{1.2}\PY{p}{,}ylim\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{\PYZhy{}0.2}\PY{p}{,}\PY{l+m}{0.4}\PY{p}{)}\PY{p}{,}yaxs\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{r\PYZsq{}}\PY{p}{,}type\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{o\PYZsq{}}\PY{p}{,}col\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{red\PYZsq{}}\PY{p}{)}
         lines\PY{p}{(}params\PY{o}{\PYZdl{}}gene\PYZus{}cor\PY{p}{,}gamma\PYZus{}hat\PYZus{}cor\PYZus{}tca2\PY{p}{,}col\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{green\PYZsq{}}\PY{p}{,}type\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{o\PYZsq{}}\PY{p}{)}
         mtext\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{TCA\PYZsq{}s gamma\PYZus{}hat \PYZlt{}Cor\PYZgt{} Ground truth gamma\PYZus{}hat\PYZdq{}}\PY{p}{,}cex\PY{o}{=}\PY{l+m}{0.9}\PY{p}{,}font\PY{o}{=}\PY{l+m}{2}\PY{p}{)}
         legend\PY{p}{(}x\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{bottom\PYZsq{}}\PY{p}{,}inset\PY{o}{=}\PY{l+m}{0}\PY{p}{,}legend\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{mdl1:SNPs+C1\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{mdl2:C1\PYZsq{}}\PY{p}{)}\PY{p}{,}
                col\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{red\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{green\PYZsq{}}\PY{p}{)}\PY{p}{,}lwd\PY{o}{=}\PY{l+m}{2}\PY{p}{,}cex\PY{o}{=}\PY{l+m}{0.7}\PY{p}{,}horiz\PY{o}{=}\PY{k+kc}{TRUE}\PY{p}{)}
\end{Verbatim}


    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_12_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_12_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}62}]:} Z\PYZus{}hat\PYZus{}train\PYZus{}seq\PYZus{}eq\PYZus{}cor\PYZus{}tca1 \PY{o}{=} \PY{k+kp}{do.call}\PY{p}{(}\PY{k+kp}{rbind}\PY{p}{,}\PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}\PY{k+kp}{length}\PY{p}{(}data\PY{p}{)}\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} li\PY{p}{[[}x\PY{p}{]]}\PY{o}{\PYZdl{}}s1\PY{o}{\PYZdl{}}Z\PYZus{}hat\PYZus{}train\PYZus{}second\PYZus{}eq\PYZus{}cor\PYZus{}tca\PY{p}{)}\PY{p}{)}
         Z\PYZus{}hat\PYZus{}train\PYZus{}seq\PYZus{}eq\PYZus{}cor\PYZus{}tca2 \PY{o}{=} \PY{k+kp}{do.call}\PY{p}{(}\PY{k+kp}{rbind}\PY{p}{,}\PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}\PY{k+kp}{length}\PY{p}{(}data\PY{p}{)}\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} li\PY{p}{[[}x\PY{p}{]]}\PY{o}{\PYZdl{}}s2\PY{o}{\PYZdl{}}Z\PYZus{}hat\PYZus{}train\PYZus{}second\PYZus{}eq\PYZus{}cor\PYZus{}tca\PY{p}{)}\PY{p}{)}
         Z\PYZus{}hat\PYZus{}test\PYZus{}seq\PYZus{}eq\PYZus{}cor\PYZus{}tca1 \PY{o}{=} \PY{k+kp}{do.call}\PY{p}{(}\PY{k+kp}{rbind}\PY{p}{,}\PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}\PY{k+kp}{length}\PY{p}{(}data\PY{p}{)}\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} li\PY{p}{[[}x\PY{p}{]]}\PY{o}{\PYZdl{}}s1\PY{o}{\PYZdl{}}Z\PYZus{}hat\PYZus{}test\PYZus{}second\PYZus{}eq\PYZus{}cor\PYZus{}tca\PY{p}{)}\PY{p}{)}
         Z\PYZus{}hat\PYZus{}test\PYZus{}seq\PYZus{}eq\PYZus{}cor\PYZus{}tca2 \PY{o}{=} \PY{k+kp}{do.call}\PY{p}{(}\PY{k+kp}{rbind}\PY{p}{,}\PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}\PY{k+kp}{length}\PY{p}{(}data\PY{p}{)}\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} li\PY{p}{[[}x\PY{p}{]]}\PY{o}{\PYZdl{}}s2\PY{o}{\PYZdl{}}Z\PYZus{}hat\PYZus{}test\PYZus{}second\PYZus{}eq\PYZus{}cor\PYZus{}tca\PY{p}{)}\PY{p}{)}
         
         par\PY{p}{(}mfrow\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{2}\PY{p}{,}\PY{l+m}{2}\PY{p}{)}\PY{p}{,}mar\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{4}\PY{p}{,} \PY{l+m}{3.8}\PY{p}{,} \PY{l+m}{4}\PY{p}{,} \PY{l+m}{2}\PY{p}{)} \PY{o}{+} \PY{l+m}{0.1}\PY{p}{)}
         opts\PY{o}{=}params\PY{o}{\PYZdl{}}cell\PYZus{}name
         \PY{k+kr}{for}\PY{p}{(}i \PY{k+kr}{in} \PY{l+m}{1}\PY{o}{:}params\PY{o}{\PYZdl{}}K\PY{p}{)}\PY{p}{\PYZob{}}
             heading \PY{o}{=} \PY{k+kp}{paste}\PY{p}{(}opts\PY{p}{[}i\PY{p}{]}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{mean weight\PYZsq{}}\PY{p}{,}mean\PYZus{}weight\PY{p}{[}i\PY{p}{]}\PY{p}{,}sep\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{ \PYZsq{}}\PY{p}{)}
             plot\PY{p}{(}params\PY{o}{\PYZdl{}}gene\PYZus{}cor\PY{p}{,}Z\PYZus{}hat\PYZus{}train\PYZus{}seq\PYZus{}eq\PYZus{}cor\PYZus{}tca1\PY{p}{[}\PY{p}{,}i\PY{p}{]}\PY{p}{,}xlab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{genetic cor of gene\PYZsq{}}\PY{p}{,}
                  ylab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{cor\PYZsq{}}\PY{p}{,}cex.lab\PY{o}{=}\PY{l+m}{1.2}\PY{p}{,}ylim\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{1}\PY{p}{)}\PY{p}{,}yaxs\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{r\PYZsq{}}\PY{p}{,}type\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{o\PYZsq{}}\PY{p}{,}col\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{red\PYZsq{}}\PY{p}{)}
             title\PY{p}{(}main\PY{o}{=}heading\PY{p}{,}font.main\PY{o}{=}\PY{l+m}{2}\PY{p}{,}cex.main\PY{o}{=}\PY{l+m}{1}\PY{p}{,}line\PY{o}{=}\PY{l+m}{1}\PY{p}{,}cex.lab\PY{o}{=}\PY{l+m}{1}\PY{p}{)}
             lines\PY{p}{(}params\PY{o}{\PYZdl{}}gene\PYZus{}cor\PY{p}{,}Z\PYZus{}hat\PYZus{}train\PYZus{}seq\PYZus{}eq\PYZus{}cor\PYZus{}tca2\PY{p}{[}\PY{p}{,}i\PY{p}{]}\PY{p}{,}col\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{green\PYZsq{}}\PY{p}{,}type\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{o\PYZsq{}}\PY{p}{)}
             lines\PY{p}{(}params\PY{o}{\PYZdl{}}gene\PYZus{}cor\PY{p}{,}Z\PYZus{}hat\PYZus{}test\PYZus{}seq\PYZus{}eq\PYZus{}cor\PYZus{}tca1\PY{p}{[}\PY{p}{,}i\PY{p}{]}\PY{p}{,}col\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{firebrick\PYZsq{}}\PY{p}{,}type\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{o\PYZsq{}}\PY{p}{)}
             lines\PY{p}{(}params\PY{o}{\PYZdl{}}gene\PYZus{}cor\PY{p}{,}Z\PYZus{}hat\PYZus{}test\PYZus{}seq\PYZus{}eq\PYZus{}cor\PYZus{}tca2\PY{p}{[}\PY{p}{,}i\PY{p}{]}\PY{p}{,}col\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{forestgreen\PYZsq{}}\PY{p}{,}type\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{o\PYZsq{}}\PY{p}{)}
         \PY{p}{\PYZcb{}}
         mtext\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{TCA\PYZsq{}s Z\PYZus{}hat 2nd eq \PYZlt{}Cor\PYZgt{} Ground truth train Z\PYZdq{}}\PY{p}{,}side\PY{o}{=}\PY{l+m}{3}\PY{p}{,}adj\PY{o}{=}\PY{l+m}{3}\PY{p}{,}cex\PY{o}{=}\PY{l+m}{0.9}\PY{p}{,}line\PY{o}{=}\PY{l+m}{24}\PY{p}{,}font\PY{o}{=}\PY{l+m}{2}\PY{p}{)}
         par\PY{p}{(}mfrow\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{2}\PY{p}{,}\PY{l+m}{1}\PY{p}{)}\PY{p}{,}mar\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{0}\PY{p}{)}\PY{p}{)}
         plot\PY{p}{(}\PY{l+m}{1}\PY{p}{,}type\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{n\PYZsq{}}\PY{p}{,}axes\PY{o}{=}\PY{k+kc}{FALSE}\PY{p}{,}xlab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZsq{}}\PY{p}{,}ylab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZsq{}}\PY{p}{)}
         legend\PY{p}{(}x\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{top\PYZsq{}}\PY{p}{,}inset\PY{o}{=}\PY{l+m}{0}\PY{p}{,}legend\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{mdl1 train:SNPs+C1\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{mdl2 train:C1\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{mdl1 test:SNPs+C1\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{mdl2 test:C1\PYZsq{}}\PY{p}{)}\PY{p}{,}
                col\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{red\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{green\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{firebrick\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{forestgreen\PYZsq{}}\PY{p}{)}\PY{p}{,}lwd\PY{o}{=}\PY{l+m}{1}\PY{p}{,}cex\PY{o}{=}\PY{l+m}{0.7}\PY{p}{,}horiz\PY{o}{=}\PY{k+kc}{TRUE}\PY{p}{)}
\end{Verbatim}


    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_13_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_13_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}63}]:} G\PYZus{}hat\PYZus{}train\PYZus{}cor\PYZus{}bulk \PY{o}{=} \PY{k+kp}{do.call}\PY{p}{(}\PY{k+kp}{rbind}\PY{p}{,}\PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}\PY{k+kp}{length}\PY{p}{(}data\PY{p}{)}\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} li\PY{p}{[[}x\PY{p}{]]}\PY{o}{\PYZdl{}}s1\PY{o}{\PYZdl{}}G\PYZus{}hat\PYZus{}train\PYZus{}cor\PYZus{}bulk\PY{p}{)}\PY{p}{)}
         G\PYZus{}hat\PYZus{}test\PYZus{}cor\PYZus{}bulk \PY{o}{=} \PY{k+kp}{do.call}\PY{p}{(}\PY{k+kp}{rbind}\PY{p}{,}\PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}\PY{k+kp}{length}\PY{p}{(}data\PY{p}{)}\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} li\PY{p}{[[}x\PY{p}{]]}\PY{o}{\PYZdl{}}s1\PY{o}{\PYZdl{}}G\PYZus{}hat\PYZus{}test\PYZus{}cor\PYZus{}bulk\PY{p}{)}\PY{p}{)}
         plot\PY{p}{(}params\PY{o}{\PYZdl{}}gene\PYZus{}cor\PY{p}{,}G\PYZus{}hat\PYZus{}train\PYZus{}cor\PYZus{}bulk\PY{p}{,}type\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{o\PYZsq{}}\PY{p}{,}col\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{red\PYZsq{}}\PY{p}{,}xlab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{genetic cor of gene\PYZsq{}}\PY{p}{,}ylab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{cor\PYZsq{}}\PY{p}{,}ylim\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{1}\PY{p}{)}\PY{p}{)}
         mtext\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{Bulk level GE, lasso by SNPs directly\PYZdq{}}\PY{p}{,}font\PY{o}{=}\PY{l+m}{2}\PY{p}{,}line\PY{o}{=}\PY{l+m}{1}\PY{p}{)}
         lines\PY{p}{(}params\PY{o}{\PYZdl{}}gene\PYZus{}cor\PY{p}{,}G\PYZus{}hat\PYZus{}test\PYZus{}cor\PYZus{}bulk\PY{p}{,}col\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{green\PYZsq{}}\PY{p}{,}type\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{o\PYZsq{}}\PY{p}{)}
         legend\PY{p}{(}x\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{topleft\PYZsq{}}\PY{p}{,}inset\PY{o}{=}\PY{l+m}{0}\PY{p}{,}legend\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{train\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{test\PYZsq{}}\PY{p}{)}\PY{p}{,}
                col\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{red\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{green\PYZsq{}}\PY{p}{)}\PY{p}{,}lwd\PY{o}{=}\PY{l+m}{2}\PY{p}{,}cex\PY{o}{=}\PY{l+m}{1}\PY{p}{,}horiz\PY{o}{=}\PY{k+kc}{FALSE}\PY{p}{)}
\end{Verbatim}


    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_14_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}64}]:} cor\PYZus{}lasso\PYZus{}tca1 \PY{o}{=} \PY{k+kp}{do.call}\PY{p}{(}\PY{k+kp}{rbind}\PY{p}{,}\PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}\PY{k+kp}{length}\PY{p}{(}data\PY{p}{)}\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} li\PY{p}{[[}x\PY{p}{]]}\PY{o}{\PYZdl{}}s1\PY{o}{\PYZdl{}}cor\PYZus{}lasso\PYZus{}tca\PY{p}{)}\PY{p}{)}
         cor\PYZus{}lasso\PYZus{}tca2 \PY{o}{=} \PY{k+kp}{do.call}\PY{p}{(}\PY{k+kp}{rbind}\PY{p}{,}\PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}\PY{k+kp}{length}\PY{p}{(}data\PY{p}{)}\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} li\PY{p}{[[}x\PY{p}{]]}\PY{o}{\PYZdl{}}s2\PY{o}{\PYZdl{}}cor\PYZus{}lasso\PYZus{}tca\PY{p}{)}\PY{p}{)}
         par\PY{p}{(}mfrow\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{2}\PY{p}{,}\PY{l+m}{2}\PY{p}{)}\PY{p}{,}mar\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{4}\PY{p}{,} \PY{l+m}{3.8}\PY{p}{,} \PY{l+m}{4}\PY{p}{,} \PY{l+m}{2}\PY{p}{)} \PY{o}{+} \PY{l+m}{0.1}\PY{p}{)}
         opts\PY{o}{=}params\PY{o}{\PYZdl{}}cell\PYZus{}name
         \PY{k+kr}{for}\PY{p}{(}i \PY{k+kr}{in} \PY{l+m}{1}\PY{o}{:}\PY{k+kp}{length}\PY{p}{(}params\PY{o}{\PYZdl{}}cell\PYZus{}name\PY{p}{)}\PY{p}{)}\PY{p}{\PYZob{}}
             heading \PY{o}{=} \PY{k+kp}{paste}\PY{p}{(}opts\PY{p}{[}i\PY{p}{]}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{mean weight\PYZsq{}}\PY{p}{,}mean\PYZus{}weight\PY{p}{[}i\PY{p}{]}\PY{p}{,}sep\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{ \PYZsq{}}\PY{p}{)}
             plot\PY{p}{(}params\PY{o}{\PYZdl{}}gene\PYZus{}cor\PY{p}{,}cor\PYZus{}lasso\PYZus{}tca1\PY{p}{[}\PY{p}{,}i\PY{p}{]}\PY{p}{,}xlab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{genetic cor of gene\PYZsq{}}\PY{p}{,}
                  ylab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{cor\PYZsq{}}\PY{p}{,}cex.lab\PY{o}{=}\PY{l+m}{1.2}\PY{p}{,}ylim\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{1}\PY{p}{)}\PY{p}{,}yaxs\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{r\PYZsq{}}\PY{p}{,}type\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{o\PYZsq{}}\PY{p}{,}col\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{red\PYZsq{}}\PY{p}{)}
             title\PY{p}{(}main\PY{o}{=}heading\PY{p}{,}font.main\PY{o}{=}\PY{l+m}{2}\PY{p}{,}cex.main\PY{o}{=}\PY{l+m}{1}\PY{p}{,}line\PY{o}{=}\PY{l+m}{1}\PY{p}{,}cex.lab\PY{o}{=}\PY{l+m}{1}\PY{p}{)}
             lines\PY{p}{(}params\PY{o}{\PYZdl{}}gene\PYZus{}cor\PY{p}{,}cor\PYZus{}lasso\PYZus{}tca2\PY{p}{[}\PY{p}{,}i\PY{p}{]}\PY{p}{,}col\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{green\PYZsq{}}\PY{p}{,}type\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{o\PYZsq{}}\PY{p}{)}
             
         \PY{p}{\PYZcb{}}
         mtext\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{TCA\PYZsq{}s Z\PYZus{}hat \PYZlt{}Cor\PYZgt{} Lasso Z\PYZus{}hat\PYZdq{}}\PY{p}{,}side\PY{o}{=}\PY{l+m}{3}\PY{p}{,}adj\PY{o}{=}\PY{l+m}{\PYZhy{}7}\PY{p}{,}cex\PY{o}{=}\PY{l+m}{0.9}\PY{p}{,}line\PY{o}{=}\PY{l+m}{24}\PY{p}{,}font\PY{o}{=}\PY{l+m}{2}\PY{p}{)}
         par\PY{p}{(}mfrow\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{2}\PY{p}{,}\PY{l+m}{1}\PY{p}{)}\PY{p}{,}mar\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{0}\PY{p}{)}\PY{p}{)}
         plot\PY{p}{(}\PY{l+m}{1}\PY{p}{,}type\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{n\PYZsq{}}\PY{p}{,}axes\PY{o}{=}\PY{k+kc}{FALSE}\PY{p}{,}xlab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZsq{}}\PY{p}{,}ylab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZsq{}}\PY{p}{)}
         legend\PY{p}{(}x\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{top\PYZsq{}}\PY{p}{,}inset\PY{o}{=}\PY{l+m}{0}\PY{p}{,}legend\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{mdl1:SNPs+C1\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{mdl2:C1\PYZsq{}}\PY{p}{)}\PY{p}{,}
                col\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{red\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{green\PYZsq{}}\PY{p}{)}\PY{p}{,}lwd\PY{o}{=}\PY{l+m}{2}\PY{p}{,}cex\PY{o}{=}\PY{l+m}{0.7}\PY{p}{,}horiz\PY{o}{=}\PY{k+kc}{TRUE}\PY{p}{)}
\end{Verbatim}


    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_15_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_15_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}65}]:} cor\PYZus{}lasso\PYZus{}real\PYZus{}train1 \PY{o}{=} \PY{k+kp}{do.call}\PY{p}{(}\PY{k+kp}{rbind}\PY{p}{,}\PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}\PY{k+kp}{length}\PY{p}{(}data\PY{p}{)}\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} li\PY{p}{[[}x\PY{p}{]]}\PY{o}{\PYZdl{}}s1\PY{o}{\PYZdl{}}cor\PYZus{}lasso\PYZus{}real\PYZus{}train\PY{p}{)}\PY{p}{)}
         cor\PYZus{}lasso\PYZus{}real\PYZus{}train2 \PY{o}{=} \PY{k+kp}{do.call}\PY{p}{(}\PY{k+kp}{rbind}\PY{p}{,}\PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}\PY{k+kp}{length}\PY{p}{(}data\PY{p}{)}\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} li\PY{p}{[[}x\PY{p}{]]}\PY{o}{\PYZdl{}}s2\PY{o}{\PYZdl{}}cor\PYZus{}lasso\PYZus{}real\PYZus{}train\PY{p}{)}\PY{p}{)}
         cor\PYZus{}lasso\PYZus{}real\PYZus{}test1 \PY{o}{=} \PY{k+kp}{do.call}\PY{p}{(}\PY{k+kp}{rbind}\PY{p}{,}\PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}\PY{k+kp}{length}\PY{p}{(}data\PY{p}{)}\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} li\PY{p}{[[}x\PY{p}{]]}\PY{o}{\PYZdl{}}s1\PY{o}{\PYZdl{}}cor\PYZus{}lasso\PYZus{}real\PYZus{}test\PY{p}{)}\PY{p}{)}
         cor\PYZus{}lasso\PYZus{}real\PYZus{}test2 \PY{o}{=} \PY{k+kp}{do.call}\PY{p}{(}\PY{k+kp}{rbind}\PY{p}{,}\PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}\PY{k+kp}{length}\PY{p}{(}data\PY{p}{)}\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} li\PY{p}{[[}x\PY{p}{]]}\PY{o}{\PYZdl{}}s2\PY{o}{\PYZdl{}}cor\PYZus{}lasso\PYZus{}real\PYZus{}test\PY{p}{)}\PY{p}{)}
         \PY{k+kp}{colnames}\PY{p}{(}cor\PYZus{}lasso\PYZus{}real\PYZus{}train1\PY{p}{)}\PY{o}{=}\PY{k+kp}{paste}\PY{p}{(}params\PY{o}{\PYZdl{}}cell\PYZus{}name\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZbs{}n\PYZsq{}}\PY{p}{,}mean\PYZus{}weight\PY{p}{)}
         \PY{k+kp}{colnames}\PY{p}{(}cor\PYZus{}lasso\PYZus{}real\PYZus{}train2\PY{p}{)}\PY{o}{=}\PY{k+kp}{paste}\PY{p}{(}params\PY{o}{\PYZdl{}}cell\PYZus{}name\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZbs{}n\PYZsq{}}\PY{p}{,}mean\PYZus{}weight\PY{p}{)}
         \PY{k+kp}{colnames}\PY{p}{(}cor\PYZus{}lasso\PYZus{}real\PYZus{}test1\PY{p}{)}\PY{o}{=}\PY{k+kp}{paste}\PY{p}{(}params\PY{o}{\PYZdl{}}cell\PYZus{}name\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZbs{}n\PYZsq{}}\PY{p}{,}mean\PYZus{}weight\PY{p}{)}
         \PY{k+kp}{colnames}\PY{p}{(}cor\PYZus{}lasso\PYZus{}real\PYZus{}test2\PY{p}{)}\PY{o}{=}\PY{k+kp}{paste}\PY{p}{(}params\PY{o}{\PYZdl{}}cell\PYZus{}name\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZbs{}n\PYZsq{}}\PY{p}{,}mean\PYZus{}weight\PY{p}{)}
         par\PY{p}{(}mfrow\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{2}\PY{p}{,}\PY{l+m}{2}\PY{p}{)}\PY{p}{,}mar\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{4}\PY{p}{,}\PY{l+m}{3.8}\PY{p}{,}\PY{l+m}{4}\PY{p}{,}\PY{l+m}{2}\PY{p}{)}\PY{l+m}{+0.1}\PY{p}{)}
         opts\PY{o}{=}params\PY{o}{\PYZdl{}}cell\PYZus{}name
         \PY{k+kr}{for}\PY{p}{(}i \PY{k+kr}{in} \PY{l+m}{1}\PY{o}{:}\PY{k+kp}{length}\PY{p}{(}params\PY{o}{\PYZdl{}}cell\PYZus{}name\PY{p}{)}\PY{p}{)}\PY{p}{\PYZob{}}
             heading\PY{o}{=}\PY{k+kp}{paste}\PY{p}{(}opts\PY{p}{[}i\PY{p}{]}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{mean weight\PYZsq{}}\PY{p}{,}mean\PYZus{}weight\PY{p}{[}i\PY{p}{]}\PY{p}{,}sep\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZsq{}}\PY{p}{)}
             plot\PY{p}{(}params\PY{o}{\PYZdl{}}gene\PYZus{}cor\PY{p}{,}cor\PYZus{}lasso\PYZus{}real\PYZus{}train1\PY{p}{[}\PY{p}{,}i\PY{p}{]}\PY{p}{,}xlab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{genetic cor of gene\PYZsq{}}\PY{p}{,}
                  ylab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{cor\PYZsq{}}\PY{p}{,}cex.lab\PY{o}{=}\PY{l+m}{1.2}\PY{p}{,}ylim\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{1}\PY{p}{)}\PY{p}{,}yaxs\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{r\PYZsq{}}\PY{p}{,}type\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{o\PYZsq{}}\PY{p}{,}col\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{red\PYZsq{}}\PY{p}{)}
             title\PY{p}{(}main\PY{o}{=}heading\PY{p}{,}font.main\PY{o}{=}\PY{l+m}{2}\PY{p}{,}cex.main\PY{o}{=}\PY{l+m}{1}\PY{p}{,}line\PY{o}{=}\PY{l+m}{1}\PY{p}{,}cex.lab\PY{o}{=}\PY{l+m}{1}\PY{p}{)}
             lines\PY{p}{(}params\PY{o}{\PYZdl{}}gene\PYZus{}cor\PY{p}{,}cor\PYZus{}lasso\PYZus{}real\PYZus{}train2\PY{p}{[}\PY{p}{,}i\PY{p}{]}\PY{p}{,}col\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{green\PYZsq{}}\PY{p}{,}type\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{o\PYZsq{}}\PY{p}{)}
             lines\PY{p}{(}params\PY{o}{\PYZdl{}}gene\PYZus{}cor\PY{p}{,}cor\PYZus{}lasso\PYZus{}real\PYZus{}test1\PY{p}{[}\PY{p}{,}i\PY{p}{]}\PY{p}{,}col\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{firebrick\PYZsq{}}\PY{p}{,}type\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{o\PYZsq{}}\PY{p}{)}
             lines\PY{p}{(}params\PY{o}{\PYZdl{}}gene\PYZus{}cor\PY{p}{,}cor\PYZus{}lasso\PYZus{}real\PYZus{}test2\PY{p}{[}\PY{p}{,}i\PY{p}{]}\PY{p}{,}col\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{forestgreen\PYZsq{}}\PY{p}{,}type\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{o\PYZsq{}}\PY{p}{)}
         \PY{p}{\PYZcb{}}
         mtext\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{Lasso Z\PYZus{}hat \PYZlt{}Cor\PYZgt{} Ground Truth Z\PYZdq{}}\PY{p}{,}side\PY{o}{=}\PY{l+m}{3}\PY{p}{,}adj\PY{o}{=}\PY{l+m}{7}\PY{p}{,}cex\PY{o}{=}\PY{l+m}{1}\PY{p}{,}line\PY{o}{=}\PY{l+m}{24}\PY{p}{,}font\PY{o}{=}\PY{l+m}{2}\PY{p}{)}
         par\PY{p}{(}mfrow\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{2}\PY{p}{,}\PY{l+m}{1}\PY{p}{)}\PY{p}{,}mar\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{0}\PY{p}{)}\PY{p}{)}
         plot\PY{p}{(}\PY{l+m}{1}\PY{p}{,}type\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{n\PYZsq{}}\PY{p}{,}axes\PY{o}{=}\PY{k+kc}{FALSE}\PY{p}{,}xlab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZsq{}}\PY{p}{,}ylab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZsq{}}\PY{p}{)}
         legend\PY{p}{(}x\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{top\PYZsq{}}\PY{p}{,}inset\PY{o}{=}\PY{l+m}{0}\PY{p}{,}legend\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{mdl1 train:SNPs+C1\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{mdl2 train:C1\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{mdl1 test:SNPs+C1\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{mdl2 test:C1\PYZsq{}}\PY{p}{)}\PY{p}{,}
                col\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{red\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{green\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{firebrick\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{forestgreen\PYZsq{}}\PY{p}{)}\PY{p}{,}lwd\PY{o}{=}\PY{l+m}{2}\PY{p}{,}cex\PY{o}{=}\PY{l+m}{0.7}\PY{p}{,}horiz\PY{o}{=}\PY{k+kc}{TRUE}\PY{p}{)}
\end{Verbatim}


    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_16_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_16_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}66}]:} \PY{c+c1}{\PYZsh{} zhat\PYZus{}cor = data.frame(heritability=params\PYZdl{}gene\PYZus{}cor,cor=cor\PYZus{}lasso\PYZus{}real\PYZus{}test1)}
         \PY{c+c1}{\PYZsh{} colnames(zhat\PYZus{}cor) = c(\PYZsq{}heritability\PYZsq{},\PYZsq{}cor\PYZus{}celltype1\PYZsq{},\PYZsq{}cor\PYZus{}celltype2\PYZsq{},\PYZsq{}cor\PYZus{}celltype3\PYZsq{},\PYZsq{}cor\PYZus{}celltype4\PYZsq{})}
         \PY{c+c1}{\PYZsh{} ggplot(zhat\PYZus{}cor,aes(heritability))+geom\PYZus{}line(}
         \PY{c+c1}{\PYZsh{}     aes(y=cor\PYZus{}celltype1,color=hue\PYZus{}pal()(4)[1]))+geom\PYZus{}line(}
         \PY{c+c1}{\PYZsh{}     aes(y=cor\PYZus{}celltype2,color=hue\PYZus{}pal()(4)[2]))+geom\PYZus{}line(}
         \PY{c+c1}{\PYZsh{}     aes(y=cor\PYZus{}celltype3,color=hue\PYZus{}pal()(4)[3]))+geom\PYZus{}line(}
         \PY{c+c1}{\PYZsh{}     aes(y=cor\PYZus{}celltype4,color=hue\PYZus{}pal()(4)[4]))+ggtitle(}
         \PY{c+c1}{\PYZsh{}     \PYZdq{}Correlation: TWAS Z\PYZus{}hat and real Z\PYZdq{})+theme(}
         \PY{c+c1}{\PYZsh{}     axis.text=element\PYZus{}text(size=18),}
         \PY{c+c1}{\PYZsh{}     axis.title=element\PYZus{}text(size=18,face=\PYZdq{}bold\PYZdq{}),}
         \PY{c+c1}{\PYZsh{}     plot.title = element\PYZus{}text(size=15,face=\PYZdq{}bold\PYZdq{},hjust=0.5))+labs(}
         \PY{c+c1}{\PYZsh{}     y=\PYZdq{}Correlation\PYZdq{})+scale\PYZus{}color\PYZus{}discrete(name=\PYZdq{}Cell Type Weights\PYZdq{},labels=c(0.08,0.35,0.03,0.53))}
         \PY{c+c1}{\PYZsh{} \PYZsh{} ggsave(\PYZdq{}/home/elessar/Documents/activities/hackathon/urop/UCLA/csst/tca\PYZhy{}twas/pipeline/plot/cor\PYZus{}twas\PYZus{}zhat\PYZus{}real\PYZus{}z.png\PYZdq{},}
         \PY{c+c1}{\PYZsh{} \PYZsh{}        plot = last\PYZus{}plot(),dpi = 300, limitsize = TRUE)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}67}]:} par\PY{p}{(}mar\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{0}\PY{p}{)}\PY{p}{,}cex.axis\PY{o}{=}\PY{l+m}{.7}\PY{p}{)}
         par\PY{p}{(}mfrow\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{2}\PY{p}{,}\PY{l+m}{2}\PY{p}{)}\PY{p}{,}mar\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{3.8}\PY{p}{,} \PY{l+m}{3.7}\PY{p}{,} \PY{l+m}{4}\PY{p}{,} \PY{l+m}{2}\PY{p}{)}\PY{p}{)}
         boxplot\PY{p}{(}cor\PYZus{}lasso\PYZus{}real\PYZus{}train1\PY{p}{,}ylab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{cor\PYZsq{}}\PY{p}{,}
                 xlab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{mdl1 train:SNPs+C1\PYZsq{}}\PY{p}{,}boxwex\PY{o}{=}\PY{l+m}{0.7}\PY{p}{,}ylim\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{1}\PY{p}{)}\PY{p}{)}
         boxplot\PY{p}{(}cor\PYZus{}lasso\PYZus{}real\PYZus{}train2\PY{p}{,}ylab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{cor\PYZsq{}}\PY{p}{,}
                 xlab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{mdl2 train:C1\PYZsq{}}\PY{p}{,}boxwex\PY{o}{=}\PY{l+m}{0.7}\PY{p}{,}ylim\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{1}\PY{p}{)}\PY{p}{)}
         boxplot\PY{p}{(}cor\PYZus{}lasso\PYZus{}real\PYZus{}test1\PY{p}{,}ylab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{cor\PYZsq{}}\PY{p}{,}
                 xlab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{mdl1 test:SNPs+C1\PYZsq{}}\PY{p}{,}ylim\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{1}\PY{p}{)}\PY{p}{,}boxwex\PY{o}{=}\PY{l+m}{0.7}\PY{p}{)}
         boxplot\PY{p}{(}cor\PYZus{}lasso\PYZus{}real\PYZus{}test2\PY{p}{,}ylab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{cor\PYZsq{}}\PY{p}{,}
                 xlab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{mdl2 test:C1\PYZsq{}}\PY{p}{,}boxwex\PY{o}{=}\PY{l+m}{0.7}\PY{p}{,}ylim\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{1}\PY{p}{)}\PY{p}{)}
         mtext\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{Lasso Z\PYZus{}hat \PYZlt{}Cor\PYZgt{} Ground Truth Z\PYZdq{}}\PY{p}{,}side\PY{o}{=}\PY{l+m}{3}\PY{p}{,}adj\PY{o}{=}\PY{l+m}{8}\PY{p}{,}cex\PY{o}{=}\PY{l+m}{1}\PY{p}{,}line\PY{o}{=}\PY{l+m}{23}\PY{p}{,}font\PY{o}{=}\PY{l+m}{2}\PY{p}{)}
\end{Verbatim}


    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_18_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}68}]:} lasso\PYZus{}dev\PYZus{}rat1 \PY{o}{=} \PY{k+kp}{do.call}\PY{p}{(}\PY{k+kp}{rbind}\PY{p}{,}\PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}\PY{k+kp}{length}\PY{p}{(}data\PY{p}{)}\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} li\PY{p}{[[}x\PY{p}{]]}\PY{o}{\PYZdl{}}s1\PY{o}{\PYZdl{}}dev\PYZus{}rat\PY{p}{)}\PY{p}{)}
         lasso\PYZus{}dev\PYZus{}rat2 \PY{o}{=} \PY{k+kp}{do.call}\PY{p}{(}\PY{k+kp}{rbind}\PY{p}{,}\PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}\PY{k+kp}{length}\PY{p}{(}data\PY{p}{)}\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} li\PY{p}{[[}x\PY{p}{]]}\PY{o}{\PYZdl{}}s2\PY{o}{\PYZdl{}}dev\PYZus{}rat\PY{p}{)}\PY{p}{)}
         \PY{k+kp}{colnames}\PY{p}{(}lasso\PYZus{}dev\PYZus{}rat1\PY{p}{)} \PY{o}{=} \PY{k+kp}{paste}\PY{p}{(}params\PY{o}{\PYZdl{}}cell\PYZus{}name\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZbs{}n\PYZsq{}}\PY{p}{,}mean\PYZus{}weight\PY{p}{)}
         \PY{k+kp}{colnames}\PY{p}{(}lasso\PYZus{}dev\PYZus{}rat2\PY{p}{)} \PY{o}{=} \PY{k+kp}{paste}\PY{p}{(}params\PY{o}{\PYZdl{}}cell\PYZus{}name\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZbs{}n\PYZsq{}}\PY{p}{,}mean\PYZus{}weight\PY{p}{)}
         par\PY{p}{(}mfrow\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{2}\PY{p}{,}\PY{l+m}{2}\PY{p}{)}\PY{p}{,}mar\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{4}\PY{p}{,} \PY{l+m}{3.8}\PY{p}{,} \PY{l+m}{4}\PY{p}{,} \PY{l+m}{2}\PY{p}{)} \PY{o}{+} \PY{l+m}{0.1}\PY{p}{)}
         opts\PY{o}{=}params\PY{o}{\PYZdl{}}cell\PYZus{}name
         \PY{k+kr}{for}\PY{p}{(}i \PY{k+kr}{in} \PY{l+m}{1}\PY{o}{:}params\PY{o}{\PYZdl{}}K\PY{p}{)}\PY{p}{\PYZob{}}
             heading \PY{o}{=} \PY{k+kp}{paste}\PY{p}{(}opts\PY{p}{[}i\PY{p}{]}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{mean weight\PYZsq{}}\PY{p}{,}mean\PYZus{}weight\PY{p}{[}i\PY{p}{]}\PY{p}{,}sep\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{ \PYZsq{}}\PY{p}{)}
             plot\PY{p}{(}params\PY{o}{\PYZdl{}}gene\PYZus{}cor\PY{p}{,}lasso\PYZus{}dev\PYZus{}rat1\PY{p}{[}\PY{p}{,}i\PY{p}{]}\PY{p}{,}xlab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{genetic cor of gene\PYZsq{}}\PY{p}{,}
                  ylab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{var explained \PYZpc{}\PYZsq{}}\PY{p}{,}cex.lab\PY{o}{=}\PY{l+m}{1.2}\PY{p}{,}ylim\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{1}\PY{p}{)}\PY{p}{,}yaxs\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{r\PYZsq{}}\PY{p}{,}type\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{o\PYZsq{}}\PY{p}{,}col\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{red\PYZsq{}}\PY{p}{)}
             title\PY{p}{(}main\PY{o}{=}heading\PY{p}{,}font.main\PY{o}{=}\PY{l+m}{2}\PY{p}{,}cex.main\PY{o}{=}\PY{l+m}{1}\PY{p}{,}line\PY{o}{=}\PY{l+m}{1}\PY{p}{,}cex.lab\PY{o}{=}\PY{l+m}{1}\PY{p}{)}
             lines\PY{p}{(}params\PY{o}{\PYZdl{}}gene\PYZus{}cor\PY{p}{,}lasso\PYZus{}dev\PYZus{}rat2\PY{p}{[}\PY{p}{,}i\PY{p}{]}\PY{p}{,}col\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{green\PYZsq{}}\PY{p}{,}type\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{o\PYZsq{}}\PY{p}{)}
         \PY{p}{\PYZcb{}}
         mtext\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{Lasso Z\PYZus{}hat \PYZlt{}dev exp\PYZgt{} Ground Truth Z\PYZdq{}}\PY{p}{,}side\PY{o}{=}\PY{l+m}{3}\PY{p}{,}adj\PY{o}{=}\PY{l+m}{3.5}\PY{p}{,}cex\PY{o}{=}\PY{l+m}{1}\PY{p}{,}line\PY{o}{=}\PY{l+m}{23.5}\PY{p}{,}font\PY{o}{=}\PY{l+m}{2}\PY{p}{)}
         par\PY{p}{(}mfrow\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{2}\PY{p}{,}\PY{l+m}{1}\PY{p}{)}\PY{p}{,}mar\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{0}\PY{p}{)}\PY{p}{)}
         plot\PY{p}{(}\PY{l+m}{1}\PY{p}{,}type\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{n\PYZsq{}}\PY{p}{,}axes\PY{o}{=}\PY{k+kc}{FALSE}\PY{p}{,}xlab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZsq{}}\PY{p}{,}ylab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZsq{}}\PY{p}{)}
         legend\PY{p}{(}x\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{top\PYZsq{}}\PY{p}{,}inset\PY{o}{=}\PY{l+m}{0}\PY{p}{,}legend\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{mdl1 train:SNPs+C1\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{mdl2 train:C1\PYZsq{}}\PY{p}{)}\PY{p}{,}
                col\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{red\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{green\PYZsq{}}\PY{p}{)}\PY{p}{,}lwd\PY{o}{=}\PY{l+m}{2}\PY{p}{,}cex\PY{o}{=}\PY{l+m}{0.7}\PY{p}{,}horiz\PY{o}{=}\PY{k+kc}{TRUE}\PY{p}{)}
\end{Verbatim}


    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_19_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_19_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}69}]:} \PY{c+c1}{\PYZsh{} lasso\PYZus{}dev\PYZus{}rat1 = do.call(rbind,lapply(1:length(data),function(x) li[[x]]\PYZdl{}s1\PYZdl{}dev\PYZus{}rat))}
         \PY{c+c1}{\PYZsh{} colnames(lasso\PYZus{}dev\PYZus{}rat1) = paste(params\PYZdl{}cell\PYZus{}name,\PYZsq{}\PYZbs{}n\PYZsq{},mean\PYZus{}weight)                                      }
         \PY{c+c1}{\PYZsh{} zhat\PYZus{}dev\PYZus{}exp = data.frame(heritability=params\PYZdl{}gene\PYZus{}cor,lasso\PYZus{}dev\PYZus{}rat1)}
         \PY{c+c1}{\PYZsh{} colnames(zhat\PYZus{}dev\PYZus{}exp) = c(\PYZsq{}heritability\PYZsq{},\PYZsq{}dev\PYZus{}celltype1\PYZsq{},\PYZsq{}dev\PYZus{}celltype2\PYZsq{},\PYZsq{}dev\PYZus{}celltype3\PYZsq{},\PYZsq{}dev\PYZus{}celltype4\PYZsq{})}
         \PY{c+c1}{\PYZsh{} ggplot(zhat\PYZus{}dev\PYZus{}exp,aes(heritability))+geom\PYZus{}line(}
         \PY{c+c1}{\PYZsh{}     aes(y=dev\PYZus{}celltype1,color=hue\PYZus{}pal()(4)[1]))+geom\PYZus{}line(}
         \PY{c+c1}{\PYZsh{}     aes(y=dev\PYZus{}celltype2,color=hue\PYZus{}pal()(4)[2]))+geom\PYZus{}line(}
         \PY{c+c1}{\PYZsh{}     aes(y=dev\PYZus{}celltype3,color=hue\PYZus{}pal()(4)[3]))+geom\PYZus{}line(}
         \PY{c+c1}{\PYZsh{}     aes(y=dev\PYZus{}celltype4,color=hue\PYZus{}pal()(4)[4]))+ggtitle(}
         \PY{c+c1}{\PYZsh{}     \PYZdq{}Deviance Explaned: TWAS deviance explained\PYZdq{})+theme(}
         \PY{c+c1}{\PYZsh{}     axis.text=element\PYZus{}text(size=18),}
         \PY{c+c1}{\PYZsh{}     axis.title=element\PYZus{}text(size=18,face=\PYZdq{}bold\PYZdq{}),}
         \PY{c+c1}{\PYZsh{}     plot.title = element\PYZus{}text(size=15,face=\PYZdq{}bold\PYZdq{},hjust=0.5))+labs(}
         \PY{c+c1}{\PYZsh{}     y=\PYZdq{}Dev Explained \PYZpc{}\PYZdq{})+scale\PYZus{}color\PYZus{}discrete(name=\PYZdq{}Cell Type Weights\PYZdq{},labels=c(0.08,0.35,0.03,0.53))}
         \PY{c+c1}{\PYZsh{} \PYZsh{} ggsave(\PYZdq{}/home/elessar/Documents/activities/hackathon/urop/UCLA/csst/tca\PYZhy{}twas/pipeline/plot/twas\PYZus{}zhat\PYZus{}dev\PYZus{}exp.png\PYZdq{},}
         \PY{c+c1}{\PYZsh{} \PYZsh{}        plot = last\PYZus{}plot(),dpi = 300, limitsize = TRUE)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}70}]:} beta\PYZus{}precision\PYZus{}lasso1 \PY{o}{=}　\PY{k+kt}{matrix}\PY{p}{(}\PY{k+kp}{do.call}\PY{p}{(}\PY{k+kp}{rbind}\PY{p}{,}\PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}\PY{k+kp}{length}\PY{p}{(}data\PY{p}{)}\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} li\PY{p}{[[}x\PY{p}{]]}\PY{o}{\PYZdl{}}s1\PY{o}{\PYZdl{}}precision\PYZus{}lasso\PY{p}{)}\PY{p}{)}\PY{p}{,}nrow\PY{o}{=}params\PY{o}{\PYZdl{}}K\PY{p}{)}
         beta\PYZus{}precision\PYZus{}lasso2 \PY{o}{=} \PY{k+kt}{matrix}\PY{p}{(}\PY{k+kp}{do.call}\PY{p}{(}\PY{k+kp}{rbind}\PY{p}{,}\PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}\PY{k+kp}{length}\PY{p}{(}data\PY{p}{)}\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} li\PY{p}{[[}x\PY{p}{]]}\PY{o}{\PYZdl{}}s2\PY{o}{\PYZdl{}}precision\PYZus{}lasso\PY{p}{)}\PY{p}{)}\PY{p}{,}nrow\PY{o}{=}params\PY{o}{\PYZdl{}}K\PY{p}{)}
         beta\PYZus{}recall\PYZus{}lasso1 \PY{o}{=}　\PY{k+kt}{matrix}\PY{p}{(}\PY{k+kp}{do.call}\PY{p}{(}\PY{k+kp}{rbind}\PY{p}{,}\PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}\PY{k+kp}{length}\PY{p}{(}data\PY{p}{)}\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} li\PY{p}{[[}x\PY{p}{]]}\PY{o}{\PYZdl{}}s1\PY{o}{\PYZdl{}}recall\PYZus{}lasso\PY{p}{)}\PY{p}{)}\PY{p}{,}nrow\PY{o}{=}params\PY{o}{\PYZdl{}}K\PY{p}{)}
         beta\PYZus{}recall\PYZus{}lasso2 \PY{o}{=} \PY{k+kt}{matrix}\PY{p}{(}\PY{k+kp}{do.call}\PY{p}{(}\PY{k+kp}{rbind}\PY{p}{,}\PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}\PY{k+kp}{length}\PY{p}{(}data\PY{p}{)}\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} li\PY{p}{[[}x\PY{p}{]]}\PY{o}{\PYZdl{}}s2\PY{o}{\PYZdl{}}recall\PYZus{}lasso\PY{p}{)}\PY{p}{)}\PY{p}{,}nrow\PY{o}{=}params\PY{o}{\PYZdl{}}K\PY{p}{)}
         prec\PYZus{}rec\PYZus{}frame \PY{o}{=} \PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}params\PY{o}{\PYZdl{}}K\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} \PY{k+kp}{t}\PY{p}{(}\PY{k+kp}{rbind}\PY{p}{(}beta\PYZus{}precision\PYZus{}lasso1\PY{p}{[}x\PY{p}{,}\PY{p}{]}\PY{p}{,}beta\PYZus{}recall\PYZus{}lasso1\PY{p}{[}x\PY{p}{,}\PY{p}{]}\PY{p}{,}beta\PYZus{}precision\PYZus{}lasso2\PY{p}{[}x\PY{p}{,}\PY{p}{]}\PY{p}{,}beta\PYZus{}recall\PYZus{}lasso2\PY{p}{[}x\PY{p}{,}\PY{p}{]}\PY{p}{)}\PY{p}{)}\PY{p}{)}
         
         par\PY{p}{(}mfrow\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{2}\PY{p}{,}\PY{l+m}{2}\PY{p}{)}\PY{p}{,}mar\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{4}\PY{p}{,} \PY{l+m}{3.8}\PY{p}{,} \PY{l+m}{4}\PY{p}{,} \PY{l+m}{2}\PY{p}{)} \PY{o}{+} \PY{l+m}{0.1}\PY{p}{)}
         opts\PY{o}{=}\PY{k+kp}{paste}\PY{p}{(}params\PY{o}{\PYZdl{}}cell\PYZus{}name\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{ W:\PYZsq{}}\PY{p}{,}mean\PYZus{}weight\PY{p}{)}
         \PY{k+kr}{for}\PY{p}{(}i \PY{k+kr}{in} \PY{l+m}{1}\PY{o}{:}params\PY{o}{\PYZdl{}}K\PY{p}{)}\PY{p}{\PYZob{}}
             boxplot\PY{p}{(}prec\PYZus{}rec\PYZus{}frame\PY{p}{[[}i\PY{p}{]]}\PY{p}{,}ylab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{precision/recall\PYZsq{}}\PY{p}{,}
                 xlab\PY{o}{=}opts\PY{p}{[}i\PY{p}{]}\PY{p}{,}boxwex\PY{o}{=}\PY{l+m}{0.7}\PY{p}{,}ylim\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{1}\PY{p}{)}\PY{p}{,}col\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{red\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{green\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{firebrick\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{forestgreen\PYZsq{}}\PY{p}{)}\PY{p}{)}
         \PY{p}{\PYZcb{}}
         mtext\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{Precision/Recall for Lasso\PYZsq{}s beta\PYZus{}hat\PYZdq{}}\PY{p}{,}side\PY{o}{=}\PY{l+m}{3}\PY{p}{,}adj\PY{o}{=}\PY{l+m}{12.5}\PY{p}{,}cex\PY{o}{=}\PY{l+m}{0.9}\PY{p}{,}line\PY{o}{=}\PY{l+m}{22.5}\PY{p}{,}font\PY{o}{=}\PY{l+m}{2}\PY{p}{)}
         par\PY{p}{(}mfrow\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{2}\PY{p}{,}\PY{l+m}{1}\PY{p}{)}\PY{p}{,}mar\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{0}\PY{p}{)}\PY{p}{)}
         plot\PY{p}{(}\PY{l+m}{1}\PY{p}{,}type\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{n\PYZsq{}}\PY{p}{,}axes\PY{o}{=}\PY{k+kc}{FALSE}\PY{p}{,}xlab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZsq{}}\PY{p}{,}ylab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZsq{}}\PY{p}{)}
         legend\PY{p}{(}x\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{top\PYZsq{}}\PY{p}{,}inset\PY{o}{=}\PY{l+m}{0}\PY{p}{,}legend\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{precision mdl1:SNPs+C1\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{recall mdl1:SNPs+C1\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{precision mdl2:C1\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{recall mdl2:C1\PYZsq{}}\PY{p}{)}\PY{p}{,}
                col\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{red\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{green\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{firebrick\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{forestgreen\PYZsq{}}\PY{p}{)}\PY{p}{,}lwd\PY{o}{=}\PY{l+m}{1}\PY{p}{,}cex\PY{o}{=}\PY{l+m}{0.65}\PY{p}{,}horiz\PY{o}{=}\PY{k+kc}{TRUE}\PY{p}{)}
\end{Verbatim}


    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_21_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_21_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}71}]:} rmse\PYZus{}lasso1 \PY{o}{=}　\PY{k+kp}{do.call}\PY{p}{(}\PY{k+kp}{rbind}\PY{p}{,}\PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}\PY{k+kp}{length}\PY{p}{(}data\PY{p}{)}\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} li\PY{p}{[[}x\PY{p}{]]}\PY{o}{\PYZdl{}}s1\PY{o}{\PYZdl{}}rmse\PYZus{}lasso\PY{p}{)}\PY{p}{)}
         rmse\PYZus{}lasso2 \PY{o}{=} \PY{k+kp}{do.call}\PY{p}{(}\PY{k+kp}{rbind}\PY{p}{,}\PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}\PY{k+kp}{length}\PY{p}{(}data\PY{p}{)}\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} li\PY{p}{[[}x\PY{p}{]]}\PY{o}{\PYZdl{}}s2\PY{o}{\PYZdl{}}rmse\PYZus{}lasso\PY{p}{)}\PY{p}{)}
         rmse\PYZus{}tca1 \PY{o}{=}　\PY{k+kp}{do.call}\PY{p}{(}\PY{k+kp}{rbind}\PY{p}{,}\PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}\PY{k+kp}{length}\PY{p}{(}data\PY{p}{)}\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} li\PY{p}{[[}x\PY{p}{]]}\PY{o}{\PYZdl{}}s1\PY{o}{\PYZdl{}}rmse\PYZus{}tca\PY{p}{)}\PY{p}{)}
         rmse\PYZus{}tca2 \PY{o}{=} \PY{k+kp}{do.call}\PY{p}{(}\PY{k+kp}{rbind}\PY{p}{,}\PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}\PY{k+kp}{length}\PY{p}{(}data\PY{p}{)}\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} li\PY{p}{[[}x\PY{p}{]]}\PY{o}{\PYZdl{}}s2\PY{o}{\PYZdl{}}rmse\PYZus{}tca\PY{p}{)}\PY{p}{)}
         rmse\PYZus{}frame \PY{o}{=} \PY{k+kp}{lapply}\PY{p}{(}\PY{l+m}{1}\PY{o}{:}params\PY{o}{\PYZdl{}}K\PY{p}{,}\PY{k+kr}{function}\PY{p}{(}x\PY{p}{)} \PY{k+kp}{t}\PY{p}{(}\PY{k+kp}{rbind}\PY{p}{(}rmse\PYZus{}lasso1\PY{p}{[}\PY{p}{,}x\PY{p}{]}\PY{p}{,}rmse\PYZus{}lasso2\PY{p}{[}\PY{p}{,}x\PY{p}{]}\PY{p}{,}rmse\PYZus{}tca1\PY{p}{[}\PY{p}{,}x\PY{p}{]}\PY{p}{,}rmse\PYZus{}tca2\PY{p}{[}\PY{p}{,}x\PY{p}{]}\PY{p}{)}\PY{p}{)}\PY{p}{)}
         
         par\PY{p}{(}mfrow\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{2}\PY{p}{,}\PY{l+m}{2}\PY{p}{)}\PY{p}{,}mar\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{4}\PY{p}{,} \PY{l+m}{3.8}\PY{p}{,} \PY{l+m}{4}\PY{p}{,} \PY{l+m}{2}\PY{p}{)} \PY{o}{+} \PY{l+m}{0.1}\PY{p}{)}
         opts\PY{o}{=}\PY{k+kp}{paste}\PY{p}{(}params\PY{o}{\PYZdl{}}cell\PYZus{}name\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{ W:\PYZsq{}}\PY{p}{,}mean\PYZus{}weight\PY{p}{)}
         \PY{k+kr}{for}\PY{p}{(}i \PY{k+kr}{in} \PY{l+m}{1}\PY{o}{:}params\PY{o}{\PYZdl{}}K\PY{p}{)}\PY{p}{\PYZob{}}
             boxplot\PY{p}{(}rmse\PYZus{}frame\PY{p}{[[}i\PY{p}{]]}\PY{p}{,}ylab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{rmse\PYZsq{}}\PY{p}{,}
                 xlab\PY{o}{=}opts\PY{p}{[}i\PY{p}{]}\PY{p}{,}boxwex\PY{o}{=}\PY{l+m}{0.7}\PY{p}{,}ylim\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{1.2}\PY{p}{)}\PY{p}{,}col\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{red\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{green\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{firebrick\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{forestgreen\PYZsq{}}\PY{p}{)}\PY{p}{)}
         \PY{p}{\PYZcb{}}
         mtext\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{RMSE for lasso / TCA\PYZdq{}}\PY{p}{,}side\PY{o}{=}\PY{l+m}{3}\PY{p}{,}adj\PY{o}{=}\PY{l+m}{\PYZhy{}1.5}\PY{p}{,}cex\PY{o}{=}\PY{l+m}{0.9}\PY{p}{,}line\PY{o}{=}\PY{l+m}{22.5}\PY{p}{,}font\PY{o}{=}\PY{l+m}{2}\PY{p}{)}
         par\PY{p}{(}mfrow\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{2}\PY{p}{,}\PY{l+m}{1}\PY{p}{)}\PY{p}{,}mar\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{0}\PY{p}{)}\PY{p}{)}
         plot\PY{p}{(}\PY{l+m}{1}\PY{p}{,}type\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{n\PYZsq{}}\PY{p}{,}axes\PY{o}{=}\PY{k+kc}{FALSE}\PY{p}{,}xlab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZsq{}}\PY{p}{,}ylab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZsq{}}\PY{p}{)}
         legend\PY{p}{(}x\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{top\PYZsq{}}\PY{p}{,}inset\PY{o}{=}\PY{l+m}{0}\PY{p}{,}legend\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{lasso mdl1:SNPs+C1\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{lasso mdl2:C1\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{tca mdl1:SNPs+C1\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{tca mdl2:C1\PYZsq{}}\PY{p}{)}\PY{p}{,}
                col\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{red\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{green\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{firebrick\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{forestgreen\PYZsq{}}\PY{p}{)}\PY{p}{,}lwd\PY{o}{=}\PY{l+m}{1}\PY{p}{,}cex\PY{o}{=}\PY{l+m}{0.65}\PY{p}{,}horiz\PY{o}{=}\PY{k+kc}{TRUE}\PY{p}{)}
\end{Verbatim}


    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_22_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_22_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}76}]:} par\PY{p}{(}mfrow\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{2}\PY{p}{,}\PY{l+m}{2}\PY{p}{)}\PY{p}{,}mar\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{4}\PY{p}{,} \PY{l+m}{3.8}\PY{p}{,} \PY{l+m}{4}\PY{p}{,} \PY{l+m}{2}\PY{p}{)} \PY{o}{+} \PY{l+m}{0.1}\PY{p}{)}
         \PY{k+kr}{for}\PY{p}{(}i \PY{k+kr}{in} \PY{l+m}{1}\PY{o}{:}params\PY{o}{\PYZdl{}}K\PY{p}{)}\PY{p}{\PYZob{}}
             plot\PY{p}{(}params\PY{o}{\PYZdl{}}gene\PYZus{}cor\PY{p}{,}rmse\PYZus{}lasso1\PY{p}{[}\PY{p}{,}i\PY{p}{]}\PY{p}{,}xlab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{heritibility of gene\PYZsq{}}\PY{p}{,}
                  ylab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{RMSE\PYZsq{}}\PY{p}{,}cex.lab\PY{o}{=}\PY{l+m}{1.2}\PY{p}{,}ylim\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{1.2}\PY{p}{)}\PY{p}{,}yaxs\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{r\PYZsq{}}\PY{p}{,}type\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{o\PYZsq{}}\PY{p}{,}col\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{red\PYZsq{}}\PY{p}{)}
             title\PY{p}{(}main\PY{o}{=}opts\PY{p}{[}i\PY{p}{]}\PY{p}{,}font.main\PY{o}{=}\PY{l+m}{2}\PY{p}{,}cex.main\PY{o}{=}\PY{l+m}{1}\PY{p}{,}line\PY{o}{=}\PY{l+m}{1}\PY{p}{,}cex.lab\PY{o}{=}\PY{l+m}{1}\PY{p}{)}
             lines\PY{p}{(}params\PY{o}{\PYZdl{}}gene\PYZus{}cor\PY{p}{,}rmse\PYZus{}lasso2\PY{p}{[}\PY{p}{,}i\PY{p}{]}\PY{p}{,}col\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{green\PYZsq{}}\PY{p}{,}type\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{o\PYZsq{}}\PY{p}{)}
             lines\PY{p}{(}params\PY{o}{\PYZdl{}}gene\PYZus{}cor\PY{p}{,}rmse\PYZus{}tca1\PY{p}{[}\PY{p}{,}i\PY{p}{]}\PY{p}{,}col\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{firebrick\PYZsq{}}\PY{p}{,}type\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{o\PYZsq{}}\PY{p}{)}
             lines\PY{p}{(}params\PY{o}{\PYZdl{}}gene\PYZus{}cor\PY{p}{,}rmse\PYZus{}tca2\PY{p}{[}\PY{p}{,}i\PY{p}{]}\PY{p}{,}col\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{forestgreen\PYZsq{}}\PY{p}{,}type\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{o\PYZsq{}}\PY{p}{)}
         \PY{p}{\PYZcb{}}
         mtext\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{RMSE for lasso / TCA\PYZdq{}}\PY{p}{,}side\PY{o}{=}\PY{l+m}{3}\PY{p}{,}adj\PY{o}{=}\PY{l+m}{\PYZhy{}1.8}\PY{p}{,}cex\PY{o}{=}\PY{l+m}{1}\PY{p}{,}line\PY{o}{=}\PY{l+m}{23.5}\PY{p}{,}font\PY{o}{=}\PY{l+m}{2}\PY{p}{)}
         par\PY{p}{(}mfrow\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{2}\PY{p}{,}\PY{l+m}{1}\PY{p}{)}\PY{p}{,}mar\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{0}\PY{p}{,}\PY{l+m}{0}\PY{p}{)}\PY{p}{)}
         plot\PY{p}{(}\PY{l+m}{1}\PY{p}{,}type\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{n\PYZsq{}}\PY{p}{,}axes\PY{o}{=}\PY{k+kc}{FALSE}\PY{p}{,}xlab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZsq{}}\PY{p}{,}ylab\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZsq{}}\PY{p}{)}
         legend\PY{p}{(}x\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{top\PYZsq{}}\PY{p}{,}inset\PY{o}{=}\PY{l+m}{0}\PY{p}{,}legend\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{lasso mdl1:SNPs+C1\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{lasso mdl2:C1\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{tca mdl1:SNPs+C1\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{tca mdl2:C1\PYZsq{}}\PY{p}{)}\PY{p}{,}
                col\PY{o}{=}\PY{k+kt}{c}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{red\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{green\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{firebrick\PYZsq{}}\PY{p}{,}\PY{l+s}{\PYZsq{}}\PY{l+s}{forestgreen\PYZsq{}}\PY{p}{)}\PY{p}{,}lwd\PY{o}{=}\PY{l+m}{1}\PY{p}{,}cex\PY{o}{=}\PY{l+m}{0.65}\PY{p}{,}horiz\PY{o}{=}\PY{k+kc}{TRUE}\PY{p}{)}
\end{Verbatim}


    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_23_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_23_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    

    % Add a bibliography block to the postdoc
    
    
    
    \end{document}
